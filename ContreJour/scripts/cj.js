var cj=cj||{};window.cj=cj,cj.version=cj.version||"1.6.3",cj.PRODUCTION=!0,cj.BUILDDATE="2016-12-01 8:31 PM",cj.offline=!1,cj.util=cj.util||{},cj.ctrl=cj.ctrl||{},cj.elem=cj.elem||{},cj.constants=cj.constants||{},function(t,e){function i(t){return'<tile><visual version="2">'+t.join("")+"</visual></tile>"}
function s(t,e){var i=h+t;return'<image id="'+(e+1)+'" src="'+i+'" />'}
function n(t,e){return'<text id="'+(e+1)+'">'+t+"</text>"}
function a(t,e){return t?Array.isArray(t)?t.map(e).join(""):e(t,0):""}
function o(t,e,i){var o='<binding template="'+t+'" branding="'+d+'">'+a(e,s)+a(i,n)+"</binding>";return o}
function r(t,e,s){window.external.msClearTile();var n=i([o("TileSquare150x150Image",t),o("TileWide310x150Image",e),o("TileSquare310x310Image",s)]),a=Date.now(),r=a,h=r+31536e6;window.external.msScheduledTileNotification(n,"notificationId-"+a,"notificationTag-"+a,r,h),c("update sent with start time: "+r),c(n)}
var h="https://yell0wsuit.github.io/html5-games/ContreJour/tiles/",l=[["tile-medium-01.jpg","tile-wide-01.jpg","tile-large-01.jpg"],["tile-medium-02.jpg","tile-wide-02.jpg","tile-large-02.jpg"],["tile-medium-03.jpg","tile-wide-03.jpg","tile-large-03.jpg"],["tile-medium-04.jpg","tile-wide-04.jpg","tile-large-04.jpg"],["tile-medium-05.jpg","tile-wide-05.jpg","tile-large-05.jpg"]],d="name",c=function(t){};e.util.updateTiles=function(){try{var t=0!==window.external.msPinnedSiteState();if(c("site pinned: "+t),t){var e=parseInt(localStorage.getItem("WindowsTileIndex"),10)||0;e=(e+1)%l.length;var i=l[e];r(i[0],i[1],i[2]),localStorage.setItem("WindowsTileIndex",e.toString())}}catch(s){c(s)}}}(jQuery,cj),function(t,e){function i(t,e){var i=D[t];return null==i?null==e?"":e:i}
function s(e,i,s){s||(s=t.location.href);var n=new RegExp("([?|&])"+e+"=.*?(&|#|$)","gi");if(s.match(n))return i?s.replace(n,"$1"+e+"="+i+"$2"):s.replace(n,"$2");if(i){var a=-1!==s.indexOf("?")?"&":"?",o=s.split("#");return s=o[0]+a+e+"="+i,o[1]&&(s+="#"+o[1]),s}
return s}
function n(t,e){var i,s=h(t),n=s.split(" "),a=r(n);if(e.indexOf(" ")>=0){var o=e.split(" ");r(o);for(var d=0;a>d;d++){var c=o.indexOf(n[d]);c>=0&&o.splice(c,1)}
o.length>0&&(i=o.join(" "))}else{for(var u=!1,d=0;a>d;d++)
if(n[d]===e){u=!0;break}u||(i=e)}
return i&&(a>0&&n[0].length>0?l(t,s+" "+i):l(t,i)),t}
function a(t,e){var i,s,n=h(t);if(e.indexOf(" ")>=0)i=e.split(" "),s=r(i);else{if(n.indexOf(e)<0)return t;i=[e],s=1}
for(var a,o=n.split(" "),d=r(o),c=d-1;c>=0;c--)i.indexOf(o[c])>=0&&(o.splice(c,1),a=!0);return a&&l(t,o.join(" ")),a===!0}
function o(t,e){for(var i=h(t),s=i.trim().split(" "),n=s.length,a=!1,o=0;n>o;o++)s[o]==e&&(a=!0);return a?l(t,s.reduce(function(t,i){return i==e?t:t&&t.length>0?t+" "+i:i},"")):n>0&&s[0].length>0?l(t,i+" "+e):l(t,i+e),t}
function r(t){for(var e=t.length,i=e-1;i>=0;i--)t[i]||(t.splice(i,1),e--);return e}
function h(t){var e=t.className||"";return"string"==typeof e?e:e.baseVal||""}
function l(t,e){var i=t.className||"";return"string"==typeof i?t.className=e:t.className.baseVal=e,t}
function d(t,e,i){var s="translate("+e+","+i+")";t.style.transform=s,t.style.WebkitTransform=s,t.style.msTransform=s,t.style.MozTransform=s}
function c(t,e,i,s){var n="scale("+e+","+i+")";t.style.transform=n,t.style.msTransform=n,t.style.WebkitTransform=n,t.style.MozTransform=n}
function u(t,e){t.style.transitionProperty=e,t.style.msTransitionProperty=e,t.style.WebkitTransitionProperty=e,t.style.oTransitionProperty=e}
function m(t,e){var i=e+"ms";t.style.transitionDuration=i,t.style.msTransitionDuration=i,t.style.MozTransitionDuration=i,t.style.WebkitTransitionDuration=i,t.style.oTransitionDuration=i}
function p(t,e){var i=e+"ms";t.style.transitionDelay=i,t.style.msTransitionDelay=i,t.style.MozTransitionDelay=i,t.style.WebkitTransitionDelay=i,t.style.oTransitionDelay=i}
function g(t,e){t.style.transitionTimingFunction=e,t.style.msTransitionTimingFunction=e,t.style.MozTransitionTimingFunction=e,t.style.WebkitTransitionTimingFunction=e,t.style.oTransitionTimingFunction=e}
function f(t,e){var i=S();t.addEventListener(i,e)}
function y(t,e){var i=S();t.removeEventListener(i,e)}
function v(t,e){var i=function(){e(),y(t,i)};f(t,i)}
function S(){var t,e=document.createElement("fakeelement"),i={transition:"transitionend",OTransition:"oTransitionEnd",MSTransition:"msTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in i)
if(void 0!==e.style[t])return i[t]}
function w(){for(var t,e=["transform","msTransform","WebkitTransform","MozTransform","oTransform"],i=document.createElement("fakeelement"),s=0;s<e.length;){if(t=e[s],void 0!==i.style[t])return t;s++}
return!1}
function M(e){var i=t.getComputedStyle(e,null),s=i[w()];return s&&"none"!==s||(s="matrix(1, 0, 0, 1, 0, 0)"),s}
function b(t){var e=t.split("(")[1];return e=e.split(")")[0],e=e.split(","),{a:parseFloat(e[0]),b:parseFloat(e[1]),c:parseFloat(e[2]),d:parseFloat(e[3]),e:parseFloat(e[4]),f:parseFloat(e[5])}}
function P(t){var e=M(t),i=b(e);return Math.sqrt(i.a*i.a+i.b*i.b)}
function C(t,e){t.x+=.025*(e.x-t.x),t.y+=.025*(e.y-t.y)}
function T(t,e,i){for(var s,n=document.styleSheets,a=0;a<n.length;a++)try{if(s=n[a].cssRules||n[a].rules)
for(var o=0;o<s.length;o++)s[o].selectorText===t&&(s[o].style[e]=i)}catch(r){}}
function E(t,i,s){t===e.constants.ROSE_WORLD_INDEX&&0==i?e.util.logEvent("Levels","Load","Final Level",s.totalScore()):e.util.logEvent("Levels","Load","Level "+(t+1)+" - "+i,s.totalScore()),0===t?1===i?(e.util.logEvent("http://view.atdmt.com/action/SMG_MRTINX_SITE_CJ_Chapter1_Play"),e.util.logMeteorEvent("hp_2"),e.util.logEvent("http://ace.adoftheyear.com/p13100/tagger_v02.php?project=p13100&tag=1a&channel=[sid=US_ContreJour_Tag_4_1d|cid=1004|]")):2===i?e.util.logEvent("http://ace.adoftheyear.com/p13100/tagger_v02.php?project=p13100&tag=1a&channel=[sid=US_ContreJour_Tag_5_1e|cid=1005|]"):3===i?e.util.logEvent("http://ace.adoftheyear.com/p13100/tagger_v02.php?project=p13100&tag=1a&channel=[sid=US_ContreJour_Tag_6_1f|cid=1006|]"):10===i&&e.util.logEvent("http://ace.adoftheyear.com/p13100/tagger_v02.php?project=p13100&tag=1a&channel=[sid=US_ContreJour_Tag_7_1g|cid=1007|]"):1===t&&1===i?(e.util.logEvent("http://view.atdmt.com/action/SMG_MRTINX_SITE_CJ_Chapter2_Play"),e.util.logMeteorEvent("hp_3")):2===t&&1===i&&(e.util.logEvent("http://view.atdmt.com/action/SMG_MRTINX_SITE_CJ_Chapter3_Play"),e.util.logMeteorEvent("hp_4"))}
function B(t){e.util.logEvent("http://view.atdmt.com/action/SMG_MRTINX_SITE_CJ_Share"),e.util.logMeteorEvent("hp_9_share"),e.util.logEvent("Share",t)}
function x(t){e.offline||"undefined"==typeof meteor||meteor.tracking.track_conversion("63e3041e-d303-48f8-b0ae-c12a34ebd1de",{name:t})}
function k(t){if(!e.offline){var i=new Image;i.src=t}}
function A(t){if(!e.offline){var i=document.createElement("script");i.type="text/javascript",i.src=t,document.getElementsByTagName("head")[0].appendChild(i)}}
function L(t){t+="";for(var e=t.split("."),i=e[0],s=e.length>1?"."+e[1]:"",n=/(\d+)(\d{3})/;n.test(i);)i=i.replace(n,"$1,$2");return i+s}
var D=function(){var t,e,i,s={},n=location.search.substring(1)||"",a=n.split("&"),o=function(t){return decodeURIComponent(t.replace(/\+/g," "))};for(t=0,e=a.length;e>t;t++)
if(i=a[t].split("="),i.length>0){var r=i[0],h=i.length>1?i[1]:"";s[o(r)]=o(h)}return s}();e.util.getQueryString=i,e.util.updateQueryString=s,e.util.addClass=n,e.util.removeClass=a,e.util.toggleClass=o,e.util.set2dTranslate=d,e.util.set2dScale=c,e.util.setTransitionProperty=u,e.util.setTransitionDuration=m,e.util.setTransitionDelay=p,e.util.setTransitionEasingFunction=g,e.util.addTransitionEndCallback=f,e.util.removeTransitionEndCallback=y,e.util.addRemoveTransitionEndCallback=v,e.util.getScaleProperty=P,e.util.easeToVec=C,e.util.ModifyClass=T,e.util.logLevelEvent=E,e.util.logMeteorEvent=x,e.util.logShareEvent=B,e.util.logEvent=k,e.util.logScriptEvent=A,e.util.formatNumber=L}(window,cj),function(t,e){function i(t){for(var e,i,s,n,a=[],o=t.split("\n"),r="",h=0;h<o.length;h++)
if(r=o[h],r&&r.length>1&&(i=r.split("="),2===i.length)){e=i[0].split('"'),s=e[1].trim(),e=i[1].trim(),e=e.substr(1,e.length-3);for(var l=e.length,d=0;l>d;d++)e[d],"\\"===e[d]&&'"'===e[d+1]&&(e=e.substr(0,d)+e.substr(d+1,e.length-1));n=e,s.length>0&&n.length>0&&(a[s]=n)}return a}
var s=[],n={currentLanguage:null,load:function(n,a){var o=this;if(o.currentLanguage=o.getBrowserLanguage(),a){for(var r=document.getElementById("languageSelect"),h=0;h<r.length;h++){var l=r[h];if(l.id==o.currentLanguage){l.selected=!0;break}}
r.addEventListener("change",function(){t.location.href=e.util.updateQueryString("lang",r.options[r.selectedIndex].value)});var d=document.getElementById("siteLanguage");d.addEventListener("click",function(){"hide"==r.className?(d.innerText=o.getFormatedLocalizedString("SITE_LANGUAGE",[""]),e.util.removeClass(r,"hide")):(d.innerText=o.getFormatedLocalizedString("SITE_LANGUAGE",[o.getLocalizedString("LANGUAGE")]),e.util.addClass(r,"hide"))})}
var c=new XMLHttpRequest;c.open("GET","strings/"+o.currentLanguage+".txt?v="+e.version,!1),c.onreadystatechange=function(){4===c.readyState&&(s[o.currentLanguage]=i(c.responseText),a&&(d.innerText=o.getFormatedLocalizedString("SITE_LANGUAGE",[o.getLocalizedString("LANGUAGE")])),n&&n())},c.send()},getLocalizedString:function(t){var e=s[this.currentLanguage][t];return e||""},getFormatedLocalizedString:function(t,e){var i=this.getLocalizedString(t),s=-1,n=null;do s=i.indexOf("%d"),n=e.shift(),s>=0&&(i=i.replace("%d",n));while(s>=0&&e.length>0);return i||""},isEnglish:function(){return"english"==this.currentLanguage},getFontSize:function(t){return this.isEnglish()?t:.85*t},getLanguagePrefix:function(){var i=e.util.getQueryString("lang",null);null!==i&&""!==i||(i=t.navigator.language||t.navigator.userLanguage||t.navigator.browserLanguage||t.navigator.systemLanguage||"en-us");var s=null;switch(i=i.substr(0,2)){case "fr":s="fr";break;case "de":s="de";break;case "ru":s="ru";break;case "pt":s="pt";break;case "es":s="es";break;case "zh":s="zh"}
return s},getModernBrowserLink:function(){var t=this.getLanguagePrefix();return null!==t?"ModernBrowser-"+t+".html":"ModernBrowser.html"},getUpgradeInternetExplorerLink:function(){var t=this.getLanguagePrefix();return null!==t?"UpgradeInternetExplorer-"+t+".html":"UpgradeInternetExplorer.html"},getBrowserLanguage:function(){var i=e.util.getQueryString("lang",null);switch(null!==i&&""!==i||(i=t.navigator.language||t.navigator.userLanguage||t.navigator.browserLanguage||t.navigator.systemLanguage||"en-us"),i=i.substr(0,2)){case "fr":return"french";case "de":return"german";case "ru":return"russian";case "pt":return"portuguese";case "es":return"spanish";case "zh":return"chinese_hans";default:return"english"}}};e.util.localizedStringLoader=n}(window,cj),function(t,e,i,s){if(!e.canvas)return void("Windows Vista"===i.OS?t.location=s.util.localizedStringLoader.getUpgradeInternetExplorerLink():"Windows 7"===i.OS?t.location=s.util.localizedStringLoader.getUpgradeInternetExplorerLink():t.location=s.util.localizedStringLoader.getModernBrowserLink());"Explorer"===i.browser&&i.version<9&&(t.location=s.util.localizedStringLoader.getUpgradeInternetExplorerLink());var n=null!=navigator.userAgent.match(/iPad/i),a=null!=navigator.userAgent.match(/Android/i),o=null!=navigator.userAgent.match(/Mobile/i);if(n){var r=document.querySelector("meta[name=viewport]");r.setAttribute("content","width=device-width; maximum-scale=.75; user-scalable=0;")}
if(a){var r=document.querySelector("meta[name=viewport]");r.setAttribute("content","width=device-width; maximum-scale=.55; user-scalable=0;")}
if(a&&o){var r=document.querySelector("meta[name=viewport]");r.setAttribute("content","width=device-width; maximum-scale=.35; user-scalable=0;")}}(window,Modernizr,BrowserDetect,cj),function(t){function e(){document.getElementById("surface").getContext("2d"),this.run=function(e){var i=new PxLoader({appVersion:t.version}),s=[];s.push(i.addImage("img/TitleMenuBg.jpg")),s.push(i.addImage("img/titleLightRay.png")),s.push(i.addImage("img/logoBig.png")),s.push(i.addImage("img/LoaderPlanetBg.png")),s.push(i.addImage("img/LoaderPlanetFg.png")),s.push(i.addImage("img/loaderEye.png")),s.push(i.addImage("img/loaderEyeBall.png")),i.addCompletionListener(function(){var i=document.getElementById("surface").getContext("2d"),n=16,a=33,o=0,r=0,h=0,l=0,d=0,c=function(){0===d?l=Date.now():(d=Date.now(),h=d-l,o+=h,r+=1,l=Date.now()),d=-1;for(var u=0;7>u;u++)
for(var m=0;m<s.length;m++)i.drawImage(s[m],0,0);for(var p=0,g=0;250>g;g++)p=2.4691358024691334;if(60>r)window.console&&window.console.log("Frame Result: "+h),window.requestAnimationFrame(c);else{var f=o/r;n>f?t.performance.result=t.performance.results.optimal:a>f?t.performance.result=t.performance.results.minimum:t.performance.result=t.performance.results.degraded,i.clearRect(0,0,i.canvas.width,i.canvas.height),e()}};c()}),i.start()},this.showResults=function(){t.performance.result===t.performance.results.degraded&&(document.getElementById("gameWarning").style.visibility="visible",document.getElementById("gameWarning").innerHTML=t.util.localizedStringLoader.getLocalizedString("PERFORMANCE_WARNING"))}}
t.performance={},t.util.performance=new e,t.performance.results={undecided:"Undecided",optimal:"Optimal",minimum:"Minimum",degraded:"Degraded"},t.performance.result=t.performance.results.undecided}(cj),function(t,e,i){var s=null;"undefined"!=typeof e.hidden?s="hidden":"undefined"!=typeof e.mozHidden?s="mozHidden":"undefined"!=typeof e.msHidden?s="msHidden":"undefined"!=typeof e.webkitHidden&&(s="webkitHidden");var n=!1;t.util.isBrowserHidden=function(){return s?e[s]:n},t.util.bindVisibilityChange=function(t){var s,a,o={hidden:"visibilitychange",mozHidden:"mozvisibilitychange",webkitHidden:"webkitvisibilitychange",msHidden:"msvisibilitychange",oHidden:"ovisibilitychange"};for(s in o)
if(o.hasOwnProperty(s)&&s in e){a=o[s];break}a?e.addEventListener(a,t):(i.onfocus=function(){n=!1,t()},i.onblur=function(){n=!0,t()})}}(cj,document,window),function(t,e,i,s,n){function a(t,e,s){this.tweenable=new i,this.duration=t,this.alpha=e,this.originalAlpha=e,this.targetAlpha=s}
function o(t,e){this.x=t,this.y=e}
function r(t,e,i,s){this.velX=(.5-Math.random())/2.5,this.velY=.1+Math.random(),this.velO=.001+.004*Math.random(),this.posY=i,this.opacity=.5+.5*Math.random(),this.posX=t+Math.random()*(e-t),this.scale=.45+.5*Math.random(),this.img=s,this.isActive=!0,this.update=function(){this.posX-=this.velX,this.posY-=this.velY,this.opacity-=this.velO,this.isActive=this.scale>.05&&this.opacity>.01&&this.posY>0},this.draw=function(t){if(this.isActive){var e=this.opacity;this.posY<50&&(e*=this.posY/50),t.save(),t.globalAlpha=e,t.translate(this.posX,this.posY),t.scale(this.scale,this.scale),t.drawImage(s,0,0),t.restore()}}}
function h(){var i=this;this.ready=!1,this.fakeMousePos=new o(Math.random()*t.innerWidth,Math.random()*t.innerHeight);var r=!1;this.fakeMouseIntervalId=t.setInterval(function(){r||(i.fakeMousePos=new o(Math.random()*t.innerWidth,Math.random()*t.innerHeight))},2e3);var h=function(t){r=!0,i.fakeMousePos.x=t.clientX,i.fakeMousePos.y=t.clientY};this.getMousePos=h,e.getElementById("loaderContainer").addEventListener("mousemove",h),this.preloader=new s({appVersion:n.version}),this.planetParticle=this.preloader.addImage("img/siteLoadingParticle.png"),this.particles=[],this.planetBg1=this.preloader.addImage("img/McPlanetVBackground1-hd.png"),this.planetBg2=this.preloader.addImage("img/McPlanetVBackground2-hd.png"),this.planetBg1Rotate=0,this.planetBg2Rotate=30,this.planetFg=this.preloader.addImage("img/LoaderPlanetFg.png"),this.onlyDrawPlanetBackground=!1,this.state=l.FLOATINGPLANET,this.loaderProgressContainer=e.getElementById("loaderProgressContainer"),this.faders={progress:new a(300,1,0)};var i=this;this.preloader.addCompletionListener(function(){i.ready=!0,i.show()}),this.preloader.start(),this.surfaceCanvas=e.getElementById("surface"),this.ctx=this.surfaceCanvas.getContext("2d"),this.loaderCanvas=e.getElementById("loaderCanvas"),this.loaderCtx=this.loaderCanvas.getContext("2d"),this.sineTimer=void 0,this.cw=t.innerWidth,this.ch=t.innerHeight,this.loaderPercent=0,this.loaderPercentTarget=0,this.loaderProgress=e.getElementById("loaderProgress"),this.isHibernationEnabled=!1}
var l={FLOATINGPLANET:0,FADEPROGRESSINDICATOR:1,FADINGPROGRESSINDICATOR:2,READY_TO_PLAY:3};a.prototype.fade=function(t,e){this.tweenable.tween({from:{alpha:this.originalAlpha},to:{alpha:this.targetAlpha},duration:this.duration,step:t,callback:e,easing:"easeOutSine"})},Array.prototype.remove=function(t,e){var i=this.slice((e||t)+1||this.length);return this.length=0>t?this.length+t:t,this.push.apply(this,i)},o.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},h.prototype.show=function(){var i=this;n.util.addClass(e.getElementById("loaderPanel"),"show"),e.getElementById("fader").style.opacity=.4,this.sineTimer=t.setInterval(function(){var t=Date.now();i.update(i.loaderCtx,t)},1e3/60)},h.prototype.hide=function(){e.getElementById("loaderPanel").style.opacity=0,n.util.removeClass(e.getElementById("loaderPanel"),"show"),t.clearInterval(this.sineTimer),e.getElementById("loaderContainer").removeEventListener("mousemove",this.getMousePos)},h.prototype.update=function(t,e){e=.002*e;var i=15*Math.sin(e),s=10*Math.cos(e);(isNaN(i)||isNaN(s))&&(i=15*Math.sin(.001*e),s=10*Math.cos(.001*e));var n=this.loaderPercentTarget-this.loaderPercent;n=0>=n?n>-10&&this.loaderPercentTarget<90?1:0:Math.min(n,5),this.loaderPercent+=n,this.loaderProgress.style.width=this.loaderPercent/100*90+"px";var a=this.fakeMousePos,h=new o(this.cw/2,this.ch/2);if(new o(a.x-h.x,a.y-h.y),this.planetBg1Rotate+=.35,this.planetBg2Rotate-=.65,t.clearRect(0,0,t.canvas.width,t.canvas.height),!this.isHibernationEnabled){if(this.ProcessState(),this.drawPlanet(t,i,s,this.onlyDrawPlanetBackground),0==this.particles.length)
for(;this.particles.length<20;)this.particles.push(new r(100,360,100+300*Math.random(),this.planetParticle));else if(this.particles.length>100)
for(var l=this.particles.length-1;l>=0;l--)this.particles[l].isActive||this.particles.remove(l);for(var d=0,l=0;l<this.particles.length;l++)this.particles[l].update(),this.particles[l].isActive&&d++;for(var l=d;80>l;l++)this.particles.push(new r(100,360,400,this.planetParticle))}},h.prototype.ProcessState=function(){switch(this.state){case l.FLOATINGPLANET:case l.FADINGPROGRESSINDICATOR:break;case l.FADEPROGRESSINDICATOR:var t,e=this;e.state=l.FADINGPROGRESSINDICATOR,this.faders.progress.fade(function(){e.loaderProgressContainer.style.opacity=this.alpha,t=e.loaderProgressContainer.childNodes;for(var i=0;i<t.length;i++)1===t[i].nodeType&&(t[i].style.opacity=this.alpha)},function(){e.loaderProgressContainer.style.opacity=this.alpha,t=e.loaderProgressContainer.childNodes;for(var i=0;i<t.length;i++)1===t[i].nodeType&&(t[i].style.opacity=this.alpha);e.state=l.READY_TO_PLAY,e.startGame(e)})}},h.prototype.drawPlanet=function(t,e,i,s){t.save(),t.scale(.99,.99);for(var a=0;a<this.particles.length;a++)this.particles[a].draw(t);t.save(),t.translate(t.canvas.width/2+e,t.canvas.height/2+(i-10)),t.rotate(n.util.Maths.toRadians(this.planetBg1Rotate)),t.scale(1.25,1.25),t.translate(this.planetBg1.width/-2,this.planetBg1.height/-2),t.drawImage(this.planetBg1,0,0),t.restore(),t.save(),t.translate(t.canvas.width/2+e,t.canvas.height/2+(i-10)),t.rotate(n.util.Maths.toRadians(this.planetBg2Rotate)),t.scale(1.25,1.25),t.translate(this.planetBg2.width/-2,this.planetBg2.height/-2),t.drawImage(this.planetBg2,0,0),t.restore(),t.drawImage(this.planetFg,(t.canvas.width-this.planetFg.width)/2+(e+10),(t.canvas.height-this.planetFg.height)/2+(i-10)),t.restore()},h.prototype.onLoadComplete=function(){var e=this;t.clearInterval(this.fakeMouseIntervalId),e.state=l.FADEPROGRESSINDICATOR};var d=!1;h.prototype.startGame=function(t){d||(n.util.logScriptEvent("http://view.atdmt.com/jaction/SMG_MRTINX_SITE_CJ_HP_Play"),n.util.logEvent("http://ace.adoftheyear.com/p13100/tagger_v02.php?project=p13100&tag=1a&channel=[sid=US_ContreJour_Tag_1_1a|cid=1001|]"),n.util.logMeteorEvent("hp_1"),d=!0,e.getElementById("fader").style.opacity=0,$("#container").addClass("show"),$("#gameFooter").addClass("show"),$("#gameHeader").addClass("show"),$("#sharePanel").addClass("show"),$("#shareCardPanel").addClass("show"),$("#vote-sxsw").addClass("show"),t.hide(),t.surfaceCanvas.style.backgroundColor="rgba(0,0,0,0)",e.body.removeChild(e.getElementById("loaderContainer")),n.util.removeClass(e.getElementById("menuContainer"),"noShow"),n.ctrl.game.Start())},h.prototype.startHibernation=function(){this.isHibernationEnabled=!0},h.prototype.stopHibernation=function(){this.isHibernationEnabled=!1},n.ctrl.loader=new h}(window,document,Tweenable,PxLoader,cj),function(t){function e(){this.enabled=!0,this.listeners=[]}
e.prototype.addListener=function(t,e){this.listeners.push({context:t,callback:e})},e.prototype.removeListener=function(t,e){for(var i=0;i<this.listeners.length;i++)
if(e===this.listeners[i].callback&&t===this.listeners[i].context){this.listeners.splice(i,1);break}},e.prototype.removeListeners=function(){this.listeners.length=0},e.prototype.sendEvent=function(t){if(this.enabled)
for(var e=this.listeners.length-1;e>=0;e--)this.listeners[e].callback.call(this.listeners[e].context,t)},t.util.EventSender=e}(cj),function(t){var e={shadeEdges:function(t,e,i){void 0===i&&(i=2),void 0===e&&(e=20);for(var s=t.getImageData(0,0,t.canvas.width,t.canvas.height),n=s.data,a=n.length,o=s.width,r=0,h=0,l=4*o,d=0;a>d;d+=4)
if(0===n[d]&&0!==n[d+3]){for(r=0,h=1;e>h;h++)
if(0===n[d-1+4*h]){r+=e-h;break}for(h=1;e>h;h++)
if(0===n[d+3-h*l]){r+=e-h;break}r>0&&(n[d]+=r*i,n[d+1]+=r*i,n[d+2]+=r*i)}t.putImageData(s,0,0)},createStrokeGradient:function(t,e,i,s,n){s=s||"rgb(0,0,0)";var a=t.createLinearGradient(0,0,0,t.canvas.height),o=n?Math.min(1,e/t.canvas.height):Math.min(.94,e/t.canvas.height);return a.addColorStop(Math.max(0,o-.06),i),a.addColorStop(Math.min(1,o+.06),s),a},shadePath:function(t,e,i,s,n,a,o,r,h){function l(t,e,i){return h&&h!=EasingType.Linear?t+(e-t)*Penner.easeIn(i,h):t+(e-t)*i}
for(var d=this.hexToR(a)/255,c=this.hexToG(a)/255,u=this.hexToB(a)/255,m=this.hexToR(o)/255,p=this.hexToG(o)/255,g=this.hexToB(o)/255,f=i/s,y=i;y>0;y-=f){t.lineWidth=y;var v=Math.floor(y*e)/255,S=Math.floor(255*l(m,d,v)),w=Math.floor(255*l(p,c,v)),M=Math.floor(255*l(g,u,v)),b="rgb("+S+","+w+","+M+")",P=this.createStrokeGradient(t,n,b,o,r);t.strokeStyle=P,t.stroke()}},shadePathSolidColorWithFade:function(t,e,i,s){e=void 0===e?1.3:e,i=void 0===i?30:i,s=void 0===s?5:s;for(var n=0,a=i/s,o=i;o>0;o-=a)n++,t.lineWidth=o,t.strokeStyle="rgba("+e+","+e+","+e+","+n/s+")",t.stroke()},hexToR:function(t){return parseInt(this.cutHex(t).substring(0,2),16)},hexToG:function(t){return parseInt(this.cutHex(t).substring(2,4),16)},hexToB:function(t){return parseInt(this.cutHex(t).substring(4,6),16)},cutHex:function(t){return"#"==t.charAt(0)?t.substring(1,7):t}};t.util.Shader=e}(cj),function(t,e,i){function s(t,e,i,s){t.save(),s&&(t.globalCompositeOperation=s),t.globalAlpha=i||1,t.drawImage(e,0,0),t.restore()}
function n(i,s,n){this.imgName=i;var a=e.util.assets.getImage(i,s||e.ctrl.game.theme);this.image=a.img,this.clipData=e.util.ClipFactory.getClipData(a.name),this.frame=0,this.anchorX=-this.clipData.anchor.x,this.anchorY=-(1-this.clipData.anchor.y),this.alpha=1,n&&(this.buffer=t.createElement("canvas"),this.buffer.width=this.image.width,this.buffer.height=this.image.height)}
function a(t,e,i){this.spriteName=t,this.sprite=new n(t,i),this.onAnimationEnd=null,this.loop=e,this.manual=!1,this.isAnimating=!1,this.isDrawing=!1,this.onCompletionShowNothing=!0,this.rewind=!1,this.minFrame=0,this.maxFrame=this.sprite.clipData.frames-1,this.speed=1,this.currentFrame=this.sprite.frame}
function o(){this.animations=[],this.randomAnimations=[],this.currentAnimation=null}
var r="arm"===navigator.cpuClass;n.prototype.changeTheme=function(t){var i=e.util.assets.getImage(this.imgName,t);this.image=i.img},n.prototype.draw=function(t,e,i){this.drawNoTransform(t,e.position.x,e.position.y,e.rotation,e.scale.x,e.scale.y,i)},n.prototype.drawWithTint=function(t,e,i){this.buffer.width=this.image.width,this.buffer.height=this.image.height;var n=this.buffer.getContext("2d");n.fillStyle=i.toString(),n.fillRect(0,0,this.buffer.width,this.buffer.height),s(n,this.image,1,"destination-atop"),this.drawBufferNoTransform(t,e.position.x,e.position.y,e.rotation,e.scale.x,e.scale.y)},n.prototype.drawNoTransform=function(t,e,i,s,n,a,o){this.drawImage(t,this.image,e,i,s,n,a,o,t.globalAlpha*this.alpha)},n.prototype.drawImage=function(t,i,s,n,a,o,h,l,d){if(!i)return void(e.PRODUCTION||"undefined"==typeof console||this.loggedImageProblem||(console.log("missing image:"),console.log(this.imgName),this.loggedImageProblem=!0));if(!(0>=d||0===o||0===h)){var c=0!==s||0!==n,u=0!==a,m=1!==o||1!==h,p=this.clipData.framesBounds[this.frame],g=p.width*this.anchorX,f=p.height*this.anchorY;u||m||(g+=s,f+=n,c=!1),t.save();var y=t.globalAlpha;if(d!==y&&(t.globalAlpha=d),e.ctrl.game.drawCount++,!r){var v=t.globalCompositeOperation;l&&l!==v&&(t.globalCompositeOperation=l)}
c&&t.translate(s,n),u&&t.rotate(a),m&&t.scale(o,h),t.drawImage(i,p.x,p.y,p.width,p.height,g,f,p.width,p.height),e.PRODUCTION||(!this.loggedImageProblem&&"undefined"!=typeof console&&(p.x+p.width>i.naturalWidth||p.y+p.height>i.naturalHeight)&&(console.log("exceeded image size: "+i.src),console.log("natural size, width: "+i.naturalWidth+" height:"+i.naturalHeight),this.loggedImageProblem=!0),this.drawRedBorder&&(t.strokeStyle="red",t.strokeRect(g,f,p.width,p.height))),t.restore()}},n.prototype.drawBufferNoTransform=function(t,e,i,s,n,a,o){this.drawImage(t,this.buffer,e,i,s,n,a,o,this.alpha)},n.prototype.drawToFit=function(t,e,i,s,n){t.save(),t.globalAlpha=this.alpha,t.translate(e,i),t.drawImage(this.image,e,i,s,n),t.restore()},a.prototype.update=function(t){if(this.isAnimating&&!this.manual){var e=this.rewind?-1:1,i=30*t.delta*this.speed*e;this.setCurrentFrame(this.currentFrame+i),(!this.rewind&&this.sprite.frame>=this.maxFrame||this.rewind&&this.sprite.frame<=this.minFrame)&&(this.loop||(this.onCompletionShowNothing?(this.setFrame(this.rewind?this.maxFrame:this.minFrame),this.isAnimating=!1,this.isDrawing=!1):(this.isAnimating=!1,this.isDrawing=!0)),this.onAnimationEnd&&this.onAnimationEnd(this.spriteName))}},a.prototype.draw=function(t,e){this.isDrawing&&this.sprite.draw(t,e)},a.prototype.changeTheme=function(t){this.sprite.changeTheme(t)},a.prototype.play=function(t){this.isAnimating=!0,this.isDrawing=!0,this.onAnimationEnd=t},a.prototype.pause=function(){this.isAnimating=!1},a.prototype.stop=function(){this.pause(),this.setFrame(this.rewind?this.maxFrame:this.minFrame),this.isAnimating=!1,this.isDrawing=!1,this.onAnimationEnd&&this.onAnimationEnd(this.spriteName)},a.prototype.isPlaying=function(){return this.isAnimating},a.prototype.getCurrentFrame=function(){return this.sprite.frame},a.prototype.setCurrentFrame=function(t){t<this.minFrame?this.setFrame(this.minFrame):t>this.maxFrame?this.setFrame(this.maxFrame):this.setFrame(t)},a.prototype.setMinFrame=function(t){this.minFrame=t?t:0,this.sprite.frame<this.minFrame&&this.setFrame(this.minFrame)},a.prototype.setMaxFrame=function(t){this.maxFrame=t?t:this.sprite.clipData.frames-1,this.sprite.frame>this.maxFrame&&this.setFrame(this.maxFrame)},a.prototype.setFrame=function(t){this.currentFrame=t,this.sprite.frame=0|t},a.prototype.setPersistent=function(){this.isDrawing=!0,this.onCompletionShowNothing=!1},o.prototype.add=function(t,e,i){this.animations[e]=t,i&&(this.randomAnimations[e]=t)},o.prototype.update=function(t){this.currentAnimation&&this.currentAnimation.update(t)},o.prototype.draw=function(t,e,i,s){this.currentAnimation&&this.currentAnimation.draw(t,e,i,s)},o.prototype.changeTheme=function(t){var e;for(e in this.animations)this.animations.hasOwnProperty(e)&&e.changeTheme(t);for(e in this.randomAnimations)this.randomAnimations.hasOwnProperty(e)&&e.changeTheme(t)},o.prototype.clear=function(){var t;for(t in this.animations)this.animations.hasOwnProperty(t)&&delete this.animations[t];for(t in this.randomAnimations)this.randomAnimations.hasOwnProperty(t)&&delete this.animations[t]},o.prototype.setAnimation=function(t,e,i){var s=this.animations[t],n=this.currentAnimation&&this.currentAnimation.isPlaying();!s||n&&!e||(n&&this.currentAnimation.stop(),this.currentAnimation=s,this.currentAnimation.play(i))},o.prototype.setRandomAnimation=function(t){var i,s,n=this.randomSize(),a=Math.floor(e.util.Maths.randRange(0,n)),o=0;for(i in this.randomAnimations)
if(this.randomAnimations.hasOwnProperty(i)){if(o===a){this.setAnimation(i,!1,t),s=i;break}
o+=1}return s},o.prototype.totalFrames=function(){return this.currentAnimation?this.currentAnimation.sprite.clipData.frames:-1},o.prototype.currentFrame=function(){return this.currentAnimation?this.currentAnimation.sprite.frame:-1},o.prototype.setCurrentFrame=function(t){this.currentAnimation&&(this.currentAnimation.sprite.frame=t)},o.prototype.setManualMode=function(t){this.currentAnimation&&(this.currentAnimation.manual=t)},o.prototype.size=function(){var t,e=0;for(t in this.animations)this.animations.hasOwnProperty(t)&&(e+=1);return e},o.prototype.randomSize=function(){var t,e=0;for(t in this.randomAnimations)this.randomAnimations.hasOwnProperty(t)&&(e+=1);return e},o.prototype.hasAnimations=function(){return this.size()>0},o.prototype.animationPlaying=function(){return this.currentAnimation?this.currentAnimation.isPlaying():!1},o.prototype.stopCurrentAnimation=function(){this.currentAnimation&&this.currentAnimation.stop()},e.util.Bitmap=n,e.util.BitmapAnimation=a,e.util.BitmapAnimationCollection=o}(document,cj),function(t,e){var i=t.Common.Math.b2Vec2,s={};s.transformConcat=function(t,e,i){i.scale.x=t.scale.x*e.scale.x,i.scale.y=t.scale.y*e.scale.y,i.rotation=t.rotation+e.rotation,i.position.x=t.position.x+e.position.x*t.scale.x,i.position.y=t.position.y+e.position.y*t.scale.y},s.transformContext=function(t,e){0===e.position.x&&0===e.position.y||t.translate(e.position.x,e.position.y),0!==e.rotation&&t.rotate(e.rotation),1===e.scale.x&&1===e.scale.y||t.scale(e.scale.x,e.scale.y)},s.PI2=function(){return Math.PI/2},s.PI4=function(){return s.PI2()/2},s.clamp=function(t,e,i){return Math.min(Math.max(t,e),i)},s.fuzzyEqual=function(t,e){return Math.abs(t-e)<.01},s.fuzzyNotEqual=function(t,e){return Math.abs(t-e)>.01},s.between=function(t,e,i){return t>e&&i>t},s.getSign=function(t){return 0>t?-1:t>0?1:0},s.easeInOutSine=function(t,e){return-e/2*(Math.cos(Math.PI*t)-1)},s.stepTo=function(t,e,i){return Math.abs(e-t)<=i?e:t+this.getSign(e-t)*i},s.randRange=function(t,e){return t+Math.random()*(e-t)},s.isFinite=function(t){return!isNaN(t)&&t!=Number.POSITIVE_INFINITY&&t!=Number.NEGATIVE_INFINITY},s.modP=function(t,e){var i=t%e;return 0>i&&(i+=e),i},s.remainderP=function(t,e){return t%e},s.simplifyAngleRadians=function(t,e){var i=t-e;return i=this.remainderP(i,2*Math.PI),0>i&&(i+=2*Math.PI),i+e},s.toDegrees=function(t){return 57.29577951308232*t},s.toRadians=function(t){return.017453292519943295*t},s.simplifyAngle=function(t,e){var i=t-e;return i=this.remainderP(t,360),0>i&&(i+=360),i+e},s.normalizeValue=function(t,e,i){return t=Math.max(t,e),t=Math.min(t,i)},s.addBezierPoints=function(t,i,n,a){for(var o=0,r=0;r<i.length-2;r+=2)o+=s.getBezierPoints(i[r],i[r+1],i[r+2],n,!1,t,a+o);return e.util.Box2dUtil.b2Vec2Copy(i[i.length-1],t[a+o]),o++,o},s.getBezierPoints=function(t,i,s,n,a,o,r){for(var h,l,d=0,c=null,u=0,m=0;n>m;m++)c=o[r+u],h=(1-d)*(1-d)*t.x+2*(1-d)*d*i.x+d*d*s.x,l=(1-d)*(1-d)*t.y+2*(1-d)*d*i.y+d*d*s.y,c.x=h,c.y=l,u++,d+=1/n;return a&&(e.util.Box2dUtil.b2Vec2Copy(s,o[r+u]),u++),u},s.lerp=function(t,e,i){return t+(e-t)*i},s.angleToNormalizedVector=function(t,e){e.x=Math.cos(t),e.y=Math.sin(t),e.Normalize()},s.angleToVector=function(t){return new i(Math.cos(t),Math.sin(t))},e.util=e.util||{},e.util.Maths=s}(Box2D,cj),function(t,e){var i={},s=t.Common.Math.b2Vec2,n=t.Collision.b2AABB,a=t.Dynamics.b2BodyDef,o=t.Dynamics.b2Body,r=t.Dynamics.b2FixtureDef,h=t.Dynamics.b2World,l=t.Collision.Shapes.b2MassData,d=t.Collision.Shapes.b2PolygonShape,c=t.Collision.Shapes.b2CircleShape,u=t.Dynamics.b2DebugDraw,m=t.Dynamics.Joints.b2MouseJointDef,p=t.Dynamics.Joints.b2DistanceJointDef,g=t.Dynamics.Joints.b2RevoluteJointDef,f=t.Collision.b2WorldManifold;i.defaultFriction=1,i.sizeMultiplier=1/30,i.operationVector=new s;var y=5*i.sizeMultiplier,v=.04,S=1.2;i.createWorld=function(t,e){var i=new h(new s(0,10),!0);return i.SetContinuousPhysics(!0),i},i.toggleDebugDraw=function(t,e,i){if(e){var s=new u;s.SetSprite(i.getContext("2d")),s.SetDrawScale(t._scale),s.SetFillAlpha(.3),s.SetLineThickness(1),s.SetFlags(u.e_shapeBit|u.e_jointBit),t.SetDebugDraw(s)}else e||(t.SetDebugDraw(null),i.getContext("2d").clearRect(0,0,2500,900))},i.updateWorld=function(t,e){var i=Math.min(e,v);t.Step(i*S,16,20),t.ClearForces()},i.createPolygon=function(t,e,i,n,r){var h,l;h=new a,h.type=r===!0?o.b2_staticBody:o.b2_dynamicBody;for(var c=[],u=0;u<n.length;u++){var m=new s;m.Set(n[u].x,n[u].y),c[u]=m}
return l.shape=new d,l.shape.SetAsArray(c,c.length),h.position.x=e,h.position.y=i,t.CreateBody(h).CreateFixture(l)},i.createBall=function(t,e,i,s,n){s=null==s?20:s;var h=new r;h.density=1,h.friction=.5,h.restitution=.2;var l=new a;return l.type=1==n?o.b2_staticBody:o.b2_dynamicBody,h.shape=new c(s),l.position.x=e,l.position.y=i,t.CreateBody(l).CreateFixture(h)},i.b2Vec2Copy=function(t,e){e.x=t.x,e.y=t.y},i.b2Vec2Add=function(t,e){return i.operationVector.x=t.x+e.x,i.operationVector.y=t.y+e.y,i.operationVector},i.b2Vec2AddRef=function(t,e,i){i.x=t.x+e.x,i.y=t.y+e.y},i.b2Vec2Subtract=function(t,e){return i.operationVector.x=t.x-e.x,i.operationVector.y=t.y-e.y,i.operationVector},i.b2Vec2SubtractRef=function(t,e,i){i.x=t.x-e.x,i.y=t.y-e.y},i.b2Vec2Segment=function(t,e){this.A=t,this.B=e},i.clampLength=function(t,e,s){var n=t.Length();return i.b2Vec2Copy(t,s),n>e&&s.Multiply(e/n),s},i.atan2Target=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},i.atan2Vec=function(t){return Math.atan2(t.y,t.x)},i.atan2VecDiff=function(t,e){return Math.atan2(e.y-t.y,e.x-t.x)},i.toVec=function(t,e,i){i.x=t*Math.cos(e),i.y=t*Math.sin(e)},i.stepToVec=function(t,e,s,n){var a=i.b2Vec2Subtract(e,t);if(a.LengthSquared()<s*s)n.x=e.x,n.y=e.y;else{var o=this.atan2Vec(a);this.toVec(s,o,a),a=i.b2Vec2Add(t,a),n.x=a.x,n.y=a.y}},i.b2Vec2Lerp=function(t,e,i,s){s.x=t.x+i*(e.x-t.x),s.y=t.y+i*(e.y-t.y)},i.b2Vec2Middle=function(t,e){return new s((t.x+e.x)/2,(t.y+e.y)/2)},i.b2Vec2Distance=function(t,e){return i.b2Vec2Subtract(t,e).Length()},i.b2Vec2ScalarMult=function(t,e){return t.x*e.x+t.y*e.y},i.b2Vec2FuzzyEqual=function(t,e){return Math.abs(t.x-e.x)<.01&&Math.abs(t.y-e.y)<.01},i.b2Vec2Equal=function(t,e){return t.x===e.x&&t.y===e.y},i.rotate=function(t,e,i){var s=Math.cos(e),n=Math.sin(e),a=t.x,o=t.y;i.x=t.x*s-o*n,i.y=t.y*s+a*n},i.rotateAround=function(e,i,s){var n=t.Common.Math.b2Math.SubtractVV(e,i);return this.rotate(n,s,n),n.Add(i),n},i.rotate90=function(t){var e=-t.x;return t.x=t.y,t.y=e,t},i.rotateMinus90=function(t){var e=t.x;return t.x=-t.y,t.y=e,t},i.getAngle=function(t,e){var s=i.b2Vec2Subtract(e,t);return Math.atan2(s.y,s.x)},i.getCenter=function(t,e,i){i.x=(t.x+e.x)/2,i.y=(t.y+e.y)/2},i.b2Vec2DistanceToSegment=function(e,i,s){var n=t.Common.Math.b2Math.SubtractVV(s,i),a=t.Common.Math.b2Math.SubtractVV(e,i),o=this.b2Vec2ScalarMult(a,n);if(0>=o)return this.b2Vec2Distance(e,i);var r=this.b2Vec2ScalarMult(n,n);return o>=r?this.b2Vec2Distance(e,s):this.b2Vec2DistanceToLine(e,i,s)},i.b2Vec2DistanceToLine=function(t,e,i){var s=t.x-e.x,n=t.y-i.y,a=i.x-e.x,o=i.y-e.y;return Math.abs(s*o-a*n)/Math.sin(a*a+o*o)},i.testSegmentsIntersect=function(t,e,i,s){return this.TestSegmentsIntersect(new this.b2Vec2Segment(t,e),new this.b2Vec2Segment(i,s))},i.testSegmentsIntersect=function(t,e){var i=(e.B.y-e.A.y)*(t.B.x-t.A.x)-(e.B.x-e.A.x)*(t.B.y-t.A.y);if(0===i)return!1;var s=(e.B.x-e.A.x)*(t.A.y-e.A.y)-(e.B.y-e.A.y)*(t.A.x-e.A.x),n=(t.B.x-t.A.x)*(t.A.y-e.A.y)-(t.B.y-t.A.y)*(t.A.x-e.A.x);return 1>=s/i&&s/i>=0&&1>=n/i&&n/i>=0},i.setMass=function(t,e){var i=new l;t.GetMassData(i),i.mass=e,t.SetMassData(i)},i.limitDistance=function(t,e,s,n){var a=i.b2Vec2Subtract(t,e),o=a.Length();s>o?i.b2Vec2Copy(t,n):(a.Multiply(s/o),a.Add(e),i.b2Vec2Copy(a,n))},i.limitSpeed=function(t,e){var i=t.GetLinearVelocity(),s=i.Length();s>e&&(i.Multiply(e/s),t.SetLinearVelocity(i))},i.stepTo=function(e,s,n){this.stepToVec(e.GetPosition(),s,n,i.operationVector),e.SetTransform(new t.Common.Math.b2Transform(i.operationVector,t.Common.Math.b2Mat22.FromAngle(e.GetAngle())))},i.setDensity=function(t,e){for(var i=t.GetFixtureList();i;i=i.GetNext())i.SetDensity(e);t.ResetMassData()},i.wakeUpJoined=function(t){for(var e=t.GetJointList();e;e=e.next)e.joint.GetBodyA().SetAwake(!0),e.joint.GetBodyB().SetAwake(!0)},i.applyAntigravity=function(t){var e=t.GetWorld().GetGravity().GetNegative();e.Multiply(t.GetMass()),t.ApplyForce(e,t.GetWorldCenter())},i.setGroup=function(t,e){var i=t.GetFixtureList().GetFilterData();i.groupIndex=e,this.setFilterData(t,i)},i.setFilterData=function(t,e){for(var i=t.GetFixtureList();i;i=i.GetNext())i.SetFilterData(e)},i.createLevelBorders=function(t,e){i.createBorder(t,new s(-e.x/2,0),new s(1.5*e.x,0),new s(0,y)),i.createBorder(t,new s(0,1.5*e.y),new s(0,-e.y/2),new s(-y,0)),i.createBorder(t,new s(e.x,1.5*e.y),new s(e.x,-e.y/2),new s(y,0))},i.createBorder=function(t,e,i,s){var n=new d,a=new r;a.shape=n;for(var o=0;2>o;o++)n.SetAsEdge(e,i),t.CreateFixture(a),e.Add(s),i.Add(s)},i.createRevoluteJoint=function(t,e,i,s,n){var a=new g;return a.Initialize(t,e,i),a.collideConnected=s,n&&(a.lowerAngle=0,a.upperAngle=0,a.enableLimit=!0),t.GetWorld().CreateJoint(a)},i.createMouseJoint=function(t,e,i,s){var n=new m;return n.bodyA=t.GetWorld().GetGroundBody(),n.bodyB=t,n.target.Set(e.x,e.y),n.collideConnected=!0,n.maxForce=i,n.frequency=s,n.bodyB.SetAwake(!0),t.GetWorld().CreateJoint(n)},i.createDistanceJoint=function(t,e,i,s,n){var a=new p;return a.Initialize(t,e,t.GetWorldCenter(),e.GetWorldCenter()),a.collideConnected=i,a.frequencyHz=s,a.dampingRatio=n,t.GetWorld().CreateJoint(a)},i.createDistanceJointWithAnchors=function(t,e,i,s,n,a,o){var r=new p;return r.Initialize(t,e,i,s),r.collideConnected=n,r.frequencyHz=a,r.dampingRatio=o,t.GetWorld().CreateJoint(r)},i.createDefFromJoint=function(t){var e=new g;return e.bodyA=t.GetBodyA(),e.bodyB=t.GetBodyB(),e.localAnchorA=e.bodyA.GetLocalPoint(t.GetAnchorA()),e.localAnchorB=e.bodyB.GetLocalPoint(t.GetAnchorB()),e},i.setSensor=function(t,e){for(var i=t.GetFixtureList();i;i=i.GetNext())i.SetSensor(e)},i.getVectorProjection=function(t,e){var i=this.b2Vec2ScalarMult(t,e),n=e.LengthSquared();return 0===n?new s(0,0):(i/=n,new s(i*e.x,i*e.y))},i.getProjection=function(t,e){return this.b2Vec2ScalarMult(t,e)/e.Length()},i.getWorldPoint=function(t){var e=new f;return t.GetWorldManifold(e),e.m_points[0]},i.isTouching=function(t){for(var e=t.GetContactList();e;){if(e.contact.IsTouching()&&!e.contact.GetFixtureA().IsSensor()&&!e.contact.GetFixtureB().IsSensor())return!0;e=e.next}
return!1},i.isTouchingOther=function(t,e){for(var i=t.GetContactList();i;){if(i.contact.IsTouching()&&i.other===e)return!0;i=i.next}
return!1},i.isSensor=function(t){return t.GetFixtureA().IsSensor()||t.GetFixtureB().IsSensor()},i.createCircle=function(t,e,i,s,n,a,o){var r=new c(e);return this.bodyFromShape(t,r,i,s,n,a,o)},i.createBoxByVertices=function(t,e,i,s,n,a,o){var r=new d;return r.SetAsArray(i,i.length),this.bodyFromShape(t,r,e,s,n,a,o)},i.createBoxBySize=function(t,e,i,s,n,a,o,r){var h=new d;return h.SetAsBox(i/2,s/2),this.bodyFromShape(t,h,e,n,a,o,r)},i.addShape=function(t,e,i){var s=new r;return s.shape=t,s.density=i,s.restitution=0,s.friction=this.defaultFriction,e.CreateFixture(s)},i.bodyFromShape=function(t,e,i,s,n,r,h){var l=new a;l.type=h?o.b2_dynamicBody:o.b2_staticBody,l.position=i,l.angle=s;var d=t.CreateBody(l),c=this.addShape(e,d,r);return c.SetSensor(n),d},i.raycast=function(t,e,i){var s=[];return t.RayCast(function(t,e,i,n){s.push(t)},e,i),s},i.queryPoint=function(t,e){var i=[],s=this.aabbFromPoint(e);return t.QueryAABB(function(t){i.push(t)},s),i},i.aabbFromPoint=function(t){return this.createAABB(t,this.sizeMultiplier,this.sizeMultiplier)},i.createAABB=function(e,i,a){var o=new n;return o.lowerBound=t.Common.Math.b2Math.SubtractVV(e,new s(i/2,a/2)),o.upperBound=t.Common.Math.b2Math.AddVV(e,new s(i/2,a/2)),o},i.moveBody=function(t,e,i,s){this.moveBodyWithRotation(t,e,t.GetAngle(),i,s)},i.moveBodyWithRotation=function(e,i,n,a,o){var r=1-a,h=t.Common.Math.b2Math.SubtractVV(i,e.GetPosition()),l=n-e.GetAngle(),d=new s(h.x,h.y);d.Multiply(r/o),h.Multiply(a),e.SetLinearVelocity(d),e.SetAngularVelocity(l*(r/o)),e.SetPositionAndAngle(t.Common.Math.b2Math.AddVV(e.GetPosition(),h),e.GetAngle()+l*a)},i.moveKinematicBody=function(e,i,s){var n=t.Common.Math.b2Math.SubtractVV(i,e.GetPosition());n.Multiply(1/s),e.SetLinearVelocity(n)},i.b2Vec2ToStr=function(t){return"["+t.x+", "+t.y+"]"},i.queryAABBFromRadiusByType=function(t,i,s,n){var a=[],o=e.util.Box2dUtil.queryAABBFromRadius(t,i,s);if(o.length>0)
for(var r,h=0;h<o.length;h++)r=o[h].GetBody().GetUserData(),r instanceof n&&a.push(r);return a},i.queryAABBFromRadius=function(t,e,i){var s=this.createAABB(e,2*i,2*i);return this.queryAABB(t,s)},i.queryAABB=function(t,e){var i=[];return t.QueryAABB(function(t){var e=t.GetBody(),s=(e.GetType(),e.GetUserData());return s&&i.push(t),!0},e),i},i.fixturesUnderPoint=function(t,e){for(var i=[],s=t.GetBodyList();s;s=s.next)
for(var n=s.GetFixtureList();n;n=n.GetNext())n.TestPoint(e)&&i.push(n);return i},i.getCrossPointStart1=function(t,e,i,n){var a=(e.y-t.y)*(i.x-n.x)-(i.y-n.y)*(e.x-t.x),o=(e.y-t.y)*(i.x-t.x)-(i.y-t.y)*(e.x-t.x),r=(i.y-t.y)*(i.x-n.x)-(i.y-n.y)*(i.x-t.x);if(0===a)return 0===o&&0===r?t:new s(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY);var h=r/a;return new s(t.x+(e.x-t.x)*h,t.y+(e.y-t.y)*h)},i.randomPoint=function(t,i){return new s(e.util.Maths.randRange(t.x,i.x),e.util.Maths.randRange(t.y,i.y))},e.util=e.util||{},e.util.Box2dUtil=i}(Box2D,cj),function(t,e){function i(t,e,i,s){this.r=t,this.g=e,this.b=i,this.a=s}
var s=t.Common.Math.b2Vec2,n=e.util.Box2dUtil;i.prototype.toString=function(){return"rgb("+this.r+","+this.g+","+this.b+")"},i.prototype.toAlphaString=function(){return"rgba("+this.r+","+this.g+","+this.b+","+this.a+")"},i.prototype.copy=function(t){this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a};var a={};a.colorLerp=function(t,i,s,n){n.r=e.util.Maths.lerp(t.r,i.r,s)+.5<<0,n.g=e.util.Maths.lerp(t.g,i.g,s)+.5<<0,n.b=e.util.Maths.lerp(t.b,i.b,s)+.5<<0,n.a=e.util.Maths.lerp(t.a,i.a,s)},a.ConvertToDrawPoint=function(t){return new s(30*t.x,30*t.y)},a.PointsPair=function(t,e){this.first=t?t:new s,this.second=e?e:new s},a.cachedOffset=new s,a.getPointsPair=function(t,e,i,s,o){a.cachedOffset.x=s.x-i.x,a.cachedOffset.y=s.y-i.y,n.rotate90(a.cachedOffset),a.cachedOffset.Normalize(),t.first.x=e.x,t.first.y=e.y,t.second.x=e.x,t.second.y=e.y,a.cachedOffset.Multiply(.5*o),t.first.Add(a.cachedOffset),a.cachedOffset.x=-a.cachedOffset.x,a.cachedOffset.y=-a.cachedOffset.y,t.second.Add(a.cachedOffset)},a.drawBezier=function(t,e,i){t.fillStyle=i,t.beginPath();var s,n,a=e[0].first;t.moveTo(a.x,a.y);for(var o=1;o<e.length;o+=2)s=e[o].first,n=e[o+1].first,t.quadraticCurveTo(s.x,s.y,n.x,n.y);t.lineTo(e[e.length-1].second.x,e[e.length-1].second.y);for(var o=e.length-2;o>0;o-=2)s=e[o].second,n=e[o-1].second,t.quadraticCurveTo(s.x,s.y,n.x,n.y);t.lineTo(a.x,a.y),t.closePath(),t.fill()},a.drawOffsetBezier=function(t,e,i){t.fillStyle=i,t.beginPath();var s,o,r,h=e[0].first;t.moveTo(h.x,h.y);for(var l=0,d=1;d<e.length;d+=2)s=.07,o=e[d],r=e[d+1],n.b2Vec2Lerp(o.first,o.second,s,a.offsetCtrl),n.b2Vec2Lerp(r.first,r.second,s,a.offsetAnchor),t.quadraticCurveTo(a.offsetCtrl.x,a.offsetCtrl.y,a.offsetAnchor.x,a.offsetAnchor.y),l++;n.b2Vec2Lerp(e[e.length-1].second,e[e.length-1].first,.1,a.offsetCtrl),t.lineTo(a.offsetCtrl.x,a.offsetCtrl.y),l=e.length/2;for(var d=e.length-2;d>0;d-=2)s=.05,o=e[d],r=e[d-1],n.b2Vec2Lerp(o.second,o.first,s,a.offsetCtrl),n.b2Vec2Lerp(r.second,r.first,s,a.offsetAnchor),t.quadraticCurveTo(a.offsetCtrl.x,a.offsetCtrl.y,a.offsetAnchor.x,a.offsetAnchor.y),l--;t.lineTo(h.x,h.y),t.closePath(),t.fill()},a.calculateColors=function(t,e,s){var o,r,h=[],l=[],d=0,c=0,u=new i;h.push(e.toString());for(var m=0,p=1;p<t.length;p+=2)o=t[p-1],r=t[p+1],n.getCenter(o.first,o.second,a.center),n.getCenter(r.first,r.second,a.center2),d=n.b2Vec2Distance(a.center,a.center2),c+=d,l.push(d);d=0;for(var p=0;p<l.length;p++)d+=l[p],m=d/c,a.colorLerp(e,s,m,u),h.push(u.toString());return h},a.calculateColorsTowardsCenter=function(t,e,s){var o,r,h,l,d,c=[],u=[],m=0,p=0,g=new i;for(c.push(e.toString()),l=1,d=t.length;d>l;l+=2)o=t[l-1],r=t[l+1],n.getCenter(o.first,o.second,a.center),n.getCenter(r.first,r.second,a.center2),m=n.b2Vec2Distance(a.center,a.center2),p+=m,u.push(m);var f=p/2;for(m=0,l=0,d=u.length;d>l;l++)m+=u[l],h=1-Math.abs(f-m)/f,a.colorLerp(e,s,h,g),c.push(g.toString());return c},a.drawSegmentsWithColors=function(t,e,i){var s,o,r,h,l,d;t.save();for(var c=0,u=1;u<e.length;u+=2)s=e[u-1],o=e[u],r=e[u+1],l=i[c],d=i[c+1],u>1&&(n.b2Vec2Lerp(s.first,e[u-2].first,.05,s.first),n.b2Vec2Lerp(s.second,e[u-2].second,.05,s.second)),n.getCenter(s.first,s.second,a.center),n.getCenter(r.first,r.second,a.center2),h=t.createLinearGradient(a.center.x,a.center.y,a.center2.x,a.center2.y),h.addColorStop(0,l),h.addColorStop(1,d),t.fillStyle=h,t.beginPath(),t.moveTo(s.first.x,s.first.y),t.quadraticCurveTo(o.first.x,o.first.y,r.first.x,r.first.y),t.lineTo(r.second.x,r.second.y),t.quadraticCurveTo(o.second.x,o.second.y,s.second.x,s.second.y),t.lineTo(s.first.x,s.first.y),t.closePath(),t.fill(),c++;t.restore()},a.drawSegmentsWithTexture=function(t,e,i,s,o){var r,h,l;a.drawBezier(t,e,o),t.save();for(var d=1;d<e.length-1;d+=2){r=e[d-1],h=e[d],l=e[d+1],d>1&&(n.b2Vec2Lerp(r.first,e[d-2].first,.05,r.first),n.b2Vec2Lerp(r.second,e[d-2].second,.05,r.second)),t.beginPath(),t.moveTo(r.first.x,r.first.y),t.quadraticCurveTo(h.first.x,h.first.y,l.first.x,l.first.y),t.lineTo(l.second.x,l.second.y),t.quadraticCurveTo(h.second.x,h.second.y,r.second.x,r.second.y),t.lineTo(r.first.x,r.first.y),t.closePath(),t.save(),i.frame=0,n.getCenter(r.first,r.second,a.center),n.getCenter(h.first,h.second,a.center2);var c=n.b2Vec2Subtract(a.center2,a.center),u=n.atan2Vec(c),m=c.Length()/16,p=n.b2Vec2Distance(h.first,h.second),g=(n.b2Vec2Distance(r.first,r.second)+p)/64;n.getCenter(a.center,a.center2,a.center),t.clip(),i.drawNoTransform(t,a.center.x,a.center.y,u,m,g),t.restore(),t.save(),i.frame=1,n.getCenter(l.first,l.second,a.center);var c=n.b2Vec2Subtract(a.center,a.center2),u=n.atan2Vec(c),m=c.Length()/16,g=(p+n.b2Vec2Distance(l.first,l.second))/64;n.getCenter(a.center,a.center2,a.center),t.clip(),i.drawNoTransform(t,a.center.x,a.center.y,u,m,g),t.restore()}
t.restore()},a.center=new s,a.center2=new s,a.offsetCtrl=new s,a.offsetAnchor=new s,e.util.Color=i,e.util.DrawUtil=a}(Box2D,cj),function(t){var e={NORMAL:"Normal",BLACKSIDE:"BlackSide",MACHINE:"Machine",WHITESIDE:"WhiteSide",VALENTINE:"Valentine"};e.all=[e.NORMAL,e.BLACKSIDE,e.MACHINE,e.WHITESIDE,e.VALENTINE];var i=function(t,i,s,n,a){this.keys={},t&&(this.keys[e.NORMAL]=t),i&&(this.keys[e.BLACKSIDE]=i),s&&(this.keys[e.MACHINE]=s),n&&(this.keys[e.WHITESIDE]=n),a&&(this.keys[e.VALENTINE]=a)};i.prototype.key=function(t){return this.keys[this.hasTheme(t)?t:e.NORMAL]},i.prototype.hasTheme=function(t){return t in this.keys},t.util.Theme=e,t.util.ThemedAsset=i}(cj),function(t,e,i){function s(t){this.levels=[],this.initial=c.LOCKED,this.theme=t||i.util.Theme.NORMAL}
function n(t,e,s){this.time=0,this.stars=i.PRODUCTION?0:3,this.score=0,this.levelDisplayNumber=t||0,this.levelNumber=e||0,this.state=i.PRODUCTION?s:c.UNLOCKED}
function a(t){t=t||{},this.version=t.version||i.version,this.perf=t.perf||0,this.config=t.config||new u,this.unlockedChapters=t.unlockedChapters||(i.PRODUCTION?0:4),this.openedMultiTouch=t.openedMultiTouch||!1,this.lastLevelOpen=t.lastLevelOpen||!i.PRODUCTION,this.settings=t.settings||{mutedTracks:!1,mutedEffects:!1,debug:!i.PRODUCTION},this.worlds=t.worlds,this.worlds&&!this.settings.debug||(this.worlds=[],this.worlds[0]=new s,this.worlds[0].levels=[new n(1,0,c.UNLOCKED),new n(2,1),new n(3,195),new n(4,171),new n(5,187),new n(6,174),new n(7,178),new n(8,181),new n(9,197),new n(10,184)],this.worlds[1]=new s(i.util.Theme.BLACKSIDE),this.worlds[1].levels=[new n(1,198,c.UNLOCKED),new n(2,175),new n(3,170),new n(4,186,c.LOCKED),new n(5,185),new n(6,173),new n(7,182),new n(8,192),new n(9,193),new n(10,191)]),this.worlds[2]&&this.worlds.length<5?(this.worlds[4]=this.worlds[2],this.worlds[2]=null):this.worlds[4]&&!this.settings.debug||(this.worlds[4]=new s(i.util.Theme.MACHINE),this.worlds[4].levels=[new n(1,18,c.UNLOCKED),new n(2,200),new n(3,86),new n(4,203),new n(5,83),new n(6,75),new n(7,51),new n(8,52),new n(9,204),new n(10,55)]),this.worlds[2]&&!this.settings.debug||(this.worlds[2]=new s(i.util.Theme.WHITESIDE),this.worlds[2].levels=[new n(1,98,c.UNLOCKED),new n(2,97),new n(3,96),new n(4,99),new n(5,100),new n(6,102),new n(7,105),new n(8,112),new n(9,113),new n(10,116)]),this.worlds[3]&&!this.settings.debug||(this.worlds[3]=new s(i.util.Theme.VALENTINE),this.worlds[3].levels=[new n(1,126,c.UNLOCKED),new n(2,127),new n(3,129),new n(4,131),new n(5,136),new n(6,138),new n(7,143),new n(8,137),new n(9,144),new n(10,142)])}
function o(){var i=t.localStorage.contrejour||new a;return i instanceof a||(i=new a(e.parse(i))),i}
function r(i){if(i){var s=e.stringify(i);return t.localStorage.contrejour=s,i}}
function h(){t.localStorage.contrejour=null}
var l=[0,10,20,30,40,0],d=50,c={LOCKED:"Locked",UNLOCKED:"Unlocked",COMPLETE:"Complete"},u=function(){this.os=void 0,this.browser=void 0,this.version=void 0,this.touch=void 0};a.prototype.endLevel=function(){return new n(0,169,c.UNLOCKED)},a.prototype.starsToUnlock=function(t){return l[t]},a.prototype.totalStars=function(){for(var t,e,i=0,s=0;s<this.worlds.length;s++){t=this.worlds[s];for(var n=0;n<t.levels.length;n++)e=t.levels[n],i+=e.stars}
return i},a.prototype.getChapterStars=function(t){for(var e=this.worlds[t],i=0,s=0;s<e.levels.length;s++){var n=e.levels[s];i+=n.stars}
return i},a.prototype.totalScore=function(){for(var t,e,i=0,s=0;s<this.worlds.length;s++){t=this.worlds[s];for(var n=0;n<t.levels.length;n++)e=t.levels[n],i+=e.score}
return i},a.prototype.getChapterScore=function(t){for(var e=this.worlds[t],i=0,s=0;s<e.levels.length;s++){var n=e.levels[s];i+=n.score}
return i},a.prototype.roseSaved=function(){return this.totalStars()>=d},i.util.LevelState=c,i.util.ReadUserData=o,i.util.WriteUserData=r,i.util.ClearUserData=h}(window,JSON,cj),function(t,e){function i(){this.lastTrack=null,this.currentlyMutedTracks=null,this.currentlyMutedEffects=null,this.lastMutedAt=0,this.isIPAD="iPad"===BrowserDetect.OS,this.playedMutedTrackAt=0}
i.prototype.playSoundEffect=function(t,i){this.currentlyMutedEffects||(e.util.GameSounds[t].volume=i>1?i/100:i,e.util.GameSounds[t].play())},i.prototype.playSoundTrack=function(i,s){var n=this;this.lastTrack!==e.util.GameSounds[i]&&(void 0!=this.lastTrack&&(this.lastTrack.pause(),function(){var e=n.lastTrack;t.setTimeout(function(){e.currentTime=0},1500)}()),this.lastTrack=e.util.GameSounds[i],this.currentlyMutedTracks?this.playedMutedTrackAt=Date.now():e.util.GameSounds[i].play())},i.prototype.muteTracks=function(t){if(t){for(var i=0;i<e.util.GameSoundsArray.length;i++)e.util.GameSoundsArray[i].isTrack===!0&&(e.util.GameSoundsArray[i].muted=!0,this.isIPAD&&e.util.GameSoundsArray[i].pause());this.lastMutedAt=Date.now()}else{for(var i=0;i<e.util.GameSoundsArray.length;i++)e.util.GameSoundsArray[i].muted=!1;if(0!==this.lastMutedAt&&!this.isIPAD)
if(0!==this.playedMutedTrackAt){var s=Date.now()-this.playedMutedTrackAt;this.lastTrack.currentTime=s%(1e3*this.lastTrack.duration)/1e3}else if(0===this.lastTrack.currentTime){var s=Date.now()-this.lastMutedAt;this.lastTrack.currentTime+=s%(1e3*this.lastTrack.duration)/1e3}
this.playedMutedTrackAt=0,this.lastMutedAt=0,this.lastTrack.play()}
this.updateMuteTrackUserData(t)},i.prototype.muteEffects=function(t){if(t)
for(var i=0;i<e.util.GameSoundsArray.length;i++)e.util.GameSoundsArray[i].isTrack===!1&&(e.util.GameSoundsArray[i].muted=!0);else for(var i=0;i<e.util.GameSoundsArray.length;i++)e.util.GameSoundsArray[i].isTrack===!1&&(e.util.GameSoundsArray[i].muted=!1);this.updateMuteEffectUserData(t)},i.prototype.isMutedTracks=function(){return null===this.currentlyMutedTracks&&(this.currentlyMutedTracks=this.getPersistedMuteTracksState()),this.currentlyMutedTracks},i.prototype.isMutedEffects=function(){return null===this.currentlyMutedEffects&&(this.currentlyMutedEffects=this.getPersistedMuteEffectsState()),this.currentlyMutedEffects},i.prototype.updateMuteTrackUserData=function(t){var i=e.util.ReadUserData();i.settings.mutedTracks=t,this.currentlyMutedTracks=t,e.util.WriteUserData(i)},i.prototype.updateMuteEffectUserData=function(t){var i=e.util.ReadUserData();i.settings.mutedEffects=t,this.currentlyMutedEffects=t,e.util.WriteUserData(i)},i.prototype.getPersistedMuteTracksState=function(){var t=e.util.ReadUserData();return t.settings.mutedTracks},i.prototype.getPersistedMuteEffectsState=function(){var t=e.util.ReadUserData();return t.settings.mutedEffects},e.util.soundController=new i}(window,cj),function(t,e,i){var s=[],n={GAMEIMAGE:"game-image",GAMESOUND:"game-sound",LEVELIMAGE:"level-image"},a={McMainMenuLogo:"McMainMenuLogo-hd",McMainMenuLogoBlue:"McMainMenuLogoBlue-hd",McMenuMonsterEye:"McEyeMonster-hd",McMenuMonsterEyeBall:"McEyeBallMonster-hd",McMenuGround:"McMenuGroundPhone-hd",McMenuGroundBlue:"McMenuGroundPhoneBlue-hd",McPlanetIELocked:"McChapterIELocked-hd",McPlanetLockedBackground:"McPlanetLocked-hd",McPlanetLockedBackgroundBlue:"McPlanetLockedBlue-hd",McChapterLockedBlur:"McChapterLockedBlur-hd",McChapterIELockedBlur:"McChapterIELockedBlur-hd",McBlackSmoke:"McSmokeBlack-hd",McPlanetTablo:"McPlanetTablo-hd",McPlanetTabloBlue:"McPlanetTabloBlue-hd",McEnergyIcon:"McEnergyIcon-hd",McLockIcon:"McLockIcon-hd",McLockIconBlue:"McLockIconBlue-hd",McChapter1Name:"McChapter1Name-hd",McChapter1Background:"McBackground4Content-hd",McPlanet1Background:"McPlanet1Background-hd",McPlanet1Foreground:"McPlanet1Foreground-hd",McChapter1Blur:"McChapter1Blur-hd",McMenuCircleSpikes:"McMenuCircleSpikes-hd",McPlanetRoseLight:"McPlanetRoseLight-hd",McRoseForeground:"McRoseForeground-hd",McPlanet1Eye:"McPlanetEye-hd",McPlanet1EyeBall:"McPlanet1EyeBall-hd",McPlanet1EyeBlink:"McPlanetEyeBlink-hd",McPlanet1EyeBlinkOneTime:"McPlanetEyeBlinkOneTime-hd",McPlanetSnotStart:"McFlowerHead-hd",McPlanetDevSnotStart:"McFlowerHeadBlue-hd",McChapter2Name:"McChapter2Name-hd",McChapter2Background:"McBackgroundContent1_5Blue-hd",McPlanet2Background:"McPlanet2Background-hd",McChapter2Blur:"McChapter2Blur-hd",McPlanetSpringView:"McPlanetSpringView-hd",McPlanetSpringBack:"McPlanetSpringBack-hd",McSatellite:"McSatellite-hd",McChapter3Name:"McChapter3Name-hd",McChapter3Background:"McMenuBackground3-hd",McPlanet3Background:"McPlanetIEBackground-hd",McPlanet3Foreground:"McPlanetIEForeground-hd",McChapter3Blur:"McChapterIEBlur-hd",McPlanet3BackgroundLight:"McPlanetIEBackgroundLight-hd",McPlanet3Gear1:"McPlanetIEGear1-hd",McPlanet3Gear2:"McPlanetIEGear2-hd",McPlanet3Gear3:"McPlanetIEGear3-hd",McPlanet3Gear4:"McPlanetIEGear4-hd",McPlanet3ForegroundParticle:"McPlanetIEForegroundParticle-hd",McPlanet3Particle:"McPlanetIEParticle-hd",McIeLockedSign:"McIELockedSign-hd",McPlanet4Background:"McPlanet4Background-hd",McPlanet4Shadow:"McPlanet4Shadow-hd",McPlanet4Spring0:"McPlanet4Spring0-hd",McPlanet4Spring1:"McPlanet4Spring1-hd",McChapter4Name:"McChapter4Name-hd",McChapter4Background:"McChapter4MenuBackground-hd",McChapter4Blur:"McChapter4Blur-hd",McPlanet4Locked:"McPlanet4Locked-hd",McEggView0:new i.util.ThemedAsset("McEggView0-hd",null,null,null,"McEggView0_7-hd"),McEggView1:new i.util.ThemedAsset("McEggView1-hd",null,null,null,"McEggView1_7-hd"),McEggView2:new i.util.ThemedAsset("McEggView2-hd",null,null,null,"McEggView2_7-hd"),McEggView3:new i.util.ThemedAsset("McEggView3-hd",null,null,null,"McEggView3_7-hd"),McEggBridgeView:new i.util.ThemedAsset("McEggBridgeView-hd",null,null,null,"McEggBridgeView_7-hd"),McPlanetVBackground:"McPlanetVBackground-hd",McPlanetVBackground1:"McPlanetVBackground1-hd",McPlanetVBackground2:"McPlanetVBackground2-hd",McChapterVBlur:"McChapterVBlur-hd",McPlanetVLocked:"McPlanetVLocked-hd",McChapter5Name:"McChapter5Name-hd",McChapter5Background:"McChapter5MenuBackground-hd",McRotatorBase:"McRotatorBase-hd",McBaloonGrassAll:"McBaloonGrassAll-hd",McBaloonLegs:"McBaloonLegs-hd",McBaloonTailEnd:"McBaloonTailEnd-hd",McChapterDevName:"McChapterDevName-hd",McPlanetDevBackground:"McPlanetDevBackground-hd",McPlanetDevForeground:"McPlanetDevForeground-hd",McChapterDevBlur:"McChapterDevBlur-hd",McPlanetDevSign:"McPlanetDevSign-hd",McPlanetDevBackRays:"McPlanetDevBackRays-hd",McPlanetDevLowerRightRays:"McPlanetDevLowerRightRays-hd",McPlanetDevUpperLeftRays:"McPlanetDevUpperLeftRays-hd",McPlanetDevUpperRightRays:"McPlanetDevUpperRightRays-hd",McPlanetDevParticles:"McPlanetDevParticles-hd",McPlanetDevBackLight:"McPlanetDevBackLight-hd",McDevSnotEye:"McEyeMonsterBlack-hd",McDevSnotEyeBall:"McEyeBallMonsterBlack-hd",McDevSnotEyeBlink:"McEyeBlinkMonsterBlack-hd",McDevSnotEyeBlinkOneTime:"McEyeBlinkOneTimeMonsterBlack-hd",McInspired:"McInspired-hd",McIntroLogo:"McIntroLogo-hd",McFinalRose:"McFinalRose-hd",McStebloAnimation:"McStebloAnimation-hd",McRoseHeadLight:"McRoseHeadLight-hd",McRoseHeadBack:"McRoseHeadBack-hd",McRoseHeadFront:"McRoseHeadFront-hd",McRoseHeadDown:"McRoseHeadDown-hd",McLystokMain:"McLystokMain-hd",McLystok1:"McLystok1-hd",McLystok2:"McLystok2-hd",McPuddle:"McPuddle-hd",McArrowView:"McArrowView-hd",McBackSnotEye:"McBackSnotEye-hd",McBackSnotBase:"McBackSnotBase-hd",McBackSnotEyeBall:"McBackSnotEyeBall-hd",McBackSnotEyeBlink:"McBackSnotEyeBlink-hd",McBackSnotEyeBlinkOneTime:"McBackSnotEyeBlinkOneTime-hd",McDust:new i.util.ThemedAsset("McDust-hd",null,null,"McDustWhite-hd"),McEnergyBall:"McEnergyBall-hd",McEye:new i.util.ThemedAsset("McEye-hd","McEyeBlack-hd",null,"McEyeBlack-hd"),McEyeAngry:new i.util.ThemedAsset("McEyeAngry-hd","McEyeAngryBlack-hd",null,"McEyeAngryBlack-hd"),McEyeBall:new i.util.ThemedAsset("McEyeBall-hd","McEyeBallBlack-hd",null,"McEyeBallWhite-hd"),McEyeBallHit:new i.util.ThemedAsset("McEyeBallHit-hd","McEyeBallHitBlack-hd",null,"McEyeBallHitWhite-hd"),McEyeBallMonster:new i.util.ThemedAsset("McEyeBallMonster-hd","McEyeBallMonsterBlack-hd",null,"McEyeBallMonsterWhite-hd"),McEyeBlink:new i.util.ThemedAsset("McEyeBlink-hd","McEyeBlinkBlack-hd",null,"McEyeBlinkBlack-hd"),McEyeBlinkOneTime:new i.util.ThemedAsset("McEyeBlinkOneTime-hd","McEyeBlinkOneTimeBlack-hd",null,"McEyeBlinkOneTimeBlack-hd"),McEyeBlinkMonster:new i.util.ThemedAsset("McEyeBlinkMonster-hd","McEyeBlinkMonsterBlack-hd",null,"McEyeBlinkOneTimeBlack-hd"),McEyeBlinkOneTimeMonster:new i.util.ThemedAsset("McEyeBlinkOneTimeMonster-hd","McEyeBlinkOneTimeMonsterBlack-hd",null,"McEyeBlinkOneTimeMonsterBlack-hd"),McEyeWink:new i.util.ThemedAsset("McEyeWink-hd","McEyeWinkBlack-hd",null,"McEyeWinkBlack-hd"),McEyeBlue:"McEyeBlue-hd",McEyeCloseMonster:new i.util.ThemedAsset("McEyeCloseMonster-hd","McEyeCloseMonsterBlack-hd",null,"McEyeCloseMonsterBlack-hd"),McEyeClose:new i.util.ThemedAsset("McEyeClose-hd","McEyeCloseBlack-hd",null,"McEyeCloseBlack-hd"),McEyeCloseSlow:new i.util.ThemedAsset("McEyeCloseSlow-hd","McEyeCloseSlowBlack-hd",null,"McEyeCloseSlowBlack-hd"),McEyeDead:new i.util.ThemedAsset("McEyeDead-hd","McEyeDeadBlack-hd",null,"McEyeDeadBlack-hd"),McEyeMonster:new i.util.ThemedAsset("McEyeMonster-hd","McEyeMonsterBlack-hd",null,"McEyeMonsterBlack-hd"),McEyeMonsterRed:"McEyeMonsterRed-hd",McEyeOpen:new i.util.ThemedAsset("McEyeOpen-hd","McEyeOpenBlack-hd",null,"McEyeOpenBlack-hd"),McEyeOpenMonster:new i.util.ThemedAsset("McEyeOpenMonster-hd","McEyeOpenMonsterBlack-hd",null,"McEyeOpenMonsterBlack-hd"),McEyeSleep:new i.util.ThemedAsset("McEyeSleep-hd","McEyeSleepBlack-hd",null,"McEyeSleepBlack-hd"),McEyeSmile:new i.util.ThemedAsset("McEyeSmile-hd","McEyeSmileBlack-hd",null,"McEyeSmileBlack-hd"),McFakeHeroBackground:new i.util.ThemedAsset("McFakeHeroBackground-hd","McFakeHeroBackgroundBlack-hd",null,"McFakeHeroBackgroundWhite-hd"),McFakeHeroEye:new i.util.ThemedAsset("McFakeHeroEye-hd","McFakeHeroEyeBlack-hd",null,"McFakeHeroEyeBlack-hd"),McFakeHeroEyeBall:new i.util.ThemedAsset("McFakeHeroEyeBall-hd","McFakeHeroEyeBallBlack-hd",null,"McFakeHeroEyeBallWhite-hd"),McFakeHeroEyeBlink:new i.util.ThemedAsset("McFakeHeroEyeBlink-hd","McFakeHeroEyeBlinkBlack-hd",null,"McFakeHeroEyeBlinkBlack-hd"),McFakeHeroEyeOpen:"McFakeHeroEyeOpen-hd",McFakeHeroEyeSmile:new i.util.ThemedAsset("McFakeHeroEyeSmile-hd","McFakeHeroEyeSmileBlack-hd",null,"McFakeHeroEyeSmileBlack-hd"),McFakeHeroHotspot:new i.util.ThemedAsset("McFakeHeroHotspot-hd","McFakeHeroHotspotBlack-hd",null,"McFakeHeroHotspotWhite-hd"),McFakeHeroShadow:new i.util.ThemedAsset("McFakeHeroShadow-hd","McFakeHeroShadowBlack-hd",null,"McFakeHeroShadowWhite-hd"),McImprovedResult:"McImprovedResult-hd",McFallParticle:new i.util.ThemedAsset("McFallParticle-hd",null,null,null,"McParticle_7-hd"),McSnowParticle:"McSnowParticle-hd",McFinishPart:"McFinishPart-hd",McFly:"McFly-hd",McGroundPart:new i.util.ThemedAsset("McGroundPart-hd","McGroundPartBlack-hd",null,"McGroundPartWhite-hd","McGroundPart_7-hd"),McHeroBackView:new i.util.ThemedAsset("McHeroBackView-hd","McHeroBlackView-hd",null,"McHeroWhiteView-hd"),McHeroShadow:new i.util.ThemedAsset("McHeroShadow-hd",null,null,"McHeroShadowWhite-hd"),McHighliteMenu:"McHeroHighliteMenu-hd",McHotspotwhite:"McHotspotwhite-hd",McSimpleSpikes:new i.util.ThemedAsset("McSimpleSpikesView-hd","McSimpleSpikesViewBlack-hd",null,"McSimpleSpikesViewWhite-hd"),McSnotEnd:new i.util.ThemedAsset("McSnotEnd-hd","McSnotEndBlack-hd",null,"McSnotEndWhite-hd"),McSnotEndHighlite:new i.util.ThemedAsset("McSnotEndHighlite-hd",null,null,null,"McSnotEndHighlite_7-hd"),McSnotStart:new i.util.ThemedAsset("McSnotStart-hd","McSnotStartBlack-hd",null,"McSnotStartWhite-hd"),McStrongSnotEnd:new i.util.ThemedAsset("McStrongSnotEnd-hd","McStrongSnotEndBlack-hd",null,"McStrongSnotEndWhite-hd","McStrongSnotEnd_7-hd"),McStrongSnotTexture:new i.util.ThemedAsset("strongSnotTexture-hd","blackStrongSnotTexture-hd",null,"whiteStrongSnotTexture-hd","strongSnotTexture_7-hd"),McStrongSnotTextureRed:"strongSnotTextureRed-hd",McTeleportPartBlack:"McTeleportPartBlack-hd",McTeleportPartBlue:"McTeleportPartBlue-hd",McTeleportPart:"McTeleportPart-hd",McTotalGrass:new i.util.ThemedAsset("McTotalGrass-hd",null,null,"McWhiteGrass-hd","McGrass_7-hd"),McTrampolineEnd:new i.util.ThemedAsset("McTrampolineEnd-hd","McTrampolineEndBlack-hd",null,"McTrampolineEndWhite-hd"),McTrampolinePath:new i.util.ThemedAsset("McTrampolinePath-hd","McTrampolinePathBlack-hd"),McWhiteSmoke:new i.util.ThemedAsset("McWhiteSmoke-hd","McWhiteSmokeBlack-hd"),McDragViewLimit:"McDragViewLimitWhite-hd",McKaktusView0:new i.util.ThemedAsset("McKaktusView0-hd","McKaktusView0Black-hd"),McKaktusView1:"McKaktusView1-hd",McKaktusView2:new i.util.ThemedAsset("McKaktusView2-hd","McKaktusView2Black-hd"),McKaktusView3:new i.util.ThemedAsset("McKaktusView3-hd","McKaktusView3Black-hd"),McKaktusView4:"McKaktusView4-hd",McLightView0:new i.util.ThemedAsset("McLightView0-hd"),McLightView1:new i.util.ThemedAsset("McLightView1-hd"),McLightView7:new i.util.ThemedAsset("McLightView7-hd"),McLightView11:new i.util.ThemedAsset("McLightView11-hd"),McLightView12:new i.util.ThemedAsset("McLightView12-hd"),McMultitouch2HintView:new i.util.ThemedAsset("McMultitouch2HintView-hd"),McPortal2HintView:new i.util.ThemedAsset("McPortal2HintView-hd"),McPortalHintView:new i.util.ThemedAsset("McPortalHintView-hd"),McRelsHintView:new i.util.ThemedAsset("McRelsHintView-hd",null,null,"McRelsHintView_7-hd"),McRoseView:new i.util.ThemedAsset("McRoseView-hd"),McShadowView0:new i.util.ThemedAsset("McShadowView0-hd"),McSlingshotHintView:new i.util.ThemedAsset("McSlingshotHintView-hd"),McSnotHintView:new i.util.ThemedAsset("McSnotHintView-hd"),McSnotReleaseHintView:new i.util.ThemedAsset("McSnotReleaseHintView-hd"),McSpringView:new i.util.ThemedAsset("McSpringView-hd","McSpringViewBlack-hd",null,"McSpringViewWhite-hd","McSpringView_7-hd"),McSpringShadow:new i.util.ThemedAsset("McSpringShadow-hd",null,null,"McSpringShadowWhite-hd","McSpringShadow_7-hd"),McStoneLongBlackView:new i.util.ThemedAsset("McStoneLongBlackView-hd"),McStoneLongView:new i.util.ThemedAsset("McStoneLongView-hd"),McStripesHintView:new i.util.ThemedAsset("McStripesHintView-hd"),McAmieHintView:new i.util.ThemedAsset("McAmieHintView-hd"),McBackgroundStoneView1:new i.util.ThemedAsset("McBackgroundStoneView1-hd","McBackgroundStoneView1Black-hd"),McBackgroundStoneView2:new i.util.ThemedAsset("McBackgroundStoneView2-hd","McBackgroundStoneView2Black-hd"),McDragSquareView:new i.util.ThemedAsset("McDragSquareView-hd",null,null,"McDragViewWhite-hd","McDragView_7-hd"),McRoundDragSquareView:new i.util.ThemedAsset("McRoundDragSquareView-hd",null,null,"McRoundDragViewWhite-hd","McRoundDragView_7-hd"),McRoundDragFrameView:new i.util.ThemedAsset("McRoundDragFrameView-hd",null,null,null,"McRoundDragFrameView_7-hd"),McEndLevelView:new i.util.ThemedAsset("McEndLevelView-hd"),McEnergyView:new i.util.ThemedAsset("McEnergyView-hd"),McGroundHintView:new i.util.ThemedAsset("McGroundHintView-hd"),McGroundHintMouseView:new i.util.ThemedAsset("McGroundHintMouseView-hd"),McSpikesView:new i.util.ThemedAsset("McSpikesView-hd",null,null,"McSpikesViewWhite-hd"),McSimpleSpikesView:new i.util.ThemedAsset("McSimpleSpikesViewBlack-hd","McSimpleSpikesView-hd",null,"McSimpleSpikesViewWhite-hd"),McCircleSpikesView:new i.util.ThemedAsset("McCircleSpikesViewBlack-hd","McCircleSpikesView-hd",null,"McCircleSpikesViewWhite-hd","McCircleSpikesView_7-hd"),McStoneShadow:"McStoneView3Black-hd",McStoneView1:new i.util.ThemedAsset("McStoneView1-hd"),McStoneView2:new i.util.ThemedAsset("McStoneView2-hd"),McStoneView3:new i.util.ThemedAsset("McStoneView3-hd"),McStoneView4:new i.util.ThemedAsset("McStoneView4-hd"),McStoneView5:new i.util.ThemedAsset("McStoneView5-hd"),McStoneView6:new i.util.ThemedAsset("McStoneView6-hd"),McStoneView7:new i.util.ThemedAsset("McStoneView7-hd"),McStoneView8:new i.util.ThemedAsset("McStoneView8-hd"),McBackground3_0Content:"McBackground3_0Content-hd.jpg",McBackground3_0Foreground:"McBackground3_0Foreground-hd.png",McBackground3_1Content:"McBackground3_1Content-hd.jpg",McBackground3_1Foreground:"McBackground3_1Foreground-hd.png",McBackground3_2Content:"McBackground3_2Content-hd.jpg",McBackground3_2Foreground:"McBackground3_2Foreground-hd.png",McBackground3_4Content:"McBackground3_4Content-hd.jpg",McBackground3_4Foreground:"McBackground3_4Foreground-hd.png",McBackground5Content:"McBackground5Content-hd.jpg",McBackgroundContent1_5:"McBackgroundContent1_5-hd.jpg",McBackgroundContent2_1:"McBackgroundContent2_1-hd.jpg",McBackgroundContent2_2:"McBackgroundContent2_2-hd.jpg",McBackgroundContent2_3:"McBackgroundContent2_3-hd.jpg",McBackgroundContent2_4:"McBackgroundContent2_4-hd.jpg",McBackgroundContent2_6:"McBackgroundContent2_6-hd.jpg",McBackgroundContent4_3:"McBackgroundContent4_3-hd.png",McBackgroundContent4_4:"McBackgroundContent4_4-hd.png",McBackgroundContent4_7:"McBackgroundContent4_7-hd.png",McBackgroundContent7_1:"McBackgroundContent7_1-hd.jpg",McBackgroundContent7_2:"McBackgroundContent7_2-hd.jpg",McBackgroundContent7_3:"McBackgroundContent7_3-hd.jpg",McBackgroundContent7_4:"McBackgroundContent7_4-hd.jpg",McBackgroundCrabContent:"McBackgroundCrabContent-hd.jpg",McBlackGround0:"McBlackGround0-hd.png",McBlackGround1:"McBlackGround1-hd.png",McShesternaBackground:"McShesternaBackground-hd.png",McShesternaBackgroundBlur:"McShesternaBackgroundBlur-hd.png",McShesternaOut:"McShesternaOut-hd.png",McEndRose:"McEndRose-hd",McEndRoseBlack:"McEndRoseBlack-hd",McTear:"McTear-hd"},o={};o.tracks={chapter1:"chapter1",chapter2:"chapter2",chapter3:"chapter3",chapter4:"chapter4",chapter5:"chapter5",menu:"menu"},o.allTracks=[o.tracks.chapter1,o.tracks.chapter2,o.tracks.chapter3,o.tracks.chapter4,o.tracks.chapter5],o.effects={angry2:"angry2",backgroundEyeHit0:"backgroundEyeHit0",begin5:"begin5",bonus5:"bonus5",bonus6:"bonus6",bonus7:"bonus7",breathIn4:"breathIn4",click:"click",clip0:"clip0",clip1:"clip1",deathByFall2:"deathByFall2",deathByFlowerOut10:"deathByFlowerOut10",deathByFlowerOut4:"deathByFlowerOut4",deathBySpikes5:"deathBySpikes5",end:"end",landing1:"landing1",landing3:"landing3",laugh0:"laugh0",laugh1:"laugh1",laugh3:"laugh3",leapOn1:"leapOn1",leapOn2:"leapOn2",leapOn3:"leapOn3",newClip:"newClip",newClip1:"newClip1",perdelkaOut0:"perdelkaOut0",perdelkaOutEmpty1:"perdelkaOutEmpty1",petitkoIsHoping:"petitkoIsHoping",petitkoIsTrying:"petitkoIsTrying",rope2:"rope2",rope3:"rope3",rope5:"rope5",saddness:"saddness",sleeping0:"sleeping0",suspicious0:"suspicious0",suspicious1:"suspicious1",suspicious3:"suspicious3",teleport:"teleport",teleport2:"teleport2"},o.bonus=[o.effects.bonus5,o.effects.bonus6,o.effects.bonus7],o.leapOut=[o.effects.leapOn2,o.effects.leapOn3,o.effects.newClip1],o.leapOn=[o.effects.leapOn1,o.effects.newClip],o.ropeOn=[o.effects.rope2,o.effects.rope3,o.effects.rope5],o.backSnot=[o.effects.newClip,o.effects.newClip1],o.laughs=[o.effects.laugh0,o.effects.laugh1,o.effects.laugh3],o.suspicious=[o.effects.suspicious0,o.effects.suspicious1,o.effects.suspicious3],o.sleeping=[o.effects.sleeping0],o.random=function(t){return t&&t instanceof Array?t[Math.round(i.util.Maths.randRange(0,t.length-1))]:void 0};var r=function(t){this.loader=new e({appVersion:i.version}),this.expendableImages=[],this.images={},this.gameelements=0,this.levelelements=0,this.logging=t===!0,this.imgDir="img/",this.imgExt=".png",this.xmlDir="elements/",this.xmlExt=".xml"};r.prototype.initializeGameSounds=function(t,e){this.loader&&(t?(this.addGameSounds(o.tracks.chapter1,"sound/tracks/"+e+"/chapter1."+e,!0),this.addGameSounds(o.tracks.chapter2,"sound/tracks/"+e+"/chapter2."+e,!0),this.addGameSounds(o.tracks.chapter3,"sound/tracks/"+e+"/chapter3."+e,!0),this.addGameSounds(o.tracks.chapter4,"sound/tracks/"+e+"/chapter4."+e,!0),this.addGameSounds(o.tracks.chapter5,"sound/tracks/"+e+"/chapter5."+e,!0),this.addGameSounds(o.tracks.menu,"sound/tracks/"+e+"/menu."+e,!0)):(this.addGameSounds(o.effects.angry2,"sound/effects/"+e+"/angry2."+e),this.addGameSounds(o.effects.backgroundEyeHit0,"sound/effects/"+e+"/backgroundEyeHit0."+e),this.addGameSounds(o.effects.begin5,"sound/effects/"+e+"/begin5."+e),this.addGameSounds(o.effects.bonus5,"sound/effects/"+e+"/bonus5."+e),this.addGameSounds(o.effects.bonus6,"sound/effects/"+e+"/bonus6."+e),this.addGameSounds(o.effects.bonus7,"sound/effects/"+e+"/bonus7."+e),this.addGameSounds(o.effects.breathIn4,"sound/effects/"+e+"/breathIn4."+e),this.addGameSounds(o.effects.click,"sound/effects/"+e+"/click."+e),this.addGameSounds(o.effects.clip0,"sound/effects/"+e+"/clip0."+e),this.addGameSounds(o.effects.clip1,"sound/effects/"+e+"/clip1."+e),this.addGameSounds(o.effects.deathByFall2,"sound/effects/"+e+"/deathByFall2."+e),this.addGameSounds(o.effects.deathByFlowerOut10,"sound/effects/"+e+"/deathByFlowerOut10."+e),this.addGameSounds(o.effects.deathByFlowerOut4,"sound/effects/"+e+"/deathByFlowerOut4."+e),this.addGameSounds(o.effects.deathBySpikes5,"sound/effects/"+e+"/deathBySpikes5."+e),this.addGameSounds(o.effects.end,"sound/effects/"+e+"/end."+e),this.addGameSounds(o.effects.landing1,"sound/effects/"+e+"/landing1."+e),this.addGameSounds(o.effects.landing3,"sound/effects/"+e+"/landing3."+e),this.addGameSounds(o.effects.laugh0,"sound/effects/"+e+"/laugh0."+e),this.addGameSounds(o.effects.laugh1,"sound/effects/"+e+"/laugh1."+e),this.addGameSounds(o.effects.laugh3,"sound/effects/"+e+"/laugh3."+e),this.addGameSounds(o.effects.leapOn1,"sound/effects/"+e+"/leapOn1."+e),this.addGameSounds(o.effects.leapOn2,"sound/effects/"+e+"/leapOn2."+e),this.addGameSounds(o.effects.leapOn3,"sound/effects/"+e+"/leapOn3."+e),this.addGameSounds(o.effects.newClip,"sound/effects/"+e+"/newClip."+e),this.addGameSounds(o.effects.newClip1,"sound/effects/"+e+"/newClip1."+e),this.addGameSounds(o.effects.perdelkaOut0,"sound/effects/"+e+"/perdelkaOut0."+e),this.addGameSounds(o.effects.perdelkaOutEmpty1,"sound/effects/"+e+"/perdelkaOutEmpty1."+e),this.addGameSounds(o.effects.petitkoIsHoping,"sound/effects/"+e+"/petitkoIsHoping."+e),this.addGameSounds(o.effects.petitkoIsTrying,"sound/effects/"+e+"/petitkoIsTrying."+e),this.addGameSounds(o.effects.rope2,"sound/effects/"+e+"/rope2."+e),this.addGameSounds(o.effects.rope3,"sound/effects/"+e+"/rope3."+e),this.addGameSounds(o.effects.rope5,"sound/effects/"+e+"/rope5."+e),this.addGameSounds(o.effects.saddness,"sound/effects/"+e+"/saddness."+e),this.addGameSounds(o.effects.sleeping0,"sound/effects/"+e+"/sleeping0."+e),this.addGameSounds(o.effects.suspicious0,"sound/effects/"+e+"/suspicious0."+e),this.addGameSounds(o.effects.suspicious1,"sound/effects/"+e+"/suspicious1."+e),this.addGameSounds(o.effects.suspicious3,"sound/effects/"+e+"/suspicious3."+e),this.addGameSounds(o.effects.teleport,"sound/effects/"+e+"/teleport."+e),this.addGameSounds(o.effects.teleport2,"sound/effects/"+e+"/teleport."+e)))},r.prototype.initializeGameImages=function(){this.loader&&(this.addGameImages(a.McMainMenuLogo),this.addGameImages(a.McMainMenuLogoBlue),this.addGameImages(a.McMenuMonsterEye),this.addGameImages(a.McMenuMonsterEyeBall),this.addGameImages(a.McMenuGround),this.addGameImages(a.McMenuGroundBlue),this.addGameImages(a.McPlanetLockedBackground),this.addGameImages(a.McPlanetLockedBackgroundBlue),this.addGameImages(a.McPlanetIELocked),this.addGameImages(a.McPlanetTablo),this.addGameImages(a.McPlanetTabloBlue),this.addGameImages(a.McEnergyIcon),this.addGameImages(a.McLockIcon),this.addGameImages(a.McLockIconBlue),this.addGameImages(a.McChapterLockedBlur),this.addGameImages(a.McChapterIELockedBlur),this.addGameImages(a.McBlackSmoke),this.addGameImages(a.McChapter1Name),this.addGameImages(a.McChapter1Background),this.addGameImages(a.McPlanet1Background),this.addGameImages(a.McPlanet1Foreground),this.addGameImages(a.McChapter1Blur),this.addGameImages(a.McMenuCircleSpikes),this.addGameImages(a.McPlanetRoseLight),this.addGameImages(a.McRoseForeground),this.addGameImages(a.McPlanet1Eye),this.addGameImages(a.McPlanet1EyeBall),this.addGameImages(a.McPlanet1EyeBlink),this.addGameImages(a.McPlanet1EyeBlinkOneTime),this.addGameImages(a.McPlanetSnotStart),this.addGameImages(a.McPlanetDevSnotStart),this.addGameImages(a.McChapter2Name),this.addGameImages(a.McChapter2Background),this.addGameImages(a.McPlanet2Background),this.addGameImages(a.McChapter2Blur),this.addGameImages(a.McPlanetSpringView),this.addGameImages(a.McPlanetSpringBack),this.addGameImages(a.McSatellite),this.addGameImages(a.McChapter3Name),this.addGameImages(a.McChapter3Background),this.addGameImages(a.McPlanet3Background),this.addGameImages(a.McPlanet3Foreground),this.addGameImages(a.McPlanet3BackgroundLight),this.addGameImages(a.McPlanet3Gear1),this.addGameImages(a.McPlanet3Gear2),this.addGameImages(a.McPlanet3Gear3),this.addGameImages(a.McPlanet3Gear4),this.addGameImages(a.McPlanet3ForegroundParticle),this.addGameImages(a.McPlanet3Particle),this.addGameImages(a.McIeLockedSign),this.addGameImages(a.McChapter3Blur),this.addGameImages(a.McChapterDevName),this.addGameImages(a.McPlanetDevBackground),this.addGameImages(a.McPlanetDevForeground),this.addGameImages(a.McChapterDevBlur),this.addGameImages(a.McPlanetDevSign),this.addGameImages(a.McPlanetDevBackRays),this.addGameImages(a.McPlanetDevLowerRightRays),this.addGameImages(a.McPlanetDevUpperLeftRays),this.addGameImages(a.McPlanetDevUpperRightRays),this.addGameImages(a.McPlanetDevBackLight),this.addGameImages(a.McPlanetDevParticles),this.addGameImages(a.McDevSnotEyeBall),this.addGameImages(a.McDevSnotEye),this.addGameImages(a.McDevSnotEyeBlink),this.addGameImages(a.McDevSnotEyeBlinkOneTime),this.addGameImages(a.McInspired),this.addGameImages(a.McIntroLogo),this.addGameImages(a.McFinalRose),this.addGameImages(a.McStebloAnimation),this.addGameImages(a.McRoseHeadLight),this.addGameImages(a.McRoseHeadBack),this.addGameImages(a.McRoseHeadFront),this.addGameImages(a.McRoseHeadDown),this.addGameImages(a.McLystokMain),this.addGameImages(a.McLystok1),this.addGameImages(a.McLystok2),this.addGameImages(a.McPuddle),this.addGameImages(a.McArrowView),this.addGameImages(a.McBackSnotEye),this.addGameImages(a.McBackSnotBase),this.addGameImages(a.McBackSnotEyeBall),this.addGameImages(a.McBackSnotEyeBlink),this.addGameImages(a.McBackSnotEyeBlinkOneTime),this.addGameImages(a.McDust),this.addGameImages(a.McEnergyBall),this.addGameImages(a.McEye),this.addGameImages(a.McEyeAngry),this.addGameImages(a.McEyeBall),this.addGameImages(a.McEyeBallHit),this.addGameImages(a.McEyeBallMonster),this.addGameImages(a.McEyeBlink),this.addGameImages(a.McEyeBlinkOneTime),this.addGameImages(a.McEyeBlinkMonster),this.addGameImages(a.McEyeBlinkOneTimeMonster),this.addGameImages(a.McEyeWink),this.addGameImages(a.McEyeBlue),this.addGameImages(a.McEyeCloseMonster),this.addGameImages(a.McEyeClose),this.addGameImages(a.McEyeCloseSlow),this.addGameImages(a.McEyeDead),this.addGameImages(a.McEyeMonster),this.addGameImages(a.McEyeMonsterRed),this.addGameImages(a.McEyeOpen),this.addGameImages(a.McEyeOpenMonster),this.addGameImages(a.McEyeSleep),this.addGameImages(a.McEyeSmile),this.addGameImages(a.McFakeHeroBackground),this.addGameImages(a.McFakeHeroEye),this.addGameImages(a.McFakeHeroEyeBall),this.addGameImages(a.McFakeHeroEyeBlink),this.addGameImages(a.McFakeHeroEyeOpen),this.addGameImages(a.McFakeHeroEyeSmile),this.addGameImages(a.McFakeHeroHotspot),this.addGameImages(a.McFakeHeroShadow),this.addGameImages(a.McImprovedResult),this.addGameImages(a.McFallParticle),this.addGameImages(a.McSnowParticle),this.addGameImages(a.McFinishPart),this.addGameImages(a.McFly),this.addGameImages(a.McGroundPart),this.addGameImages(a.McHeroBackView),this.addGameImages(a.McHeroShadow),this.addGameImages(a.McHighliteMenu),this.addGameImages(a.McHotspotwhite),this.addGameImages(a.McSimpleSpikes),this.addGameImages(a.McSnotEnd),this.addGameImages(a.McSnotEndHighlite),this.addGameImages(a.McSnotStart),this.addGameImages(a.McSpringShadow),this.addGameImages(a.McStrongSnotEnd),this.addGameImages(a.McStrongSnotTexture),this.addGameImages(a.McStrongSnotTextureRed),this.addGameImages(a.McTeleportPartBlack),this.addGameImages(a.McTeleportPartBlue),this.addGameImages(a.McTeleportPart),this.addGameImages(a.McTotalGrass),this.addGameImages(a.McTrampolinePath),this.addGameImages(a.McTrampolineEnd),this.addGameImages(a.McWhiteSmoke),this.addGameImages(a.McDragViewLimit),this.addGameBackground(a.McBackground3_0Content),this.addGameBackground(a.McBackground3_0Foreground),this.addGameBackground(a.McBackground3_1Content),this.addGameBackground(a.McBackground3_1Foreground),this.addGameBackground(a.McBackground3_2Content),this.addGameBackground(a.McBackground3_2Foreground),this.addGameBackground(a.McBackground3_4Content),this.addGameBackground(a.McBackground3_4Foreground),this.addGameBackground(a.McBackground5Content),this.addGameBackground(a.McBackgroundContent1_5),this.addGameBackground(a.McBackgroundContent2_1),this.addGameBackground(a.McBackgroundContent2_2),this.addGameBackground(a.McBackgroundContent2_3),this.addGameBackground(a.McBackgroundContent2_4),this.addGameBackground(a.McBackgroundContent2_6),this.addGameBackground(a.McBackgroundCrabContent),this.addGameBackground(a.McBlackGround0),this.addGameBackground(a.McBlackGround1),this.addGameBackground(a.McShesternaBackground),this.addGameBackground(a.McShesternaBackgroundBlur),this.addGameBackground(a.McShesternaOut),this.addGameImages(a.McBackgroundStoneView1),this.addGameImages(a.McBackgroundStoneView2),this.addGameImages(a.McCircleSpikesView),this.addGameImages(a.McDragSquareView),this.addGameImages(a.McEndLevelView),this.addGameImages(a.McEnergyView),this.addGameImages(a.McGroundHintView),this.addGameImages(a.McGroundHintMouseView),this.addGameImages(a.McKaktusView0),this.addGameImages(a.McKaktusView1),this.addGameImages(a.McKaktusView2),this.addGameImages(a.McKaktusView3),this.addGameImages(a.McKaktusView4),this.addGameImages(a.McLightView0),this.addGameImages(a.McLightView7),this.addGameImages(a.McMultitouch2HintView),this.addGameImages(a.McPortal2HintView),this.addGameImages(a.McPortalHintView),this.addGameImages(a.McRelsHintView),this.addGameImages(a.McRoseView),this.addGameImages(a.McShadowView0),this.addGameImages(a.McSimpleSpikesView),this.addGameImages(a.McSlingshotHintView),this.addGameImages(a.McSnotHintView),this.addGameImages(a.McSnotReleaseHintView),this.addGameImages(a.McSpikesView),this.addGameImages(a.McSpringView),this.addGameImages(a.McStoneLongBlackView),this.addGameImages(a.McStoneLongView),this.addGameImages(a.McStoneShadow),this.addGameImages(a.McStoneView1),this.addGameImages(a.McStoneView2),this.addGameImages(a.McStoneView3),this.addGameImages(a.McStoneView4),this.addGameImages(a.McStoneView5),this.addGameImages(a.McStoneView6),this.addGameImages(a.McStoneView7),this.addGameImages(a.McStoneView8),this.addGameImages(a.McStripesHintView),this.addGameImages(a.McEndRose),this.addGameImages(a.McEndRoseBlack),this.addGameImages(a.McTear),this.addGameBackground(a.McBackgroundContent4_3),this.addGameBackground(a.McBackgroundContent4_4),this.addGameBackground(a.McBackgroundContent4_7),this.addGameImages(a.McChapter4Background),this.addGameImages(a.McLightView1),this.addGameImages(a.McLightView11),this.addGameImages(a.McLightView12),this.addGameImages(a.McEggView0),this.addGameImages(a.McEggView1),this.addGameImages(a.McEggView2),this.addGameImages(a.McEggView3),this.addGameImages(a.McEggBridgeView),this.addGameImages(a.McRoundDragSquareView),this.addGameImages(a.McRoundDragFrameView),this.addGameImages(a.McChapter4Name),this.addGameImages(a.McChapter4Blur),this.addGameImages(a.McPlanet4Locked),this.addGameImages(a.McPlanet4Background),this.addGameImages(a.McPlanet4Shadow),this.addGameImages(a.McPlanet4Spring0),this.addGameImages(a.McPlanet4Spring1),this.addGameBackground(a.McBackgroundContent7_1),this.addGameBackground(a.McBackgroundContent7_2),this.addGameBackground(a.McBackgroundContent7_3),this.addGameBackground(a.McBackgroundContent7_4),this.addGameImages(a.McRotatorBase),this.addGameImages(a.McBaloonGrassAll),this.addGameImages(a.McBaloonLegs),this.addGameImages(a.McBaloonTailEnd),this.addGameImages(a.McAmieHintView),this.addGameImages(a.McChapter5Name),this.addGameImages(a.McChapter5Background),this.addGameImages(a.McChapterVBlur),this.addGameImages(a.McPlanetVLocked),this.addGameImages(a.McPlanetVBackground),this.addGameImages(a.McPlanetVBackground1),this.addGameImages(a.McPlanetVBackground2),this.addGameImages("McSkipIcon-hd"),this.addGameImages("McTotalLine-hd"),this.addGameImages("McRightPanelBackground-hd"),this.addGameImages("McRestartIcon-hd"),this.addGameImages("McPauseIcon-hd"),this.addGameImages("McMenuIcon-hd"),this.addGameImages("McButtonBackgroundBig-hd_blue"),this.addGameImages("McButtonBackground-hd_blue"),this.addGameImages("McRightPanelBackground-hd_blue"),this.addGameImages("McPauseIcon-hd_blue"),this.addGameImages("McPlayIcon-hd_blue"),this.addGameImages("McRestartIcon-hd_blue"),this.addGameImages("McSkipIcon-hd_blue"),this.addGameImages("McSoundIcon-hd_blue"),this.addGameImages("McMusicIcon-hd"),this.addGameImages("McMusicIcon-hd_blue"),this.addGameImages("McMenuIcon-hd_blue"),this.addGameImages("McBackIcon-hd_blue"),this.addGameImages("McLevelComplete-hd_blue"),this.addGameImages("McLevelComplete-hd"),this.addGameImages("McLevels0-hd"),this.addGameImages("McLevels1-hd"),this.addGameImages("McLevels2-hd"),this.addGameImages("McLevels3-hd"),this.addGameImages("McLevels4-hd"),this.addGameImages("McLevels5-hd"),this.addGameImages("McLevels6-hd"),this.addGameImages("McLevels7-hd"),this.addGameImages("McLevels8-hd"),this.addGameImages("McLevels9-hd"),this.addGameImages("McLevels0-hd_blue"),this.addGameImages("McLevels1-hd_blue"),this.addGameImages("McLevels2-hd_blue"),this.addGameImages("McLevels3-hd_blue"),this.addGameImages("McLevels4-hd_blue"),this.addGameImages("McLevels5-hd_blue"),this.addGameImages("McLevels6-hd_blue"),this.addGameImages("McLevels7-hd_blue"),this.addGameImages("McLevels8-hd_blue"),this.addGameImages("McLevels9-hd_blue"),this.addGameImages("McButtonBackgroundBig-hd"),this.addGameImages("McPlayIcon-hd"),this.addGameImages("McLevelItemBackground-hd"),this.addGameImages("McLevelItemBackground-hd_blue"),this.addGameImages("McLevelEnergy-hd"),this.addGameImages("McBackIcon-hd"),this.addGameImages("McButtonBackground-hd"),this.addGameImages("McDisabledIcon-hd"),this.addGameImages("McSoundIcon-hd"),this.addGameImages("McLevelItemInactive-hd"),this.addGameImages("McLevelItemInactive-hd_blue"),this.addGameImages("McRoseButton-hd"),this.addGameImages("McVenzel-hd"),this.addGameImages("McEnergyBig-hd"),this.addGameImages("McEnergyBigInactive-hd"),this.addGameImages("shareBlack"),this.addGameImages("shareBlue"),this.addGameImages("sharePurple"),this.addGameImages("shareHover"),this.addGameImages("meetPetit"),this.addGameImages("McBackIcon-hd_purple"),this.addGameImages("McMenuIcon-hd_purple"),this.addGameImages("McMusicIcon-hd_purple"),this.addGameImages("McPauseIcon-hd_purple"),this.addGameImages("McPlayIcon-hd_purple"),this.addGameImages("McRestartIcon-hd_purple"),this.addGameImages("McSkipIcon-hd_purple"),this.addGameImages("McSoundIcon-hd_purple"),this.addGameImages("McTotalLine-hd_purple"))},r.prototype.addThemedGameImages=function(t,e){if(this.loader){var s,a,o;if(t instanceof i.util.ThemedAsset)
for(var r=0;r<i.util.Theme.all.length;r++)a=i.util.Theme.all[r],t.hasTheme(a)&&(s=t.key(a),o=this.imgDir+s+this.imgExt,this.images[s]=this.loader.addImage(o,[n.GAMEIMAGE],e),this.gameelements+=1)}},r.prototype.addGameImages=function(e,s){if(this.loader)
if(e instanceof i.util.ThemedAsset)this.addThemedGameImages(e,s);else{var a=this.imgDir+e+this.imgExt;this.logging&&t.console&&t.console.log("["+(this.gameelements+1)+"] Game Image: "+e+" url: "+a),this.images[e]=this.loader.addImage(a,[n.GAMEIMAGE],s),this.gameelements+=1}},r.prototype.addGameBackground=function(e,s){if(this.loader)
if(e instanceof i.util.ThemedAsset)this.addThemedGameImages(e,s);else{var a=this.imgDir+e;this.logging&&t.console&&t.console.log("["+(this.gameelements+1)+"] Game Image: "+e+" url: "+a),this.images[e]=this.loader.addImage(a,[n.GAMEIMAGE],s),this.gameelements+=1}},r.prototype.addGameSounds=function(t,e,i){this.loader&&(!function(){var n=new Audio;o[t]=n,s.push(n),n.isTrack=i||!1,n.isTrack&&(n.loop="loop"),n.loadComplete=!1,n.preload="auto",n.src=e,n.load()}(),this.gameelements+=1)};var h=function(){for(var t=s.length;t>=0;)t--};r.prototype.loadGameAssets=function(){this.loader&&this.loader.start([n.GAMEIMAGE,n.GAMESOUND]),function(){if("iPad"===BrowserDetect.OS)return void h();var e=!0,i=!1,n=t.setInterval(function(){e=!0;for(var a=s.length-1;a>=0;a--)s[a].loadComplete||(4===s[a].readyState?s[a].loadComplete=!0:e=!1);e&&(t.clearInterval(n),i=!0)},300);t.setTimeout(function(){i||(t.clearInterval(n),h())},45e3)}()},r.prototype.getImage=function(t,e){if(this.images){var i=t.key?t.key(e):t;return{name:i,img:this.images[i]}}},r.prototype.addGameImageAssetCompletionListener=function(t){this.loader&&this.loader.addCompletionListener(t,[n.GAMEIMAGE])},r.prototype.addGameImageAssetProgressListener=function(t){this.loader&&this.loader.addProgressListener(t,[n.GAMEIMAGE])},r.prototype.queueLevelImage=function(e,i,s,a){return-1===this.expendableImages.indexOf(i)?(this.logging&&t.console&&t.console.log("["+(this.levelelements+1)+"] Level Image: "+i+" url: "+s),this.images[i]=e.addImage(s,[n.LEVELIMAGE],a),this.expendableImages.push(i),this.levelelements+=1,!0):!1};var l=!1;i.util.assets=new r(l),i.util.GameImages=a,i.util.GameSounds=o,i.util.GameSoundsArray=s}(window,PxLoader,cj),function(t,e){function i(){this.initial=void 0,this.position=new s(0,0),this.scale=new s(1,1),this.rotation=0}
var s=t.Common.Math.b2Vec2;i.prototype.setPosition=function(t,e){this.position.x=t,this.position.y=e},i.prototype.setPositionVec=function(t){this.position.x=t.x,this.position.y=t.y},i.prototype.setPositionRelative=function(t,e){this.position.x+=t,this.position.y+=e},i.prototype.setPositionRelativeVector=function(t){this.position.Add(t.Copy())},i.prototype.setScale=function(t,e){this.scale.x=t,this.scale.y=e},i.prototype.setScaleRelative=function(t,e){this.scale.x+=t,this.scale.y+=e},i.prototype.setRotation=function(t){this.rotation=t},i.prototype.setRotationRelative=function(t){this.rotation+=t},i.prototype.setInitial=function(t){this.initial||(this.initial=new i,this.initial.setPosition(t.position.x,t.position.y),this.initial.setScale(t.scale.x,t.scale.y),this.initial.setRotation(t.rotation))},i.prototype.copy=function(t){e.util.Box2dUtil.b2Vec2Copy(t.position,this.position),e.util.Box2dUtil.b2Vec2Copy(t.scale,this.scale),this.rotation=t.rotation},e.util.Transform=i}(Box2D,cj),function(t){function e(){this.elements=[],this.removedElements=[],this.addedElements=[],this.sort=void 0,this.dispose=void 0,this.forceSort=!1}
e.prototype.add=function(t){this.addedElements.push(t)},e.prototype.remove=function(t){var e=this.elements.indexOf(t);-1!==e&&this.removedElements.push(e)},e.prototype.removeAt=function(t){t>=0&&t<this.elements.length&&this.removedElements.push(t)},e.prototype.disposeMethod=function(t){this.dispose=t},e.prototype.sortMethod=function(t){this.sort=t},e.prototype.update=function(){var t=!1;if(this.removedElements.length>0){t=!0,this.removedElements.sort(function(t,e){return e-t});for(var e=0;e<this.removedElements.length;e++){var i=this.removedElements[e];this.dispose&&this.dispose(this.elements[i]),this.elements.splice(i,1)}
this.removedElements=[]}
this.addedElements.length>0&&(t=!0,this.elements=this.elements.concat(this.addedElements),this.addedElements=[]),(t&&this.sort||this.forceSort)&&(this.elements.sort(this.sort),this.forceSort=!1)},e.prototype.printZOrderAndIndex=function(){console.log("elements, z-order, z-index"),console.log(this.elements);var t,e,i;for(i=[],t=0,e=this.elements.length;e>t;t++)i.push(this.elements[t].zOrder);for(console.log(i),i=[],t=0,e=this.elements.length;e>t;t++)i.push(this.elements[t].zIndex);console.log(i)},e.prototype.clear=function(){if(this.elements=this.elements.concat(this.addedElements),this.dispose)
for(var t=0;t<this.elements.length;t++)this.dispose(this.elements[t]);this.elements=[],this.removedElements=[],this.addedElements=[]},t.util.Collection=e}(cj),function(t,e,i,s){function n(t,e,i,n,a){var o=e.alpha;s.util.newStepAction(t,a,function(t,i){e.alpha=s.util.Maths.lerp(o,n,1-i/t)},i)}
function a(t,e,i,n,a){var o=e.transform.scale.x;s.util.newStepAction(t,a,function(t,i){var a=s.util.Maths.lerp(o,n,1-i/t);e.setScale(a,a)},i)}
function o(t,e,i,n,a){var o=e.transform.position.Copy(),r=new u;s.util.newStepAction(t,a,function(t,i){s.util.Box2dUtil.b2Vec2Lerp(o,n,1-i/t,r),e.setPosition(r.x,r.y)},i)}
function r(t,e,i,n,a){var o=e.transform.rotation,r=o;s.util.newStepAction(t,a,function(t,i){r=s.util.Maths.lerp(o,n,1-i/t),e.setRotation(r)},i)}
function h(t,e,i,n,a,o){var r=e.transform.position.Copy(),h=e.transform.scale.x,l=new u;s.util.newStepAction(t,o,function(t,i){s.util.Box2dUtil.b2Vec2Lerp(r,n,1-i/t,l),e.setPosition(l.x,l.y);var o=s.util.Maths.lerp(h,a,1-i/t);e.setScale(o,o)},i)}
function l(t,e,i,n,a,o){var r=0,l=i/a,d=new u(s.util.Maths.randRange(-n,n),s.util.Maths.randRange(-n,n)),c=e.getPosition().Copy();d.Add(c);var m=1+r/a*.2;m+=r%2!==0?.05:-.05;var p=!1,g=function(){h(t,e,l,d,m,function(){r++,a-1>r?(p=r===a-2,p?(d.x=d.y=0,m=1):(d.x=s.util.Maths.randRange(-n,n),d.y=s.util.Maths.randRange(-n,n),m=1+r/a*.2,m+=r%2!==0?.05:-.05),d.Add(c),g()):o()})};g()}
function d(t,e,i,n){s.util.scheduler.add(new g(t,e,i,n))}
function c(t,e,i,n,a){s.util.scheduler.add(new f(t,e,i,n,a))}
var u=e.Common.Math.b2Vec2,m={NONE:0,GAME:1,WORLD:2,LEVEL:4,ALL:7},p=i.extend({init:function(t,e,i,s){this.context=t,this.callback=e,this.seconds=i,this.name=s?s:"noname-"+Math.floor(100*Math.random()+1)},update:function(t){return!0}}),g=p.extend({init:function(t,e,i,s){s||(s="noname-delay-"+Math.floor(100*Math.random()+1)),this._super(t,e,i,s)},update:function(t){return this.seconds-=t.delta,this.seconds<=0?(this.callback(),!0):!1}}),f=p.extend({init:function(t,e,i,s,n){n||(n="noname-step-"+Math.floor(100*Math.random()+1)),this._super(t,e,s,n),this.step=i,this.duration=s},update:function(t){return this.seconds-=t.delta,this.seconds<0&&(this.seconds=0),this.step&&this.step(this.duration,this.seconds),this.seconds<=0?(this.callback&&this.callback(),!0):!1}}),y=i.extend({init:function(t){this.logging=t,this.actions=new s.util.Collection},add:function(e){if(!(e instanceof p))throw "Scheduler could not add Action.";this.logging&&t.console&&t.console.log(e.name+" has been added"),this.actions.add(e)},clear:function(e,i){if(0==(m.ALL&e))throw "Can not clear Actions from unknown context: "+e;this.actions.update();for(var s=0;s<this.actions.elements.length;s++)(i?this.actions.elements[s].context!=e:0)||0==(this.actions.elements[s].context&e)||(this.logging&&t.console&&t.console.log("Cleared action: ["+this.actions.elements[s].name+"]"),this.actions.removeAt(s))},update:function(e,i){this.actions.update(),i||(i=m.ALL);for(var s=0;s<this.actions.elements.length;s++)try{0!=(this.actions.elements[s].context&i)&&this.actions.elements[s].update(e)&&(this.logging&&t.console&&t.console.log("Completed action: ["+this.actions.elements[s].name+"]"),this.actions.removeAt(s))}catch(n){this.logging&&t.console&&t.console.log("Error occurred during action: ["+this.actions.elements[s].name+"] Error: ["+n+"]"),this.actions.removeAt(s)}}});s.util=s.util||{},s.util.ScheduleContext=m,s.util.newDelayAction=d,s.util.newStepAction=c,s.util.newFadeAction=n,s.util.newScaleAction=a,s.util.newMoveAction=o,s.util.newRotationAction=r,s.util.newScaleMoveAction=h,s.util.newShakeSequence=l,s.util.scheduler=new y}(window,Box2D,Class,cj),function(t,e){function i(t,i,n,a){this.fontFamily=a||"Tekton",this.shadow=!1,this.bold=!1,this.text=t,this.transform=new e.util.Transform,this.fontSize=i,this.lineHeight=n,this.alpha=1,this.totalSize=0,this.refreshed=!1,this.lines=[],this.textPosition=new s,this.anchor=new s,this.color="rgb(45, 45, 45)",this.shadowColor="rgba(45,45,45,.8)",this.alignment="center",this.visible=!0,this.firstLineScale=1,this.shadowOffsetX=0,this.shadowOffsetY=5,this.shadowBlur=8;for(var o,r=[14,20,28,40],h=1.5,l=0;l<r.length;l++)
if(o=r[l],o>i){h*=i/o;break}this.transform.setScale(h,h)}
var s=t.Common.Math.b2Vec2;i.prototype.draw=function(t){this.refreshed||(this.refreshText(t),this.refreshed=!0),t.save(),this.bold?t.font="bold "+this.fontSize+"pt "+this.fontFamily:t.font=this.fontSize+"pt "+this.fontFamily,t.globalAlpha*=this.alpha,t.textAlign=this.alignment;for(var e=0,i=0;i<this.lines.length;i++)
if(this.visible){var s=0==i?this.firstLineScale:1;t.save(),t.fillStyle=this.color,this.shadow&&(t.shadowColor=this.shadowColor,t.shadowOffsetX=this.shadowOffsetX,t.shadowOffsetY=this.shadowOffsetY,t.shadowBlur=this.shadowBlur),t.translate(this.transform.position.x,this.transform.position.y+e),t.rotate(this.transform.rotation),t.scale(this.transform.scale.x*s,this.transform.scale.y*s),t.fillText(this.lines[i],0,0),e+=this.lineHeight,t.restore()}t.restore()},i.prototype.setText=function(t){this.text=t,this.refreshed=!1},i.prototype.setAlignment=function(t){this.alignment=t},i.prototype.refreshText=function(t){this.lines.length=0,this.lines=this.text.split("\\n")},i.prototype.setPosition=function(t,e){this.transform.setPosition(t,e)},i.prototype.setScale=function(t,e){this.transform.setScale(t,e)},i.prototype.setRotation=function(t){this.transform.rotation=t},e.util.MultilineLabel=i}(Box2D,cj),function(t,e,i){var s=t.Common.Math.b2Vec2,n=t.Dynamics.b2Body,a=e.extend({name:"unknown",init:function(t,e,a,o){this.world=t,this.dragging=!1,this.transform=new i.util.Transform,this.body=e,this.config=o,this._SCALE=30,this.zOrder=0,this.visible=!0,this.rotationOffset=o?i.util.Maths.toRadians(o.rotationOffset):0,this.rotationOffset||(this.rotationOffset=0),this.body instanceof n||(this.body=null),a&&(this.transform=a,this.transform.setInitial(a)),this.refreshVec=new s},update:function(t){this.body&&(this.updatePosition(),this.updateRotation())},updatePosition:function(){var t=this.body.GetPosition();this.transform.position.x=t.x*this._SCALE,this.transform.position.y=t.y*this._SCALE},updateRotation:function(){this.transform.rotation=-this.body.GetAngle()+this.rotationOffset},draw:function(t){},isCharacter:function(){return!1},isHero:function(){return!1},canTeleport:function(){return!1},canLaunch:function(){return!1},setVisible:function(t){this.visible=t},startTouch:function(t){this.dragging=!0},moveTouch:function(t){},endTouch:function(t){this.dragging=!1},onCollisionStart:function(t,e){},onCollisionEnd:function(t,e){},onCollision:function(t,e){},postSolve:function(t,e,i){},isClickable:function(){return!1},getPosition:function(){return this.transform.position},getPositionX:function(){return this.transform.position.x},getPositionY:function(){return this.transform.position.y},refreshPosition:function(){this.body&&(i.util.Box2dUtil.b2Vec2Copy(this.transform.position,this.refreshVec),this.refreshVec.Multiply(1/this._SCALE),this.body.SetPosition(this.refreshVec))},setPosition:function(t,e){this.transform.setPosition(t,e),this.refreshPosition()},setPositionV:function(t){this.transform.setPosition(t.x,t.y),this.refreshPosition()},addToPosition:function(t,e){this.transform.setPositionRelative(t,e),this.refreshPosition()},addToPositionV:function(t){this.transform.setPositionRelative(t.x,t.y),this.refreshPosition()},getScale:function(){return this.transform.scale.Copy()},getScaleX:function(){return this.transform.scale.x},getScaleY:function(){return this.transform.scale.y},setScale:function(t,e){this.transform.setScale(t,e)},setScaleTime:function(t,e){var s=this,n=this.getScaleX();i.util.newStepAction(i.util.ScheduleContext.LEVEL,null,function(e,a){var o=1-a/e,r=i.util.Maths.lerp(n,t,o);s.setScale(r,r)},e)},addToScale:function(t,e){this.transform.setScaleRelative(t,e)},getRotation:function(){return this.transform.rotation},setRotation:function(t){this.transform.setRotation(t)},addToRotation:function(t){this.transform.setRotationRelative(t)},setZOrder:function(t){this.zOrder=t},touchPriority:function(){return-1},isTouchSwipable:function(){return!1},getViewType:function(){return this.world.isBlackSide()&&this.config.blackViewType?this.config.blackViewType:this.config.iPhoneViewType||this.config.viewType},getViewImage:function(){var t=this.getViewType();return i.util.GameImages[t]||t+"-hd"},bonusTargetPosition:function(){return this.transform.position},dispose:function(){},drawOrder:0,updateOrder:0}),o=a.extend({init:function(t,e,i,s){this._super(t,e,i,s)},providePosition:function(){return this.transform.position},isTouch:function(){return!1}}),r=e.extend({init:function(t,e){this.provider=t,this.value=e}}),h=e.extend({init:function(t){this.touch=t,this.touchVec=new s},providePosition:function(){return this.touchVec.x=this.touch.x,this.touchVec.y=this.touch.y,this.touchVec},isTouch:function(){return!0}}),l=a.extend({init:function(t,e,i){this._super(t,e,i),this.positionProvider=null},providerRemoved:function(t){},providerAdded:function(t){}}),d={PORTAL:-2,SNOW:11,HINTS:12,DUST:1,FLIES:6,BLUE_PARTICLES:-9,PARTICLES:-2,END_LEVEL_LAYER:11,DRAGGER:2,SNOT:4,ENERGY:9,TAIL:9,SPRINGS:2,ARROW:-1,TRAMPOLINE_PATH:11,HERO:10,GROUND_FALL:-1,GRASS:-1,BLACK_KAKTUS:-2,BACK_SNOT:-9,BACKGROUND:-10,GROUND:-3};i.elem.EntityBase=a,i.elem.PositionProvider=o,i.elem.PositionProviderValue=r,i.elem.TouchPositionProvider=h,i.elem.PositionDependent=l,i.util.EntityZOrder=d}(Box2D,Class,cj),function(t,e){function i(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}
function s(){this.width=0,this.height=0,this.frames=0,this.useSheet=!1,this.tileData=new n,this.anchor=new n,this.jpg=!1,this.framesBounds=[]}
var n=t.Common.Math.b2Vec2;s.prototype.initialize=function(){for(var t=null,e=0;e<this.tileData.y;e++)
for(var s=0;s<this.tileData.x;s++)t=new i(s*this.width,e*this.height,this.width,this.height),this.framesBounds.push(t)},s.prototype.reverseFrames=function(){this.framesBounds.reverse()};var a={getClipData:function(t){"-hd"!==t.substr(-3).toLowerCase()&&(t+="-hd");var i=e.util.elementConfigCache[t];if(i)var n=i;else var n=e.util.elementXmlLoader.getConfigFile(t);if(n){var a=new s;return a.width=parseFloat(n.width),a.height=parseFloat(n.height),a.frames=parseFloat(n.frames),a.tileData.x=parseFloat(n.tileData.x),a.tileData.y=parseFloat(n.tileData.y),a.anchor.x=parseFloat(n.anchor.x),a.anchor.y=parseFloat(n.anchor.y),a.initialize(),a}
return null}};e.util.ClipFactory=a}(Box2D,cj),function(t,e){function i(e,i,s,n,a,o,r){this.eyeBody=e,this.eyeJoint=i,this.bodies=a,this.joints=o,this.joinedBody=s,this.localStartAnchor=n,this.initialLength=t.Common.Math.b2Math.SubtractVV(this.endBody().GetPosition(),this.eyeBody.GetPosition()).Length(),this.metrics=r}
function s(t,e){this.body=t,this.point=e?e:new n}
var n=t.Common.Math.b2Vec2,a=t.Dynamics.b2Body,o=e.elem.PositionProvider.extend({init:function(t,i,s,a){this._super(s,i.eyeBody,a,t),this.snotData=i,this.world=s,this.dragging=!1,this.startWidth=30,this.centerWidth=8,this.endWidth=12,this.startPosition=new n,this.endPosition=new n,this.drawPoints=[],this.numPoints=this.numPoints?this.numPoints:2*(this.snotData.bodies.length-1)+1;for(var o=0;o<this.numPoints;o++)this.drawPoints.push(new e.util.DrawUtil.PointsPair(new n,new n));this.previousPoint=new n,this.currentBodyPosition=new n,this.nextBodyPosition=new n,this.nextCenter=new n,this.endPosition=new n},update:function(t){this.calculateDrawPoints()},calculateDrawPoints:function(){var t=this.snotData.bodies[0].GetPosition();this.startPosition=this.snotData.eyeBody.GetPosition().Copy(),this.startPosition.Multiply(this._SCALE),e.util.Box2dUtil.b2Vec2Copy(t,this.currentBodyPosition),this.currentBodyPosition.Multiply(this._SCALE),e.util.DrawUtil.getPointsPair(this.drawPoints[0],this.startPosition,this.startPosition,this.currentBodyPosition,this.startWidth),this.previousPoint.x=this.startPosition.x,this.previousPoint.y=this.startPosition.y;var i=this.snotData.endBody().GetPosition();this.endPosition.x=i.x,this.endPosition.y=i.y,this.endPosition.Multiply(this._SCALE);for(var s=1,n=0;n<this.snotData.bodies.length-1;n++){t=this.snotData.bodies[n].GetPosition();var a=this.snotData.bodies[n+1].GetPosition();this.currentBodyPosition.x=t.x,this.currentBodyPosition.y=t.y,this.currentBodyPosition.Multiply(this._SCALE),this.nextBodyPosition.x=a.x,this.nextBodyPosition.y=a.y,this.nextBodyPosition.Multiply(this._SCALE),e.util.DrawUtil.getPointsPair(this.drawPoints[s++],this.currentBodyPosition,this.previousPoint,this.nextBodyPosition,this.centerWidth),this.previousPoint.x=this.nextBodyPosition.x,this.previousPoint.y=this.nextBodyPosition.y,n<this.snotData.bodies.length-2&&(e.util.Box2dUtil.getCenter(this.currentBodyPosition,this.nextBodyPosition,this.nextCenter),e.util.DrawUtil.getPointsPair(this.drawPoints[s++],this.nextCenter,this.currentBodyPosition,this.nextBodyPosition,this.centerWidth))}
e.util.DrawUtil.getPointsPair(this.drawPoints[this.drawPoints.length-1],this.endPosition,this.currentBodyPosition,this.endPosition,this.endWidth)},touchPriority:function(){return 1},isTouchSwipable:function(){return!0}}),r=o.extend({name:"SnotBodyClip",init:function(t,i,s,a){this._super(t,i,s,a),this.createHighlight(),this.setZOrder(e.util.EntityZOrder.SNOT),this.stickyJoint=null,this.linkedObject=null,this.hasRelease=!1,this.snotData.endBody().SetUserData(this),this.world.addPositionProvider(new e.elem.PositionProviderValue(this,1)),this.eye=new h(this,s,e.util.GameImages.McSnotStart),this.endBall=new e.util.Bitmap(e.util.GameImages.McSnotEnd),this.setDamping(r.FREE_DAMPING);var o=this.world.isBlackSide(),l=this.world.isWhiteSide();o||l?(this.calculateDrawPoints(),o?(this.startColor=new e.util.Color(0,72,101,1),this.endColor=new e.util.Color(0,255,255,1)):(this.startColor=new e.util.Color(160,160,160,1),this.endColor=new e.util.Color(204,204,204,1)),this.colors=e.util.DrawUtil.calculateColors(this.drawPoints,this.startColor,this.endColor),this.startColor=this.startColor.toString(),this.endColor=this.endColor.toString(),this.touchEndTime=-1,o&&(this.blackTail=new e.elem.BlackTail(this.world,this.snotData.endBody(),new e.util.Color(0,81,83,1)),this.blackTail.width=15)):(this.startColor="black",this.endColor="black"),this.linkEvent=new e.util.EventSender,this.releaseEvent=new e.util.EventSender,this.touchPoint=new n,this.dragTargetVec=new n},createHighlight:function(){this.world.isBlackSide()||(this.endHighlight=new e.util.Bitmap(e.util.GameImages.McSnotEndHighlite),this.highlightChanger=new e.elem.CosChanger(.05,.1))},update:function(t){if(this.hasRelease&&(this.release(),this.hasRelease=!1),this.dragging)
for(var e=0;e<this.snotData.bodiesSize();e++)this.snotData.bodyAt(e).SetAwake(!0);if(null==this.stickyJoint&&(this.touchEndTime>0&&this.world.totalTime-this.touchEndTime<.015||this.dragging)){if(this.dragging){var i=this.getDragTarget();this.updateDragBodyPosition(i,t.delta/3)}else{var i=this.getDragTargetPoint(this.snotData.endBody().GetPosition());null!=i.body&&this.updateDragBodyPosition(i,t.delta/3)}
null!=this.stickyJoint&&(this.touchEndTime=0)}
this.eye.update(t),this.world.isBlackSide()&&this.blackTail.update(t),this._super(t),this.highlightChanger&&(this.highlightChanger.update(t.delta),this.endHighlight.alpha=.4+.6*this.highlightChanger.value)},updateDragBodyPosition:function(t,i){e.util.Box2dUtil.moveBodyWithRotation(this.snotData.endBody(),t.point,this.snotData.endBody().GetAngle(),.5,i),null!=t.body&&(this.joinTo(t.body,t.point),this.endTouch(null))},onLinkedDestroy:function(){this.hasRelease=!0},getDragTarget:function(){return e.util.Box2dUtil.limitDistance(this.touchPoint,this.snotData.eyeBody.GetPosition(),this.maxLength(),this.dragTargetVec),e.util.Box2dUtil.limitDistance(this.dragTargetVec,this.snotData.endBody().GetPosition(),r.SNOT_DRAG_OFFSET,this.dragTargetVec),this.getDragTargetPoint(this.dragTargetVec)},getDragTargetPoint:function(t){var i=new s,n=this.joinDistance(),a=e.util.Box2dUtil.queryAABBFromRadius(this.world.b2World,t,n);if(a.length>0){for(var o,r=!1,h=0;h<a.length;h++)
if(o=a[h].GetBody().GetUserData(),o&&o.isCharacter()&&o.snotEnabled&&e.util.Box2dUtil.b2Vec2Distance(t,o.body.GetPosition())<1.5){i.body=o.body,e.util.Box2dUtil.b2Vec2Copy(o.body.GetPosition(),i.point),r=!0;break}r||e.util.Box2dUtil.b2Vec2Copy(t,i.point)}else e.util.Box2dUtil.b2Vec2Copy(t,i.point);return i},joinDistance:function(){return r.HERO_STICK_DISTANCE},maxLength:function(){return this.snotData.initialLength*this.dragDistanceMultiplier()},dragDistanceMultiplier:function(){return r.DRAG_DISTANCE_MULTIPLIER},draw:function(t){if(this.world.useSnots){var i=t.foreground;i.save(),this.blackTail&&this.blackTail.draw(t),this.endHighlight&&this.endHighlight.drawNoTransform(i,this.endPosition.x,this.endPosition.y,0,1,1),this.colors?e.util.DrawUtil.drawSegmentsWithColors(i,this.drawPoints,this.colors):e.util.DrawUtil.drawBezier(i,this.drawPoints,this.startColor),this.endBall.drawNoTransform(i,this.endPosition.x,this.endPosition.y,0,1,1),this.eye.draw(t),i.restore()}},touchPriority:function(){return 1},providePosition:function(){return this.endPosition},startTouch:function(t){return this.stickyJoint?!1:(this._super(t),this.dragging=!0,this.touchPoint.x=t.x/30,this.touchPoint.y=t.y/30,this.setDamping(r.DRAG_DAMPING),this.snotData.endBody().SetType(a.b2_staticBody),e.util.soundController.playSoundEffect(e.util.GameSounds.effects.leapOn1,50),!0)},moveTouch:function(t){this.touchPoint.x=t.x/30,this.touchPoint.y=t.y/30},endTouch:function(t){this._super(t),this.touchEndTime=this.world.totalTime,this.dragging=!1,this.setDamping(r.FREE_DAMPING),this.snotData.endBody().SetType(a.b2_dynamicBody)},joinTo:function(t,i){e.util.soundController.playSoundEffect(e.util.GameSounds.random(this.onSound()),50),this.setDamping(r.JOINED_DAMPING),this.linkedObject=t.GetUserData(),this.linkedObject&&(this.linkedObject.snotJoinedCount++,this.linkedObject.destroyEvent.addListener(this,this.onLinkedDestroy)),this.snotData.endBody().SetPositionAndAngle(t.GetPosition(),t.GetAngle()),this.stickyJoint=e.util.Box2dUtil.createRevoluteJoint(this.snotData.endBody(),t,i,!1,!1),this.eye.eyeSprite.openEye(),this.linkEvent.sendEvent()},release:function(){this.stickyJoint&&(e.util.soundController.playSoundEffect(e.util.GameSounds.random(e.util.GameSounds.leapOut),50),this.linkedObject&&(this.linkedObject.destroyEvent.removeListener(this,this.onLinkedDestroy),this.linkedObject.snotJoinedCount--,this.linkedObject=null),this.world.b2World.DestroyJoint(this.stickyJoint),this.stickyJoint=null,this.applyDisconnectForce(),this.releaseEvent.sendEvent())},isJoined:function(){return!(!this.stickyJoint||null==this.stickyJoint)},isClickable:function(){return!this.linkedObject},applyDisconnectForce:function(){var t=this.snotData.getWorldStartPoint();t.Subtract(this.snotData.endBody().GetPosition()),t.Multiply(r.DISCONNECT_FORCE/t.Length()),this.snotData.endBody().ApplyForce(t,this.snotData.endBody().GetWorldCenter())},setDamping:function(t){for(var e,i=0;i<this.snotData.bodiesSize();i++)e=this.snotData.bodyAt(i),e.SetAwake(!0),e.SetLinearDamping(t)},onSound:function(){return e.util.GameSounds.leapOn},debug:function(t,e){if(t){this.active=[];for(var i=0;i<this.snotData.bodiesSize();i++){var s=this.snotData.bodyAt(i),n=s.GetType(),o=(s.IsAwake(),s.GetPosition());this.active.push({x:30*o.x,y:30*o.y,color:n==a.b2_staticBody?"red":"green"})}}
if(e)
for(var i=0;i<this.active.length;i++){var s=this.active[i];e.fillStyle=s.color,e.beginPath(),e.arc(s.x,s.y,.6*this.endBallWidth,0,2*Math.PI,!0),e.closePath(),e.fill()}}});r.DISCONNECT_FORCE=10,r.FREE_DAMPING=.5,r.DRAG_DAMPING=3,r.DRAG_DISTANCE_MULTIPLIER=2.6,r.JOINED_DAMPING=0,r.HERO_STICK_DISTANCE=.3,r.SNOT_DRAG_OFFSET=50*e.util.Box2dUtil.sizeMultiplier;var h=e.elem.EntityBase.extend({name:"SnotEye",init:function(t,i,s){this._super(i,t.snotData.eyeBody),this.snot=t,this.blinking=!1,this.snot.snotData.eyeBody.SetUserData(this),this.eyeSprite=new e.elem.MonsterEye(i,this.snot.snotData.eyeBody),this.background=new e.util.Bitmap(s);var n=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){n.blink()},e.util.Maths.randRange(1,2),"blink")},update:function(t){this._super(t),this.eyeSprite.update(t)},startTouch:function(t){return this.snot.release(),this.eyeSprite.closeEye(),!0},isClickable:function(){return!0},blink:function(){var t=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.blink()},e.util.Maths.randRange(h.BLINK_TIME_MIN,h.BLINK_TIME_MAX),"blink"),this.snot.stickyJoint||(this.blinking=!0,this.eyeSprite.openEye(),e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.endBlink()},e.util.Maths.randRange(h.END_BLINK_TIME_MIN,h.END_BLINK_TIME_MAX),"endblink"))},endBlink:function(){this.blinking=!1,this.snot.stickyJoint||this.eyeSprite.closeEye()},draw:function(t){var e=t.foreground;e.fillStyle=this.snot.startColor,e.beginPath(),e.arc(this.transform.position.x,this.transform.position.y,.5*this.snot.startWidth,0,2*Math.PI,!0),e.closePath(),e.fill(),this.background.draw(t.foreground,this.transform),this.eyeSprite.draw(t)},touchPriority:function(){return this.snot.isJoined()?1:-1},setEyeScale:function(t,e){this.eyeSprite.setScale(t,e)}});h.BLINK_TIME_MIN=10,h.BLINK_TIME_MAX=25,h.END_BLINK_TIME_MIN=2,h.END_BLINK_TIME_MAX=5,i.prototype.bodyAt=function(t){return this.bodies[t]},i.prototype.jointAt=function(t){return this.joints[t]},i.prototype.bodiesSize=function(){return this.bodies.length},i.prototype.jointsSize=function(){return this.joints.length},i.prototype.firstBody=function(){return this.bodies[0]},i.prototype.endBody=function(){return this.bodies[this.bodies.length-1]},i.prototype.getWorldStartPoint=function(){return this.joinedBody.GetWorldPointCachedVector(this.localStartAnchor)},e.elem.SnotBodyClipBase=o,e.elem.SnotBodyClip=r,e.elem.SnotEye=h,e.elem.SnotData=i}(Box2D,cj),function(t,e,i){var s=t.Common.Math.b2Vec2,n=e.extend({init:function(t,e){this.world=t,this.type=e},match:function(t){return this.type===t.config.type},processItem:function(t){return null}}),a=n.extend({init:function(t){this._super(t,"foreground")},processItem:function(t){var e=t.config;return e.z||(e.z=12),1}}),o=n.extend({init:function(t){this._super(t,"plasticine")},processItem:function(t){for(var e=[],i=t.points,n=0;n<i.length;n++)e.push(new s(i[n].x,this.world.box2dHeight-i[n].y));return e}}),r=n.extend({processItem:function(t){return 1}});i.elem.TypeProcessorBase=n,i.elem.ForegroundProcessor=a,i.elem.PlasticineProcessor=o,i.elem.FakeProcessor=r}(Box2D,Class,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=t.Dynamics.b2BodyDef,n=t.Dynamics.b2Body,a=e.elem.TypeProcessorBase.extend({processItem:function(t){var e=new s,a=t.config;e.type=a.dynamic?n.b2_dynamicBody:n.b2_staticBody,e.position=new i(t.position.x,this.world.box2dHeight-t.position.y),e.bullet="true"===a.bullet;var o=this.world.b2World.CreateBody(e);return a.angularDamping&&o.SetAngularDamping(a.angularDamping),a.fixedRotation&&o.SetFixedRotation(!0),this.addShapesItem(o,t),o},createShape:function(t){},addShapesItem:function(t,e){var i=this.createShape(e);this.addShapeItemShape(t,e,i)},addShapeItemShape:function(t,i,s){var n=i.config,a=n.density||.3,o=e.util.Box2dUtil.addShape(s,t,a);o.friction=n.friction||1,o.restitution=n.restitution||0,o.SetSensor(n.sensor||!1);var r=o.GetFilterData();return n.categoryBits&&(r.categoryBits=n.categoryBits),n.maskBits&&(r.maskBits=n.maskBits),n.filterGroup&&(r.groupIndex=n.filterGroup),o.SetFilterData(r),o}}),o=a.extend({init:function(t){this._super(t,"circle")},createShape:function(e){var s=e.radius,n=new t.Collision.Shapes.b2CircleShape(s);return n.SetLocalPosition(new i(e.position.x,-e.position.y)),n.density=.3,n}}),r=a.extend({init:function(t){this._super(t,"polygon")},createShape:function(e){for(var s=new t.Collision.Shapes.b2PolygonShape,n=[],a=e.vertices,o=a.length-1;o>=0;o--)n.push(new i(a[o].x,-a[o].y));return s.SetAsArray(n,n.length),s.density=.3,s}}),h=a.extend({init:function(t){this._super(t,"body"),this.processors=[new o(t),new r(t)]},addShapesItem:function(t,e){for(var i,s,n,a=0;a<e.shapes.length;a++){i=e.shapes[a];for(var o=0;o<this.processors.length;o++)
if(this.processors[o].match(i)){s=this.processors[o].createShape(i),n=this.addShapeItemShape(t,e,s),i.fixtureConfig&&n.SetUserData(i.fixtureConfig);break}}}});e.elem.CircleProcessor=o,e.elem.PolygonProcessor=r,e.elem.BodyProcessor=h}(Box2D,cj),function(t,e){function i(t,e){this.body=t,this.joint=e}
var s=t.Common.Math.b2Vec2,n=e.elem.TypeProcessorBase.extend({init:function(t,e,i){e?this._super(t,e):this._super(t,"snot"),this.partSize=i?i:1.2*n.PART_SIZE},processItem:function(t){var a=new s(t.start.x,this.world.box2dHeight-t.start.y),o=new s(t.end.x,this.world.box2dHeight-t.end.y),r=this.getRopeMetrics(a,o),h=e.util.Box2dUtil.queryAABBFromRadius(this.world.b2World,a,.5);if(h.sort(function(t,i){var s=t.GetBody().GetUserData(),n=i.GetBody().GetUserData();return s instanceof e.elem.DragableBodyClip?-1:n instanceof e.elem.DragableBodyClip?1:0}),h=h[0]){h=h.GetBody();var l=h.GetUserData();null!=l&&(l instanceof e.elem.EnergyBodyClip||l instanceof e.elem.PlasticinePartBodyClip)&&(h=this.world.ground)}else h=this.world.ground;var d=e.util.Box2dUtil.createCircle(this.world.b2World,n.JOINT_CIRCLE_RADIUS,a,0,!0,this.getStartDensity(),!0);e.util.PlasticineConstants.applyActiveBodiesFilter(d);for(var c=e.util.Box2dUtil.createRevoluteJoint(h,d,a,!1,!1),u=d,m=[],p=[],g=new i(null,null),f=0;f<r.parts;f++)g=this.createPart(u,r.getPositionByIndex(f),r.getPositionByIndex(f+1),f,r.parts),m.push(g.body),p.push(g.joint),u=g.body;return new e.elem.SnotData(d,c,h,h.GetLocalPoint(a),m,p,r)},getDensity:function(t,e){return t==e-1?n.END_DENSITY:n.DENSITY},getStartDensity:function(){return n.DENSITY},getRopeMetrics:function(t,i,s,a){return e.util.RopeMetrics.getRopeMetrics(t,i,this.partSize,n.MIN_SNOT_PARTS)},linearDamping:function(){return n.LINEAR_DAMPING},createPart:function(t,e,s,n,a){var o=this.getDensity(n,a),r=this.createPartBody(e,s,o,n,a);r.SetLinearDamping(this.linearDamping());var h=this.joinBodies(t,r,e,s);return new i(r,h)},createPartBody:function(t,i,s,a,o){return e.util.Box2dUtil.createCircle(this.world.b2World,n.JOINT_CIRCLE_RADIUS,i,0,!0,s,!0)},joinBodies:function(t,i,s,a){return e.util.Box2dUtil.createDistanceJoint(t,i,!1,5,n.DAMPING)}});n.MIN_SNOT_PARTS=3,n.PART_SIZE=50*e.util.Box2dUtil.sizeMultiplier,n.DENSITY=.13,n.END_DENSITY=1.7*n.DENSITY,n.LINEAR_DAMPING=1,n.DAMPING=.1,n.JOINT_CIRCLE_RADIUS=5*e.util.Box2dUtil.sizeMultiplier;var a=n.extend({init:function(t){this._super(t,"backSnot",100*e.util.Box2dUtil.sizeMultiplier)},getDensity:function(t,e){return.3}});e.elem.SnotProcessor=n,e.elem.BackSnotProcessor=a}(Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=60,n=5,a=e.elem.EntityBase.extend({init:function(t,i,s){this._super(i,null,s,t),this.setZOrder(e.util.EntityZOrder.BACKGROUND),this.img=new e.util.Bitmap(t.type)},draw:function(t){this.world.isCulling||this.img.draw(t.particle,this.transform)}}),o=a.extend({init:function(t,s,n){this._super(t,s,n),this.initialPosition=this.transform.position.Copy(),this.destination=this.transform.position.Copy();var a=new i,o=t.config.moveOffset;if(o&&(o=o.split(","),a.x=parseFloat(o[0]),a.y=-parseFloat(o[1])),this.destination.Add(a),!this.supressScheduledMove){var r=this;e.util.newStepAction(e.util.ScheduleContext.LEVEL,null,function(t,i){e.util.Box2dUtil.b2Vec2Lerp(r.initialPosition,r.destination,1-i/t,r.transform.position)},60)}}}),r=o.extend({init:function(t,i,s){this._super(t,i,s),this.rotationStep=e.util.Maths.toRadians(t.config.speed/2)},update:function(t){this.transform.rotation+=this.rotationStep*t.delta*30}}),h=r.extend({init:function(t,s,n){this._super(t,s,n),this.centerPosition=this.transform.position.Copy(),this.radius=40,this.centerPosition.x+=this.radius,this.rotationStep=e.util.Maths.toRadians(.2),this.positionDiff=new i},update:function(t){this._super(t),e.util.Box2dUtil.toVec(this.radius,2*this.transform.rotation,this.positionDiff),this.positionDiff.Add(this.centerPosition),e.util.Box2dUtil.b2Vec2Copy(this.positionDiff,this.transform.position)}}),l=a.extend({init:function(t,e,i){this._super(t,e,i),this.updateCount=0,this.world.canShowIntro?(this.world.forcePlasticineDraw=!0,this.alpha=245/255):this.img.alpha=0},update:function(t){this.world.lightPower=1-this.img.alpha,this.img.alpha>0&&(this.updateCount<=0?(this.world.forcePlasticineDraw=!0,this.updateCount=n):(this.world.forcePlasticineDraw=!1,this.updateCount--),this.alpha-=2*t.delta/s,this.img.alpha=this.alpha,this.img.alpha<0&&(this.img.alpha=0,this.world.forcePlasticineDraw=!1))}}),d=o.extend({init:function(t,e,i){this.supressScheduledMove=!e.canShowIntro,this._super(t,e,i),e.canShowIntro||this.transform.setPosition(this.destination.x,this.destination.y)}}),c=a.extend({});e.elem.BackgroundBase=a,e.elem.MoveBackground=o,e.elem.RotatableBackground=r,e.elem.RadiusRotatableBackground=h,e.elem.FadeBackground=l,e.elem.SunBackground=d,e.elem.LightPowerBackground=c}(Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=(t.Dynamics.b2Body,e.elem.SnotBodyClip.extend({init:function(t,i,a,o){this._super(t,i,a,o),this.eye=new n(this,a,e.util.GameImages.McSnotStart),this.startWidth=20,this.centerWidth=10,this.endWidth=10,this.texture=new e.util.Bitmap(e.util.GameImages.McStrongSnotTexture),this.world.isBlackSide()?(this.color1=new e.util.Color(0,54,70,1),this.color2=new e.util.Color(0,102,131,1)):this.world.isWhiteSide()?(this.color1=new e.util.Color(202,202,202,1),this.color2=new e.util.Color(160,160,160,1)):this.world.isValentine()?(this.color1=new e.util.Color(128,108,141,1),this.color2=new e.util.Color(128,108,141,1)):(this.color1=new e.util.Color(30,30,30,1),this.color2=new e.util.Color(90,90,90,1)),this.endBall=new e.util.Bitmap(e.util.GameImages.McStrongSnotEnd),this.eye.setEyeScale(.95,.95),this.normalDistance=this.currentDistance(),this.maxDistance=Math.max(this.normalDistance*s.MAX_DISTANCE_MULT,this.normalDistance+s.MAX_STRETCHING),this.extremeDistance=2*this.normalDistance,this.timeToRelease=0,this.redAlpha=0,this.eye.setRedAlpha(0)},createHighlight:function(){},update:function(t){this._super(t);var i=(this.targetR,this.currentDistance()),n=this.canRelease();if(this.stickyJoint&&i>this.maxDistance&&n)this.redAlpha=e.util.Maths.stepTo(this.redAlpha,1,s.COLOR_STEP),this.timeToRelease>s.RELEASE_TIME||i>this.extremeDistance?this.release():this.timeToRelease+=t.delta;else{var a=0;n&&i>this.normalDistance&&(a=Math.min(.65,(i-this.normalDistance)/this.normalDistance)),this.redAlpha=e.util.Maths.stepTo(this.redAlpha,a,s.COLOR_STEP),this.timeToRelease=0}
this.eye.setRedAlpha(this.redAlpha)},draw:function(t){if(this.world.useSnots){var i=t.foreground;e.util.DrawUtil.drawSegmentsWithTexture(i,this.drawPoints,this.texture,this.color1.toString(),this.color2.toString()),i.fillStyle="black",this.eye.draw(t),this.endBall.drawNoTransform(i,this.endPosition.x,this.endPosition.y,0,1,1),i.restore()}},currentDistance:function(){return e.util.Box2dUtil.b2Vec2Distance(this.snotData.firstBody().GetPosition(),this.snotData.endBody().GetPosition())},dragDistanceMultiplier:function(){return s.DRAG_DISTANCE_MULTIPLIER},joinDistance:function(){return s.JOIN_DISTANCE},applyDisconnectForce:function(){},setDamping:function(t){},onSound:function(){return e.util.GameSounds.ropeOn},canRelease:function(){return this.stickyJoint?this.linkedObject.isHero()?this.linkedObject.snotJoinedCount>1||this.linkedObject.isOnGround():!0:!1}}));s.MAX_DISTANCE_MULT=1.3,s.MAX_STRETCHING=2.33,s.RELEASE_TIME=.6,s.DRAG_DISTANCE_MULTIPLIER=1,s.JOIN_DISTANCE=.2,s.COLOR_STEP=20/255,s.ZERO_VEC=new i;var n=e.elem.SnotEye.extend({init:function(t,s,n){this._super(t,s,n),this.eyeSprite=new e.elem.RedEye(s,this.snot.snotData.eyeBody),this.isRed=!1,this.timeToShake=0,this.minShakeTime=.075,this.shakeTime=this.minShakeTime,this.minVariance=.5,this.shakeVariance=this.minVariance,this.shakeTarget=new i,this.shakeVec=new i},update:function(t){this._super(t),this.isRed?(this.timeToShake+=t.delta,this.timeToShake>this.shakeTime&&(this.timeToShake=0,this.shakeTarget.x=e.util.Maths.randRange(-this.shakeVariance,this.shakeVariance),this.shakeTarget.y=e.util.Maths.randRange(-this.shakeVariance,this.shakeVariance))):e.util.Box2dUtil.b2Vec2Copy(s.ZERO_VEC,this.shakeTarget),e.util.Box2dUtil.b2Vec2Lerp(s.ZERO_VEC,this.shakeTarget,this.timeToShake/this.shakeTime,this.shakeVec),this.eyeSprite.addToPositionV(this.shakeVec)},setRedAlpha:function(t){this.eyeSprite.redOverlay.alpha=t,this.setRandomAnimations(.05>=t),this.isRed=t>.05,this.shakeVariance=this.minVariance+t*this.minVariance,this.shakeTime=this.minShakeTime-.06*t},setRandomAnimations:function(t){this.eyeSprite.allowRandomAnimation=t}});e.elem.StrongSnotBodyClip=s,e.elem.StrongSnotEye=n}(Box2D,cj),function(t){var e=t.elem.SnotProcessor.extend({init:function(e,i,s){this._super(e,i?i:"strongSnot",s?s:t.elem.SnotProcessor.PART_SIZE/3*2)},joinBodies:function(e,i,s,n){return t.util.Box2dUtil.createRevoluteJoint(e,i,n,!1,!1)},getDensity:function(e,i){return t.elem.SnotProcessor.DENSITY+(i-e)/i*t.elem.SnotProcessor.DENSITY},getStartDensity:function(){return 10},linearDamping:function(){return 0}});t.elem.StrongSnotProcessor=e}(cj),function(t,e){var i=t.Common.Math.b2Vec2,s=e.elem.SnotBodyClipBase.extend({init:function(n,a,o,r){this._super(n,a,o,r),this.startWidth=15,this.centerWidth=6,this.endWidth=15,this.startBallWidth=this.endBallWidth;for(var h,l=2;l<this.snotData.bodiesSize()-2;l++)h=this.snotData.bodyAt(l).GetUserData(),h&&(h.parent=this);var d=this.snotData.getWorldStartPoint(),c=this.snotData.endBody().GetPosition();this.center=t.Common.Math.b2Math.AddVV(d,c),this.startTrampolineWidth=t.Common.Math.b2Math.SubtractVV(d,c).Length(),this.center.Multiply(.5),this.centerInPixels=this.center.Copy(),this.centerInPixels.Multiply(this._SCALE),this.normal=t.Common.Math.b2Math.SubtractVV(c,d),this.normal=e.util.Box2dUtil.rotate90(this.normal),this.normal.Multiply(1/this.normal.Length()),this.impulseMultiplier=this.startTrampolineWidth/s.DEFAULT_WIDTH,this.startDistance=this.impulseMultiplier*s.START_CENTER_DISTANCE,this.maxDistance=this.impulseMultiplier*s.MAX_CENTER_DISTANCE,this.centerDistanceDiff=this.maxDistance-this.startDistance,this.path=new e.elem.ParticleSystem(this.world,this.centerBody(),e.util.GameImages.McTrampolinePath),this.path.setZOrder(e.util.EntityZOrder.TRAMPOLINE_PATH),this.path.alpha=0;for(var u,l=0;l<s.PATH_PARTS;l++)u=this.path.addParticle(),u.opacity=1-Math.abs(l-3)/(s.PATH_PARTS-3),u.setPosition(s.PATH_PART_DISTANCE*l*this.impulseMultiplier,0);this.dragTarget=new i,this.touchId=-1,this.dragJoint=null,this.timeFromLaunch=s.POST_LAUNCH_TIME,this.setJointsDamping(1),this.launchBodies=[],this.bodies=[],this.impulseVec=void 0;var m=this.world.isBlackSide(),p=this.world.isWhiteSide();m||p?(this.calculateDrawPoints(),m?(this.startColor=new e.util.Color(0,72,101,1),this.endColor=new e.util.Color(0,255,255,1)):(this.startColor=new e.util.Color(160,160,160,1),this.endColor=new e.util.Color(204,204,204,1)),this.colors=e.util.DrawUtil.calculateColorsTowardsCenter(this.drawPoints,this.startColor,this.endColor),this.startColor=this.startColor.toString(),this.endColor=this.endColor.toString()):(this.startColor="black",this.endColor="black"),this.endBall=new e.util.Bitmap(e.util.GameImages.McTrampolineEnd),this.dragEvent=new e.util.EventSender,this.heroTouchEvent=new e.util.EventSender,this.steppedDragTarget=new i,this.contactForce=new i,this.bodyImpulseVec=new i},update:function(t){this._super(t),this.timeFromLaunch+=t.delta;var i=0;if(this.dragging){e.util.Box2dUtil.b2Vec2SubtractRef(this.dragTarget,this.center,this.steppedDragTarget);var n=e.util.Box2dUtil.getProjection(this.steppedDragTarget,this.normal);if(n>-s.START_CENTER_DISTANCE)this.stopDrag(),this.world.freeTouch(this.touchId);else{i=.5;var a=this.steppedDragTarget.Length();a>this.maxDistance&&(this.steppedDragTarget.Multiply(this.maxDistance/a),a=this.maxDistance);for(var o,r=e.util.Box2dUtil.atan2Vec(this.steppedDragTarget),h=s.PATH_PART_DISTANCE*Math.max(a-s.START_CENTER_DISTANCE,1)*this.impulseMultiplier,l=Math.cos(r),d=Math.sin(r),c=0;c<this.path.particles.length;c++)o=this.path.particles[c],o.setPosition(this.centerInPixels.x-l*h*c,this.centerInPixels.y-(d*h*c-1.6*c*c));e.util.Box2dUtil.b2Vec2AddRef(this.steppedDragTarget,this.center,this.steppedDragTarget),e.util.Box2dUtil.stepToVec(this.centerBody().GetWorldCenter(),this.steppedDragTarget,s.MAX_STEP,this.steppedDragTarget),this.dragJoint.SetTarget(this.steppedDragTarget);for(var u,m,p,c=0;c<this.snotData.bodiesSize();c++)
for(u=this.snotData.bodyAt(c),m=u.GetContactList();m;)p=m.other,p.GetFixtureList().IsSensor()||(e.util.Box2dUtil.b2Vec2SubtractRef(this.centerBody().GetWorldCenter(),p.GetWorldCenter(),this.contactForce),this.contactForce.Multiply(1/this.contactForce.Length()),this.contactForce.Multiply(s.TO_CENTER_FORCE*p.GetMass()*t.delta*30),p.ApplyForce(this.contactForce,p.GetWorldCenter())),m=m.next}}
this.path.alpha=e.util.Maths.stepTo(this.path.alpha,i,.05)},draw:function(t){if(this.world.useSnots){var i=t.foreground;i.save(),this.colors?e.util.DrawUtil.drawSegmentsWithColors(i,this.drawPoints,this.colors):e.util.DrawUtil.drawBezier(i,this.drawPoints,this.startColor),this.endBall.drawNoTransform(i,this.startPosition.x,this.startPosition.y,0,1,1),this.endBall.drawNoTransform(i,this.endPosition.x,this.endPosition.y,0,1,1),this.path.draw(t),i.restore()}},startTouch:function(t){this.touchId=t.id,this.dragging=!0,this.dragTarget.x=t.x/30,this.dragTarget.y=t.y/30;var i=this.centerBody();this.dragJoint=e.util.Box2dUtil.createMouseJoint(i,i.GetWorldCenter(),s.DRAG_FORCE,100),this.dragEvent.sendEvent(),this.setJointsDamping(20)},moveTouch:function(t){this.dragTarget.x=t.x/30,this.dragTarget.y=t.y/30},endTouch:function(t){this.launch(),this.stopDrag()},onCollisionStart:function(t,i){t.GetUserData()instanceof e.elem.HeroBodyClip&&this.heroTouchEvent.sendEvent(),this.timeFromLaunch<s.POST_LAUNCH_TIME&&this.launchBodies.indexOf(t)<0&&(this.launchBodies.push(t),e.util.Box2dUtil.b2Vec2Copy(this.impulseVec,this.bodyImpulseVec),this.bodyImpulseVec.Multiply(t.GetMass()),t.SetLinearVelocity(s.ZERO_VEC),t.ApplyImpulse(this.bodyImpulseVec,t.GetWorldCenter()))},stopDrag:function(){this.dragging=!1,this.world.b2World.DestroyJoint(this.dragJoint),this.setJointsDamping(1)},centerBody:function(){return this.snotData.bodyAt(Math.floor(this.snotData.bodiesSize()/2))},setJointsDamping:function(t){for(var e,i=1;i<this.snotData.jointsSize();i++)e=this.snotData.jointAt(i),e.SetDampingRatio(t)},launch:function(){e.util.soundController.playSoundEffect(e.util.GameSounds.effects.landing3,70);var i=t.Common.Math.b2Math.SubtractVV(this.center,this.centerBody().GetWorldCenter()),n=i.Length();if(!(n<=s.START_CENTER_DISTANCE)){this.launchBodies.length=0,this.bodies.length=0;for(var a,o,r,h,l=0;l<this.snotData.bodiesSize();l++)
for(a=this.snotData.bodyAt(l),o=a.GetContactList(),r=e.util.Box2dUtil.b2Vec2Distance(a.GetWorldCenter(),this.center),this.bodies.push(a);o;)o.contact.IsTouching()&&(h=e.util.Box2dUtil.b2Vec2Distance(o.other.GetWorldCenter(),this.center),r>h&&this.launchBodies.push(o.other)),o=o.next;i.Multiply(1/n);var d=(n-this.startDistance)/this.centerDistanceDiff*this.impulseMultiplier;this.launchBodiesImpulseDirection(this.bodies,s.MAX_LAUNCH_IMPULSE*d,i),this.launchBodiesImpulseDirection(this.launchBodies,s.BODY_LAUNCH_IMPULSE*d,i),this.impulseVec=i,this.impulseVec.Multiply(s.BODY_LAUNCH_IMPULSE*d),this.timeFromLaunch=0}},launchBodiesImpulseDirection:function(t,i,n){for(var a,o=0;o<t.length;o++)a=t[o],e.util.Box2dUtil.b2Vec2Copy(n,this.bodyImpulseVec),this.bodyImpulseVec.Multiply(i*a.GetMass()),a.SetLinearVelocity(s.ZERO_VEC),a.ApplyImpulse(this.bodyImpulseVec,a.GetWorldCenter())}});s.POST_LAUNCH_TIME=.3,s.DEFAULT_WIDTH=6.533333,s.PATH_PARTS=7,s.PATH_PART_DISTANCE=14,s.TO_CENTER_FORCE=3,s.MAX_STEP=50/30,s.MAX_CENTER_DISTANCE=5,s.START_CENTER_DISTANCE=1.621671,s.BODY_LAUNCH_IMPULSE=22,s.MAX_LAUNCH_IMPULSE=6,s.DRAG_FORCE=500,s.ZERO_VEC=new i;var n=e.elem.EntityBase.extend({init:function(t,e){this._super(t,e),this.body.SetUserData(this),this.data=null,this.parent=null},isClickable:function(){return this.parent&&!this.parent.dragging},isTouchSwipable:function(){return!0},startTouch:function(t){return this.parent&&!this.parent.dragging?(this.parent.startTouch(t),!0):!1},moveTouch:function(t){this.parent&&this.parent.moveTouch(t)},endTouch:function(t){this.parent&&this.parent.endTouch(t)},onCollisionStart:function(t,e){this.parent&&this.parent.onCollisionStart(t,e)},touchPriority:function(){return 0}});e.elem.TrampolineBodyClip=s,e.elem.TrampolinePartBodyClip=n}(Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=e.elem.StrongSnotProcessor.extend({init:function(t,e,i){this._super(t,e?e:"bridgeSnot",i?i:s.BRIDGE_PART_SIZE)},createPartBody:function(t,n,a,o,r){var h=n.Copy(),l=this.getLocalPartPositions(t,n,o,r),d=new e.util.DrawUtil.PointsPair(new i,new i),c=new e.util.DrawUtil.PointsPair(new i,new i);e.util.DrawUtil.getPointsPair(d,l.start,l.start,l.end,s.BRIDGE_WIDTH),e.util.DrawUtil.getPointsPair(c,l.end,l.start,l.end,s.BRIDGE_WIDTH);var u=[c.first,c.second,d.second,d.first],m=e.util.Box2dUtil.createBoxByVertices(this.world.b2World,h,u,0,!1,a,!0);return e.util.PlasticineConstants.applyActiveBodiesFilter(m),m},getLocalPartPositions:function(e,i,s,n){return e=t.Common.Math.b2Math.SubtractVV(e,i),i.x=i.y=0,{start:e,end:i}},joinBodies:function(i,s,n,a){return e.util.Box2dUtil.createRevoluteJoint(i,s,t.Common.Math.b2Math.SubtractVV(n,s.GetPosition()),!1,!1)}});s.BRIDGE_WIDTH=10/30,s.BRIDGE_PART_SIZE=25/30;var n=s.extend({init:function(t){this._super(t,"trampoline",.5*e.elem.SnotProcessor.PART_SIZE),this.parts=[]},getDensity:function(t,e){return 2},getLocalPartPositions:function(e,i,s,n){var a=t.Common.Math.b2Math.SubtractVV(e,i),o=a.Copy();return s>0&&a.Multiply(1.25),s!==n-1?o.Multiply(-.25):o.x=i.y=0,{start:a,end:o}},getRopeMetrics:function(t,i){var s=this._super(t,i);return s.parts%2===0&&(s=e.util.RopeMetrics.getRopeMetrics(t,i,this.partSize,s.parts+1)),s},joinBodies:function(i,s,n,a){var o=t.Common.Math.b2Math.SubtractVV(n,a),r=t.Common.Math.b2Math.AddVV(o,a);o.Add(a);var h=e.util.Box2dUtil.createDistanceJointWithAnchors(i,s,r,o,!1,4.5,1);return h},createPartBody:function(t,i,s,n,a){var o=this._super(t,i,s,n,a);return e.util.PlasticineConstants.applyActiveBodiesFilter(o),o.SetAngularDamping(20),this.parts.push(new e.elem.TrampolinePartBodyClip(this.world,o)),o},processItem:function(t){this.parts.length=0;for(var s=this._super(t),n=0;n<this.parts.length;n++)this.parts[n].data=s;var a=new i(t.start.x,this.world.box2dHeight-t.start.y),o=new i(t.end.x,this.world.box2dHeight-t.end.y);return e.util.Box2dUtil.createRevoluteJoint(this.world.ground,s.endBody(),o,!1,!1),e.util.Box2dUtil.createRevoluteJoint(this.world.ground,s.firstBody(),a,!1,!1),s}});e.elem.TrampolineProcessor=n}(Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=e.elem.SnotBodyClipBase.extend({init:function(t,n,a,o){this._super(t,n,a,o),this.setZOrder(e.util.EntityZOrder.BACK_SNOT),this.force=.25,this.forceProgress=e.util.Maths.randRange(0,2*Math.PI),this.forceStep=e.util.Maths.randRange(.01,.02),this.stabilize=!1,this.stabilizeCalculated=!1;var r=t.scale;this.startWidth=6.2*r.x,this.centerWidth=2.5*r.x,this.endWidth=6.2*r.x,this.endBallWidth=.5*this.endWidth,this.snotData.endBody().SetUserData(this),this.eye=new e.elem.BackSnotEye(this.world,this.snotData.endBody());var h=r.x/s.BASE_SCALE;this.eye.setScale(h,h),this.eye.openEye(),this.color="rgb(61,61,60)",this.forceVec=new i},update:function(t){if(this._super(t),this.eye.update(t),!this.stabilizeCalculated){this.stabilizeCalculated=!0;var i=Math.ceil(e.util.Maths.simplifyAngle(this.transform.rotation,-180)/90);this.stabilize=e.util.Maths.fuzzyNotEqual(i,0)}
if(this.stabilize)
for(var s,n=0;n<this.snotData.bodiesSize();n++)s=this.snotData.bodyAt(n),e.util.Box2dUtil.applyAntigravity(s);else e.util.Box2dUtil.applyAntigravity(this.snotData.endBody());var a=.75*this.force+this.force*Math.cos(this.forceProgress)*.25;this.forceProgress+=this.forceStep,e.util.Box2dUtil.toVec(a,this.eye.viewAngle,this.forceVec),this.snotData.endBody().ApplyForce(this.forceVec,this.snotData.endBody().GetWorldCenter())},draw:function(t){if(this.world.useSnots&&!this.world.isCulling){var i=t.particle;i.save(),e.util.DrawUtil.drawBezier(i,this.drawPoints,this.color),e.util.Shader.shadePathSolidColorWithFade(i,61,30,7),i.restore(),this.eye.draw(t)}},touchPriority:function(){return-2},startTouch:function(t){var i=this.snotData.endBody();this.eye.positionProvider=this.world.getTouchProvider(t);var n=e.util.Box2dUtil.b2Vec2Subtract(this.snotData.getWorldStartPoint(),i.GetPosition());return n.Multiply(s.SCARE_FORCE/n.Length()),i.ApplyImpulse(n,i.GetWorldCenter()),e.util.soundController.playSoundEffect(e.util.GameSounds.random(e.util.GameSounds.backSnot),e.util.Maths.randRange(30,50)),Math.random()<.5&&e.util.soundController.playSoundEffect(e.util.GameSounds.effects.backgroundEyeHit0,e.util.Maths.randRange(30,50)),!0},isClickable:function(){return!0},isTouchSwipable:function(){return!1}});s.SCARE_FORCE=.7,s.BASE_SCALE=11.24,e.elem.BackSnotBodyClip=s}(Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=t.Dynamics.b2Body,n=new i,a=3.4,o=.588,r=1,h=.02,l=1.66,d=26.67,c=.3,u=1-c,m=e.elem.EntityBase.extend({init:function(t,n,r,h){this._super(r,n,h,t),this.setZOrder(e.util.EntityZOrder.DRAGGER),this.image=new e.util.Bitmap(this.imageId),this.dragStartEvent=new e.util.EventSender,this.limitSpeed=!1,this.currentAlpha=o,this.initialPosition=this.body.GetPosition().Copy(),this.targetPosition=this.initialPosition.Copy(),this.initialMousePosition=new i,this.initialDragOffset=new i,this.touchOffset=new i,this.touchPoint=new i,this.touch=null,this.axis=new i,e.util.Box2dUtil.toVec(1,e.util.Maths.toRadians(t.rotation),this.axis);var l=t.scaleX;this.upperLimit=a*l,this.lowerLimit=-a*l,this.createBoundsClip(l),this.body.SetUserData(this),this.body.SetType(s.b2_kinematicBody),this.speed=new i,this.diff=new i},imageId:e.util.GameImages.McDragSquareView,update:function(t){this._super(t),this.body.SetLinearVelocity(n),this.touch&&this.updateTouchPosition(t),this.moveToTarget(t),e.util.Maths.fuzzyEqual(t.delta,0)||this.body.GetType()!==s.b2_dynamicBody||(this.body.SetType(s.b2_staticBody),this.body.SetPositionAndAngle(this.initialPosition,this.body.GetAngle()));var i=this.dragging?r:o;this.setAlpha(e.util.Maths.stepTo(this.currentAlpha,i,h))},draw:function(t){var e=t.foreground;this.image.draw(e,this.transform)},isClickable:function(){return!0},isTouchSwipable:function(){return!0},touchPriority:function(){return 1},startTouch:function(t){return!this.touch&&this.processTouch(t)?(this.limitSpeed=!1,this.touch=t,this.dragging=!0,e.util.Box2dUtil.b2Vec2Copy(this.touchPoint,this.initialMousePosition),e.util.Box2dUtil.b2Vec2Copy(e.util.Box2dUtil.b2Vec2Subtract(this.body.GetPosition(),this.initialPosition),this.initialDragOffset),this.dragStartEvent.sendEvent(),!0):!1},moveTouch:function(t){},endTouch:function(t){this.dragging=!1,this.touch=null},processTouch:function(t){this.touchPoint.x=t.x/30,this.touchPoint.y=t.y/30;var i=e.util.Box2dUtil.b2Vec2Add(this.body.GetPosition(),this.touchOffset),s=e.util.Box2dUtil.b2Vec2Distance(this.touchPoint,i);return l>s},updateTouchPosition:function(t){this.touchPoint.x=this.touch.x/30,this.touchPoint.y=this.touch.y/30;var i=e.util.Box2dUtil.b2Vec2Add(e.util.Box2dUtil.b2Vec2Subtract(this.touchPoint,this.initialMousePosition),this.initialDragOffset);this.dragUpdateTargetPosition(i)},dragUpdateTargetPosition:function(t){var i=e.util.Box2dUtil.getProjection(t,this.axis);i=e.util.Maths.clamp(i,this.lowerLimit,this.upperLimit),e.util.Box2dUtil.b2Vec2Copy(this.axis,this.targetPosition),this.targetPosition.Multiply(i),e.util.Box2dUtil.b2Vec2AddRef(this.targetPosition,this.initialPosition,this.targetPosition)},moveToTarget:function(t){e.util.Maths.fuzzyEqual(t.delta,0)||e.util.Box2dUtil.b2Vec2FuzzyEqual(this.targetPosition,this.body.GetPosition())||(e.util.Box2dUtil.b2Vec2SubtractRef(this.targetPosition,this.body.GetPosition(),this.diff),this.limitSpeed&&e.util.Box2dUtil.clampLength(this.diff,d*t.delta,this.diff),e.util.Box2dUtil.b2Vec2Copy(this.diff,this.speed),this.speed.Multiply(c/t.delta),this.diff.Multiply(u),this.body.SetLinearVelocity(this.speed),this.body.SetPosition(e.util.Box2dUtil.b2Vec2Add(this.body.GetPosition(),this.diff))),e.util.Box2dUtil.wakeUpJoined(this.body)},createBoundsClip:function(t){this.limitSystem=new e.elem.ForegroundParticleSystem(this.world,null,e.util.GameImages.McDragViewLimit);var s=new i;e.util.Box2dUtil.toVec(30*this.upperLimit,this.rotationOffset,s);var n=this.transform.position.Copy();n.x=Math.floor(n.x),n.y=Math.floor(n.y),this.left=this.limitSystem.addParticleWithFrame(0),this.left.setPositionV(e.util.Box2dUtil.b2Vec2Subtract(n,s)),this.left.setRotation(this.transform.rotation),this.right=this.limitSystem.addParticleWithFrame(0),this.right.setPositionV(e.util.Box2dUtil.b2Vec2Add(n,s)),this.right.setRotation(this.transform.rotation),this.right.setScale(-1,1),this.middle=this.limitSystem.addParticleWithFrame(1),this.middle.setPositionV(e.util.Box2dUtil.b2Vec2Add(n,s)),this.middle.setRotation(this.transform.rotation),this.middle.setScale(s.Length()/this.limitSystem.particleImage.clipData.width*2,1),this.world.entities.add(this.limitSystem),this.limitSystem.setZOrder(1),this.setAlpha(o)},setAlpha:function(t){this.currentAlpha=t,this.limitSystem.baseOpacity=t}});e.elem.DragableBodyClip=m}(Box2D,cj),function(t,e){var i=200,s=200,n=42,a=(t.Common.Math.b2Vec2,t.Dynamics.b2Body,e.elem.DragableBodyClip.extend({init:function(t,i,s,a){this._super(t,i,s,a);var o=n*e.util.Box2dUtil.sizeMultiplier;this.touchOffset.x=o,this.touchOffset.y=-o},draw:function(t){var e=t.foreground;this.bgCircleImage.draw(e,this.bgTransform),this._super(t)},imageId:e.util.GameImages.McRoundDragSquareView,createBoundsClip:function(t){this.bgCircleImage=new e.util.Bitmap(e.util.GameImages.McRoundDragFrameView);var n=t*s/i;this.bgTransform=new e.util.Transform,this.bgTransform.copy(this.transform.initial),this.bgTransform.setScale(n,n),this.radius=s*t*e.util.Box2dUtil.sizeMultiplier/2},dragUpdateTargetPosition:function(t){e.util.Box2dUtil.clampLength(t,this.radius,t),e.util.Box2dUtil.b2Vec2AddRef(this.initialPosition,t,this.targetPosition)},setAlpha:function(t){this.currentAlpha=t,this.bgCircleImage.alpha=t}}));e.elem.RoundDragBodyClip=a}(Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=e.elem.EntityBase.extend({init:function(t,e,n){this._super(t,e),this.updateEnabled=!1,this.frames=s.FRAMES_TO_LIVE,this.currentPosition=new i,this.previousPosition=this.body.GetPosition().Copy(),this.previousPosition.Multiply(this._SCALE),this.previousCenter=new i,this.currentCenter=new i,this.target=new i,this.currentFrame=0,this.width=s.TAIL_WIDTH,this.bezierPoints=[],this.removeFrames=[],this.drawPoints=[],this.currentPoints=[];for(var a=0;20>a;a++)this.currentPoints.push(new i);this.color=n,this.colorString=this.color.toString(),this.alpha=1,this.visible=!0,this.cull=!1,this.forceRedraw=!1},update:function(t){var n=this.body?this.body.GetPosition():this.target;e.util.Box2dUtil.b2Vec2Copy(n,this.currentPosition),this.currentPosition.Multiply(this._SCALE);var a=!0;if(!e.util.Box2dUtil.b2Vec2FuzzyEqual(this.previousPosition,s.ZERO)){if(e.util.Box2dUtil.getCenter(this.previousPosition,this.currentPosition,this.currentCenter),e.util.Box2dUtil.b2Vec2FuzzyEqual(this.previousCenter,s.ZERO))this.removeFrames.unshift(this.currentFrame),this.bezierPoints.unshift(this.currentPosition.Copy());else{var o=e.util.Box2dUtil.b2Vec2Distance(this.previousCenter,this.currentCenter);if(a=o>s.MIN_DISTANCE){var r=Math.ceil(o/s.PART_DISTANCE);r>20&&(r=20),e.util.Maths.getBezierPoints(this.previousCenter,this.previousPosition,this.currentCenter,r,!1,this.currentPoints,0);for(var h=0;r>h;h++)this.removeFrames.unshift(this.currentFrame);0===this.bezierPoints.length&&this.bezierPoints.push(new i),e.util.Box2dUtil.b2Vec2Copy(this.currentPosition,this.bezierPoints[0]);for(var h=0;r>h;h++)this.bezierPoints.splice(1,0,this.currentPoints[h].Copy())}}
this.createPairs()}
a&&(e.util.Box2dUtil.b2Vec2Copy(this.currentCenter,this.previousCenter),e.util.Box2dUtil.b2Vec2Copy(this.currentPosition,this.previousPosition)),this.removeTail(),this.currentFrame++},draw:function(t){if(!(this.drawPoints.length<3||!this.visible||this.cull&&this.world.isCulling&&!this.forceRedraw)){var e=this.cull?t.particle:t.foreground;e.save(),e.fillStyle=this.colorString,e.globalAlpha=this.alpha,e.beginPath();var i,s=this.drawPoints[0].first;e.moveTo(s.x,s.y);for(var n=0;n<this.drawPoints.length-1;n+=2)s=this.drawPoints[n].first,i=this.drawPoints[n+1].first,e.quadraticCurveTo(s.x,s.y,i.x,i.y);for(var n=this.drawPoints.length-1;n>0;n--)s=this.drawPoints[n].second,i=this.drawPoints[n-1].second,e.quadraticCurveTo(s.x,s.y,i.x,i.y);e.closePath(),e.fill(),e.restore(),this.forceRedraw=!1}},length:function(){return this.bezierPoints.length},createPairs:function(){this.drawPoints.length=0;for(var t,i,s,n=this.bezierPoints.length+1,a=this.bezierPoints.length-1;a>=0;a--)
if(t=a===this.bezierPoints.length-1?this.bezierPoints[this.bezierPoints.length-1]:this.bezierPoints[a+1],i=0===a?this.currentPosition:this.bezierPoints[a-1],s=this.width*(1-(a+1)/n),s>1){var o=new e.util.DrawUtil.PointsPair;e.util.DrawUtil.getPointsPair(o,this.bezierPoints[a],t,i,s),this.drawPoints.push(o)}},removeTail:function(){for(var t=this.currentFrame-this.frames;this.removeFrames.length>0&&this.removeFrames[this.removeFrames.length-1]<=t;)this.removeFrames.pop(),this.bezierPoints.pop()},setCull:function(t){this.cull!==t&&(this.cull=t,this.cull&&(this.forceRedraw=!0))}});s.FRAMES_TO_LIVE=25,s.MIN_DISTANCE=1,s.PART_DISTANCE=3,s.TAIL_WIDTH=30,s.ZERO=new i,e.elem.BlackTail=s}(Box2D,cj),function(t){function e(){this.STAR_SCORE=1e3,this.TIME_SCORE=2e3,this.MAX_LEVEL_TIME=60,this.time=0,this.stars=0,this.getTimeBonus=function(){return Math.round(Math.max(this.TIME_SCORE*(180-this.time)/180,0))},this.getStarBonus=function(){return Math.round(this.stars*this.STAR_SCORE)}}
t.util.Score=e}(cj),function(t,e){var i=t.Common.Math.b2Vec2,s=e.elem.PositionDependent.extend({init:function(t,s,n,a){this._super(t,s),this.viewAngle=0,this.viewDistance=0,this.targetPosition=new i,this.RADIUS=7,this.SCALE=30,this.EYE_CORNER_SPEED=3,this.STEP=.5,this.MIN_TIMEOUT=5,this.MAX_TIMEOUT=10,this.visible=!0,this.lockX=!1,this.lockY=!1,this.allowRandomAnimation=!0,this.eyeOffset=.5,this.targetOffset=new i,this.oldTargetOffset=new i,this.backEye=new e.util.Bitmap(a),this.eyeBall=new e.util.Bitmap(n),this.eyeAnimations=new e.util.BitmapAnimationCollection,this.eyeBallAnimations=new e.util.BitmapAnimationCollection,this.setAnimations(),this.shiftedEyeTransform=new e.util.Transform,this.transform.setInitial(this.transform)},update:function(t){this._super(t),this.transform.rotation=0,this.refresh(),e.util.Box2dUtil.stepToVec(this.oldTargetOffset,this.targetOffset,this.STEP,this.oldTargetOffset),this.visible&&(this.eyeAnimations.animationPlaying()&&this.eyeAnimations.update(t),this.eyeBallAnimations.animationPlaying()&&this.eyeBallAnimations.update(t))},draw:function(t){this.visible&&(this.shiftedEyeTransform.setPosition(this.transform.position.x+this.oldTargetOffset.x*this.eyeOffset*this.getScaleX(),this.transform.position.y+this.oldTargetOffset.y*this.eyeOffset*this.getScaleY()),this.shiftedEyeTransform.setScale(this.transform.scale.x,this.transform.scale.y),this.eyeAnimations.animationPlaying()?this.eyeAnimations.draw(t.foreground,this.shiftedEyeTransform):(this.backEye.draw(t.foreground,this.shiftedEyeTransform),this.drawOverlay(t.foreground,this.shiftedEyeTransform)),this.shiftedEyeTransform.setPosition(this.transform.position.x+this.oldTargetOffset.x*this.getScaleX(),this.transform.position.y+this.oldTargetOffset.y*this.getScaleY()),this.shiftedEyeTransform.setScale(this.transform.scale.x,this.transform.scale.y),this.shiftedEyeTransform.setScale(this.transform.scale.x,this.transform.scale.y),this.eyeBallAnimations.animationPlaying()?this.eyeBallAnimations.draw(t.foreground,this.shiftedEyeTransform):this.eyeBall.draw(t.foreground,this.shiftedEyeTransform))},drawOverlay:function(t,e){},setViewDistance:function(t){t!=this.viewDistance&&(this.viewDistance=e.util.Maths.normalizeValue(t,0,1))},refresh:function(){var t=this.RADIUS*this.viewDistance;this.targetOffset.x=t*Math.cos(this.viewAngle),this.targetOffset.y=t*Math.sin(this.viewAngle),this.lockX&&(this.targetOffset.x=0),this.lockY&&(this.targetOffset.y=0)},hasAnimations:function(){return this.eyeAnimations.hasAnimations()},playAnimation:function(t,e,i){var s=this;this.eyeAnimations.setAnimation(t,e,function(){s.onAnimationEnd(t),i&&i(t)}),s.onAnimation(t),this.eyeAnimations.currentAnimation&&(this.lockX=this.eyeAnimations.currentAnimation.lockX,this.lockY=this.eyeAnimations.currentAnimation.lockY)},playEyeAnimation:function(t,e,i){var s=this;this.eyeBallAnimations.setAnimation(t,e,function(){s.onAnimationEnd(t),i&&i(t)}),this.lockX=this.eyeBallAnimations.currentAnimation.lockX,this.lockY=this.eyeBallAnimations.currentAnimation.lockY},scheduleAnimation:function(t,i,s,n){var a=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){a.playAnimation(t,s,n)},i)},scheduleRandomAnimation:function(){var t=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){if(!t.eyeAnimations.animationPlaying()&&t.allowRandomAnimation){var e=t.eyeAnimations.setRandomAnimation(function(){t.onAnimationEnd(e)});t.lockX=t.eyeAnimations.currentAnimation.lockX,t.lockY=t.eyeAnimations.currentAnimation.lockY,t.onAnimation(e)}
t.scheduleRandomAnimation()},e.util.Maths.randRange(t.MIN_TIMEOUT,t.MAX_TIMEOUT))},onAnimation:function(t){},onAnimationEnd:function(t){this.lockX=!1,this.lockY=!1},addEyeAnimation:function(t,i,s,n,a){var o=new e.util.BitmapAnimation(t,!1);return o.lockX=n,o.lockY=a,this.eyeAnimations.add(o,i,s),o},addEyeBallAnimation:function(t,i,s,n,a){var o=new e.util.BitmapAnimation(t,!1);o.lockX=n,o.lockY=a,this.eyeBallAnimations.add(o,i,s)},setAnimations:function(){},changeTheme:function(t){this.backEye.changeTheme(t),this.eyeBall.changeTheme(t)}}),n=s.extend({init:function(t,i){this._super(t,i,e.util.GameImages.McEyeBall,e.util.GameImages.McEye),this.RADIUS=14,this.colorTime=0,this.colorProgress=0,this.isDefaultColor=!0,this.moveAllowed=!0,this.eyeClosed=!1,this.blueEye=new e.util.Bitmap(e.util.GameImages.McEyeBlue)},update:function(t){this._super(t),this.colorTime>0?(this.colorProgress=e.util.Maths.stepTo(this.colorProgress,1,.1),this.isDefaultColor=!1,this.colorTime-=t.delta):this.isDefaultColor||(this.colorProgress=e.util.Maths.stepTo(this.colorProgress,0,.1),e.util.Maths.fuzzyEqual(this.colorProgress,0)&&(this.isDefaultColor=!0,this.allowRandomAnimation=!0)),this.blueEye.alpha=this.colorProgress},drawOverlay:function(t,e){this.isDefaultColor||this.world.isBlackSide()||this.world.isWhiteSide()||this.blueEye.draw(t,e)},setAnimations:function(){this.addEyeAnimation(e.util.GameImages.McEyeSmile,"smile",!0,!1,!0),this.addEyeAnimation(e.util.GameImages.McEyeBlink,"blink",!0,!1,!1),this.addEyeAnimation(e.util.GameImages.McEyeAngry,"angry",!0,!1,!1),this.addEyeAnimation(e.util.GameImages.McEyeBlinkOneTime,"blinkonce",!0,!1,!0),this.addEyeAnimation(e.util.GameImages.McEyeWink,"wink",!0,!1,!0),this.addEyeAnimation(e.util.GameImages.McEyeCloseSlow,"closeSlow",!1,!1,!0),this.addEyeAnimation(e.util.GameImages.McEyeSleep,"sleep",!1,!1,!0),this.addEyeAnimation(e.util.GameImages.McEyeOpen,"open",!1,!1,!0),this.addEyeBallAnimation(e.util.GameImages.McEyeBallHit,"hit",!1,!0,!0);var t=this.addEyeAnimation(e.util.GameImages.McEyeClose,"close",!1,!1,!0);t.setPersistent()},setVelocity:function(t){var e=Math.atan2(t.y,t.x),i=t.Length();this.moveAllowed&&(this.viewAngle=e,this.setViewDistance(i/this.EYE_CORNER_SPEED))},setEyeMoveAllowed:function(t){this.moveAllowed=t,this.moveAllowed||this.setViewDistance(0)},eyeHit:function(){if(this.isDefaultColor){var t=this;this.eyeAnimations.stopCurrentAnimation(),this.allowRandomAnimation=!1,this.playEyeAnimation("hit",!0,function(){t.onHitEnd()})}},onHitEnd:function(){var t=this;this.playAnimation("blink",!0,function(){t.allowRandomAnimation=!0})},openEye:function(){if(this.isDefaultColor){var t=this;this.eyeAnimations.stopCurrentAnimation(),t.allowRandomAnimation=!1,this.playAnimation("open",!0,function(){t.allowRandomAnimation=!0})}},closeEye:function(){if(this.isDefaultColor){var t=this;this.eyeAnimations.stopCurrentAnimation(),this.playAnimation("closeSlow",!0,function(){t.onEyeClose()})}},onEyeClose:function(){this.eyeClosed=!0,this.playAnimation("sleep",!0),this.eyeAnimations.setManualMode(!0)},applyBonus:function(){this.colorTime=.5,this.world.isBlackSide()||(this.allowRandomAnimation=!1,this.eyeAnimations.stopCurrentAnimation())},onAnimation:function(t){switch(t){case "smile":e.util.soundController.playSoundEffect(e.util.GameSounds.random(e.util.GameSounds.laughs),75);break;case "angry":e.util.soundController.playSoundEffect(e.util.GameSounds.effects.angry2,75);break;case "blink":e.util.soundController.playSoundEffect(e.util.GameSounds.effects.clip1,75);break;case "blinkonce":e.util.soundController.playSoundEffect(e.util.GameSounds.effects.clip0,75);break;case "wink":e.util.soundController.playSoundEffect(e.util.GameSounds.random(e.util.GameSounds.suspicious),75)}}}),a=s.extend({init:function(t,i,s,n){this._super(t,i,s?s:e.util.GameImages.McEyeBallMonster,n?n:e.util.GameImages.McEyeMonster);var o=this;this.RADIUS=5,this.MIN_TIMEOUT=3,this.MAX_TIMEOUT=8,this.providerMinTime=a.PROVIDER_MIN_TIME,this.providerMaxTime=a.PROVIDER_MAX_TIME,this.visible=!1,this.changedOffSchedule=!1,this.world&&this.world.addPositionDependent(this);var o=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){o.changePositionProviderAndReschedule()},.1,"changePosition"),this.scheduleRandomAnimation()},update:function(t){if(this.positionProvider){var i=e.util.Box2dUtil.b2Vec2Subtract(this.positionProvider.providePosition(),this.transform.position);this.viewAngle=Math.atan2(i.y,i.x),this.setViewDistance(Math.min(i.LengthSquared(),1))}
this._super(t)},setAnimations:function(){this.addEyeAnimation(e.util.GameImages.McEyeBlinkMonster,"blink",!0,!1,!1),this.addEyeAnimation(e.util.GameImages.McEyeBlinkOneTimeMonster,"blinkonce",!0,!1,!1),this.addEyeAnimation(e.util.GameImages.McEyeOpenMonster,"open",!1,!1,!1),this.addEyeAnimation(e.util.GameImages.McEyeCloseMonster,"close",!1,!1,!1)},openEye:function(){this.visible||(this.visible=!0,this.playAnimation("open",!0),this.allowRandomAnimation=!0)},onEyeClose:function(){this.visible=!1,this.allowRandomAnimation=!1},closeEye:function(){var t=this;this.visible&&this.playAnimation("close",!0,function(){t.onEyeClose()})},providerAdded:function(t){Math.random()<.5&&(this.changePositionProvider(),this.changedOffSchedule=!0)},providerRemoved:function(t){this.positionProvider===t&&(this.changePositionProvider(),this.changedOffSchedule=!0)},changePositionProvider:function(){this.world&&(this.positionProvider=this.world.getRandomPositionProvider())},changePositionProviderAndReschedule:function(){this.changedOffSchedule?this.changedOffSchedule=!1:this.changePositionProvider();var t=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.changePositionProviderAndReschedule()},e.util.Maths.randRange(this.providerMinTime,this.providerMaxTime),"changePosition")}});a.PROVIDER_MIN_TIME=3,a.PROVIDER_MAX_TIME=15;var o=a.extend({init:function(t,i){this._super(t,i),this.redOverlay=new e.util.Bitmap(e.util.GameImages.McEyeMonsterRed)},drawOverlay:function(t,e){this.redOverlay.draw(t,e)}}),r=a.extend({init:function(t,i){this._super(t,i,e.util.GameImages.McBackSnotEyeBall,e.util.GameImages.McBackSnotEye),this.RADIUS=28,this.eyeOffset=.4,this.STEP=3,this.base=new e.util.Bitmap(e.util.GameImages.McBackSnotBase)},draw:function(t){var e=t.particle;this.base.draw(e,this.transform),this.visible&&(this.shiftedEyeTransform.setPosition(this.transform.position.x+this.oldTargetOffset.x*this.eyeOffset,this.transform.position.y+this.oldTargetOffset.y*this.eyeOffset),this.shiftedEyeTransform.setScale(this.transform.scale.x,this.transform.scale.y),this.eyeAnimations.animationPlaying()?this.eyeAnimations.draw(e,this.shiftedEyeTransform):this.backEye.draw(e,this.shiftedEyeTransform),this.shiftedEyeTransform.setPosition(this.transform.position.x+this.oldTargetOffset.x,this.transform.position.y+this.oldTargetOffset.y),this.shiftedEyeTransform.setScale(this.transform.scale.x,this.transform.scale.y),this.eyeBallAnimations.animationPlaying()?this.eyeBallAnimations.draw(e,this.shiftedEyeTransform):this.eyeBall.draw(e,this.shiftedEyeTransform))},setAnimations:function(){this.addEyeAnimation(e.util.GameImages.McBackSnotEyeBlink,"blink",!0,!1,!1),this.addEyeAnimation(e.util.GameImages.McBackSnotEyeBlinkOneTime,"blinkonce",!0,!1,!1)}}),h=s.extend({init:function(t){this._super(null,null,e.util.GameImages.McFakeHeroEyeBall,e.util.GameImages.McFakeHeroEye),this.RADIUS=12,this.STEP=2,this.MIN_TIMEOUT=3,this.MAX_TIMEOUT=7,this.transform=t},draw:function(t){this.visible&&(this.shiftedEyeTransform.setPosition(this.transform.position.x+.5*this.oldTargetOffset.x,this.transform.position.y+.5*this.oldTargetOffset.y),this.shiftedEyeTransform.setScale(this.transform.scale.x,this.transform.scale.y),this.eyeAnimations.animationPlaying()?this.eyeAnimations.draw(t,this.shiftedEyeTransform):this.backEye.draw(t,this.shiftedEyeTransform),this.shiftedEyeTransform.setPosition(this.transform.position.x+this.oldTargetOffset.x,this.transform.position.y+this.oldTargetOffset.y),this.shiftedEyeTransform.setScale(this.transform.scale.x,this.transform.scale.y),this.eyeBallAnimations.animationPlaying()?this.eyeBallAnimations.draw(t,this.shiftedEyeTransform):this.eyeBall.draw(t,this.shiftedEyeTransform))},setAnimations:function(){this.addEyeAnimation(e.util.GameImages.McFakeHeroEyeBlink,"blink",!0,!1,!1),this.addEyeAnimation(e.util.GameImages.McFakeHeroEyeSmile,"smile",!1,!1,!1)}});e.elem.HeroEye=n,e.elem.MonsterEye=a,e.elem.RedEye=o,e.elem.FakeHeroEye=h,e.elem.BackSnotEye=r}(Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=e.elem.PositionProvider.extend({init:function(s,n,a){s.entities.add(this);var o=new t.Dynamics.b2BodyDef;o.type=t.Dynamics.b2Body.b2_dynamicBody,o.position=new i(n.position.x/30,n.position.y/30);var r=s.b2World.CreateBody(o),h=new t.Collision.Shapes.b2CircleShape(.5);h.SetLocalPosition({x:o.position.x/30,y:-o.position.y/30});var l=new t.Dynamics.b2FixtureDef;l.shape=h,l.restitution=0,l.density=1,l.friction=1,r.CreateFixture(l),this._super(s,r),this._SCALE=30,this.body.SetUserData(this),this.body.SetActive(!0),this.body.ApplyForce(new i(100,-100),this.body.GetWorldCenter()),this.bitmap=new e.util.Bitmap(e.util.GameImages.McEyeDead),e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){s.game.restartLevel()},2,"Waiting to restart after DeadEye pops out")},update:function(t){this._super(t)},draw:function(t){this.bitmap.draw(t.foreground,this.transform)}});e.elem.DeadEye=s}(Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=t.Dynamics.b2Body,n={};n.CIRCLE_RANDOM=.5,n.CIRCLE_ANGLE=Math.PI/6,n.CIRCLE_DISTANCE_MAX=6,n.CIRCLE_DISTANCE_MIN=3,n.BLACK_MULTIPLIER=1,n.GRASS_MAX_COUNT=5,n.GRASS_MIN_COUNT=3,n.GRASS_RANDOM=.2,n.createParentPointsMaxWidth=function(i,s,o,r){var h=n.getVertices(o,r);Math.seedrandom(i.game.internalLevel);for(var l=null,d=0,c=null,u=0,m=null,p=null,g=null,f=null,y=0;y<h.length-1;y++){0>=u&&Math.random()<n.GRASS_RANDOM&&(u=Math.floor(e.util.Maths.randRange(n.GRASS_MIN_COUNT,n.GRASS_MAX_COUNT))),m=h[y],p=h[y+1];var v=t.Common.Math.b2Math.SubtractVV(m,p).Length(),S=e.util.Box2dUtil.atan2Target(m,p),w=n.getPartCenterEnd(m,p),M=n.CreateSurfaceBodyWidthAnglePosition(i,a.PLASTICINE_PART_WIDTH,S,w),b=u>0||i.isWhiteSide()||i.isValentine();f=new e.elem.PlasticinePartBodyClip(i,M,s,v,b),u--,g=new e.elem.PlasticineItem(f,v),null!=c?c.insertAfter(g):l=g,c=g,d++}
return l.insertBefore(c),{item:l,count:d}},n.getPartCenterEnd=function(s,n){var o=t.Common.Math.b2Math.SubtractVV(n,s),r=new i;return e.util.Box2dUtil.getCenter(s,n,r),o=e.util.Box2dUtil.rotateMinus90(o),o.Normalize(),o.Multiply(a.THICKESS/2),r.Add(o),r},n.getBezierVerticesControlEndWidth=function(t,i,s,n,a){for(var o=new e.util.Bezier(t,i,s),r=e.util.RopeMetrics.getRopeMetricsByLength(o.length(),n,3),h=o.getTimesSequenceWithStep(r.partSize,r.partSize),l=null,d=null,c=0;c<r.parts;c++)l=h[c],d=o.getPointByTime(l),a.push(d)},n.getVertices=function(t,s){for(var a=[],o=new i,r=0;r<t.length-1;r++)e.util.Box2dUtil.getCenter(t[r],t[r+1],o),a.push(o.Copy());e.util.Box2dUtil.getCenter(t[t.length-1],t[0],o),a.push(o.Copy()),a.unshift(o.Copy());for(var h=[],r=0;r<a.length-1;r++)n.getBezierVerticesControlEndWidth(a[r],t[r],a[r+1],s,h);return h.push(o),h},n.CreateSurfaceBodyWidthAnglePosition=function(i,n,o,r){var h=e.util.Box2dUtil.createBoxBySize(i.b2World,r,n,a.THICKESS,o,!1,a.PLASTICINE_DENSITY,!1);h.SetType(s.b2_kinematicBody),a.applyStaticBodiesFilter(h),h.SetLinearDamping(10),h.SetAngularDamping(10);var l=new t.Collision.Shapes.b2MassData;return h.GetMassData(l),l.I*=10,h.SetMassData(l),h},n.LIMIT={};var a={};a.GROUND_OUT_OFFSET=5/30,a.INNER_DRAG_OFFSET=-10/30,a.MAX_ORTO_OFFSET=.4,a.MAX_DRAG_OFFSET=40/30,a.START_DRAG_TIME=.1,a.PLASTICINE_DENSITY=.3,a.SURFACE_WIDTH=70/30,a.THICKESS=25/30,a.PLASTICINE_PART_WIDTH=.6,a.PLASTICINE_WIDTH=.6,a.WIDE_BORDER_OFFSET=-a.THICKESS/2,a.PLASTICINE_BEZIER_POINTS=3,a.OUT_DIFF=2/30,a.SURFACE_OFFSET=-a.THICKESS/2-a.GROUND_OUT_OFFSET+.5,a.applyActiveBodiesFilter=function(i){var s=new t.Dynamics.b2FilterData;s.categoryBits=16,s.maskBits=61455,s.groupIndex=0,e.util.Box2dUtil.setFilterData(i,s)},a.applyActiveBodiesFilterToFixture=function(e){var i=new t.Dynamics.b2FilterData;i.categoryBits=16,i.maskBits=61455,i.groupIndex=0,e.SetFilterData(i)},a.applyStaticBodiesFilter=function(i){var s=new t.Dynamics.b2FilterData;s.categoryBits=256,s.maskBits=65535,s.groupIndex=0,e.util.Box2dUtil.setFilterData(i,s)},a.applyStaticBodiesFilterToFixture=function(e){var i=new t.Dynamics.b2FilterData;i.categoryBits=256,i.maskBits=65535,i.groupIndex=0,e.SetFilterData(i)},e.util=e.util||{},e.util.SurfaceCreator=n,e.util.PlasticineConstants=a}(Box2D,cj),function(t,e,i){var s=t.Common.Math.b2Vec2,n=e.extend({init:function(e,s){this.previous=null,this.next=null,this.bodyClip=e,this.bodyClip.item=this,this.width=s,this.initialPosition=this.bodyClip.body.GetPosition().Copy(),this.initialAngle=this.bodyClip.body.GetAngle(),this.innerPosition=this.getBorderVec(i.util.PlasticineConstants.INNER_DRAG_OFFSET).Copy(),this.outerPosition=this.getBorderVec(i.util.PlasticineConstants.MAX_DRAG_OFFSET).Copy(),this.normalVec=t.Common.Math.b2Math.SubtractVV(this.outerPosition,this.innerPosition),this.normalVec.Normalize(),this.highlightPosition=this.normalVec.Copy(),this.highlightPosition.Multiply(-i.util.PlasticineConstants.MAX_DRAG_OFFSET-.5*i.util.PlasticineConstants.THICKESS),this.highlightPosition.x*=this.bodyClip._SCALE,this.highlightPosition.y*=this.bodyClip._SCALE,this.ortoAngle=-Math.atan2(this.normalVec.y,this.normalVec.x)+i.util.Maths.PI2(),this.orthogonalVec=i.util.Box2dUtil.rotateMinus90(this.normalVec.Copy())},getTargetPoint:function(t){t.Subtract(this.initialPosition);var e=0;e=i.util.Box2dUtil.getProjection(t,this.bodyClip.normal)<0?-i.util.PlasticineConstants.INNER_DRAG_OFFSET:i.util.PlasticineConstants.MAX_DRAG_OFFSET;var s=-i.util.Box2dUtil.getProjection(t,this.orthogonalVec);if(Math.abs(s)>i.util.PlasticineConstants.MAX_ORTO_OFFSET){var n=i.util.Box2dUtil.getProjection(t,this.normalVec);s=i.util.Maths.clamp(s,-i.util.PlasticineConstants.MAX_ORTO_OFFSET,i.util.PlasticineConstants.MAX_ORTO_OFFSET),t.x=s,t.y=n,i.util.Box2dUtil.rotate(t,-this.ortoAngle,t)}
return t.Length()<=e?t.Add(this.initialPosition):(t.Normalize(),t.Multiply(e),t.Add(this.initialPosition)),t},updateTouchesDistance:function(t,e,i){this.bodyClip.onTouchWith(t,e);for(var s=this.previous,n=.5*this.width+t+.5*s.width;i>n;)s.bodyClip.onTouchWith(n,e),n+=.5*s.width,s=s.previous,n+=.5*s.width;for(s=this.next,n=t-.5*this.width-.5*s.width;Math.abs(n)<i;)s.bodyClip.onTouchWith(n,e),n-=.5*s.width,s=s.next,n-=.5*s.width},getSurfaceCenterVec:function(){return this.bodyClip.getSurfaceCenter()},getLeftOffset:function(t){return i.util.DrawUtil.ConvertToDrawPoint(this.bodyClip.getLeftOffset(t))},getRightOffset:function(t){return i.util.DrawUtil.ConvertToDrawPoint(this.bodyClip.getRightOffset(t))},getCenterOffset:function(t){return i.util.DrawUtil.ConvertToDrawPoint(this.bodyClip.getCenterOffset(t))},getSurfaceCenter:function(){var t=this.bodyClip.getSurfaceCenter();return t.x*=this.bodyClip._SCALE,t.y*=this.bodyClip._SCALE,t},getFlowerSurfaceCenter:function(){var t=this.bodyClip.getFlowerSurfaceCenter();return t.x*=this.bodyClip._SCALE,t.y*=this.bodyClip._SCALE,t},getLeft:function(){return n.cachedWorldPointVec.x=.5*-this.width,n.cachedWorldPointVec.y=0,this.bodyClip.body.GetWorldPointCachedVector(n.cachedWorldPointVec)},getRight:function(){return n.cachedWorldPointVec.x=.5*this.width,n.cachedWorldPointVec.y=0,this.bodyClip.body.GetWorldPointCachedVector(n.cachedWorldPointVec)},getBorderVec:function(t){return n.cachedWorldPointVec.x=.5*this.width,n.cachedWorldPointVec.y=.5*i.util.PlasticineConstants.THICKESS+t,this.bodyClip.body.GetWorldPointCachedVector(n.cachedWorldPointVec)},getBorder:function(t){var e=this.getBorderVec(t);return e.x*=this.bodyClip._SCALE,e.y*=this.bodyClip._SCALE,e},getSurfacePosition:function(t){return n.cachedWorldPointVec.x=t,n.cachedWorldPointVec.y=i.util.PlasticineConstants.SURFACE_OFFSET,this.bodyClip.body.GetWorldPointCachedVector(n.cachedWorldPointVec)},getNextAnchorPosition:function(){return n.cachedWorldPointVec.x=2*this.width,n.cachedWorldPointVec.y=0,this.bodyClip.body.GetWorldPointCachedVector(n.cachedWorldPointVec)},getPreviousAnchorPosition:function(){return n.cachedWorldPointVec.x=2*-this.width,n.cachedWorldPointVec.y=0,this.bodyClip.body.GetWorldPointCachedVector(n.cachedWorldPointVec)},getRightSurfacePosition:function(){var t=this.bodyClip.body.GetWorldPointCachedVector(this.getRightSurfacePositionLocal());return t.x*=this.bodyClip._SCALE,t.y*=this.bodyClip._SCALE,t},getRightSurfacePositionLocal:function(){return n.cachedWorldPointVec.x=this.width/2,n.cachedWorldPointVec.y=i.util.PlasticineConstants.SURFACE_OFFSET,n.cachedWorldPointVec},getLeftSurfacePosition:function(){return this.bodyClip.body.GetWorldPointCachedVector(this.getLeftSurfacePositionLocal())},getLeftSurfacePositionLocal:function(){return n.cachedWorldPointVec.x=-this.width/2,n.cachedWorldPointVec.y=i.util.PlasticineConstants.SURFACE_OFFSET,n.cachedWorldPointVec},remove:function(){this.next&&(this.next.previous=this.previous),this.previous&&(this.previous.next=this.next),this.previous=null,this.next=null},insertBefore:function(t){this.previous&&(this.previous.next=t,t.previous=this.previous),t.next=this,this.previous=t},insertAfter:function(t){this.next&&(this.next.previous=t,t.next=this.next),t.previous=this,this.next=t},getItem:function(t,e){for(var i=0,s=this;t>i;)s=0>e?s.previous:s.next,i++;return s}});n.cachedWorldPointVec=new s;var a=e.extend({init:function(t,e){this.dragItem=t,this.touch=e,this.initialTouchPosition=new s(e.x/30,e.y/30),this.lastTouchPosition=this.initialTouchPosition.Copy(),this.currentTouchPosition=this.initialTouchPosition.Copy(),this.initialPosition=this.dragItem.bodyClip.body.GetPosition().Copy(),this.left=t.getItem(a.DRAG_COUNT,-1),this.right=t.getItem(a.DRAG_COUNT,1),this.basePoints=new i.util.DrawUtil.PointsPair,this.setDragging(!0),this._SCALE=1/30,this.basePointFirst=new s,this.basePointSecond=new s,this.baseAnchorFirst=new s,this.baseAnchorSecond=new s,this.baseAngle=0,this.topAnchorFirst=new s,this.topAnchorSecond=new s,this.topPointFirst=new s,this.topPointSecond=new s,this.movingVertexLeft=new s,this.movingVertexRight=new s,this.positions=[];for(var n=0;n<2*a.DRAG_COUNT;n++)this.positions.push(new s);this.bezierKeyPointsFirst=[this.basePointFirst,this.baseAnchorFirst,this.movingVertexLeft,this.topAnchorFirst,this.topPointFirst],this.bezierKeyPointsSecond=[this.topPointSecond,this.topAnchorSecond,this.movingVertexRight,this.baseAnchorSecond,this.basePointSecond],this.getDragVec=new s},setDragging:function(t){var e=this.dragItem.previous,i=this.dragItem.next,s=0;for(this.dragItem.bodyClip.setDragging(t);s<a.DRAG_COUNT;)e.bodyClip.setDragging(t),i.bodyClip.setDragging(t),e=e.previous,i=i.next,s++},update:function(){var t=!1;this.currentTouchPosition.x=this.touch.x*this._SCALE,this.currentTouchPosition.y=this.touch.y*this._SCALE,i.util.Box2dUtil.b2Vec2FuzzyEqual(this.currentTouchPosition,this.lastTouchPosition)||(this.calculatePositions(),this.lastTouchPosition=this.currentTouchPosition.Copy(),t=!0);var e=i.util.Box2dUtil.getProjection(i.util.Box2dUtil.b2Vec2Subtract(this.currentTouchPosition,this.dragItem.bodyClip.body.GetPosition()),this.dragItem.bodyClip.normal);return Math.abs(e)>a.FREE_DISTANCE&&this.dragItem.bodyClip.free(this.touch),t},calculatePositions:function(){var t=this.left.getRight();this.basePointFirst.x=t.x,this.basePointFirst.y=t.y,t=this.right.getLeft(),this.basePointSecond.x=t.x,this.basePointSecond.y=t.y,t=this.left.getNextAnchorPosition(),this.baseAnchorFirst.x=t.x,this.baseAnchorFirst.y=t.y,t=this.right.getPreviousAnchorPosition(),this.baseAnchorSecond.x=t.x,this.baseAnchorSecond.y=t.y,this.baseAngle=Math.atan2(this.baseAnchorSecond.y-this.baseAnchorFirst.y,this.baseAnchorSecond.x-this.baseAnchorFirst.x);var e=this.getCurrentDragPosition();this.topAnchorFirst.x=e.x+2*-i.util.PlasticineConstants.PLASTICINE_WIDTH*Math.cos(this.baseAngle),this.topAnchorFirst.y=e.y+2*-i.util.PlasticineConstants.PLASTICINE_WIDTH*Math.sin(this.baseAngle),this.topAnchorSecond.x=e.x+2*-i.util.PlasticineConstants.PLASTICINE_WIDTH*Math.cos(this.baseAngle+Math.PI),this.topAnchorSecond.y=e.y+2*-i.util.PlasticineConstants.PLASTICINE_WIDTH*Math.sin(this.baseAngle+Math.PI),this.topPointFirst.x=e.x+.5*-i.util.PlasticineConstants.PLASTICINE_WIDTH*Math.cos(this.baseAngle),this.topPointFirst.y=e.y+.5*-i.util.PlasticineConstants.PLASTICINE_WIDTH*Math.sin(this.baseAngle),this.topPointSecond.x=e.x+.5*-i.util.PlasticineConstants.PLASTICINE_WIDTH*Math.cos(this.baseAngle+Math.PI),this.topPointSecond.y=e.y+.5*-i.util.PlasticineConstants.PLASTICINE_WIDTH*Math.sin(this.baseAngle+Math.PI),this.movingVertexLeft.x=.5*(this.topAnchorFirst.x+this.baseAnchorFirst.x),this.movingVertexLeft.y=.5*(this.topAnchorFirst.y+this.baseAnchorFirst.y),this.movingVertexRight.x=.5*(this.topAnchorSecond.x+this.baseAnchorSecond.x),this.movingVertexRight.y=.5*(this.topAnchorSecond.y+this.baseAnchorSecond.y);var s=i.util.Maths.addBezierPoints(this.positions,this.bezierKeyPointsFirst,3,0);i.util.Maths.addBezierPoints(this.positions,this.bezierKeyPointsSecond,3,s),this.updatePositions()},updatePositions:function(){for(var t,e,i=0,n=this.left.next,a=null,o=new s(0,0);i<this.positions.length-1;)t=this.positions[i],e=this.positions[i+1],o.x=.5*(t.x+e.x),o.y=.5*(t.y+e.y),a=Math.atan2(e.y-t.y,e.x-t.x),n.bodyClip.setTargetPositionAngle(o,a),n=n.next,i++},getCurrentDragPoint:function(){return i.util.DrawUtil.ConvertToDrawPoint(this.getCurrentDragPosition())},getCurrentDragPosition:function(){return i.util.Box2dUtil.b2Vec2AddRef(this.initialPosition,this.currentTouchPosition,this.getDragVec),this.getDragVec.Subtract(this.initialTouchPosition),this.dragItem.getTargetPoint(this.getDragVec)},finish:function(){this.setDragging(!1)}});a.DRAG_COUNT=7,a.FREE_DISTANCE=100/30,i.elem.PlasticineItem=n,i.elem.DraggingItem=a}(Box2D,Class,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=e.elem.EntityBase.extend({name:"PlasticineBodyClip",init:function(t,n,a,o){this._super(a,null,o,t),this.setZOrder(e.util.EntityZOrder.GROUND);var r=e.util.SurfaceCreator.createParentPointsMaxWidth(a,this,n,18*e.util.Box2dUtil.sizeMultiplier);this.plasticineDiv=document.getElementById("plasticineDiv"),this.myCanvas=document.createElement("canvas"),this.myCanvas.style.position="absolute",this.myCanvas.width=960,this.myCanvas.height=640,this.ctx=this.myCanvas.getContext("2d"),this.plasticineDiv.appendChild(this.myCanvas),this.numItems=r.count,this.firstItem=r.item,this.numDraggingItems=0,this.draggingItems=[],this.lastFrameSpeedX=0,this.lastFrameSpeedY=0,this.lastTouchTime=1/0,this.borderOpacity=0,this.targetOpacity=0,this.dirty=!0,this.borderColor=this.world.isBlackSide()?"rgb(26,70,99)":this.world.isWhiteSide()?"#cccccc":this.world.isValentine()?"#FFFB00":"rgb(204,204,204)",this.shadeColor=this.world.isBlackSide()?"#00ade8":this.world.isWhiteSide()?"#a6a6a6":this.world.isValentine()?"#fe7f28":"#ffffff",this.fillColor=this.world.isWhiteSide()?"#cccccc":"#000000",this.world.isBlackSide()?(this.shadingIntensity=4.5,this.shadingWidth=30,this.shadingPasses=8,this.extendToGround=!1,this.shadingEasing=EasingType.Linear):this.world.isWhiteSide()?(this.shadingIntensity=7.7,this.shadingWidth=35,this.shadingPasses=10,this.extendToGround=!1,this.shadingEasing=EasingType.Linear):this.world.isValentine()?(this.shadingIntensity=6.5,this.shadingWidth=36,this.shadingPasses=10,this.extendToGround=!0,this.shadingEasing=EasingType.Sine):(this.shadingIntensity=3.5,this.shadingWidth=s.DEFAULT_SHADING_WIDTH,this.shadingPasses=8,this.extendToGround=!1,this.shadingEasing=EasingType.Linear),this.drawPoints=[],this.highlightPoints=[];for(var h=0;h<=2*this.numItems;h++)this.drawPoints.push(new i),this.highlightPoints.push(new i);this.initialRect=this.calculateDrawPoints(!0),this.fixedShadingDropOffPoint=this.initialRect.y+Math.min(25,.25*this.initialRect.height),this.extendToGround&&this.initialRect.y+this.initialRect.height>640&&(this.fixedShadingDropOffPoint=640),this.calculateHighlightPoints()},update:function(t){this.targetOpacity=this.lastTouchTime<2?s.END_OPACITY:s.START_OPACITY,this.borderOpacity=e.util.Maths.stepTo(this.borderOpacity,this.targetOpacity,s.OPACITY_STEP),this.lastTouchTime+=t.delta;for(var i=this.firstItem,n=0;n<this.numItems;n++)i.bodyClip.update(t),i=i.next},draw:function(t,i){if(this.world.usePlasticines){var s,n,a,o=t.particle;if(!this.world.isCulling&&this.borderOpacity>0){o.save(),o.lineWidth=2,o.strokeStyle=this.borderColor,o.globalAlpha=this.borderOpacity,o.beginPath(),s=this.highlightPoints[0],o.moveTo(s.x,s.y);for(var r=1,h=0;h<this.numItems;h++)n=this.highlightPoints[r++],a=this.highlightPoints[r++],o.quadraticCurveTo(n.x,n.y,a.x,a.y);o.closePath(),o.stroke(),o.restore()}
if(this.dirty||this.world.forcePlasticineDraw||this.world.isZooming){this.calculateDrawPoints(),o=this.ctx,o.save(),o.setTransform(1,0,0,1,0,0),o.clearRect(0,0,o.canvas.width,o.canvas.height),o.restore(),o.save(),o.fillStyle=this.fillColor,o.beginPath(),o.globalAlpha=1,s=this.drawPoints[0],o.moveTo(s.x,s.y);for(var r=1,h=0;h<this.numItems;h++)n=this.drawPoints[r++],a=this.drawPoints[r++],o.quadraticCurveTo(n.x,n.y,a.x,a.y);o.closePath(),e.util.Shader.shadePath(o,this.shadingIntensity*this.world.lightPower,this.shadingWidth,this.shadingPasses,this.fixedShadingDropOffPoint,this.shadeColor,this.fillColor,this.extendToGround,this.shadingEasing),o.fill(),o.restore(),this.dirty=!1}}},dispose:function(){this._super(),this.plasticineDiv.removeChild(this.myCanvas),this.ctx="Null"},calculateDrawPoints:function(t){t=void 0===t?!1:t,e.util.Box2dUtil.b2Vec2Copy(this.firstItem.getSurfaceCenter(),this.drawPoints[0]);var i,s;i=this.firstItem;for(var n=this.ctx.canvas.width,a=this.ctx.canvas.height,o=0,r=0,h=1,l=0;l<this.numItems;l++)
if(s=i.next,e.util.Box2dUtil.b2Vec2Copy(i.getRightSurfacePosition(),this.drawPoints[h++]),e.util.Box2dUtil.b2Vec2Copy(s.getSurfaceCenter(),this.drawPoints[h++]),i=i.next,t){var d=this.drawPoints[h-1];d.x<n&&(n=d.x),d.x>o&&(o=d.x),d.y<a&&(a=d.y),d.y>r&&(r=d.y)}return t?{x:n,y:a,width:o-n,height:r-a}:void 0},calculateHighlightPoints:function(){var t,i;t=this.firstItem,e.util.Box2dUtil.b2Vec2AddRef(this.drawPoints[0],this.firstItem.highlightPosition,this.highlightPoints[0]);for(var s=1,n=0;n<this.numItems;n++)i=t.next,e.util.Box2dUtil.b2Vec2AddRef(this.drawPoints[s],t.highlightPosition,this.highlightPoints[s++]),e.util.Box2dUtil.b2Vec2AddRef(this.drawPoints[s],i.highlightPosition,this.highlightPoints[s++]),t=t.next},startDragItemTouch:function(t,i){this.dirty=!0;for(var s=t.previous,n=t.next,a=0;a<e.elem.DraggingItem.DRAG_COUNT;){if(s.bodyClip.dragging||n.bodyClip.dragging)return!1;s=s.previous,n=n.next,a++}
return t.bodyClip.scareFlies(0),t.next.bodyClip.scareFlies(0),t.next.next.bodyClip.scareFlies(0),t.previous.bodyClip.scareFlies(0),t.previous.previous.bodyClip.scareFlies(0),this.draggingItems[i.id]=new e.elem.DraggingItem(t,i),this.numDraggingItems++,this.world.grass.incrementTouch(),!0},moveDragItemTouch:function(t){this.dirty=!0;var e=this.draggingItems[t.id];e&&(this.dirty=e.update(),this.lastTouchTime=0)},stopDragItemTouch:function(t,e){var i=this.draggingItems[e.id];i&&(i.finish(),i=null,delete this.draggingItems[e.id],this.numDraggingItems--,this.world.grass.decrementTouch(),this.dirty=!0)},restart:function(){for(var t=this.firstItem,e=0;e<this.numItems;e++)t.bodyClip.moveToInitialPosition(),t=t.next}});s.START_OPACITY=0,s.OPACITY_STEP=.02,s.END_OPACITY=.4,s.DEFAULT_SHADING_WIDTH=30;var n=e.elem.EntityBase.extend({name:"PlasticinePartBodyClip",init:function(s,a,o,r,h){this._super(s,a),this.body.SetUserData(this),this.parent=o,this.width=r,this.item=null,this.moveToInitial=!1,this.initialAngle=this.body.GetAngle(),this.initialPosition=this.body.GetPosition().Copy(),this.targetAngle=this.initialAngle,this.targetPosition=this.initialPosition.Copy(),this.normal=t.Common.Math.b2Math.SubtractVV(this.getSurfaceCenter(),this.body.GetWorldCenter()),this.normal.Normalize();var l=e.util.Maths.simplifyAngleRadians(this.body.GetAngle(),-e.util.Maths.PI2()),d=this.world.isWhiteSide()?n.GRASS_ANGLE_WHITE:n.GRASS_ANGLE;e.util.Maths.between(l,-d,d)?(this.isFloor=!0,h&&this.createGrass()):this.isFloor=!1,this.isTop=e.util.Maths.between(l,Math.PI/2,2*Math.PI),this.lastTime=0,this.groundFallTime=0,e.util.PlasticineConstants.applyStaticBodiesFilter(this.body),this.instantVelocity=new i,this.velocity=new i,this.dirty=!1,this.velocity=new i,this.instantVelocity=new i,this.newPosition=new i},createGrass:function(){this.world.isBlackSide()||(this.world.isWhiteSide()||this.world.isValentine()?this.grassController=new e.elem.WhiteGrassController(this.world,this):this.grassController=new e.elem.GrassController(this.world,this))},update:function(t){this.lastTime=t.delta,this.dirty&&this.moveToTargetPosition(t),this.grassController&&this.grassController.update(t)},setTargetPositionAngle:function(t,i){this.moveToInitial=!1,this.dirty=!0;var s=this.body.GetPosition();this.lastFrameSpeedX=(t.x-s.x)*(1/this.lastTime),this.lastFrameSpeedY=(t.y-s.y)*(1/this.lastTime),this.targetAngle=e.util.Maths.simplifyAngleRadians(i,this.body.GetAngle()-Math.PI),this.targetPosition.x=t.x,this.targetPosition.y=t.y,this.lastFrameSpeedX*this.lastFrameSpeedX+this.lastFrameSpeedY*this.lastFrameSpeedY>4&&this.fallGround()},onCollision:function(i,s){var n=i.GetUserData();if(n&&n.isCharacter()){var a=new t.Collision.b2WorldManifold;s.GetWorldManifold(a);var o=this.body.GetLocalPoint(a.m_points[0]),r=o.x;o.y+=6*e.util.Box2dUtil.sizeMultiplier,this.item.updateTouchesDistance(r,n,e.elem.GrassController.GRASS_TRAMPLE_DISTANCE),this.isFloor&&!this.dragging&&this.addDust(i,s,o)}},onTouchWith:function(t,e){this.grassController&&this.grassController.onTouchWith(t,e)},moveToInitialPosition:function(){this.setTargetPositionAngle(this.initialPosition,this.initialAngle),this.moveToInitial=!0},moveToTargetPosition:function(t){var i=this.body.GetPosition();if(e.util.Maths.fuzzyEqual(this.targetAngle,this.body.GetAngle())||this.body.SetAngle(this.targetAngle),e.util.Box2dUtil.b2Vec2FuzzyEqual(this.targetPosition,i))e.util.Box2dUtil.b2Vec2FuzzyEqual(this.body.GetLinearVelocity(),n.zeroVec)||(this.body.SetLinearVelocity(n.zeroVec),this.parent.dirty=!0,this.dirty=!1);else{e.util.Box2dUtil.b2Vec2SubtractRef(this.targetPosition,i,this.instantVelocity),this.moveToInitial&&this.instantVelocity.Multiply(.3),e.util.Box2dUtil.b2Vec2Copy(this.instantVelocity,this.velocity),this.instantVelocity.Multiply(n.MOVE_SPEED_MULT),this.velocity.Multiply(n.SPEED_MULT/t.delta);var s=this.velocity.Length();s>n.MAX_GROUND_VELOCITY&&this.velocity.Multiply(n.MAX_GROUND_VELOCITY/s),e.util.Box2dUtil.b2Vec2AddRef(i,this.instantVelocity,this.newPosition),this.body.SetLinearVelocity(this.velocity),this.body.SetPosition(this.newPosition),this.isTop&&this.fallGround(),this.parent.dirty=!0}},free:function(t){this.parent.stopDragItemTouch(this.item,t),this.world.freeTouch(t.id)},fallGround:function(){if(this.groundFallTime-=this.lastTime,this.isTop&this.groundFallTime<=0&&this.lastFrameSpeedY>-5&&Math.random()<.2){this.groundFallTime=n.GROUND_FALL_MAX_TIME;var t=e.util.Box2dUtil.randomPoint(this.item.getLeftOffset(n.GROUND_FALL_OFFSET),this.item.getRightOffset(0)),i=this.world.groundFall.addOrGetInvisible();this.lastFrameSpeedY<0&&(i.speedY*=1.3,t.y+=Math.max(this.lastFrameSpeedY,-35)),i.setPositionV(t)}},addDust:function(t,e,i){var s=t.GetLinearVelocity().Length();if(s>=1&&Math.random()<.33){var n=t.GetWorldPointCachedVector(i),a=this.world.dust,o=this.world.isWhiteSide()?2:1;a.addItem(t.GetLinearVelocity(),n,s,o)}},scareFlies:function(t){this.grassController&&this.grassController.scareFlies(t)},isClickable:function(){return!0},startTouch:function(t){return this.parent.startDragItemTouch(this.item,t)},moveTouch:function(t){this.parent.moveDragItemTouch(t)},endTouch:function(t){this.parent.stopDragItemTouch(this.item,t)},setDragging:function(t){this.dragging=t},getLocalSurfaceCenter:function(){return n.cachedVec.x=0,n.cachedVec.y=e.util.PlasticineConstants.SURFACE_OFFSET,n.cachedVec},getLocalFlowerSurfaceCenter:function(){var t=.8*(this.parent.shadingWidth-s.DEFAULT_SHADING_WIDTH),i=(t+15)/30,a=e.util.PlasticineConstants.SURFACE_OFFSET-i;return n.cachedVec.x=0,n.cachedVec.y=a,n.cachedVec},getFlowerSurfaceCenter:function(){return this.body.GetWorldPointCachedVector(this.getLocalFlowerSurfaceCenter())},getSurfaceCenter:function(){return this.body.GetWorldPointCachedVector(this.getLocalSurfaceCenter())},getLeftOffset:function(t){return n.cachedVec.x=-this.width/2,n.cachedVec.y=t,this.body.GetWorldPointCachedVector(n.cachedVec)},getRightOffset:function(t){return n.cachedVec.x=this.width/2,n.cachedVec.y=t,this.body.GetWorldPointCachedVector(n.cachedVec)},getCenterOffset:function(t){return n.cachedVec.x=0,n.cachedVec.y=t,this.body.GetWorldPointCachedVector(n.cachedVec)},touchPriority:function(){return 0},isTouchSwipable:function(){return!0}});n.cachedVec=new i,n.zeroVec=new i,n.MOVE_SPEED_MULT=.4,n.SPEED_MULT=.5,n.MAX_GROUND_VELOCITY=4.5,n.GRASS_ANGLE=Math.PI/6,n.GRASS_ANGLE_WHITE=Math.PI/3,n.GROUND_FALL_MAX_TIME=e.util.Maths.randRange(.205,.41),n.GROUND_FALL_OFFSET=20*e.util.Box2dUtil.sizeMultiplier,e.elem.PlasticineBodyClip=s,e.elem.PlasticinePartBodyClip=n}(Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=e.elem.EntityBase.extend({init:function(t,s,n,a){this._super(n,s,a,t),this.body=s,this.body.SetUserData(this);var o,r=this.getViewType(),h=r.indexOf("Circle")>=0;o=h?e.util.GameImages.McCircleSpikesView:r.indexOf("Simple")>=0?e.util.GameImages.McSimpleSpikesView:e.util.GameImages.McSpikesView,this.spikeImage=new e.util.BitmapAnimation(o,!1),this.spikeImage.onCompletionShowNothing=!1,this.spikeImage.isDrawing=!0,this.hit=!1,this.floating=h,this.initialPosition=this.body.GetPosition().Copy(),this.initialScale=this.transform.scale.x,this.offset=new i,this.runActions()},update:function(t){if(this._super(t),this.spikeImage.update(t),this.floating&&!this.hit){var i=e.util.Box2dUtil.b2Vec2Subtract(this.initialPosition,this.body.GetPosition()),s=Math.atan2(i.y,i.x);s=e.util.Maths.simplifyAngleRadians(s,this.direction-Math.PI);var n=this.angleStep*t.delta;this.direction=e.util.Maths.stepTo(this.direction,s,n),e.util.Box2dUtil.toVec(this.speed*t.delta,this.direction,this.offset),this.body.SetPosition(e.util.Box2dUtil.b2Vec2Add(this.body.GetPosition(),this.offset)),this._super(t)}},draw:function(t){this.spikeImage.draw(t.foreground,this.transform)},onCollisionStart:function(t,e){var i=t.GetUserData();void 0!==i&&null!==i&&i.isCharacter()&&(this.hit=!0,this.spikeImage.play(),i.explode())},runActions:function(){this.speed=e.util.Maths.randRange(.067,.1),this.direction=e.util.Maths.randRange(0,2*Math.PI),this.angleStep=e.util.Maths.randRange(.8,1.2)}});e.elem.SimpleSpikesBodyClip=s}(Box2D,cj),function(t,e){function i(t,i){this.that=this,this.flowerSpike=t,this.offsetCache=new s,this.leanOffset=new s,this.stemOffset=new s,this.rotationVector=new s,this.topOffset=new s,this.stemCorrection=34*this.flowerSpike.transform.scale.x,this.leanDampen=.9,this.leanMagnitude=7*this.flowerSpike.transform.scale.x,this.flowerHeight=70*this.flowerSpike.transform.scale.x,this.eyeBackgroundSize=9.25*this.flowerSpike.transform.scale.x,this.stemWidth=6*this.flowerSpike.transform.scale.x,this.centerWidth=.01*this.flowerSpike.transform.scale.x,this.topWidth=6*this.flowerSpike.transform.scale.x,this.stem=new s(i.position.x,i.position.y),this.center=new s,this.top=new s,this.stemPair=[new s,new s],this.centerPair=[new s,new s],this.topPair=[new s,new s],e.util.Maths.angleToNormalizedVector(this.flowerSpike.transform.rotation,this.rotationVector),e.util.Box2dUtil.rotate90(this.rotationVector),this.rotationVector.Normalize(),this.offsetCache.x=this.rotationVector.x,this.offsetCache.y=this.rotationVector.y,this.offsetCache.Multiply(this.stemCorrection),this.stem.x-=this.offsetCache.x,this.stem.y-=this.offsetCache.y,this.topOffset.x=this.rotationVector.x,this.topOffset.y=this.rotationVector.y,this.topOffset.Multiply(this.flowerHeight);var n=t.world.isWhiteSide();this.stalkColor=n?"#979797":"black",this.eyeBackColor=n?"#979797":"black",this.update=function(t){var i=this.flowerSpike.eye.positionProvider;this.top.x=this.stem.x+this.topOffset.x,this.top.y=this.stem.y+this.topOffset.y;var s=i&&i.isCharacter&&i.isCharacter(),n=i instanceof e.elem.SpikesFlowerBodyClip;if(s&&!this.flowerSpike.isEating||!s&&!n&&i){var a=i.providePosition();this.leanOffset.x=a.x-this.top.x,this.leanOffset.y=a.y-this.top.y}else this.leanOffset.x=0,this.leanOffset.y=0;this.leanOffset.Normalize(),this.leanOffset.x*=this.leanMagnitude,this.leanOffset.y*=this.leanMagnitude,this.top.x+=this.leanOffset.x,this.top.y+=this.leanOffset.y,e.util.Box2dUtil.getCenter(this.stem,this.top,this.center),this.center.x-=this.leanOffset.x*this.leanDampen,this.center.y-=this.leanOffset.y*this.leanDampen,this.updatePair(this.stem,this.stemPair,this.stemWidth,this.center),this.updatePair(this.center,this.centerPair,this.centerWidth,this.top),this.updatePair(this.top,this.topPair,this.topWidth,this.center)},this.draw=function(t){var e=t.foreground;e.fillStyle=this.stalkColor,e.beginPath(),e.moveTo(this.stemPair[0].x,this.stemPair[0].y),e.quadraticCurveTo(this.centerPair[0].x,this.centerPair[0].y,this.topPair[1].x,this.topPair[1].y),e.lineTo(this.topPair[0].x,this.topPair[0].y),e.quadraticCurveTo(this.centerPair[1].x,this.centerPair[1].y,this.stemPair[1].x,this.stemPair[1].y),e.lineTo(this.stemPair[0].x,this.stemPair[0].y),e.closePath(),e.fill(),e.fillStyle=this.eyeBackColor,e.beginPath(),e.arc(this.top.x,this.top.y,this.eyeBackgroundSize,0,2*Math.PI,!1),e.closePath(),e.fill()},this.updatePair=function(t,i,s,n){this.offsetCache.x=n.x-t.x,this.offsetCache.y=n.y-t.y,e.util.Box2dUtil.rotate90(this.offsetCache),this.offsetCache.Normalize(),this.offsetCache.x*=s,this.offsetCache.y*=s,i[0].x=t.x,i[0].y=t.y,i[1].x=t.x,i[1].y=t.y,i[0].x+=-this.offsetCache.x,i[0].y+=-this.offsetCache.y,i[1].x+=this.offsetCache.x,i[1].y+=this.offsetCache.y}}
var s=t.Common.Math.b2Vec2;e.elem.FlowerNeck=i}(Box2D,cj),function(t){var e=t.elem.SimpleSpikesBodyClip.extend({init:function(e,i,s,n){this._super(e,i,s,n),this.isEating=!1,this.transform=n,this.flowerNeck=new t.elem.FlowerNeck(this,this.transform),this.eye=new t.elem.MonsterEye(s,i),this.eye.visible=!0,this.eye.transform.setScale(.7*this.transform.scale.x,.7*this.transform.scale.x)},providePosition:function(){return this.eye.transform.position},onCollisionStart:function(e,i){var s=e.GetUserData();if(void 0!==s&&null!==s){var n=this;s.isCharacter()&&!s.isConsumedByFlower&&(s.isConsumedByFlower=!0,this.isEating=!0,this.eye.allowRandomAnimation=!1,this.spikeImage.play(),t.util.soundController.playSoundEffect(t.util.GameSounds.effects.deathByFlowerOut4,70),t.util.newDelayAction(t.util.ScheduleContext.WORLD,function(){s.eat(n.body.GetPosition(),.5,3,0,.2)},0,"Flower is eating the hero"),this.eye.positionProvider=this,t.util.newDelayAction(t.util.ScheduleContext.WORLD,function(){n.spikeImage.sprite.clipData.reverseFrames(),n.spikeImage.stop(),n.spikeImage.play(),t.util.soundController.playSoundEffect(t.util.GameSounds.effects.deathByFlowerOut10,70);var e=new t.elem.DeadEye(n.world,n.transform),i=s.deadEyeScale();e.setScale(i,i),n.eye.allowRandomAnimation=!0,n.eye.positionProvider=e,n.isEating=!1},2,"Waiting to open spike flower"))}},update:function(t){this._super(t),this.flowerNeck.update(),this.eye.update(t),this.eye.transform.position.x=this.flowerNeck.top.x,this.eye.transform.position.y=this.flowerNeck.top.y},draw:function(t){this.flowerNeck.draw(t),this._super(t),this.eye.draw(t)}});t.elem.SpikesFlowerBodyClip=e}(cj),function(t,e){var i=t.Common.Math.b2Vec2,s=t.Dynamics.b2Body,n=e.elem.EntityBase.extend({init:function(t,s,a,o){this._super(a,s,o,t),this.body.SetUserData(this),this.body.SetBullet(!0),this.startScale=this.transform.scale.x,this.suckPoint=n.SUCK_POINT.Copy(),this.suckPoint.Multiply(this.startScale),this.suckDistance=n.SUCK_DISTANCE*this.startScale*e.util.Box2dUtil.sizeMultiplier,this.breathChanger=new e.elem.CosChanger(.06,.07),this.breathChanger.minValue=.95,this.breathChanger.maxValue=1.04;for(var r=this.body.GetFixtureList();r;)r.SetFriction(1),this.isSticky(r)&&r.SetSensor(!0),r=r.GetNext();this.animation=new e.util.BitmapAnimation(e.util.GameImages.McSpringView),this.animation.onCompletionShowNothing=!1,this.animation.setMinFrame(n.BASE_FRAME),this.animation.isDrawing=!0,this.launchTime=-n.LAUNCH_PAUSE,this.sticked=null,this.smoke=new e.elem.WhiteSmoke(this.world,this.body);var h=n.SMOKE_POINT.Copy();h.y*=this.startScale,e.util.Box2dUtil.rotate(h,this.transform.rotation,h),h=this.body.GetWorldPointCachedVector(h),this.smoke.horizontalPosition.value=30*h.x,this.smoke.verticalPosition.value=30*h.y,this.smoke.scaleDownOnDestroy=!1,this.refreshSmokeAngle(),this.createSmoke(),this.timeToSmoke=e.util.Maths.randRange(n.MIN_TIME_TO_SMOKE,n.MAX_TIME_TO_SMOKE),this.setThinSmokeRange(),this.shadow=new e.util.Bitmap(e.util.GameImages.McSpringShadow),this.offset=new i,this.relativeStickedPosition=new i,this.worldSuckVec=new i,this.suckForce=new i,this.parallel=new i,e.util.Box2dUtil.rotate(n.NORMAL,this.transform.rotation,this.parallel)},update:function(t){if(this._super(t),this.sticked){var i=this.sticked.body.GetType();i==s.b2_kinematicBody||this.checkBodyContacts(this.sticked.body,"sticky",1)?(this.updateSticked(),this.updateSuckingClip()):(this.fixAnimation(),this.setSticked(null))}else if(!this.animation.isAnimating&&this.animation.getCurrentFrame()===n.BASE_FRAME&&(this.breathChanger.update(t.delta),this.setScale((2-this.breathChanger.value)*this.startScale,this.breathChanger.value*this.startScale),this.timeToSmoke<0)){this.timeToSmoke=e.util.Maths.randRange(n.MIN_TIME_TO_SMOKE,n.MAX_TIME_TO_SMOKE),this.setThinSmokeRange();for(var a,o=0;3>o&&this.smoke.particles.length<n.SMOKE_PARTS;)a=this.smoke.addOrGetInvisible(),a.speedX=a.speedX*(1/n.SLOW_SMOKE_MULT),a.speedY=a.speedY*(1/n.SLOW_SMOKE_MULT),o++}
0===this.animation.getCurrentFrame()&&(this.animation.setCurrentFrame(n.BASE_FRAME),this.animation.isDrawing=!0),this.animation.update(t),this.smoke.update(t),this.timeToSmoke-=t.delta},draw:function(t){this.shadow.draw(t.foreground,this.transform),this.animation.sprite.draw(t.foreground,this.transform),this.smoke.draw(t.foreground)},isClickable:function(){return!0},touchPriority:function(){return this.sticked?2:-10},startTouch:function(t){var s=e.util.Box2dUtil.b2Vec2Distance(this.body.GetWorldCenter(),new i(t.x/30,t.y/30));return s<n.MAX_DISTANCE?(this.launchTouching(),this.sticked?this.launch():(e.util.soundController.playSoundEffect(e.util.GameSounds.effects.perdelkaOutEmpty1,70),this.spit()),!0):!1},onCollisionStart:function(t,e){this.processCollisionPoint(t,e)},onCollisionEnd:function(t,i){null==this.sticked||t!==this.sticked.body||e.util.Box2dUtil.isTouchingOther(this.body,this.sticked.body)||(this.fixAnimation(),this.setSticked(null))},onCollision:function(t,e){this.processCollisionPoint(t,e)},processCollisionPoint:function(t,i){if(!(null!=this.sticked||this.world.totalTime-this.launchTime<n.LAUNCH_PAUSE)){var s=t.GetUserData(),a=i.GetFixtureA(),o=i.GetFixtureB();s&&i.IsTouching()&&(!a.IsSensor()||!o.IsSensor())&&s.canLaunch()&&(this.isSticky(a)||this.isSticky(o)||this.checkBodyContacts(t,"base",2))&&(this.reverseSmoke(),this.setSticked(s),e.util.soundController.playSoundEffect(e.util.GameSounds.effects.perdelkaOut0,70),this.animation.manual=!0)}},isSticky:function(t){return this.checkFixtureKey(t,"sticky")},updateSticked:function(){var t=this.sticked.body;if(t.GetType()===s.b2_dynamicBody){var i=this.worldSuckPoint();e.util.Box2dUtil.b2Vec2SubtractRef(i,t.GetPosition(),this.suckForce),e.util.Box2dUtil.b2Vec2Copy(this.suckForce,this.offset);var a=this.suckForce.Length();this.suckForce.Normalize(),this.suckForce.Multiply(t.GetMass()*(this.suckDistance-a)*n.SUCK_FORCE),t.ApplyForce(this.suckForce,t.GetWorldCenter());var o=e.util.Box2dUtil.getProjection(t.GetLinearVelocity(),this.parallel),r=e.util.Box2dUtil.getProjection(this.offset,this.parallel);(0>o*r||Math.abs(o)<10&&Math.abs(r)>1)&&(e.util.Box2dUtil.b2Vec2Copy(this.parallel,this.offset),this.offset.Multiply(r*t.GetMass()*n.SUCK_FORCE),t.ApplyForce(this.offset,t.GetWorldCenter())),e.util.Box2dUtil.b2Vec2SubtractRef(t.GetPosition(),this.body.GetPosition(),this.relativeStickedPosition),e.util.Box2dUtil.rotate(this.relativeStickedPosition,this.transform.rotation,this.relativeStickedPosition),this.fixClosePosition(this.relativeStickedPosition),this.checkFixed(r)}},fixClosePosition:function(t){var i=t.y+2.2;0>i&&2*Math.abs(t.x)>Math.abs(i)?(t.x=e.util.Maths.stepTo(t.x,e.util.Maths.getSign(t.x)*i/2,.3),this.applyRelativePosition(t)):i>0&&(t.x=e.util.Maths.stepTo(t.x,0,.3),this.applyRelativePosition(t))},updateSuckingClip:function(){var t=this.sticked.body.GetType()===s.b2_dynamicBody?Math.min(1,this.relativeStickedPosition.y/this.suckDistance):0;this.animation.setCurrentFrame(n.BASE_FRAME+Math.max(n.SPIT_FRAMES*(1-t)-1,0))},fixAnimation:function(){this.animation.currentFrame!==n.BASE_FRAME&&(this.animation.rewind=!0,this.animation.play())},setSticked:function(t){this.sticked=t},checkFixtureKey:function(t,e){var i=t.GetUserData();return i?i.hasOwnProperty(e):!1},checkBodyContacts:function(t,e,i){for(var s=t.GetContactList(),n=0;s;){if(s.contact.IsTouching()&&(this.checkFixtureKey(s.contact.GetFixtureA(),e)||this.checkFixtureKey(s.contact.GetFixtureB(),e))&&n++,n===i)return!0;s=s.next}
return!1},checkStickedBodyContacts:function(t){return this.checkBodyContacts(this.sticked.body,t,2)},worldSuckPoint:function(){return e.util.Box2dUtil.rotate(this.suckPoint,this.transform.rotation,this.worldSuckVec),e.util.Box2dUtil.b2Vec2SubtractRef(this.body.GetPosition(),this.worldSuckVec,this.worldSuckVec),this.worldSuckVec},checkFixed:function(t){if(Math.abs(t)<.1&&this.checkStickedBodyContacts("base")){var e=this.sticked.body;e.SetType(s.b2_kinematicBody),e.SetLinearVelocity(n.ZERO),e.SetAngularVelocity(0)}},applyRelativePosition:function(t){var i=this.sticked.body.GetPosition();e.util.Box2dUtil.rotate(t,-this.transform.rotation,i),i.Add(this.body.GetPosition())},launchTouching:function(){for(var t,e,i,s=this.body.GetContactList();s;)t=s.contact.GetFixtureA(),e=s.contact.GetFixtureB(),t.IsSensor()&&e.IsSensor()||!this.isSticky(t)&&!this.isSticky(e)||!s.contact.isTouching||(i=s.other.GetUserData(),i!=this.sticked&&i.canLaunch()&&this.applyImpulseToClip(i)),s=s.next},launch:function(){this.sticked.setSpeedLocked(!1),this.sticked.body.SetType(s.b2_dynamicBody),this.applyImpulseToClip(this.sticked),this.launchTime=this.world.totalTime,this.setSticked(null),e.util.soundController.playSoundEffect(e.util.GameSounds.effects.perdelkaOut0,70),this.spit()},applyImpulseToClip:function(t){var i=1;if(t.body.GetType()===s.b2_dynamicBody){var a=e.util.Box2dUtil.b2Vec2Distance(this.worldSuckPoint(),t.body.GetPosition());a-=t.getRadius(),a>0&&(i=Math.max(0,(n.IMPULSE_DISTANCE-a)/n.IMPULSE_DISTANCE))}
this.applyImpulseToBody(n.IMPULSE*i,t.body)},applyImpulseToBody:function(t,i){t=t*i.GetMass()*this.startScale,i.SetLinearVelocity(n.ZERO),e.util.Box2dUtil.toVec(t,this.transform.rotation-.5*Math.PI,this.suckForce),i.ApplyImpulse(this.suckForce,i.GetWorldCenter())},spit:function(){this.setWideSmokeRange(),this.showSmoke(),this.animation.setMinFrame(),this.animation.setMaxFrame(),this.animation.rewind=!0,this.animation.isAnimating=!0,this.animation.manual=!1},refreshSmokeAngle:function(){this.smoke.angle=new e.elem.Range(-this.transform.rotation+.5*Math.PI,.34906585)},createSmoke:function(){for(var t,e=0;e<n.SMOKE_PARTS;e++)t=this.smoke.addParticleWithPosition(this.transform.position),t.visible=!1},setSmokeRange:function(t){this.smoke.horizontalPosition=new e.elem.Range(this.smoke.horizontalPosition.value,t),this.smoke.verticalPosition=new e.elem.Range(this.smoke.verticalPosition.value,t)},setThinSmokeRange:function(){this.setSmokeRange(0),this.smoke.maxOpacity=.294,this.smoke.opacityStep=n.OPACITY_STEP/n.SLOW_SMOKE_MULT,this.smoke.scaleStep=n.SCALE_STEP/n.SLOW_SMOKE_MULT},setWideSmokeRange:function(){this.setSmokeRange(n.SMOKE_RANGE),this.smoke.maxOpacity=.705,this.smoke.opacityStep=1.6*n.OPACITY_STEP,this.smoke.scaleStep=n.SCALE_STEP},showSmoke:function(){this.smoke.showAllParticles()},reverseSmoke:function(){this.smoke.scaleStep=1.5*-n.SCALE_STEP;for(var t,e=0;e<this.smoke.particles.length;e++){t=this.smoke.particles[e],t.speedX*=-n.SLOW_SMOKE_MULT,t.speedY*=-n.SLOW_SMOKE_MULT;var i=Math.sqrt(t.speedX*t.speedX+t.speedY*t.speedY);if(i>300){var s=300/i;t.speedX*=s,t.speedY*=s}}}});n.SLOW_SMOKE_MULT=6,n.MAX_JOINED_DISTANCE=40*e.util.Box2dUtil.sizeMultiplier,n.TO_CENTER_FORCE=7,n.SCALE_STEP=7,n.OPACITY_STEP=.784,n.SMOKE_RANGE=20,n.MAX_TIME_TO_SMOKE=2.3,n.MIN_TIME_TO_SMOKE=1.5,n.LAUNCH_PAUSE=.2,n.SPIT_FRAMES=5,n.BASE_FRAME=7,n.SMOKE_PARTS=10,n.BUBBLE_DISTANCE=80*e.util.Box2dUtil.sizeMultiplier,n.JOINT_STEP=20*e.util.Box2dUtil.sizeMultiplier,n.MAX_DISTANCE=35*e.util.Box2dUtil.sizeMultiplier,n.IMPULSE=25,n.BODY_CENTER=new i(0,20*e.util.Box2dUtil.sizeMultiplier),n.SMOKE_POINT=new i(0,-2),n.IMPULSE_DISTANCE=200*e.util.Box2dUtil.sizeMultiplier,n.SUCK_DISTANCE=150,n.SUCK_POINT=new i(0,40*e.util.Box2dUtil.sizeMultiplier),n.SUCK_FORCE=150,n.NORMAL=new i(1,0),n.ZERO=new i(0,0),e.elem.SpringBodyClip=n}(Box2D,cj),function(t,e){function i(){var e=this;this.registrees=[],this.running=!1,this.time={now:Date.now(),previous:e.timeNow,delta:0},this.loop=function(){if(e.running){if(e.time.now=Date.now(),e.time.delta=.001*(e.time.now-e.time.previous),e.time.previous=e.time.now,e.time.delta>0)
for(var i=0;i<e.registrees.length;i++)e.registrees[i].update(e.time);t.requestAnimationFrame(e.loop)}}}!function(){for(var e=0,i=["ms","moz","webkit","o"],s=0;s<i.length&&!t.requestAnimationFrame;++s)t.requestAnimationFrame=t[i[s]+"RequestAnimationFrame"],t.cancelAnimationFrame=t[i[s]+"CancelAnimationFrame"]||t[i[s]+"CancelRequestAnimationFrame"];t.requestAnimationFrame||(t.requestAnimationFrame=function(i,s){var n=Date.now(),a=Math.max(0,16-(n-e)),o=t.setTimeout(function(){i(n+a)},a);return e=n+a,o}),t.cancelAnimationFrame||(t.cancelAnimationFrame=function(e){t.clearTimeout(e)})}(),i.prototype.register=function(t){this.registrees.push(t)},i.prototype.deregister=function(t){var e=this.registrees.indexOf(t);e>=0&&this.registrees.splice(e,1)},i.prototype.start=function(){this.running||(this.running=!0,this.loop())},i.prototype.stop=function(){this.running=!1},e.util.dispatcher=new i}(window,cj),function(t,e,i){function s(t,e,i,s){this.id=t,this.x=e,this.y=i,this.listener=void 0,this.isTouch=s||!1,this.radius=this.isTouch?o:a}
function n(n,a){function o(t,e,i,n){x[t]=new s(t,e,i,n),n?A++:k++;var a=x[t];I.startTouch(a)}
function r(t,e,i){var s=x[t];s&&(s.x=e,s.y=i)}
function h(t,e,i){var s=x[t];s&&(I.endTouch(s),s.listener=null,s.isTouch?A--:k--,delete x[t])}
function l(t){return{x:(t.pageX-L.left)*G/_,y:(t.pageY-L.top)*V/R}}
function d(t){t.preventDefault()}
function c(t,e){t.preventDefault();var i=t.pointerId||0,s=l(t);return o(i,s.x,s.y,e)}
function u(t){t.preventDefault();var e=t.pointerId||0,i=l(t);return r(e,i.x,i.y)}
function m(t){var e=t.pointerId||0;return h(e)}
function p(t){t.target.msSetPointerCapture(t.pointerId),0===A&&e.addEventListener("MSPointerMove",g),c(t,!0)}
function g(t){u(t)}
function f(t){m(t),0===A&&e.removeEventListener("MSPointerMove",g)}
function y(t){t.target.setPointerCapture(t.pointerId),0===A&&e.addEventListener("pointermove",v),c(t,!0)}
function v(t){u(t)}
function S(t){m(t),0===A&&e.removeEventListener("pointermove",v)}
function w(t){var i,s,n;for(t.preventDefault(),0===A&&e.addEventListener("touchmove",M),i=0;i<t.changedTouches.length;i+=1)s=t.changedTouches[i],n=l(s),o(s.identifier,n.x,n.y,!0)}
function M(t){var e,i,s;for(t.preventDefault(),e=0;e<t.changedTouches.length;e+=1)i=t.changedTouches[e],s=l(i),r(i.identifier,s.x,s.y)}
function b(t){var i,s;for(i=0;i<t.changedTouches.length;i+=1)s=t.changedTouches[i],h(s.identifier);0===A&&e.removeEventListener("touchmove",M)}
function P(t){0===k&&e.addEventListener("mousemove",C),c(t,!1)}
function C(t){u(t)}
function T(t){m(t),0===k&&e.removeEventListener("mousemove",C)}
function E(t){L=$("#surface").offset(),D=i.util.getScaleProperty(e.getElementById("container")),_=G*D,R=V*D}
function B(){return Modernizr.pointerevents?"pointer":t.navigator.msPointerEnabled?"mspointer":void 0!==t.ontouchstart?"touch":"unknown"}
var x=[],I=a,k=0,A=0,L=$("#surface").offset(),D=i.util.getScaleProperty(e.getElementById("container")),G=960,V=640,_=G*D,R=V*D;switch(this.update=function(){var t,e;for(t in x)x.hasOwnProperty(t)&&(e=x[t],I.moveTouch(e))},this.getPoints=function(){return x},this.freeTouch=function(t){var e=x[t];e&&(e.listener=null)},this.clearTouches=function(){var t,e;for(t in x)x.hasOwnProperty(t)&&(e=x[t],h(e.id,e.x,e.y))},B()){case "mspointer":n.addEventListener("MSPointerDown",p),e.addEventListener("MSPointerUp",f),e.addEventListener("MSPointerCancel",f),e.addEventListener("MSHoldVisual",d);break;case "pointer":n.addEventListener("pointerdown",y),e.addEventListener("pointerup",S),e.addEventListener("pointercancel",S),e.addEventListener("MSHoldVisual",d);break;case "touch":n.addEventListener("touchstart",w),e.addEventListener("touchend",b),n.addEventListener("mousedown",P),e.addEventListener("mouseup",T);break;default:n.addEventListener("mousedown",P),e.addEventListener("mouseup",T)}
e.addEventListener("contextmenu",d),e.addEventListener("selectstart",d),t.onresize=E}
var a=.5,o=1.5;s.prototype.addListener=function(t){this.listener=t},s.prototype.startTouch=function(){this.listener&&this.listener.startTouch(this)},s.prototype.moveTouch=function(){this.listener&&this.listener.moveTouch(this)},s.prototype.endTouch=function(){this.listener&&this.listener.endTouch(this)},s.prototype.copy=function(t){this.id=t.id,this.x=t.x,this.y=t.y},i.util.TouchPoint=s,i.util.TouchModule=n}(window,document,cj),function(t,e){function i(t){return!isNaN(t)}
function s(t){var e,n,a,o;switch(t.getAttribute("__type__")){case "NSMutableDictionary":case "Level":case "FlashPoint":for(n={},e=0;e<t.attributes.length;e+=1)a=t.attributes[e],"viewType"==a.name&&"McTeleportView"==a.value||"__type__"!==a.name&&(n[a.name]=i(a.value)?+a.value:a.value);for(e=0;e<t.childNodes.length;e+=1)o=t.childNodes[e],n[o.nodeName]=s(o);return n;case "NSMutableArray":for(n=[],e=0;e<t.childNodes.length;e+=1)n.push(s(t.childNodes[e]));return n;case "null":return null;default:throw new Error("unrecognized __type__: "+t.getAttribute("__type__"))}}
function n(t){return t=t.replace(/>\s*</g,"><"),s(r(t).documentElement)}
function a(t){var e=t instanceof Array?[]:{};for(var i in t)t[i]&&"object"==typeof t[i]?e[i]=a(t[i]):e[i]=t[i];return e}
var o,r,h=[],l=[];if("undefined"!=typeof t.DOMParser)r=function(e){return(new t.DOMParser).parseFromString(e,"text/xml")};else{if("undefined"==typeof t.ActiveXObject||!new t.ActiveXObject("Microsoft.XMLDOM"))throw new Error("No XML parser found");r=function(e){var i=new t.ActiveXObject("Microsoft.XMLDOM");return i.async="false",i.loadXML(e),i}}
var d={load:function(i,s){if(s=s||t.console.log,h[i])return void s(a(h[i]));var o=new XMLHttpRequest;isNaN(i)?o.open("GET","levels/"+i+"?v="+e.version,!0):o.open("GET","levels/level"+i+"web.xml?v="+e.version,!0),o.onreadystatechange=function(){4===o.readyState&&(h[i]=n(o.responseText),s(a(h[i])))},o.send()}},c={load:function(t,e){for(var i=t.length-1;i>=0;i--)
if(!l[t[i]])
for(var s=0;s<o.length;s++)o[i].name==t[i]&&(l[element[i]]=o[i].root);e()},makeConfigFileRequests:function(){$.get("elements-all.json?v="+e.version,function(t,e,i){if(o=JSON.parse(i.responseText))
for(var s=0;s<o.length;s++)l[o[s].name]=o[s].root})},getConfigFile:function(e){var i=l[e];return i?i:void(t.console&&console.log("unrecognized or uncached element "+e))}};e.util.levelXmlToJSON=n,e.util.levelXmlLoader=d,e.util.elementConfigCache=l,e.util.elementXmlLoader=c}(window,cj),function(t,e,i,s,n){var a=e.extend({init:function(t,e,n){this.element=t,this.moveEventName=void 0,this.dragMove=void 0,this.moved=!1,this.onPress=void 0,this.checked=!1,this.hasTransitions=!0,this.toggle=n,this.initX=0,this.initY=0,this.mouseDown=!1,this.hasEvents=!1,this.shouldFire=!1,this.shouldToggle=!0,this.touchEvent=null,this.getAudioTag=null,i.csstransitions||(this.hasTransitions=!1,this.myTweenable2=new s),this.boundTouchStart=this.touchStart.bind(this),this.boundTouchMove=this.touchMove.bind(this),this.boundTouchStop=this.touchStop.bind(this),this.boundMsStart=this.msStart.bind(this),this.boundMsMove=this.msMove.bind(this),this.boundMsStop=this.msStop.bind(this),this.boundPointerStart=this.pointerStart.bind(this),this.boundPointerMove=this.pointerMove.bind(this),this.boundPointerStop=this.pointerStop.bind(this),this.boundMouseStart=this.mouseStart.bind(this),this.boundMouseMove=this.mouseMove.bind(this),this.boundMouseStop=this.mouseStop.bind(this),this.boundFireClick=this.fireClick.bind(this),this.touchType=this.getTouchType(),this.initVisible(!0),this.initActive(e),this.fadeInTargetScale=1},getTouchType:function(){return window.navigator.pointerEnabled?"pointer":window.navigator.msPointerEnabled?"mspointer":void 0!==window.ontouchstart?"touch":"unknown"},initActive:function(t){t?this.onActivate():this.onDeactivate(),this.active=t},setActive:function(t){this.active!==t&&(t?this.onActivate():this.onDeactivate()),this.active=t},onActivate:function(){},onDeactivate:function(){},initVisible:function(t){t?this.onVisible():this.onHidden(),this.visible=t},setVisible:function(t){this.visible!==t&&(t?this.onVisible():this.onHidden()),this.visible=t},onVisible:function(){n.util.removeClass(this.element,"hiddenButton"),n.util.addClass(this.element,"visible")},onHidden:function(){n.util.removeClass(this.element,"visible"),n.util.addClass(this.element,"hiddenButton")},onTouchStart:function(t){},onTouchStop:function(){},onMovedOutside:function(){},registerClick:function(t){this.shouldFire=!0,this.touchEvent=t,this.toggle&&this.shouldToggle&&(this.toggleButton(),this.shouldToggle=!1)},fireClick:function(){this.shouldFire&&(this.onPress&&this.onPress(this.touchEvent),this.shouldFire=!1,this.touchEvent=null,this.toggle&&(this.shouldToggle=!0))},defaultStart:function(t){this.active&&this.visible&&(this.initX=t.clientX,this.initY=t.clientY,this.mouseDown=!0,this.scaleUp(),this.onTouchStart(t),this.moved=!1)},defaultMove:function(t,e){if(t.preventDefault(),this.mouseDown){var i=Math.abs(this.initX-t.clientX),s=Math.abs(this.initY-t.clientY);if(i>8||s>8)switch(this.moved=!0,this.scaleDown(),this.mouseDown=!1,this.onMovedOutside(),e){case "mspointer":this.element.removeEventListener("MSPointerMove",this.boundMsMove);break;case "pointer":this.element.removeEventListener("pointermove",this.boundPointerMove);break;case "touch":this.element.removeEventListener("touchmove",this.boundTouchMove);break;default:this.element.removeEventListener("mousemove",this.boundMouseMove)}}},defaultStop:function(t){this.active&&this.visible&&(this.initX=0,this.initY=0,this.mouseDown=!1,this.scaleDown(),this.onTouchStop(),this.moved||this.registerClick())},touchStart:function(t){this.defaultStart(t.changedTouches[0]),this.element.addEventListener("touchmove",this.boundTouchMove)},touchMove:function(t){t.preventDefault(),this.moved=!0,this.scaleDown()},touchStop:function(t){this.defaultStop(t),this.element.removeEventListener("touchmove",this.boundTouchMove)},mouseStart:function(t){this.defaultStart(t),this.element.addEventListener("mousemove",this.boundMouseMove)},mouseMove:function(t){this.defaultMove(t,"mouse")},mouseStop:function(t){this.defaultStop(t),this.element.removeEventListener("mousemove",this.boundMouseMove)},msStart:function(t){this.defaultStart(t),this.element.addEventListener("MSPointerMove",this.boundMsMove)},msMove:function(t){this.defaultMove(t,"mspointer")},msStop:function(t){this.defaultStop(t),this.element.removeEventListener("MSPointerMove",this.boundMsMove)},pointerStart:function(t){this.defaultStart(t),this.element.addEventListener("pointermove",this.boundPointerMove)},pointerMove:function(t){this.defaultMove(t,"pointer")},pointerStop:function(t){this.defaultStop(t),this.element.removeEventListener("pointermove",this.boundPointerMove)},addEventHandlers:function(){if(!this.hasEvents)switch(this.hasEvents=!0,this.touchType){case "mspointer":this.element.addEventListener("MSPointerDown",this.boundMsStart),this.element.addEventListener("MSPointerUp",this.boundMsStop),this.element.addEventListener("MSPointerCancel",this.boundMsStop);break;case "pointer":this.element.addEventListener("pointerdown",this.boundPointerStart),this.element.addEventListener("pointerup",this.boundPointerStop),this.element.addEventListener("pointercancel",this.boundPointerStop);break;case "touch":this.element.addEventListener("touchstart",this.boundTouchStart),this.element.addEventListener("touchend",this.boundTouchStop),this.element.addEventListener("mousedown",this.boundMouseStart),this.element.addEventListener("mouseup",this.boundMouseStop);break;default:this.element.addEventListener("mousedown",this.boundMouseStart),this.element.addEventListener("mouseup",this.boundMouseStop)}},removeEventHandlers:function(){if(this.hasEvents)switch(this.hasEvents=!1,this.touchType){case "mspointer":this.element.removeEventListener("MSPointerDown",this.boundMsStart),this.element.removeEventListener("MSPointerOut",this.boundMsStop),this.element.removeEventListener("MSPointerUp",this.boundMsStop),this.element.removeEventListener("MSPointerCancel",this.boundMsStop);break;case "pointer":this.element.removeEventListener("pointerdown",this.boundPointerStart),this.element.removeEventListener("pointerout",this.boundPointerStop),this.element.removeEventListener("pointerup",this.boundPointerStop),this.element.removeEventListener("pointercancel",this.boundPointerStop);break;case "touch":this.element.removeEventListener("touchstart",this.boundTouchStart),this.element.removeEventListener("touchend",this.boundTouchStop),this.element.removeEventListener("mousedown",this.boundMouseStart),this.element.removeEventListener("mouseout",this.boundMouseStop),this.element.removeEventListener("mouseup",this.boundMouseStop);break;default:this.element.removeEventListener("mousedown",this.boundMouseStart),this.element.removeEventListener("mouseout",this.boundMouseStop),this.element.removeEventListener("mouseup",this.boundMouseStop)}},setDragMoved:function(t){this.dragMove=t,this.boundDragMove=t.bind(this)},onChecked:function(){},onNotChecked:function(){},toggleButton:function(){this.toggle&&(this.checked?(this.onChecked(),this.checked=!1):(this.onNotChecked(),this.checked=!0))},scaleUp:function(){var t=this.element;if(this.hasTransitions)t.style.transitionDelay="0ms",t.style.transitionTimingFunction="ease-in",t.style.transitionDuration="150ms",t.style.WebkitTransitionDelay="0ms",t.style.WebkitTransitionTimingFunction="ease-in",t.style.WebkitTransitionDuration="150ms",t.style.msTransitionDelay="0ms",t.style.msTransitionTimingFunction="ease-in",t.style.msTransitionDuration="150ms",t.style.MozTransitionDelay="0ms",t.style.MozTransitionTimingFunction="ease-in",t.style.MozTransitionDuration="150ms",t.style.oTransitionDelay="0ms",t.style.oTransitionTimingFunction="ease-in",t.style.oTransitionDuration="150ms",n.util.set2dScale(t,1.1,1.1);else{var e=new s;e.tween({from:{scale:1},to:{scale:1.1},duration:150,step:function(){n.util.set2dScale(t,this.scale,this.scale)},easing:"easeOutSine"})}},scaleDown:function(){var t=this,e=this.element;if(n.util.soundController.isIPAD&&null!=t.getAudioTag&&n.util.soundController.playSoundTrack(t.getAudioTag()),this.hasTransitions)n.util.addRemoveTransitionEndCallback(e,this.boundFireClick),n.util.set2dScale(e,1,1);else{var i=new s;i.tween({from:{scale:1.1},to:{scale:1},duration:150,step:function(){n.util.set2dScale(e,this.scale,this.scale)},easing:"easeOutSine",callback:function(){t.fireClick()}})}},fadeIn:function(t){var e=this.element;if(n.util.set2dScale(e,this.fadeInTargetScale,this.fadeInTargetScale),this.setVisible(!0),this.hasTransitions)e.style.transitionProperty="transform, opacity",e.style.transitionTimingFunction="cubic-bezier(0.175, 0.885, 0.320, 1), ease-out",e.style.transitionDuration="300ms, 300ms",e.style.transitionDelay=t+"ms,"+t+"ms",e.style.msTransitionProperty="-ms-transform, opacity",e.style.msTransitionTimingFunction="cubic-bezier(0.175, 0.885, 0.320, 1), ease-out",e.style.msTransitionDuration="300ms, 300ms",e.style.msTransitionDelay=t+"ms,"+t+"ms",e.style.MozTransitionProperty="-moz-transform, opacity",e.style.MozTransitionTimingFunction="cubic-bezier(0.175, 0.885, 0.320, 1), ease-out",e.style.MozTransitionDuration="300ms, 300ms",e.style.MozTransitionDelay=t+"ms,"+t+"ms",e.style.WebkitTransitionProperty="-webkit-transform, opacity",e.style.WebkitTransitionTimingFunction="cubic-bezier(0.175, 0.885, 0.320, 1), ease-out",e.style.WebkitTransitionDuration="300ms, 300ms",e.style.WebkitTransitionDelay=t+"ms,"+t+"ms",e.style.oTransitionProperty="-o-transform, opacity",e.style.oTransitionTimingFunction="cubic-bezier(0.175, 0.885, 0.320, 1), ease-out",e.style.oTransitionDuration="300ms, 300ms",e.style.oTransitionDelay=t+"ms,"+t+"ms";else{e.style.opacity=0,n.util.set2dScale(e,.5,.5);var i=setTimeout(function(){clearTimeout(i);var t=new s;t.tween({from:{opacity:0,scale:.5},to:{opacity:1,scale:1},duration:150,step:function(){e.style.opacity=this.opacity,n.util.set2dScale(e,this.scale,this.scale)},easing:"easeOutSine"})},t)}},fadeOut:function(t){var e=this.element;if(this.hasTransitions)e.style.transitionDuration="0ms, 0ms",e.style.transitionDelay=t+"ms, "+t+"ms",e.style.WebkitTransitionDuration="0ms, 0ms",e.style.WebkitTransitionDelay=t+"ms, "+t+"ms",e.style.msTransitionDuration="0ms, 0ms",e.style.msTransitionDelay=t+"ms, "+t+"ms",e.style.MozTransitionDuration="0ms, 0ms",e.style.MozTransitionDelay=t+"ms, "+t+"ms",e.style.oTransitionDuration="0ms, 0ms",e.style.oTransitionDelay=t+"ms, "+t+"ms",n.util.set2dScale(e,.5,.5),this.setVisible(!1);else var i=this,s=setTimeout(function(){clearTimeout(s),i.setVisible(!1)},t)},appendToElement:function(t){t.appendChild(this.element)},appendChild:function(t){this.element.appendChild(t)},addEventListener:function(t,e){this.element.addEventListener(t,e)},getElement:function(){return this.element},setPressEvent:function(t){this.onPress=t},forceToggle:function(t){this.toggle&&(this.checked=t,this.toggleButton())}});n.ctrl.TouchButtonBase=a}(document,Class,Modernizr,Tweenable,cj),function(t,e,i,s){function n(t){this.element=t,this.states=[],this.fadeStates=[],t&&($(".meetPetitDiv span").html(s.util.localizedStringLoader.getLocalizedString("MEET_PETIT")),this.element.addEventListener("click",function(){window.open("http://www.youtube.com/watch?v=no0sGjnqYmw"),window.focus()}))}
var a=s.ctrl.TouchButtonBase.extend({init:function(e,i,n,a,o,r){this.styleName=a?a:"",this.pressedStyle=o?o:"",this.inactiveStyle=r?r:"",this._super(e,i,n),this.disabledIcon=void 0,this.toggle&&(this.disabledIcon=t.createElement("div"),s.util.addClass(this.disabledIcon,"disabledIcon"),s.util.addClass(this.disabledIcon,"hidden"),this.element.appendChild(this.disabledIcon))},onActivate:function(){this._super(),s.util.removeClass(this.element,this.inactiveStyle),s.util.addClass(this.element,this.styleName)},onDeactivate:function(){this._super(),s.util.removeClass(this.element,this.styleName),s.util.addClass(this.element,this.inactiveStyle)},onTouchStart:function(t){s.util.addClass(this.element,this.pressedStyle)},onTouchStop:function(t){s.util.removeClass(this.element,this.pressedStyle)},iosDragMove:function(t){this._super(t),s.util.removeClass(this.element,this.pressedStyle)},onMovedOutside:function(){s.util.removeClass(this.element,this.pressedStyle)},onChecked:function(){s.util.removeClass(this.disabledIcon,"visible"),s.util.addClass(this.disabledIcon,"hidden"),s.util.removeClass(this.element,"disabled")},onNotChecked:function(){s.util.removeClass(this.disabledIcon,"hidden"),s.util.addClass(this.disabledIcon,"visible"),s.util.addClass(this.element,"disabled")}}),o=a.extend({init:function(t,e){this._super(t,e,!1,"levelItem","levelItemPressed","levelItemInactive")}}),r=a.extend({init:function(e,i,n,a,o,r){if(this._super(e,i,n,a?"gameBtnBig":"gameBtn",a?"pressedBig":"pressed"),o&&s.util.addClass(e,o),r){var h=t.createElement("div");s.util.addClass(h,r),e.appendChild(h)}}}),h=a.extend({init:function(t){this._super(t,!0,!1,"roseBtn")}}),l=a.extend({init:function(t,e,i,s,n,a){this._super(t,e,i,s,n,a),this.states=[]},addState:function(e,i){var n=t.createElement("div");if(s.util.addClass(n,e),i){var a=t.createElement("div");s.util.addClass(a,i),n.appendChild(a)}
this.element.appendChild(n),this.states.push(n)},configureFadeStates:function(){},setAlphaOffset:function(t,e,i){var s=1-i,n=this.fadeStates[t],a=this.fadeStates[e];n!==a&&(n.style.opacity=s,n.style.opacity=s,a.style.opacity=i,a.style.opacity=i)},onActivate:function(){},onDeactivate:function(){},onTouchStart:function(t){for(var e,i=0;i<this.states.length;i++)e=this.states[i],s.util.addClass(e,this.pressedStyle)},onTouchStop:function(t){for(var e,i=0;i<this.states.length;i++)e=this.states[i],s.util.removeClass(e,this.pressedStyle)},touchMove:function(t){this._super(t);for(var e,i=0;i<this.states.length;i++)e=this.states[i],s.util.removeClass(e,this.pressedStyle)},onMovedOutside:function(){for(var t,e=0;e<this.states.length;e++)t=this.states[e],s.util.removeClass(t,this.pressedStyle)}}),d=l.extend({init:function(t,e,i,s){this._super(t,!0,!0,null,"pressed"),this.element.style.cursor="pointer",this.addState("gameBtnNonThemed",e),this.addState("gameBtnBlueNonThemed",i),this.addState("gameBtnPurpleNonThemed",s),this.element.removeChild(this.disabledIcon),this.element.appendChild(this.disabledIcon),this.configureFadeStates()},configureFadeStates:function(){for(var t,e=0;e<this.states.length-1;e++)t=this.states[e],t.style.opacity=0;this.fadeStates=[this.states[0],this.states[1],this.states[0],this.states[2],this.states[0],this.states[1]]}});n.prototype.addState=function(e,i){var n=t.createElement("div");if(s.util.addClass(n,e),i){var a=t.createElement("div");s.util.addClass(a,i),a.innerHTML=s.util.localizedStringLoader.getLocalizedString("MEET_PETIT"),n.appendChild(a)}
this.element.appendChild(n),this.states.push(n)},n.prototype.getElement=function(){return this.element},n.prototype.configureStates=function(){for(var t,e=0;e<this.states.length-1;e++)t=this.states[e],t.style.opacity=0;var i=this.states[0],s=this.states[1];this.fadeStates=[i,s,i,s,i,s]},n.prototype.setAlphaOffset=function(t,e,i){var s=1-i,n=this.fadeStates[t],a=this.fadeStates[e];n!==a&&(n.style.opacity=s,n.style.opacity=s,a.style.opacity=i,a.style.opacity=i)},n.prototype.configureSize=function(){switch(s.util.localizedStringLoader.currentLanguage){case "french":this.addClass("meetPetitTextFR");break;case "german":this.addClass("meetPetitTextDE");break;case "russian":this.addClass("meetPetitTextRU");break;case "portuguese":this.addClass("meetPetitTextPT")}},n.prototype.addClass=function(t){for(var e,i=0;i<this.states.length;i++)e=this.states[i],s.util.addClass(this.states[i].childNodes[0],t)},s.ctrl.TouchButton=a,s.ctrl.LevelButton=o,s.ctrl.GameButton=r,s.ctrl.RoseButton=h,s.ctrl.MainMenuSoundButton=d,s.ctrl.MeetPetitButton=n}(document,Modernizr,Tweenable,cj),function(t,e,i,s){function n(t,s){this.game=t,this.element=s,this.btnPlay=void 0,this.btnRestart=void 0,this.btnMenu=void 0,this.btnSkip=void 0,this.buttonList=[],this.myTweenable=void 0,this.hasTransitions=!0,this.createMenuElements(),e.csstransitions||(this.hasTransitions=!1,this.myTweenable=new i,this.myTweenable.cancel=!1)}
n.prototype.show=function(){var t=this.element,e=this,i=s.util.ReadUserData();this.showScoreAndLevel(i),this.hasTransitions?(s.util.setTransitionDuration(t,550),s.util.setTransitionEasingFunction(t,"cubic-bezier(0.215, 0.610, 0.355, 1.000)"),s.util.set2dTranslate(t,"620px","0px")):(this.myTweenable.cancel=!1,this.myTweenable.tween({from:{translateX:1e3},to:{translateX:620},duration:500,step:function(){e.myTweenable.cancel||s.util.set2dTranslate(e.element,this.translateX+"px","0px")},easing:"easeOutQuad"})),this.btnPlay.fadeIn(300),this.btnSound.fadeIn(400),this.btnSoundEffect.fadeIn(400),this.btnRestart.fadeIn(450),this.btnMenu.fadeIn(500),this.game.isLastLevel()&&!i.lastLevelOpen||this.game.isOutroScene()||this.btnSkip.fadeIn(550);for(var n=0;n<this.buttonList.length;n++)this.buttonList[n].addEventHandlers()},n.prototype.hide=function(t){var e=this.element,i=this;if(this.hasTransitions){for(var n=0;n<this.buttonList.length;n++){var a=this.buttonList[n];a.fadeOut(500),a.removeEventHandlers()}
s.util.setTransitionDuration(e,550),s.util.setTransitionEasingFunction(e,"cubic-bezier(0.550, 0.055, 0.675, 0.190)"),t&&s.util.addRemoveTransitionEndCallback(e,t),s.util.set2dTranslate(e,"1000px","0px")}else this.myTweenable.cancel=!1,this.myTweenable.tween({from:{translateX:620},to:{translateX:1e3},duration:500,step:function(){i.myTweenable.cancel||s.util.set2dTranslate(i.element,this.translateX+"px","0px")},callback:function(){i.myTweenable.cancel=!1,t&&t()},easing:"easeInQuad"})},n.prototype.hideImmediate=function(){var t=this.element;if(this.hasTransitions){for(var e=0;e<this.buttonList.length;e++){var i=this.buttonList[e];i.fadeOut(500),i.removeEventHandlers()}
s.util.setTransitionDuration(t,0)}else this.myTweenable.cancel=!0;s.util.set2dTranslate(t,"1000px","0px")},n.prototype.showScoreAndLevel=function(t){if(this.game.currentLevel){var e=t.worlds[this.game.currentWorld].levels[this.game.currentLevel-1].score;this.levelElement.innerHTML=s.util.localizedStringLoader.getFormatedLocalizedString("LEVEL",[this.game.currentWorld+1,this.game.currentLevel]),this.scoreElement.innerHTML=s.util.localizedStringLoader.getFormatedLocalizedString("BEST_SCORE",[e])}else this.levelElement.innerHTML="",this.scoreElement.innerHTML=""},n.prototype.createMenuElements=function(){var e=this.element,i=this,n=t.createElement("div");s.util.addClass(n,"smallText"),s.util.addClass(n,"scoreText"),n.innerText="Best Score: 1232",e.appendChild(n),this.scoreElement=n;var a=t.createElement("div");a.innerText="Level 1 - 1",s.util.addClass(a,"smallText"),s.util.addClass(a,"levelText"),e.appendChild(a),this.levelElement=a;var o=t.createElement("div");this.btnPlay=new s.ctrl.GameButton(o,!0,!1,!0,"gamePlayBtn","gamePlayIcon"),this.btnPlay.setVisible(!1),s.util.set2dScale(o,.5,.5),this.btnPlay.appendToElement(e),this.buttonList.push(this.btnPlay);var r=t.createElement("div");this.btnSound=new s.ctrl.GameButton(r,!0,!0,!1,"gameSoundBtnMenuPanel","gameSoundIcon"),this.btnSound.setVisible(!1),s.util.set2dScale(r,.5,.5),this.btnSound.appendToElement(e),this.buttonList.push(this.btnSound);var h=t.createElement("div");this.btnSoundEffect=new s.ctrl.GameButton(h,!0,!0,!1,"gameSoundEffectBtnMenuPanel","gameSoundEffectIcon"),this.btnSoundEffect.setVisible(!1),s.util.set2dScale(h,.5,.5),this.btnSoundEffect.appendToElement(e),this.buttonList.push(this.btnSoundEffect),s.util.soundController.isIPAD===!0&&(r.style.display="none",h.style.display="none");var l=t.createElement("div");t.createElement("div"),this.btnRestart=new s.ctrl.GameButton(l,!0,!1,!0,"gameRestartBtn","gameRestartIcon"),this.btnRestart.setVisible(!1),s.util.set2dScale(l,.5,.5),this.btnRestart.appendToElement(e),this.buttonList.push(this.btnRestart);var d=t.createElement("div");this.btnMenu=new s.ctrl.GameButton(d,!0,!1,!0,"gameMenuBtn","gameMenuIcon"),this.btnMenu.setVisible(!1),s.util.set2dScale(d,.5,.5),this.btnMenu.appendToElement(e),this.buttonList.push(this.btnMenu);var c=t.createElement("div");this.btnSkip=new s.ctrl.GameButton(c,!0,!1,!0,"gameSkipBtn","gameSkipIcon"),this.btnSkip.setVisible(!1),s.util.set2dScale(c,.5,.5),this.btnSkip.appendToElement(e),this.buttonList.push(this.btnSkip);var u=s.util.soundController.isMutedTracks();u&&(this.btnSound.forceToggle(!u),s.util.soundController.muteTracks(u));var m=s.util.soundController.isMutedEffects();m&&(this.btnSoundEffect.forceToggle(!m),s.util.soundController.muteEffects(m)),this.btnPlay.setPressEvent(function(){i.game.resume(),i.hide()}),this.btnRestart.setPressEvent(function(){i.hide(),s.util.newDelayAction(s.util.ScheduleContext.ALL,function(){i.game.restartLevel()},.25)}),this.btnSkip.setPressEvent(function(){i.hide(),s.util.newDelayAction(s.util.ScheduleContext.ALL,function(){i.game.nextLevel()},.25)}),this.btnMenu.setPressEvent(function(){i.hide(),i.game.levelTransitionMgr.fadeOut(function(){i.game.loadMainMenu(!1),s.util.newDelayAction(s.util.ScheduleContext.ALL,function(){i.game.levelTransitionMgr.fadeIn()},.25)})}),this.btnSound.setPressEvent(function(){var t=!s.util.soundController.isMutedTracks();s.util.soundController.muteTracks(t),i.game.menuSoundBtn.forceToggle(!t)}),this.btnSoundEffect.setPressEvent(function(){var t=!s.util.soundController.isMutedEffects();s.util.soundController.muteEffects(t),i.game.menuSoundEffectBtn.forceToggle(!t)})},s.ctrl.MenuPanel=n}(document,Modernizr,Tweenable,cj),function(t,e,i,s){function n(i,s){this.hasTransitions=e.csstransitions,this.container=t.getElementById("levelPickerContainer"),this.picker=t.getElementById("levelPicker"),this.element=s,this.game=i,this.scoreCanvas=t.getElementById("scoreCanvas"),this.createMenuElements()}
function a(t,e){this.onPress=function(){t.hide(!0,function(){var i=s.util.ReadUserData();s.util.logLevelEvent(t.game.currentWorld,e.levelDisplayNumber,i),t.game.loadLevel(e.levelDisplayNumber),t.game.resume()}),t.game.levelTransitionMgr.fadeOut()}}
function o(t,e){this.onPress=function(){t.hide(),t.game.world.hideLevels(),t.game.resume()}}
var r=4;n.prototype.show=function(t,e){var n=this;s.util.logEvent("http://ace.adoftheyear.com/p13100/tagger_v02.php?project=p13100&tag=1a&channel=[sid=US_ContreJour_Tag_3_1c|cid=1003|]"),this.update(),s.util.removeClass(this.container,"hideDelay"),this.container.style.visibility="visible";var a=s.util.ReadUserData();if(this.game.currentWorld===r&&a.lastLevelOpen?(this.picker.style.height="360px",this.venzel.style.visibility="",this.venzel2.style.visibility="",this.lastLevelButton.element.style.visibility=""):(this.picker.style.height="180px",this.venzel.style.visibility="hidden",this.venzel2.style.visibility="hidden",this.lastLevelButton.element.style.visibility="hidden"),this.toggleGround(!0),this.hasTransitions)t||this.scaleUp(),e&&s.util.addRemoveTransitionEndCallback(this.btnBack.getElement(),e),this.element.style.opacity=1,this.btnBack.getElement().style.opacity=1;else{var o=new i;o.tween({from:{opacity:0,scale:.5},to:{opacity:1,scale:1},duration:500,step:function(){n.element.style.opacity=this.opacity,n.btnBack.getElement().style.opacity=this.opacity,t||s.util.set2dScale(n.element,this.scale,this.scale)},callback:function(){e&&e()},easing:"easeOutSine"})}
this.btnBack.addEventHandlers(),this.lastLevelButton.visible&&this.lastLevelButton.addEventHandlers();for(var h=0;h<this.buttons.length;h++)this.buttons[h].addEventHandlers()},n.prototype.scaleDown=function(){s.util.set2dScale(this.element,.5,.5)},n.prototype.scaleUp=function(){s.util.set2dScale(this.element,1,1)},n.prototype.hide=function(t,e){var n=this;if(s.util.ReadUserData(),this.hasTransitions)t||this.scaleDown(),e&&s.util.addRemoveTransitionEndCallback(this.btnBack.getElement(),e),s.util.toggleClass(this.container,"hideDelay"),this.container.style.visibility="hidden",this.element.style.opacity=0,this.btnBack.getElement().style.opacity=0;else{var a=new i;a.tween({from:{opacity:1,scale:1},to:{opacity:0,scale:.5},duration:500,step:function(){n.element.style.opacity=this.opacity,n.btnBack.getElement().style.opacity=this.opacity,t||s.util.set2dScale(n.element,this.scale,this.scale)},callback:function(){n.container.style.visibility="hidden",e&&e()},easing:"easeOutSine"})}
this.btnBack.removeEventHandlers(),this.lastLevelButton.removeEventHandlers();for(var o=0;o<this.buttons.length;o++)this.buttons[o].removeEventHandlers()},n.prototype.createMenuElements=function(){for(;this.element.firstChild;)this.element.removeChild(this.element.firstChild);var e=this,i=s.util.ReadUserData(),n=i.worlds[this.game.currentWorld].levels,r=t.createElement("div");this.btnBack=new s.ctrl.GameButton(r,!0,!1,!1,"gameBackBtn","gameBackIcon"),this.btnBack.appendToElement(this.container);var h=new o(e,this.btnBack);this.btnBack.setPressEvent(h.onPress),this.buttons=[];for(var l=0;l<n.length;l++){var d=n[l];this.buttons[l]=new s.ctrl.LevelButton(t.createElement("div"),d.state===s.util.LevelState.UNLOCKED),this.buttons[l].levelDisplayNumber=n[l].levelDisplayNumber,this.buttons[l].appendToElement(this.element),this.setLevelItem(this.buttons[l],d.levelDisplayNumber,d.stars);var c=new a(e,this.buttons[l]);this.buttons[l].setPressEvent(c.onPress),this.buttons[l].getAudioTag=function(){return"chapter"+(s.ctrl.game.currentWorld+1)}}
this.lastLevelButton=new s.ctrl.RoseButton(t.createElement("div")),this.lastLevelButton.appendToElement(this.element),this.lastLevelButton.setPressEvent(function(){e.hide(!0,function(){var t=s.util.ReadUserData();s.util.logLevelEvent(e.game.currentWorld,0,t),e.game.loadOutroScene(),e.game.resume()}),e.game.levelTransitionMgr.fadeOut()}),this.venzel=t.createElement("div"),s.util.addClass(this.venzel,"venzel"),this.element.appendChild(this.venzel),this.venzel2=t.createElement("div"),s.util.addClass(this.venzel2,"venzel2"),this.element.appendChild(this.venzel2)},n.prototype.toggleGround=function(t){t?($(".menuHeader").css({visibility:"visible"}),$(".menuFooter").css({visibility:"visible"}),this.scoreCanvas.style.visibility="visible",this.game.menuSoundBtn.getElement().style.visibility="visible",this.game.menuSoundEffectBtn.getElement().style.visibility="visible"):($(".menuHeader").css({visibility:"hidden"}),$(".menuFooter").css({visibility:"hidden"}),this.scoreCanvas.style.visibility="hidden",this.game.menuSoundBtn.getElement().style.visibility="hidden",this.game.menuSoundEffectBtn.getElement().style.visibility="hidden")},n.prototype.update=function(){for(var t,e,i,n,a=s.util.ReadUserData(),o=a.worlds[this.game.currentWorld].levels,r=0;r<this.buttons.length;r++){t=this.buttons[r],i=t.lightsElement.childNodes,n=o[r],t.setActive(n.state===s.util.LevelState.UNLOCKED);for(var h=i.length-1;h>=0;h--)e=i[h],s.util.addClass(e,"levelItemLightInactive"),2-h<o[r].stars&&s.util.removeClass(e,"levelItemLightInactive")}},n.prototype.setLevelItem=function(e,i,n){var a=t.createElement("div");s.util.addClass(a,"levelItemLightsContainer"),e.appendChild(a),e.lightsElement=a;for(var o=0;3>o;o++){var r=t.createElement("div");s.util.addClass(r,"levelItemLight"),s.util.addClass(r,"levelItemLightInactive"),a.appendChild(r)}
var h=t.createElement("div");s.util.addClass(h,"levelItemInner"),e.appendChild(h);var l=t.createElement("div");s.util.addClass(l,"levelItemDigit");var d=t.createElement("div");if(s.util.addClass(d,"levelItemDigitContainer"),h.appendChild(d),9>=i)s.util.addClass(l,"level"+i),d.appendChild(l),l.style.marginLeft="15px";else{var c=Math.floor(i/10),u=i%10,m=t.createElement("div");s.util.addClass(m,"levelItemDigit"),l.style.styleFloat="left",m.style.styleFloat="left",l.style.cssFloat="left",m.style.cssFloat="left",s.util.addClass(l,"level"+c),s.util.addClass(m,"level"+u),d.appendChild(l),d.appendChild(m)}},s.ctrl.LevelPicker=n,s.constants.ROSE_WORLD_INDEX=r}(document,Modernizr,Tweenable,cj),function(t,e,i){var s=t.Common.Math.b2Vec2,n=e.extend({init:function(t){this.world=t,this.numLights=0,this.newHighScore=!1,this.transform=new i.util.Transform,this.transform.setPosition(180,250),this.transform.setScale(0,0),this.body=new i.util.Bitmap(i.util.GameImages.McFakeHeroBackground),this.eye=new i.elem.FakeHeroEye(this.transform),this.shadow=new i.util.Bitmap(i.util.GameImages.McFakeHeroShadow),this.highlight=new i.util.Bitmap(i.util.GameImages.McHighliteMenu,!1,!0),this.highlight.alpha=.4;var e="black";this.world.isBlackSide()?(this.highlight.alpha=.45,this.highlightColor=new i.util.Color(26,70,99),e="rgb(29,166,224)"):this.world.isWhiteSide()&&(e=i.elem.HeroBodyClip.WHITE_TAIL_COLOR),this.tail=new i.elem.HeroTail(e),this.tail.setScale(0,0),this.tail.limitAngles=!1,this.tail.speed=0,this.tail.attachedPoint=this.transform.position.Copy(),this.hotSpot=new i.util.Bitmap(i.util.GameImages.McFakeHeroHotspot),this.hotSpot.alpha=.4,this.portal=new i.elem.Portal(null,null,i.util.GameImages.McFinishPart,this.transform),this.portal.itemsScale=0,this.portal.targetScale=0,this.portal.scaleStep=.1},update:function(t){this.portal.update(t),this.tail.update(t),this.eye.update(t)},draw:function(t){var e=t.foreground;this.world.isBlackSide()?this.highlight.drawWithTint(e,this.transform,this.highlightColor):this.highlight.draw(e,this.transform),this.portal.draw(t.foreground),this.shadow.draw(e,this.transform),this.tail.draw(t),this.body.draw(e,this.transform),this.hotSpot.draw(e,this.transform),this.eye.draw(e),this.stamp&&(this.stamp.draw(e),e.save(),i.util.Maths.transformContext(e,this.stamp.transform),this.stampLabel.draw(e),e.restore())},setMoveAngle:function(t,e){this.tail.setMovementDirection(t),this.tail.speed=e},lookAtLights:function(){this.setViewTarget(n.LIGHTS_VECTOR);var t=this;i.util.newDelayAction(i.util.ScheduleContext.LEVEL,function(){t.lookAtScore()},.7)},lookAtScore:function(){this.setViewTarget(n.SCORE_VECTOR);var t,e=this,s=.5;this.newHighScore?(t=function(){e.lookAtImproved()},s=.7):t=function(){e.lookAtPlayer()},i.util.newDelayAction(i.util.ScheduleContext.LEVEL,t,s)},lookAtPlayer:function(){this.setViewTarget(n.PLAYER_VECTOR);var t=this;i.util.newDelayAction(i.util.ScheduleContext.LEVEL,function(){t.startBlinking()},.5)},lookAtImproved:function(){this.setViewTarget(n.IMPROVED_VECTOR);var t=this;i.util.newDelayAction(i.util.ScheduleContext.LEVEL,function(){t.lookAtPlayer()},.5)},startBlinking:function(){var t=this;3===this.numLights||this.newHighScore?(t.eye.playAnimation("smile",!0,function(){t.eye.scheduleRandomAnimation()}),i.util.soundController.playSoundEffect(i.util.GameSounds.effects.laugh0,75)):t.eye.playAnimation("blink",!0,function(){t.eye.scheduleRandomAnimation()})},setViewTarget:function(t){this.eye.viewAngle=Math.atan2(t.y,t.x),this.eye.setViewDistance(t.Length())},showPortal:function(t,e){this.numLights=t,this.newHighScore=e,this.portal.targetScale=2;var s=this;i.util.newDelayAction(i.util.ScheduleContext.LEVEL,function(){i.util.newStepAction(i.util.ScheduleContext.LEVEL,function(){s.startFakeHeroEvents(),s.portal.targetScale=0,s.setMoveAngle(Math.PI,1)},function(t,e){var n=1-e/t,a=i.util.Maths.lerp(0,1,n),o=i.util.Maths.lerp(0,2,n);s.transform.setScale(a,a),s.tail.setScale(o,o)},.3)},.5)},startFakeHeroEvents:function(){var t=this;i.util.newDelayAction(i.util.ScheduleContext.LEVEL,function(){t.lookAtLights()},.5),t.newHighScore&&i.util.newDelayAction(i.util.ScheduleContext.LEVEL,function(){t.showNewHighScore()},1)},hidePortal:function(){this.portal.targetScale=0},showNewHighScore:function(){this.stamp=new i.elem.Sprite(i.util.GameImages.McImprovedResult),this.stamp.setPosition(70,80),this.stamp.setScale(0,0),this.stamp.setRotation(i.util.Maths.toRadians(170)),this.stampLabel=new i.util.MultilineLabel(i.util.localizedStringLoader.getLocalizedString("IMPROVED_RESULT"),28,45),this.stampLabel.color="rgb(255,255,255)",this.stampLabel.setPosition(61,75),this.stampLabel.setRotation(i.util.Maths.toRadians(-10.8)),i.util.newRotationAction(i.util.ScheduleContext.LEVEL,this.stamp,.25,0),i.util.newScaleAction(i.util.ScheduleContext.LEVEL,this.stamp,.25,.7)}});n.LIGHTS_VECTOR=new s(1,-1),n.SCORE_VECTOR=new s(1,-.4),n.PLAYER_VECTOR=new s(0,0),n.IMPROVED_VECTOR=new s(-1,-1),i.elem.FakeHero=n}(Box2D,Class,cj),function(t,e,i,s,n,a){var o=a.extend({init:function(t){this.game=t,this.container=e.getElementById("letterBoxContainer"),this.letterBoxTop=e.getElementById("letterBoxTop"),this.letterBoxBottom=e.getElementById("letterBoxBottom"),this.hasTransitions=!0,this.myTweenable=null,i.csstransitions||(this.hasTransitions=!1,this.myTweenable=new s),this.boundOnFinishTranslation=this.onFinishTranslation.bind(this)},show:function(){if(this.hasTransitions)this.container.style.visibility="visible",n.util.setTransitionDuration(this.letterBoxTop,550),n.util.setTransitionDelay(this.letterBoxTop,100),n.util.setTransitionDuration(this.letterBoxBottom,550),n.util.setTransitionDelay(this.letterBoxBottom,100),n.util.addRemoveTransitionEndCallback(this.letterBoxTop,this.boundOnFinishTranslation),n.util.set2dTranslate(this.letterBoxTop,"0px","0px"),n.util.set2dTranslate(this.letterBoxBottom,"0px","0px");else{var t=this;this.container.style.visibility="visible",this.myTweenable.tween({from:{letterBox:-75,opacity:0},to:{letterBox:0,opacity:1},duration:550,step:function(){n.util.set2dTranslate(t.letterBoxTop,0,this.letterBox+"px"),n.util.set2dTranslate(t.letterBoxBottom,0,-this.letterBox+"px")},easing:"easeOutSine",callback:function(){t.onFinishTranslation()}})}},reset:function(){n.util.setTransitionDuration(this.letterBoxTop,0),n.util.setTransitionDelay(this.letterBoxTop,0),n.util.setTransitionDuration(this.letterBoxBottom,0),n.util.setTransitionDelay(this.letterBoxBottom,0),n.util.setTransitionDuration(this.container,0),n.util.setTransitionDelay(this.container,0),n.util.set2dTranslate(this.letterBoxTop,"0px","-75px"),n.util.set2dTranslate(this.letterBoxBottom,"0px","75px"),this.container.style.visibility="hidden"},onFinishTranslation:function(){}}),r=o.extend({init:function(t){this._super(t),this.textContainer=this.createElement("scoreShareContainer",this.container),this.textContainer.style.opacity=0,this.textContainer.style.visibility="visible",this.createBackButton(),this.createShareButton(),this.createShareText()},createElement:function(t,i){var s=e.getElementById(t);return s||(s=e.createElement("div"),s.id=t,i.appendChild(s)),s},createBackButton:function(){var t=this,i=this.createElement("finalBackBtn",this.container);this.btnBack=new n.ctrl.GameButton(i,!0,!1,!1,"gameBackBtn","gameBackIcon"),this.btnBack.setPressEvent(function(){t.btnBack.removeEventHandlers(),n.offline||t.facebookButton.removeEventHandlers(),t.game.levelTransitionMgr.fadeOut(function(){t.reset();var i=e.getElementById("textCanvas");i&&(i.parentElement.removeChild(i),i=void 0),t.game.loadMainMenu(!1),n.util.newDelayAction(n.util.ScheduleContext.ALL,function(){t.game.levelTransitionMgr.fadeIn()},.25)})}),this.btnBack.getElement().style.opacity=0,this.btnBack.getElement().style.visibility="visible"},createShareButton:function(){var t=this;if(!n.offline){var e=this.createElement("scoreShareBtn",this.textContainer);this.facebookButton=new n.ctrl.GameButton(e,!0,!1,!1,"gameFacebookBtn","gameFacebookIcon"),this.facebookButton.setPressEvent(function(){t.shareScore()})}},createShareText:function(t){this.scoreText=this.createElement("scoreText",this.textContainer),this.shareText=this.createElement("scoreShareText",this.textContainer),this.shareText.innerHTML=n.util.localizedStringLoader.getLocalizedString("FINAL_SCORE_SHARE"),n.util.addClass(this.scoreText,"mediumText"),n.util.addClass(this.shareText,"smallText"),n.offline?(n.util.addClass(this.scoreText,"facebookScoreOffline"),n.util.addClass(this.shareText,"facebookShareOffline")):(n.util.addClass(this.scoreText,"facebookScore"),n.util.addClass(this.shareText,"facebookShare"))},reset:function(){this._super(),this.btnBack.removeEventHandlers(),this.btnBack.getElement().style.opacity=0,this.btnBack.getElement().style.visibility="hidden",this.textContainer.style.opacity=0,this.textContainer.style.visibility="hidden"},onFinishTranslation:function(){this.setFacebookText(),this.hasTransitions?(this.btnBack.getElement().style.opacity=1,this.textContainer.style.opacity=1):(this.fadeElementIn(this.btnBack.getElement()),this.fadeElementIn(this.textContainer)),n.offline||this.facebookButton.addEventHandlers(),this.btnBack.addEventHandlers()},fadeElementIn:function(t){var e=new s;e.tween({from:{opacity:0},to:{opacity:1},duration:500,step:function(){t.style.opacity=this.opacity},easing:"easeOutSine"})},setFacebookText:function(){var t=n.util.ReadUserData();this.scoreText.innerHTML=n.util.localizedStringLoader.getFormatedLocalizedString("TOTAL",[n.util.formatNumber(t.totalScore())])},shareScore:function(){if(!n.offline){var e=n.util.ReadUserData(),i=encodeURIComponent("yell0wsuit.github.io/html5-games"),s=encodeURIComponent("https://yell0wsuit.github.io/html5-games/ContreJour/img/icon144x144.png"),a=encodeURIComponent("https://yell0wsuit.github.io/html5-games/ContreJour/complete.html"),o=encodeURIComponent(n.util.localizedStringLoader.getFormatedLocalizedString("FACEBOOK_SCORE_SHARE_MESSAGE",[n.util.formatNumber(e.totalScore())])),r=encodeURIComponent("Contre Jour"),h=encodeURIComponent("Contre Jour is now on the web with a beautiful multi-touch world for IE10 users. Play it now!"),l="427821790613350",i="https://www.facebook.com/dialog/feed?app_id="+l+"&link="+i+"&picture="+s+"&name="+r+"&caption="+o+"&description="+h+"&display=popup&redirect_uri="+a;t.open(i,"_blank","width=580,height=400,menubar=0")}}});n.ctrl.LetterBox=o,n.ctrl.BackButtonLetterBox=r}(window,document,Modernizr,Tweenable,cj,Class),function(t,e,i){var s=e.extend({init:function(t,e){this.parts=t,this.partSize=e}});s.getRopeMetricsByLength=function(t,e,i){var n=Math.max(Math.ceil(t/e),i),a=t/n;return new s(n,a)},s.getRopeMetrics=function(e,i,a,o){var r=s.getRopeMetricsByLength(t.Common.Math.b2Math.SubtractVV(i,e).Length(),a,o);return new n(r.parts,r.partSize,e,i)};var n=s.extend({init:function(e,i,s,n){this._super(e,i),this.partOffset=t.Common.Math.b2Math.SubtractVV(n,s),this.partOffset.Multiply(1/this.parts),this.start=s,this.end=n},getPositionByIndex:function(e){var i=this.start.Copy(),s=this.partOffset.Copy();return s.Multiply(e),t.Common.Math.b2Math.AddVV(i,s)}});i.util.RopeMetrics=s}(Box2D,Class,cj),function(t,e,i){var s=t.Common.Math.b2Vec2,n=e.extend({init:function(t,e,i){this.start=t,this.control=e,this.end=i,this.calculatedLength=-1,this.precision=1e-10},fOr:function(t,e){return 0!==t?t:e},length:function(){return-1===this.calculatedLength&&(this.calculatedLength=this.getSegmentLength(1)),this.calculatedLength},getPointByTime:function(t){var e=1-t,i=this.start.x*e*e+2*this.control.x*t*e+this.end.x*t*t,n=this.start.y*e*e+2*this.control.y*t*e+this.end.y*t*t;return new s(i,n)},getSegmentLength:function(t){var e,i,s=this.control.x-this.start.x,n=this.control.y-this.start.y,a=this.end.x-this.control.x-s,o=this.end.y-this.control.y-n,r=4*(s*s+n*n),h=8*(s*a+n*o),l=4*(a*a+o*o);if(0===l)return 0===h?e=Math.sqrt(r)*t:(e=2/3*(h*t+r)*Math.sqrt(h*t+r)/h,i=2/3*r*Math.sqrt(r)/h,e-i);var d=Math.sqrt(l*t*t+h*t+r),c=Math.sqrt(r),u=Math.sqrt(l),m=(.5*h+l*t)/u+d;e=m<this.precision?.25*(2*l*t+h)*d/l:.25*(2*l*t+h)*d/l+.5*Math.log((.5*h+l*t)/u+d)/u*(r-.25*h*h/l);var p=.5*h/u+c;return i=p<this.precision?.25*h*c/l:.25*h*c/l+.5*Math.log(.5*h/u+c)/u*(r-.25*h*h/l),e-i},getTimesSequenceWithStep:function(t,e){t=Math.abs(t);var s=e,n=[],a=this.length();if(s>a)return n;s=0>s?i.util.Maths.remainderP(s,t)+t:i.util.Maths.remainderP(s,t);for(var o,r,h,l,d,c,u,m=this.control.x-this.start.x,p=this.control.y-this.start.y,g=this.end.x-this.control.x,f=this.end.y-this.control.y,y=g-m,v=f-p,S=4*(m*m+p*p),w=8*(m*y+p*v),M=4*(y*y+v*v),b=s/a,P=S-.25*w*w/M,C=.25*w*Math.sqrt(S)/M,T=.5*w/Math.sqrt(M)+Math.sqrt(S),E=Math.sqrt(S),B=Math.sqrt(M);a>=s;){var x=20;if(0==M)
if(0==w){do o=E*b,r=this.fOR(Math.sqrt(Math.abs(M*b*b+w*b+S)),this.precision),b-=(o-s)/r;while(Math.abs(o-s)>this.precision&&x--)}else do o=2/3*((w*b+S)*Math.sqrt(Math.abs(w*b+S))-S*E)/w,r=this.fOR(Math.sqrt(Math.abs(M*b*b+w*b+S)),this.precision),b-=(o-s)/r;while(Math.abs(o-s)>this.precision&&x--);else do h=Math.sqrt(Math.abs(M*b*b+w*b+S)),l=(.5*w+M*b)/B+h,c=.25*(2*M*b+w)*h/M,d=l<this.precision?c:c+.5*Math.log((.5*w+M*b)/B+h)/B*P,u=T<this.precision?C:C+.5*Math.log(.5*w/B+E)/B*P,o=d-u,r=this.fOr(h,this.precision),b-=(o-s)/r;while(Math.abs(o-s)>this.precision&&x--);n.push(b),s+=t}
return n}});i.util.Bezier=n}(Box2D,Class,cj),function(t){var e=t.elem.EntityBase.extend({init:function(e){this._super(null,null),this.particleSystem=t.elem.ParticleSystem,this.opacity=1,this.frame=0,this.speedX=0,this.speedY=0,this.angularSpeed=0,this.visible=!0,this.transform.setInitial(this.transform)}});t.elem.Particle=e}(cj),function(t){var e=t.elem.EntityBase.extend({init:function(e,i,s,n,a){this._super(e,i,n,a),this.particles=[],this.particleImage=new t.util.Bitmap(s),this.invisibleParticles=[],this.paused=!1,this.alpha=1,this.enableCulling=!0},update:function(t){if(!this.paused){for(var e=[],i=null,s=0;s<this.particles.length;s++)i=this.particles[s],this.updateParticleTime(i,t),i.visible||(e.push(s),this.invisibleParticles.push(i));for(var s=e.length-1;s>=0;s--)this.particles.splice(e[s],1)}},updateParticleTime:function(t,e){},draw:function(t){if(!(this.world&&this.world.isCulling&&this.enableCulling))
for(var e=null,i=0;i<this.particles.length;i++)e=this.particles[i],this.particleImage.alpha=e.opacity*this.alpha,this.particleImage.frame=e.frame,this.particleImage.draw(t.particle,e.transform)},totalFrames:function(){return this.particleImage.clipData.frames},addParticle:function(){return this.addParticleWithFrame(Math.floor(Math.random()*this.particleImage.clipData.frames))},addParticles:function(t){for(var e=0;t>e;e++)this.addParticle()},addParticleWithFrame:function(t){var e=this.createParticle();return this.particles.push(e),e.frame=t,e},addOrGetInvisible:function(){if(this.invisibleParticles.length>0){var t=this.invisibleParticles[this.invisibleParticles.length-1];return this.setParticleVisible(t),t}
return this.addParticle()},removeParticle:function(t){var e=this.particles.indexOf(t);e>=0&&this.particles.splice(e,1)},setParticleVisible:function(t){t.visible||(this.particles.push(t),this.invisibleParticles.splice(this.invisibleParticles.length-1,1),t.visible=!0,this.onShowParticle(t))},setParticleScale:function(t,e){for(var i=0;i<this.particles.length;i++)this.particles[i].transform.setScale(t,e)},onShowParticle:function(t){},addParticleWithPosition:function(t){var e=this.addParticle();return e.setPositionV(t),e},createParticle:function(){return new t.elem.Particle(this)},showAllParticles:function(){for(;this.invisibleParticles.length>0;)this.setParticleVisible(this.invisibleParticles[this.invisibleParticles.length-1])},hideAllParticles:function(){for(var t=0;t<this.particles.length;t++)this.particles[t].visible=!1},setOpacity:function(t){this.alpha=t}}),i=e.extend({draw:function(t){for(var e=null,i=0;i<this.particles.length;i++)e=this.particles[i],this.particleImage.alpha=e.opacity*this.alpha,this.particleImage.frame=e.frame,this.particleImage.draw(t.foreground,e.transform)}}),s=e.extend({init:function(t,e,i,s,n){this._super(t,e,i,s,n),this.radius=0,this.angleStep=0},getItemAngle:function(t){return t*this.angleStep},addParticleWithFrame:function(t){var e=this._super(t);return this.angleStep=1/this.particles.length*2*Math.PI,e},setRadius:function(e){if(this.radius!==e){this.radius=e;var i,s,n,a=this.particles.length;for(i=0;a>i;i++)s=this.getItemAngle(i),n=this.particles[i],n.transform.rotation=-s+90*Math.PI/180,t.util.Box2dUtil.toVec(e,-s,n.transform.position)}},draw:function(t){if(this.visible)
for(var e=null,i=0;i<this.particles.length;i++)e=this.particles[i],this.particleImage.alpha=e.opacity*this.alpha,this.particleImage.frame=e.frame,this.particleImage.draw(t,e.transform)}}),n=e.extend({init:function(t,e,i,s,n){this._super(t,e,i,s,n),this.plasticineTouches=0},incrementTouch:function(){this.plasticineTouches++},decrementTouch:function(){this.plasticineTouches--}});t.elem.ParticleSystem=e,t.elem.ForegroundParticleSystem=i,t.elem.FurCircle=s,t.elem.GrassParticleSystem=n}(cj),function(t,e){var i=t.Common.Math.b2Vec2,s=(t.Dynamics.b2Body,e.elem.EntityBase.extend({init:function(t,i,s,n,o){this._super(s,i,n,t),this.body.SetUserData(this),this.portal=new a(s,i,o?o:e.util.GameImages.McFinishPart,n),this.portal.itemsScale=0,this.portal.targetScale=0,this.finishing=!1},update:function(t){this.portal.update(t)},draw:function(t){this.portal.draw(t.foreground)},setVisible:function(t){this.visible=t,this.portal.visible=t},showPortal:function(t){this.portal.itemsScale=0,this.portal.targetScale=1},hidePortal:function(t){this.portal.targetScale=0},onCollisionStart:function(t,i){if(t&&!this.finishing){var s=t.GetUserData();if(s&&s.isHero()){for(var n=this.world.entities.elements,a=0;a<n.length;a++)n[a]instanceof e.elem.SnotBodyClip&&n[a].release();this.world.amie&&this.world.amie.releaseHero(),this.finishing=!0;var o=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){o.completeLevel(s)},0)}}},completeLevel:function(t){if(t){var e=this,i=e.body.GetPosition();t.finishLevel(i,.3,!0,"close"),t.setScaleTime(0,.5),e.hidePortal()}}})),n=s.extend({init:function(t,e,i,s,n){this._super(t,e,i,s,n),this.world.endLevelPortal=this}});s.PARTS_COUNT=5;var a=e.elem.ParticleSystem.extend({init:function(t,e,i,n){this._super(t,e,i,n),this.visible=!1,this.parts=[],this.itemsScale=1,this.targetScale=1,this.scaleStep=.05;for(var a=null,r=null,h=0;h<s.PARTS_COUNT;h++)a=this.addParticle(),r=new o(this.world,a,null,n.position,2*Math.PI/s.PARTS_COUNT*h),this.parts.push(r)},update:function(t){for(var i=0;i<this.parts.length;i++)this.parts[i].update(t);this._super(t),e.util.Maths.fuzzyEqual(this.itemsScale,this.targetScale)||(this.itemsScale=e.util.Maths.stepTo(this.itemsScale,this.targetScale,this.scaleStep*t.delta*30)),this.visible=this.itemsScale>0},updateParticleTime:function(t,e){this._super(t,e),t.setScale(this.itemsScale,this.itemsScale)},draw:function(t){if(this.visible)
for(var e=0;e<this.particles.length;e++){var i=this.particles[e];this.particleImage.alpha=i.opacity,this.particleImage.draw(t,i.transform,"lighter")}},setSpeedValue:function(t){for(var e=0;e<this.parts.length;e++)this.parts[e].speedValue=t}}),o=e.elem.EntityBase.extend({init:function(t,s,n,a,o){this.world=t,this.target=n,this.parent=n,this.initialPosition=a.Copy(),this.clip=s,this.speedValue=e.util.Maths.randRange(30,50),this.angleStep=e.util.Maths.randRange(.12,.2),this.direction=o,this.clip.setPositionV(a),this.hasRemove=!1,this.offsetVec=new i},update:function(t){var i=Math.min(t.delta,1/30),s=this.targetPosition(),n=e.util.Box2dUtil.b2Vec2Subtract(s,this.clip.getPosition()),a=Math.atan2(n.y,n.x);a=e.util.Maths.simplifyAngleRadians(a,this.direction-Math.PI);var o=this.angleStep*i*30;this.direction=e.util.Maths.stepTo(this.direction,a,o),e.util.Box2dUtil.toVec(this.speedValue*i,this.direction,this.offsetVec),this.clip.setPositionV(e.util.Box2dUtil.b2Vec2Add(this.clip.getPosition(),this.offsetVec))},targetPosition:function(){return this.target?this.target.bonusTargetPosition():this.initialPosition}}),r=o.extend({init:function(t,i,s,n,a){this._super(t,i,s,n,a),this.timeToEnd=e.util.Maths.randRange(1,2),this.collected=!1,this.baseScale=.7,this.opacity=1},update:function(t){if(this._super(t),this.collected){this.timeToEnd-=t.delta;var i=e.util.Box2dUtil.b2Vec2Subtract(this.clip.getPosition(),this.targetPosition()).Length();50>i?this.clip.opacity=.02*i:this.clip.opacity=1,this.timeToEnd<=0&&i<=r.MIN_LENGTH?(this.remove(),this.clip.opacity>0&&this.target.applyBonus()):this.timeToEnd<=0&&(this.angleStep+=.005,this.speedValue+=1)}},collect:function(){this.collected=!0,this.speedValue=e.util.Maths.randRange(150,250),this.angleStep=e.util.Maths.randRange(.05,.1),this.target=this.world.getBonusTarget(),this.baseScale=1.2},remove:function(){this.hasRemove=!0,this.clip.visible=!1}});r.MIN_LENGTH=10;var h=e.elem.EntityBase.extend({init:function(t,i,s,n){this._super(s,i,n,t),this.parts=[],this.collected=!1,this.body.SetUserData(this),this.target=null;for(var a=null,o=0;o<h.ENERGY_PARTS_COUNT;o++)a=new r(this.world,this.world.energy.addParticle(),this,e.util.DrawUtil.ConvertToDrawPoint(this.body.GetPosition()),2*Math.PI/h.ENERGY_PARTS_COUNT*o),this.parts.push(a);this.collectEvent=new e.util.EventSender},update:function(t){for(var e=[],i=null,s=0;s<this.parts.length;s++)i=this.parts[s],i.update(t),i.hasRemove&&e.push(s);for(var s=e.length-1;s>=0;s--)this.parts.splice(e[s],1);this._super(t)},onCollisionStart:function(t,i){var s=t.GetUserData();if(!this.collected&&s&&s.isHero()){this.collected=!0,this.world.game.score.stars++,e.util.soundController.playSoundEffect(e.util.GameSounds.random(e.util.GameSounds.bonus),50),this.collectEvent.sendEvent();for(var n=0;n<this.parts.length;n++)this.parts[n].collect()}}});h.ENERGY_PARTS_COUNT=5,h.CollectedEvent="EnergyCollectedEvent",e.elem.EndLevelBodyClip=n,e.elem.PortalBodyClip=s,e.elem.Portal=a,e.elem.EnergyBodyClip=h,e.elem.EnergyPart=r}(Box2D,cj),function(t,e){var i=0,s=[e.util.GameSounds.effects.teleport,e.util.GameSounds.effects.teleport2],n=t.Common.Math.b2Vec2,a=e.elem.PortalBodyClip.extend({init:function(t,i,s,r){var h,l=(t.color||"0").toString();h=s.isBlackSide()||"0"!==l?e.util.GameImages.McTeleportPartBlue:e.util.GameImages.McTeleportPart,this._super(t,i,s,r,h),this.body&&this.body.SetUserData(this),this.portal.itemsScale=a.MAX_SCALE,this.portal.targetScale=a.MAX_SCALE,this.portal.scaleStep=.2,this.visible=!0,this.limitSpeed=t.limitSpeed,this.blackPortal=new o(s,this.body,e.util.GameImages.McTeleportPartBlack,r,this),this.blackPortal.visible=!0,this.speedValue=e.util.Maths.randRange(20,35),this.teleportables=[],this.useEvent=new e.util.EventSender,this.sibling=this.world.getTeleport(l),this.sibling?this.sibling.sibling=this:this.world.registerTeleportColor(this,l),this.newSpeed=new n},update:function(t){this._super(t),this.blackPortal.update(t)},draw:function(t){var e=t.foreground;this.portal.draw(e),this.blackPortal.draw(e)},onCollisionStart:function(t,n){if(!n.GetFixtureA().IsSensor()||!n.GetFixtureB().IsSensor()){var o=t.GetUserData();if(this.teleportableExists(o)<0&&o.canTeleport()){this.teleportables.push(o),e.util.soundController.playSoundEffect(s[i],50),i=(i+1)%s.length,o.snotEnabled=!1,o.teleport(this);var r=t.GetLinearVelocity().Length(),h=r>6.67?6.67*a.TELEPORT_TIME/r:a.TELEPORT_TIME;h=Math.max(h,.01),o.setScaleTime(0,h);var l=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){l.move(o)},h)}}},onCollisionEnd:function(t,e){var i=t.GetUserData(),s=this.teleportableExists(i);s>=0&&this.teleportables.splice(s,1)},teleportableExists:function(t){for(var e=0;e<this.teleportables.length;e++)
if(t===this.teleportables[e])return e;return-1},teleportFromSibling:function(t){this.teleportables.push(t)},move:function(t){this.sibling.teleportFromSibling(t),t.body.SetPosition(this.sibling.body.GetPosition()),t.snotEnabled=!0,this.limitSpeed&&(e.util.Box2dUtil.clampLength(t.body.GetLinearVelocity(),a.MAX_TELEPORT_SPEED,this.newSpeed),t.body.SetLinearVelocity(this.newSpeed)),this.use(),this.sibling.use(),t.afterTeleport();var i=Math.min(a.TELEPORT_TIME,a.TELEPORT_TIME/t.body.GetLinearVelocity().Length()*10);t.setScaleTime(1,i)},use:function(){var t=this;t.portal.targetScale=a.MIN_SCALE,e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.portal.targetScale=a.MAX_SCALE},a.TELEPORT_TIME),t.useEvent.sendEvent()}});a.TELEPORT_TIME=.1,a.MAX_TELEPORT_SPEED=23.33,a.MAX_SCALE=1.2,a.MIN_SCALE=.2;var o=e.elem.ParticleSystem.extend({init:function(t,e,i,s,n){this._super(t,e,i,s),this.portal=n,this.partsCount=5;for(var a=0;a<this.partsCount;a++)this.addParticle()},update:function(t){this._super(t);for(var e=0;e<this.partsCount;e++){var i=this.portal.portal.particles[e],s=this.particles[e];s.transform.position=i.transform.position,s.transform.scale=i.transform.scale}},draw:function(t){if(this.world.useParticles)
for(var e=null,i=0;i<this.particles.length;i++)e=this.particles[i],this.particleImage.alpha=e.opacity*this.baseOpacity,this.particleImage.frame=e.frame,this.particleImage.draw(t,e.transform)}});e.elem.TeleportBodyClip=a}(Box2D,cj),function(t,e){function i(t,e){this.value=t,this.range=e}
var s=t.Common.Math.b2Vec2;i.prototype.getValueInRange=function(){return this.value+e.util.Maths.lerp(-1,1,Math.random())*this.range};var n=e.elem.ParticleSystem.extend({init:function(t,e,n,a){this._super(t,e,n,null,a),this.speed=new i(0,0),this.angle=new i(0,0),this.horizontalPosition=new i(0,0),this.verticalPosition=new i(0,0),this.angularSpeed=new i(0,0),this.particleScale=new i(1,0),this.startOpacity=new i(1,0),this.gravity=new s,this.bottomLeftBound=new s(-(1/0),1/0),this.topRightBound=new s(1/0,-(1/0))},initParticle:function(t){var e=this.speed.getValueInRange(),i=this.angle.getValueInRange();t.speedX=-Math.cos(i)*e,t.speedY=Math.sin(i)*e,t.opacity=this.startOpacity.getValueInRange(),t.angularSpeed=this.angularSpeed.getValueInRange();var s=this.particleScale.getValueInRange();t.setScale(s,s),t.setPosition(this.horizontalPosition.getValueInRange(),this.verticalPosition.getValueInRange())},createOnStartPosition:function(t){for(;this.particles.length<t;){var e=new s(this.horizontalPosition.getValueInRange(),this.verticalPosition.getValueInRange());this.addParticleWithPosition(e)}},createBetweenBounds:function(t){for(;this.particles.length<t;){var i=new s(e.util.Maths.randRange(this.bottomLeftBound.x,this.topRightBound.x),e.util.Maths.randRange(this.bottomLeftBound.y,this.topRightBound.y));this.addParticleWithPosition(i)}},createParticle:function(){var t=new e.elem.Particle(this);return this.initParticle(t),t},updateParticleTime:function(t,e){t.addToPosition(t.speedX*e.delta,t.speedY*e.delta),t.addToRotation(t.angularSpeed);var i=t.getPositionX(),s=t.getPositionY();(i>this.topRightBound.x||s<this.topRightBound.y||i<this.bottomLeftBound.x||s>this.bottomLeftBound.y)&&this.initParticle(t)},onShowParticle:function(t){this.initParticle(t)}}),a=n.extend({init:function(t,n,a){this._super(t,n,a||e.util.GameImages.McFallParticle),this.setZOrder(e.util.EntityZOrder.PARTICLES),this.horizontalPosition=new i(t.width/2,t.width/2),this.verticalPosition=new i(0,0),this.speed=new i(-1,0),this.angle=new i(e.util.Maths.toRadians(-70),e.util.Maths.toRadians(15)),this.angularSpeed=new i(0,.1),this.particleScale=new i(1,.6),this.bottomLeftBound=new s(0,t.height+20),this.topRightBound=new s(t.width+20,0),this.speedMult=20},initParticle:function(t){this._super(t);var e=this.speedMult*t.getScaleX();t.speedX*=e,t.speedY*=e}}),o=a.extend({init:function(t,e){this._super(t,e),this.particleScale=new i(.5,.2),this.startOpacity=new i(.5,.2)}}),r=a.extend({init:function(t,s){this._super(t,s,e.util.GameImages.McSnowParticle),this.setZOrder(e.util.EntityZOrder.SNOW),this.angularSpeed=new i(0,0),this.particleScale=new i(1.75,.75),this.speedMult=13}}),h=r.extend({init:function(t,e){this._super(t,e),this.particleScale=new i(1,.4),this.startOpacity=new i(255/256,0)}}),l=n.extend({init:function(t,s){this._super(t,s,e.util.GameImages.McGroundPart),this.setZOrder(e.util.EntityZOrder.GROUND_FALL),this.angle=new i(e.util.Maths.toRadians(270),0),this.speed=new i(-40,-20),this.angularSpeed=new i(0,0),this.particleScale=new i(1,.3),this.startOpacity=new i(.784,.196)},updateParticleTime:function(t,e){this._super(t,e);var i=-e.delta/2;t.addToScale(i,i),t.getScaleX()<=0&&(t.visible=!1)}}),d=e.elem.ParticleSystem.extend({init:function(t,i){this._super(t,i,e.util.GameImages.McDust),this.setZOrder(e.util.EntityZOrder.DUST),this.alphaDiff=e.util.Maths.randRange(.0015,.0025)},updateParticleTime:function(t,e){this._super(e);var i=3*e.delta*Math.min(t.opacity,.3);t.addToPosition(t.speedX*i,t.speedY*i),t.opacity-=this.alphaDiff,t.opacity<=0&&(t.visible=!1)},draw:function(t){for(var e=null,i=0;i<this.particles.length;i++)e=this.particles[i],this.particleImage.alpha=e.opacity*this.alpha,this.particleImage.frame=e.frame,this.particleImage.draw(t.foreground,e.transform)},addItem:function(t,i,s,n){var a=this.addOrGetInvisible();a.visible=!0,i.Multiply(30),i.y+=25,a.setPositionV(i);var o=e.util.Maths.randRange(.5,1.5);a.setScale(o,o),a.opacity=e.util.Maths.randRange(.1*n,.2*n),a.speedX=t.x*this._SCALE*e.util.Maths.randRange(.2,.4),a.speedY=-Math.min(e.util.Maths.randRange(5,20)*s,40)}}),c=n.extend({init:function(t,s){this._super(t,s,e.util.GameImages.McWhiteSmoke),this.speed=new i(-250,80),this.particleScale=new i(2,1),this.maxOpacity=1,this.opacityStep=0,this.scaleDownOnDestroy=!0,this.scaleStep=0},initParticle:function(t){this._super(t),t.opacity=.033,t.tag=this},updateParticleTime:function(t,i){if(t.visible){this._super(t,i);var s=this.opacityStep*i.delta;t.tag?(t.opacity=e.util.Maths.stepTo(t.opacity,this.maxOpacity,.25*this.maxOpacity),t.opacity>=this.maxOpacity&&(t.tag=null)):t.opacity-=s,s=t.getScaleX()+this.scaleStep*i.delta,t.setScale(s,s),(t.opacity<=0||this.scaleStep<0&&(t.getScaleX()<2||t.opacity>.588))&&(t.visible=!1,this.initParticle(t))}},draw:function(t){for(var e=null,i=0;i<this.particles.length;i++)e=this.particles[i],this.particleImage.alpha=e.opacity*this.alpha,this.particleImage.frame=e.frame,this.particleImage.draw(t,e.transform)}}),u=n.extend({init:function(t,n){this._super(t,n,e.util.GameImages.McGroundPart),this.setZOrder(e.util.EntityZOrder.BLUE_PARTICLES),this.horizontalPosition=new i(t.width/2,t.width/2),this.verticalPosition=new i(t.height,0),this.speed=new i(-.5,0),this.angle=new i(e.util.Maths.toRadians(90),e.util.Maths.toRadians(15)),this.angularSpeed=new i(0,0),this.particleScale=new i(1.3,1),this.bottomLeftBound=new s(0,t.height),this.topRightBound=new s(t.width,0)},initParticle:function(t){this._super(t),t.opacity=.157+.078*t.getScaleX();var e=20*t.getScaleX();t.speedX*=e,t.speedY*=e}});e.elem.Range=i,e.elem.GravityParticleSystem=n,e.elem.BlackFall=a,e.elem.ValentineFall=o,e.elem.SnowFall=r,e.elem.WhiteSnow=h,e.elem.GroundFall=l,e.elem.WhiteSmoke=c,e.elem.BlueLights=u,e.elem.Dust=d}(Box2D,cj),function(t,e){function i(t,e,i){this.FAWN_MIN_STEP=.2,this.FAWN_STEP=.3,this.angle=0,this.angleStep=e,this.angleOffset=i,this.amplitude=4,this.position=new s(t,0),this.rotatedPosition=new s,this.length=t,this._fawnProgress=0}
var s=t.Common.Math.b2Vec2,n=t.Dynamics.b2Body,a=e.elem.PositionProvider.extend({init:function(t,i,o,r){this._super(o,i,r,t),this.setZOrder(e.util.EntityZOrder.HERO),this.world.hero=this,this.body.SetUserData(this),this.body.SetSleepingAllowed(!1),e.util.Box2dUtil.setGroup(this.body,a.HEROES_GROUP),this.body.SetType(n.b2_staticBody),e.util.Box2dUtil.setDensity(this.body,a.DENSITY),this.canDie=!0,this.isConsumedByFlower=!1,this.levelCompleted=!1,this.removed=!1,this.finishPosition=null,this.finishSet=!1,this.finishSpeed=0,this.restarting=!1,this.RADIUS=25/30,this.previousSpeed=new s,this.breatheScaleStep=0,this.targetScale=new s,this.timeToSleep=a.SLEEP_TIMEOUT,this.lastHitTime=0,this.sleep=!1,this.sleepSoundTime=0,this.hasToYawn=!1,this.snotJoinedCount=0,this.snotEnabled=!0,this.speedLocked=!1,this.tails=[];var u;if(this.world.isBlackSide())u=new e.elem.BlackTail(this.world,this.body,new e.util.Color(29,166,224,1));else{var m=this.world.isWhiteSide()?a.WHITE_TAIL_COLOR:"black";u=new c(m),u.attachedPoint=this.transform.position}
u.setZOrder(e.util.EntityZOrder.TAIL),this.tails.push(u),this.world.entities.add(u),this.bodySprite=new e.util.Bitmap(e.util.GameImages.McHeroBackView),this.shadow=new l(this),this.hotspot=new h(this),this.eye=new e.elem.HeroEye(o,this.body),this.portal=new d(this.world,this.body,e.util.GameImages.McFinishPart,this.transform),this.portal.itemsScale=0,this.portal.targetScale=0,this.portal.scaleStep=.1,this.portal.setZOrder(8),this.world.entities.add(this.portal),this.world.addPositionProvider(new e.elem.PositionProviderValue(this,5)),this.teleportEvent=new e.util.EventSender,this.destroyEvent=this.teleportEvent,this.setVisible(!1),this.newMaxVel=new s,this.steppedPosition=new s},update:function(t){this._super(t),this.finishSet&&(e.util.Box2dUtil.stepToVec(this.body.GetPosition(),this.finishPosition,this.finishSpeed,this.steppedPosition),this.body.SetPosition(this.steppedPosition),this._super(t),e.util.Box2dUtil.b2Vec2FuzzyEqual(this.finishPosition,this.body.GetPosition())&&(this.finishSet=!1,this.finishReached())),this.hotspot.update(t),this.onGround=this.isOnGround(),this.onGround&&(this.lastOnGroundTime=t.now),this.body.SetAngularDamping(t.now-this.lastOnGroundTime>.3?.5:0),this.tryConfuse(t),this.updateShadow(t);var i=this.snotJoinedCount>0?a.MAX_LINKED_SPEED:a.MAX_SPEED,s=this.body.GetLinearVelocity(),o=Math.atan2(s.y,s.x),r=this.speedLocked?0:s.Length();if(r>i&&(r=i,e.util.Box2dUtil.toVec(i,o,this.newMaxVel),this.body.SetLinearVelocity(this.newMaxVel)),this.eye.setVelocity(this.body.GetLinearVelocity()),this.eye.update(t),this.world.isBlackSide())
for(var h,l=this.tails.length-1;l>0;l--)h=this.tails[l],h.length()<=1&&this.world.entities.remove(this.tails.pop());else{var d=this.tails[0];d.attachedPoint=this.transform.position,d.limitAngles=this.onGround,d.setMovementDirection(o),d.speed=r,d.updateSpeed=this.sleep?.2:1}
this.previousSpeed.x=s.x,this.previousSpeed.y=s.y,this.tryWakeUp(r),this.body.GetType()===n.b2_dynamicBody&&Math.abs(this.getScaleY()-1)<a.MAX_BREATHE_SCALE&&!this.body.GetJointList()&&(this.tryBreathe(t,r),this.trySleep(),this.checkIfOutOfSideBorders())},updateRotation:function(){this.transform.rotation=this.body.GetAngle()},updateShadow:function(t){this.shadow.update(t)},draw:function(t){this.shadow.draw(t),this.bodySprite.draw(t.foreground,this.transform),this.hotspot.draw(t),this.eye.draw(t)},isCharacter:function(){return!0},isHero:function(){return!0},canLaunch:function(){return!0},canTeleport:function(){return!0},teleport:function(t){this.teleportTail(t.body.GetPosition()),this.teleportEvent.sendEvent()},teleportTail:function(t){if(this.world.isBlackSide()){var i=this.tails[0];i.body=null,i.setCull(!0),e.util.Box2dUtil.b2Vec2Copy(t,i.target),i.setZOrder(-1),this.world.entities.forceSort=!0}},afterTeleport:function(){this.world.isBlackSide()&&!this.restarting&&(this.tails.unshift(new e.elem.BlackTail(this.world,this.body,new e.util.Color(29,166,224,1))),this.tails[0].setZOrder(9),this.world.entities.add(this.tails[0]))},providePosition:function(){return this.transform.position},eat:function(t,e,i,s,n){this.body.SetActive(!1),this.setScaleTime(s,n),this.finishLevel(t,e,!1)},explode:function(){e.util.soundController.playSoundEffect(e.util.GameSounds.effects.deathBySpikes5,70),this.finishLevel(this.body.GetPosition(),1,!1),new e.elem.HeroExplosion(this.world,this.body,this)},doExplode:function(){var t=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.world.game.restartLevel()},1)},tryBreathe:function(t,i){if(i<a.BREATHE_VELOCITY){this.breatheScaleStep+=a.BREATHE_SCALE_SPEED,this.breatheScaleStep=e.util.Maths.simplifyAngleRadians(this.breatheScaleStep,0);var s=Math.cos(this.breatheScaleStep),n=s*a.MAX_BREATHE_SCALE;if(this.timeToSleep-=t.delta,this.targetScale.x=1+n,this.targetScale.y=1+.5*n,this.sleep&&this.eye.eyeClosed){var o=Math.floor(this.eye.eyeAnimations.totalFrames()*(1+s)*.5);this.eye.eyeAnimations.setCurrentFrame(Math.floor(e.util.Maths.stepTo(this.eye.eyeAnimations.currentFrame(),o,1))),this.sleepSoundTime+=t.delta,12==o&&this.breatheScaleStep>Math.PI&&this.sleepSoundTime>=1.5?(this.sleepSoundTime=0,this.hasToYawn=Math.random()>.6,this.hasToYawn&&e.util.soundController.playSoundEffect(e.util.GameSounds.effects.breathIn4,27)):23==o&&this.breatheScaleStep<Math.PI&&this.hasToYawn&&(this.hasToYawn=!1,e.util.soundController.playSoundEffect(e.util.GameSounds.random(e.util.GameSounds.sleeping),50))}}else this.targetScale.x=this.targetScale.y=1,this.timeToSleep=a.SLEEP_TIMEOUT;var r=e.util.Maths.stepTo(this.getScaleX(),this.targetScale.x,.002),h=e.util.Maths.stepTo(this.getScaleY(),this.targetScale.y,.002);this.setScale(r,h),this.eye.setScale(r,h),this.hotspot.setScale(r,h)},trySleep:function(){!this.sleep&&this.timeToSleep<0&&(this.eye.closeEye(),this.sleep=!0)},tryWakeUp:function(t){this.sleep&&t>a.BREATHE_VELOCITY&&(this.eye.openEye(),this.sleep=!1)},tryConfuse:function(t){var i=this.body.GetLinearVelocity(),s=e.util.Box2dUtil.b2Vec2Distance(i,this.previousSpeed),n=Math.min(s/a.HIT_SPEED/3,1)/8*100,o=t.now-this.lastOnGroundTime<100;if(!this.finishSet&&s>=.25*a.HIT_SPEED&&!this.speedLocked){var r=!1;t.now-this.lastHitTime>a.HIT_SOUND_PAUSE&&o&&Math.abs(i.y)<Math.abs(this.previousSpeed.y)&&(r=!0,e.util.soundController.playSoundEffect(e.util.GameSounds.effects.landing1,n),this.lastHitTime=t.now),Math.abs(i.x-this.previousSpeed.x)>=a.HIT_SPEED&&i.x<=1&&(!r&&o&&t.now-this.lastHitTime>a.HIT_SOUND_PAUSE&&(e.util.soundController.playSoundEffect(e.util.GameSounds.effects.landing1,n),this.lastHitTime=t.now),this.eye.eyeHit())}},respawn:function(){var t=this,i=t.transform.initial.scale;e.util.soundController.playSoundEffect(e.util.GameSounds.effects.begin5,50),this.eye.scheduleRandomAnimation();var t=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.world.endLevelPortal.showPortal(),t.world.entities.remove(t.portal)},1.6,"portal appear"),t.portal.targetScale=1,e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.body.SetActive(!0),e.util.newStepAction(e.util.ScheduleContext.LEVEL,function(){t.body.SetType(n.b2_dynamicBody),e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.portal.targetScale=0},.2)},function(e,s){var n=s/e;t.setScale(i.x-n*i.x,i.y-n*i.y),t.visible||t.setVisible(!0)},.3)},.2)},deadEyeScale:function(){return 1},setScale:function(t,e){this.transform.setScale(t,e),this.eye.transform.setScale(t,e),this.hotspot.setScale(t,e);for(var i=0;i<this.tails.length;i++)this.tails[i].transform.setScale(t,e)},setVisible:function(t){this.visible=t;for(var e=0;e<this.tails.length;e++)this.tails[e].visible=t;this.eye.visible=t},isOnGround:function(){for(var t=this.body.GetContactList();t;){if(t.contact.IsTouching()&&t.other.GetType()!=n.b2_dynamicBody&&!e.util.Box2dUtil.isSensor(t.contact))return!0;t=t.next}
return!1},finishLevel:function(t,i,a,h){if(!this.removed){this.snotEnabled=!1,this.finishSet=!0,this.levelCompleted=a,this.finishSpeed=i,this.finishPosition=t.Copy(),this.body.SetType(n.b2_staticBody),this.body.SetLinearVelocity(new s(0,0)),e.util.Box2dUtil.setSensor(this.body,!0);var l=this;this.eye.eyeAnimations.stopCurrentAnimation(),this.eye.allowRandomAnimation=!1,this.world.amie&&(this.world.amie.levelCompleted=a),this.levelCompleted&&h&&this.eye.playAnimation(h,!0,function(){l.eye.visible=!1}),this.fadeOutTails(),this.levelCompleted&&!this.isEndHero&&this.world.zoomTo(this.getPosition(),r,o),e.util.soundController.playSoundEffect(e.util.GameSounds.effects.end,50)}},fadeOutTails:function(){if(this.world.isBlackSide())
for(var t=0;t<this.tails.length;t++)e.util.newFadeAction(e.util.ScheduleContext.LEVEL,this.tails[t],.3,0)},checkIfOutOfSideBorders:function(){var t=this,i=this.body.GetPosition();if(i.x>this.world.box2dWidth-this.RADIUS&&this.body.SetPosition(new s(this.world.box2dWidth-this.RADIUS,i.y)),i.x<this.RADIUS&&this.body.SetPosition(new s(this.RADIUS,i.y)),i.y<this.RADIUS&&this.body.SetPosition(new s(i.x,this.RADIUS)),30*i.y>this.world.height+50){if(this.snotJoinedCount>0)return;this.alreadyDead||(this.alreadyDead=!0,e.util.soundController.playSoundEffect(e.util.GameSounds.effects.deathByFall2,100),e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.world.game.restartLevel()},1.2))}},applyBonus:function(){this.eye.applyBonus()},bonusTargetPosition:function(){return this.getPosition()},setSpeedLocked:function(t){this.speedLocked=t},getRadius:function(){return this.RADIUS},setEyeTargetAngle:function(t){this.eye.viewAngle=t,this.eye.viewDistance=.7},finishReached:function(){this.levelCompleted&&this.world.completeLevel()}});a.HIT_SOUND_PAUSE=500,a.SLEEP_TIMEOUT=7,a.BREATHE_SCALE_SPEED=.02,a.MAX_BREATHE_SCALE=.04,a.BREATHE_VELOCITY=.3,a.HIT_SPEED=4,a.MAX_SPEED=2e3/30,a.MAX_LINKED_SPEED=1e3/30,a.DENSITY=.1,a.WHITE_TAIL_COLOR="#8c8c8c",a.HEROES_GROUP=-2;var o=.8,r=1.2,h=function(t){this.hero=t,this.rawPos=new s,this.transform=new e.util.Transform,this.sprite=new e.util.Bitmap(e.util.GameImages.McHotspotwhite),this.sprite.alpha=.5,this.update=function(t){var i=this.hero.transform.position;this.rawPos.Set(i.x/this.hero._SCALE,i.y/this.hero._SCALE);var s=e.util.Box2dUtil.atan2Target(this.rawPos,this.hero.world.game.lightPoint);this.transform.setPosition(i.x,i.y),this.transform.setRotation(s)},this.draw=function(t){this.sprite.draw(t.foreground,this.transform)},this.setScale=function(t,e){this.transform.setScale(t,e)}},l=function(t){this.hero=t,this.transform=new e.util.Transform,this.sprite=new e.util.Bitmap(e.util.GameImages.McHeroShadow),this.point=new s,this.update=function(t){e.util.Box2dUtil.b2Vec2Copy(this.hero.getPosition(),this.transform.position);for(var i,s,a,o=!1,r=this.hero.body.GetContactList(),h=0,l=0;r;)e.util.Box2dUtil.b2Vec2Copy(e.util.Box2dUtil.getWorldPoint(r.contact),this.point),i=r.other.GetUserData(),a=this.hero.body.GetPosition(),i&&r.contact.IsTouching()&&!r.contact.GetFixtureA().IsSensor()&&!r.contact.GetFixtureB().IsSensor()&&a.y-this.point.y<.7*-this.hero.RADIUS&&(r.other.GetType()===n.b2_staticBody||r.other.GetType()===n.b2_kinematicBody)&&(o=!0,s=this.point.x-a.x,h+=s,l++),r=r.next;o&&(s=h/l*30,this.point.x=s,this.point.y=this.hero.transform.position.y,e.util.Box2dUtil.stepToVec(this.transform.position,this.point,Math.min(1,Math.abs(s/10)),this.transform.position)),this.updateShadowOpacity(o,t)},this.updateShadowOpacity=function(t,i){var s=600*i.delta/255;this.sprite.alpha=e.util.Maths.stepTo(this.sprite.alpha,t?1:0,s)},this.draw=function(t){this.sprite.draw(t.foreground,this.transform)}},d=e.elem.Portal.extend({draw:function(t){this._super(t.foreground)}}),c=e.elem.EntityBase.extend({init:function(t){this._super(),this.color=t,this.visible=!0,this.limitAngles=!1,this.speed=0,this.borderWidth=2,this.currentAngle=0,this.heroRadiusInPixels=23,this.updateSpeed=1,this.middle=new i(c.MIDDLE1_DISTANCE,.02,0),this.middle2=new i(c.MIDDLE2_DISTANCE,.019,Math.PI/2),this.end=new i(c.END_DISTANCE,.018,Math.PI),this.points=[this.middle,this.middle2,this.end],this.bodyPoints=new e.util.DrawUtil.PointsPair(new s,new s),this.center=new s,this.middleControls=new e.util.DrawUtil.PointsPair(new s,new s),this.middlePoints=new e.util.DrawUtil.PointsPair(new s,new s),this.endControls=new e.util.DrawUtil.PointsPair(new s,new s)},update:function(t){var i=Math.min(t.delta,.033),s=this.currentAngle;this.limitAngles&&(s=e.util.Maths.simplifyAngleRadians(s,c.CENTER_ANGLE-Math.PI),s=e.util.Maths.clamp(s,c.CENTER_ANGLE-c.ANGLE_LIMIT,c.CENTER_ANGLE+c.ANGLE_LIMIT));for(var n,a,o,r=e.util.Maths.simplifyAngleRadians(s,this.middle.angle-Math.PI),h=30*i*this.updateSpeed,l=0;l<this.points.length;l++)o=this.points[l],n=Math.min(Math.abs(o.angle-r)/Math.PI*2,.5),a=o.angleStep*this.speed*n*h,o.angle=e.util.Maths.stepTo(o.angle,r,a),o.angle=e.util.Maths.clamp(o.angle,this.middle.angle-c.PI8,this.middle.angle+c.PI8),o.update(.5*this.speed*h,this.limitAngles,h)},draw:function(t){if(this.visible){var i=this.attachedPoint,s=this.middle.getPosition(),n=this.middle2.getPosition();e.util.DrawUtil.getPointsPair(this.bodyPoints,c.zeroVec,this.middle.getPosition(),c.zeroVec,2*this.heroRadiusInPixels),e.util.Box2dUtil.getCenter(s,n,this.center),e.util.DrawUtil.getPointsPair(this.middleControls,s,n,this.center,.5*this.heroRadiusInPixels),e.util.DrawUtil.getPointsPair(this.middlePoints,this.center,n,this.center,.5*this.heroRadiusInPixels),e.util.DrawUtil.getPointsPair(this.endControls,n,n,this.center,this.heroRadiusInPixels/3);var a=t.foreground;a.save(),a.fillStyle=this.color,a.beginPath();var o=this.end.getPosition(),r=i.x,h=i.y;a.translate(r,h),a.rotate(this.transform.rotation),a.scale(this.transform.scale.x,this.transform.scale.y),a.moveTo(this.bodyPoints.first.x,this.bodyPoints.first.y),a.quadraticCurveTo(this.middleControls.first.x,this.middleControls.first.y,this.middlePoints.first.x,this.middlePoints.first.y),a.quadraticCurveTo(this.endControls.first.x,this.endControls.first.y,o.x,o.y),a.quadraticCurveTo(this.endControls.second.x,this.endControls.second.y,this.middlePoints.second.x,this.middlePoints.second.y),a.quadraticCurveTo(this.middleControls.second.x,this.middleControls.second.y,this.bodyPoints.second.x,this.bodyPoints.second.y),a.closePath(),a.fill(),a.restore()}},setMovementDirection:function(t){this.currentAngle=t+Math.PI}});c.CENTER_ANGLE=1.5*Math.PI,c.ANGLE_LIMIT=3*Math.PI/8,c.MIDDLE1_DISTANCE=30,c.MIDDLE2_DISTANCE=50,c.END_DISTANCE=70,c.PI8=Math.PI/8,c.zeroVec=new s,i.prototype.update=function(t,i,s){var n=e.util.Maths.clamp(t,.5,1.1)*this.length;this.position.x=e.util.Maths.stepTo(this.position.x,n,s),this.position.y=this.amplitude*Math.cos(this._fawnProgress+this.angleOffset),i?this._fawnProgress+=Math.max(this.FAWN_STEP*t,this.FAWN_MIN_STEP*s):this._fawnProgress+=this.FAWN_STEP*s},i.prototype.getPosition=function(){return e.util.Box2dUtil.rotate(this.position,this.angle,this.rotatedPosition),this.rotatedPosition},e.elem.HeroBodyClip=a,e.elem.HeroTail=c,e.elem.HeroPortal=d}(Box2D,cj),function(t){var e=t.elem.EntityBase.extend({init:function(e,i,s){e.entities.add(this),this.signSwitch=1,this._super(e,i),this.hero=s,s.eye.positionProvider=s,s.eye.allowRandomAnimation=!1,this.maxShakeCount=40,this.shakeCount=0,this.steps=0,t.util.newDelayAction(t.util.ScheduleContext.WORLD,function(){s.body.SetActive(!1)},0,"Hero Explosion, pin the hero in place")},update:function(){if(this.shakeCount<this.maxShakeCount){var e;e=this.signSwitch>0?t.util.Maths.randRange(.02,.04)*this.signSwitch:t.util.Maths.randRange(.016,.02)*this.signSwitch,this.steps+=1,this.steps>2&&(this.steps=0,this.signSwitch*=-1),this.hero.setScale(this.hero.transform.scale.x+e,this.hero.transform.scale.y+e),this.shakeCount++}else this.hero.setVisible(!1),this.explosion=new t.elem.Explosion(this.world,this.hero.getPosition()),this.explosion.horizontalPosition=new t.elem.Range(this.hero.getPosition().x,5),this.explosion.verticalPosition=new t.elem.Range(this.hero.getPosition().y,5),this.explosion.createOnStartPosition(14),this.explosion.setZOrder(t.util.EntityZOrder.HERO),this.world.entities.remove(this),this.world.entities.add(this.explosion),this.hero.doExplode()}});t.elem.HeroExplosion=e}(cj),function(t,e){var i=t.Common.Math.b2Vec2,s=(t.Dynamics.b2Body,e.util.Box2dUtil),n=s.sizeMultiplier,a=24*n,o=0*n,r=6*n,h=(new i,Class.extend({init:function(t){this.visible=!0,this.tail=t,this.endSprite=new e.elem.Sprite(e.util.GameImages.McBaloonTailEnd),this.start=new i,this.middle=new i,this.end=new i,this.startPair=new e.util.DrawUtil.PointsPair(new i,new i),this.middlePair=new e.util.DrawUtil.PointsPair(new i,new i),this.endPair=new e.util.DrawUtil.PointsPair(new i,new i),this.alpha=1,this.rotation=0},update:function(t){this.updatePairs();var e=s.b2Vec2Subtract(this.tail.end.GetPosition(),this.tail.start.GetPosition());e.Multiply(1/n),this.endSprite.transform.setPositionVec(e);var i=-s.atan2VecDiff(this.tail.middle.GetPosition(),this.tail.end.GetPosition());this.endSprite.setRotation(-i)},updatePairs:function(){this.start.x=this.start.y=0,s.b2Vec2SubtractRef(this.tail.middle.GetPosition(),this.tail.start.GetPosition(),this.middle),s.b2Vec2SubtractRef(this.tail.end.GetPosition(),this.tail.start.GetPosition(),this.end),e.util.DrawUtil.getPointsPair(this.startPair,this.start,this.start,this.middle,a),this.startPair.first.Multiply(1/n),this.startPair.second.Multiply(1/n),e.util.DrawUtil.getPointsPair(this.middlePair,this.middle,this.start,this.end,o),this.middlePair.first.Multiply(1/n),this.middlePair.second.Multiply(1/n),e.util.DrawUtil.getPointsPair(this.endPair,this.end,this.middle,this.end,r),this.endPair.first.Multiply(1/n),this.endPair.second.Multiply(1/n)},draw:function(t){if(this.visible&&0!==this.alpha){var e=t.foreground;e.fillStyle=e.strokeStyle="black",e.lineWidth=2;var i=e.globalAlpha;1!==this.alpha&&(e.globalAlpha*=this.alpha),0!==this.rotation&&e.rotate(this.rotation);var s=this.startPair.first,n=this.middlePair.first,a=this.endPair.first,o=this.startPair.second,r=this.middlePair.second,h=this.endPair.second;e.beginPath(),e.moveTo(s.x,s.y),e.quadraticCurveTo(n.x,n.y,a.x,a.y),e.lineTo(h.x,h.y),e.quadraticCurveTo(r.x,r.y,o.x,o.y),e.lineTo(s.x,s.y),e.closePath(),e.stroke(),e.fill(),this.endSprite.draw(e),1!==this.alpha&&(e.globalAlpha=i),0!==this.rotation&&e.rotate(-this.rotation)}}}));e.elem.BaloonTailSprite=h}(Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=t.Dynamics.b2Body,n=e.util.Box2dUtil,a=n.sizeMultiplier,o=30*a,r=18*a,h=34*a,l=o+r,d=l/3*2,c=4*a,u=7*a,m=7*a,p=Math.PI/3,g=1.5*Math.PI,f=new i,y=Class.extend({init:function(t,s){this.world=t,this.baloon=s,this.end=null,this.start=null,this.middle=null,this.neededEndPosition=new i,this.neededMiddlePosition=new i,this.linked=!1,this.visible=!0,this.targetEndPosition=new i(0,l),this.targetMiddlePosition=new i,this.endFawn=new i,this.middleFawn=new i,this.targetAngle=0,this.lastOnGroundTime=0,this.limitAngles=!1,this.targetPosition=new i,this.middleJoint=null,this.endJoint=null,this.linkedJoint=null,this.springing=!1,this.springEndTime=0,this.tailSprite=new e.elem.BaloonTailSprite(this),this.endChanger=new e.elem.CosChanger(-u,u,u/5),this.middleChanger=new e.elem.CosChanger(-m,m,u/5),this.middleChanger.progress=this.endChanger.progress+Math.PI/2,this.amplitude=1,this.timeCoeff=0,this.touchTime=-1,this.targetJointLength=l,this.createTail()},draw:function(t){this.visible&&this.tailSprite.draw(t)},setLinked:function(i){if(this.linked!==i)
if(this.linked=i,this.linked){var a=t.Common.Math.b2Mat22.FromAngle(this.start.GetAngle());this.start.SetTransform(new t.Common.Math.b2Transform(this.baloon.body.GetPosition(),a)),this.linkedJoint=n.createRevoluteJoint(this.baloon.body,this.start,this.start.GetPosition(),!1,!1),this.start.SetType(s.b2_dynamicBody),this.end.SetType(s.b2_dynamicBody),this.targetJointLength=d}else{var o=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){o.destroyJointLater()},0),this.start.SetType(s.b2_kinematicBody),this.end.SetType(s.b2_kinematicBody),this.targetJointLength=l/3}},destroyJointLater:function(){this.linkedJoint&&(this.world.b2World.DestroyJoint(this.linkedJoint),this.linkedJoint=null)},setDragging:function(t){this.dragging!==t&&(this.dragging=t,this.springTail(),this.dragging&&e.util.soundController.playSoundEffect(e.util.GameSounds.effects.leapOn1,50))},setPositions:function(e){var i=t.Common.Math.b2Mat22.FromAngle(this.start.GetAngle());this.start.SetTransform(new t.Common.Math.b2Transform(e,i));var s=t.Common.Math.b2Mat22.FromAngle(this.middle.GetAngle());this.middle.SetTransform(new t.Common.Math.b2Transform(e,s));var n=t.Common.Math.b2Mat22.FromAngle(this.end.GetAngle());this.end.SetTransform(new t.Common.Math.b2Transform(e,n))},springTail:function(){this.middle&&(this.touchTime=this.world.totalTime,this.dragging||(this.springing=!0,this.amplitude=0),this.middle.SetType(s.b2_dynamicBody),this.dragging||this.end.SetType(s.b2_dynamicBody),this.middle.SetLinearVelocity(f),this.end.SetLinearVelocity(f))},update:function(e){var i=e.delta;if(this.onGround()&&(this.lastOnGroundTime=this.world.totalTime),this.updateTargetPosition(i),this.updateJoints(i),!this.linked){this.limitAngles=this.world.totalTime-this.lastOnGroundTime<.3,this.start.SetLinearVelocity(this.baloon.body.GetLinearVelocity());var s=this.baloon.body.GetAngle(),n=t.Common.Math.b2Mat22.FromAngle(s);this.start.SetTransform(new t.Common.Math.b2Transform(this.baloon.body.GetPosition(),n)),this.springing?this.updateSpringing(i):this.dragging?this.updateDragPosition(i):this.updateTailParts(i)}
this.tailSprite.rotation=-this.baloon.getRotation(),this.tailSprite.update(e)},updateJoints:function(t){this.middleJoint&&(this.middleJoint.SetLength(e.util.Maths.stepTo(this.middleJoint.GetLength(),this.targetJointLength*o/l,.05)),this.endJoint.SetLength(e.util.Maths.stepTo(this.endJoint.GetLength(),this.targetJointLength*r/l,.05)))},endSpringing:function(){this.springing=!1,this.end.SetType(s.b2_kinematicBody),n.b2Vec2Copy(n.b2Vec2Subtract(this.middle.GetPosition(),this.start.GetPosition()),this.targetMiddlePosition),n.b2Vec2Copy(n.b2Vec2Subtract(this.end.GetPosition(),this.start.GetPosition()),this.targetEndPosition),this.amplitude=0,this.springEndTime=this.world.totalTime},updateSpringing:function(t){var e=n.b2Vec2Subtract(this.start.GetPosition(),this.end.GetPosition());e.Length()>.2?(e.Multiply(1/t),n.stepToVec(this.end.GetLinearVelocity(),e,1.5,n.operationVector),this.end.SetLinearVelocity(n.operationVector)):this.endSpringing()},updateDragPosition:function(t){var e=n.b2Vec2Subtract(this.targetPosition,this.end.GetPosition()),i=2*Math.min(this.world.totalTime-this.touchTime,.25);e.Multiply(i/t),this.end.SetLinearVelocity(e)},updateTailParts:function(t){this.end.SetPositionAndAngle(n.b2Vec2Add(n.b2Vec2Add(this.start.GetPosition(),this.targetEndPosition),this.endFawn),0),this.middle.SetPositionAndAngle(n.b2Vec2Add(n.b2Vec2Add(this.start.GetPosition(),this.targetMiddlePosition),this.middleFawn),0)},updateTargetPosition:function(t){var i=this.start.GetLinearVelocity().Length();this.timeCoeff=e.util.Maths.stepTo(this.timeCoeff,Math.min(2.5*i,15),.1),this.middleChanger.update(t*(1+this.timeCoeff)),this.endChanger.update(t*(1+this.timeCoeff)),this.amplitude=e.util.Maths.stepTo(this.amplitude,1-this.timeCoeff/20,.01),this.middleChanger.amplitude=this.amplitude,this.endChanger.amplitude=this.amplitude,this.targetAngle=i>.2?n.atan2Vec(this.start.GetLinearVelocity())+Math.PI:g,this.targetAngle=e.util.Maths.simplifyAngleRadians(this.targetAngle,-g),this.limitAngles&&(this.targetAngle=e.util.Maths.clamp(this.targetAngle,g-p,g+p));var s=i/3,a=h+(l-h)*Math.min(s,1);n.toVec(a,this.targetAngle,this.neededEndPosition),n.b2Vec2Copy(this.targetEndPosition,this.neededMiddlePosition),this.neededMiddlePosition.Multiply(o/l);var r=Math.max(i*t*1.25,.01);n.stepToVec(this.targetEndPosition,this.neededEndPosition,r,this.targetEndPosition),n.stepToVec(this.targetMiddlePosition,this.neededMiddlePosition,r,this.targetMiddlePosition);var d=n.atan2Vec(this.targetEndPosition);this.middleFawn.x=0,this.middleFawn.y=this.middleChanger.value,n.rotate(this.middleFawn,d,this.middleFawn),this.endFawn.x=0,this.endFawn.y=this.endChanger.value,n.rotate(this.endFawn,d,this.endFawn)},onGround:function(){for(var t=this.baloon.body.GetContactList();t;){if(t.contact.IsTouching()&&t.other.GetType()!==s.b2_dynamicBody&&!t.contact.GetFixtureA().IsSensor()&&!t.contact.GetFixtureB().IsSensor()&&t.other.GetPosition().y<this.baloon.body.GetPosition().y)return!0;t=t.next}
return!1},createTail:function(){var t=new i;n.b2Vec2Copy(this.baloon.body.GetPosition(),t),this.start=this.createPart(t),t.y+=o/3,this.middle=this.createPart(t),t.y+=r/3,this.end=this.createPart(t),this.middleJoint=n.createDistanceJoint(this.start,this.middle,!1,4,1),this.endJoint=n.createDistanceJoint(this.middle,this.end,!1,4,1)},createPart:function(t){var e=n.createCircle(this.world.b2World,c,t,0,!0,.3,!1);return e.SetType(s.b2_kinematicBody),n.setSensor(e,!0),e}});e.elem.BaloonTail=y}(Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=(t.Dynamics.b2Body,e.util.Box2dUtil),n=(s.sizeMultiplier,new i,e.elem.PositionProvider.extend({init:function(t,e,i,s){this._super(i,e,s,t),this.grassStep=2*Math.PI/this.grassCount(),this.trampleAngle=4*this.grassStep,this.createSprites()},createSprites:function(){this.baseSprite=new e.elem.Sprite(e.util.GameImages.McRotatorBase),this.setBaseWidth(this.width()),this.grassSystem=this.createFur(),this.grass=[],this.createGrass()},createFur:function(){var t=new e.elem.FurCircle(this.world,null,this.grassTexture());return t.addParticles(this.grassCount()),t.setRadius(this.grassRadius()),t},setBaseWidth:function(t){var e=t/this.baseSprite.image.image.width;this.baseSprite.setScale(e,e)},update:function(t){this._super(t);var i=e.util.Maths.clamp(10*this.body.GetAngularVelocity(),-65,65);i=0;for(var s=0,n=this.grass.length;n>s;s++)this.grass[s].update(t,i)},updateContactAngles:function(){var t,i;for(t=0,i=this.grass.length;i>t;t++)this.grass[t].contactAngle=0;for(var n,a,o=this.body.GetContactList();o;)o.contact.IsTouching()&&o.other.GetUserData()&&!e.util.Box2dUtil.isSensor(o.contact)&&(n=e.util.Box2dUtil.getWorldPoint(o.contact),a=s.atan2Vec(this.body.GetLocalPoint(n)),a=e.util.Maths.simplifyAngleRadians(a,0),this.addContactAngle(a)),o=o.next},addContactAngle:function(t){var e,i,s;for(e=0;3>e;e++)i=Math.floor((t-e*this.grassStep)/this.grassStep),this.addContactAngleAtIndex(t,i),s=Math.floor((t+(e+1)*this.grassStep)/this.grassStep),this.addContactAngleAtIndex(t,s)},addContactAngleAtIndex:function(t,i){i=e.util.Maths.modP(i,this.grassCount());var s=this.grass[i];t=e.util.Maths.simplifyAngleRadians(t,s.initialAngle-Math.PI);var n=e.util.Maths.getSign(t-s.initialAngle),a=this.trampleAngle-Math.abs(t-s.initialAngle);s.contactAngle=1.3*a*n},createGrass:function(){var t,i,s,n;for(t=0,i=this.grassCount();i>t;t++)s=this.grassSystem.particles[t],n=new e.elem.RotatorGrass(s),n.setInitialAngle(this.grassSystem.getItemAngle(t)),this.grass.push(n)},draw:function(t){var i=t.foreground;i.save(),e.util.Maths.transformContext(i,this.transform),this.baseSprite.draw(i),this.grassSystem.draw(i),i.restore(),this._super(t)}}));e.elem.FurBodyClip=n}(Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=t.Dynamics.b2Body,n=e.util.Box2dUtil,a=n.sizeMultiplier,o=30*a,r=150*a,h=40*a,l=30*a,d=30*a,c=170*a,u=30*a,m=22,p=28,g=2,f=70*a,y=100*a,v=1,S=4.2,w=26,M=13,b=4,P=.659745,C=.7,T=.1,E=e.elem.HeroBodyClip.HEROES_GROUP,B=130*a,x=new i,I=1.5,k=1,A=40,L=.5,D=e.elem.FurBodyClip.extend({init:function(s,a,r,h){this._super(s,a,r,h),this.snotEnabled=!0,n.setGroup(this.body,E),n.setMass(a,P),this.tail=new e.elem.BaloonTail(r,this),this.body.SetSleepingAllowed(!1),this.linkDelay=0,this.world.amie=this,this.linkEvent=new e.util.EventSender;var l=new t.Collision.Shapes.b2CircleShape(o),d=this.body.CreateFixture2(l,0);d.SetSensor(!0),this.body.SetUserData(this),this.releaseTime=0,this.baloonFur=this.createFur(),this.baloonFur.rotation=e.util.Maths.toDegrees(this.baloonFur.angleStep)/2,this.baloonFur.setVisible(!1),this.world.addPositionProvider(new e.elem.PositionProviderValue(this,2)),this.destroyEvent=new e.util.EventSender,this.legs=new e.elem.Sprite(e.util.GameImages.McBaloonLegs),this.legs.setScale(1.05,1.05),this.linked=!1,this.linkJoint=null,this.upForce=0,this.baloonFixture=null,this.snotJoinedCount=0,this.linkTime=0,this.scaleCoeff=0,this.eye=new e.elem.HeroEye(r),this.startPosition=this.body.GetPosition().Copy(),this.targetPosition=new i,this.initialMousePosition=new i,this.initialDragOffset=new i,this.tempTouchPoint=new i,this.touch=null,this.portal=new e.elem.HeroPortal(this.world,this.body,e.util.GameImages.McFinishPart,this.transform),this.portal.setZOrder(8),this.world.entities.add(this.portal),this.exploding=!1,this.airTime=0,this.finishSpeed=0,this.moveToTarget=!1,this.levelCompleted=!1,this.restartEnabled=!0,this.respawnEnabled=!0,this.respawn(),this.heroTimer=0},draw:function(t){this._super(t);var i=t.foreground;i.save(),e.util.Maths.transformContext(i,this.transform),this.baloonFur.draw(i),this.legs.draw(i),this.tail.draw(t),0!==this.transform.rotation&&i.rotate(-this.transform.rotation),this.eye.draw(t),i.restore()},canTeleport:function(){return this.canDie()},canDie:function(){return this.snotEnabled},disableHeroFocus:function(){return!1},getRadius:function(){return this.RADIUS},setSpeedLocked:function(t){},canLaunch:function(){return!this.linked},eat:function(t,a,o,r,h){this.releaseHero(),this.destroyEvent.sendEvent(),n.b2Vec2Copy(t,this.targetPosition),this.finishSpeed=a,this.moveToTarget=!0,this.body.SetType(s.b2_staticBody),this.body.SetActive(!1),this.body.SetLinearVelocity(new i(0,0)),e.util.Box2dUtil.setSensor(this.body,!0),this.setScaleTime(r,h)},setVisible:function(t){this._super(t),this.eye.setVisible(t),this.legs.setVisible(t)},explode:function(){this.endTailDrag(),this.releaseHero(),this.exploding=!0,this.destroyEvent.sendEvent(),this.tail.visible=!1,new e.elem.HeroExplosion(this.world,this.body,this)},doExplode:function(){this.restart(1)},deadEyeScale:function(){return C},restart:function(t){if(!this.levelCompleted&&this.restartEnabled){this.restartEnabled=!1;var i=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){i.world.game.restartLevel()},t||0)}},respawn:function(){if(this.respawnEnabled){this.respawnEnabled=!0;var t=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.enableRespawn()},1),this.setZOrder(e.util.EntityZOrder.HERO-1),this.eye.scheduleRandomAnimation(),this.setVisible(!0),this.moveToTarget=!1,this.airTime=0,this.tail.visible=!0,this.exploding=!1,this.portal.itemsScale=0,this.portal.targetScale=0,this.portal.scaleStep=.1,this.setScale(0,0),this.body.SetPositionAndAngle(this.startPosition,0),this.body.SetLinearVelocity(x),this.body.SetType(s.b2_staticBody),this.tail.setPositions(this.body.GetPosition());var i=t.transform.initial.scale;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.portal.targetScale=1,e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.body.SetActive(!0),e.util.newStepAction(e.util.ScheduleContext.LEVEL,function(){t.body.SetType(s.b2_dynamicBody),e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.portal.targetScale=0},.2)},function(e,s){var n=s/e;t.setScale(i.x-n*i.x,i.y-n*i.y),t.visible||t.setVisible(!0)},.7)},.2)},.2)}},enableRespawn:function(){this.respawnEnabled=!0},teleport:function(t){this.releaseHero(),this.destroyEvent.sendEvent()},afterTeleport:function(){this.tail.setPositions(this.body.GetPosition()),this.tail.springTail()},GetPosition:function(){return this.linked?this._super():this.tail.end.GetPosition()},destroyBaloon:function(){this.baloonFixture&&!this.linked&&(this.body.DestroyFixture(this.baloonFixture),this.baloonFixture=null)},createBaloon:function(){if(this.linked){var e=new t.Collision.Shapes.b2CircleShape(l);this.baloonFixture=this.body.CreateFixture2(e,0),n.setGroup(this.body,E)}},touchPriority:function(){return this.linked?2:0},isClickable:function(t,e){return!(e&&t>0)||this.tail.dragging},isTouchSwipable:function(){return!this.linked},isCharacter:function(){return!0},releaseHero:function(){if(this.linked){e.util.soundController.playSoundEffect(e.util.GameSounds.random(e.util.GameSounds.leapOut),50),this.world.hero.teleportEvent.removeListener(this,this.onHeroTeleport),this.eye.setEyeMoveAllowed(!0),this.tail.setDragging(!1),this.tail.setLinked(!1);var t=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.destroyBaloonLater()},0),this.linked=!1,this.snotEnabled=!0,e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.refreshDamping()},.2),this.releaseTime=this.world.totalTime,this.linkDelay=L}},destroyBaloonLater:function(){this.linkJoint&&(this.destroyBaloon(),this.world.b2World.DestroyJoint(this.linkJoint),this.linkJoint=null)},refreshDamping:function(){this.linked||(this.body.SetLinearDamping(0),this.body.SetAngularDamping(T))},startTouch:function(t){return this._super(t),this.exploding?!1:this.linked&&this.touchWithinDistance(t,this.body.GetPosition(),u)?(this.tail.springTail(),this.releaseHero(),!1):this.linked||0!==this.linkDelay?!1:this.tryDrag(t)},moveTouch:function(t){this.tail.dragging&&n.b2Vec2Copy(t,this.touch)},touchWithinDistance:function(t,i,s){this.tempTouchPoint.x=t.x/30,this.tempTouchPoint.y=t.y/30;var n=e.util.Box2dUtil.b2Vec2Distance(this.tempTouchPoint,i);return s>n},tryDrag:function(t){return this.touchWithinDistance(t,this.tail.end.GetPosition(),h)?(this.touch||(this.touch=new i),n.b2Vec2Copy(t,this.touch),this.tail.setDragging(!0),!0):!1},endTouch:function(t){this._super(t),this.exploding||this.endTailDrag()},endTailDrag:function(){this.touch&&(this.tail.setDragging(!1),this.touch=null)},updateHeroSeparation:function(t){if(this.linked||this.exploding)this.heroTimer=0;else{var e,s,a=this.world.hero.body,o=n.b2Vec2Subtract(a.GetPosition(),this.body.GetPosition()),r=o.Length();k>r?(this.heroTimer+=t.delta,this.heroTimer>=I&&(e=(r-k)/k*A,s=new i(o.x*e,0),this.body.ApplyForce(s,this.body.GetWorldCenter()),s.Multiply(-1),a.ApplyForce(s,a.GetWorldCenter()),this.heroTimer=0)):this.heroTimer=0}},update:function(t){if(this.moveToTarget&&(n.stepToVec(this.body.GetPosition(),this.targetPosition,this.finishSpeed,n.operationVector),this.body.SetPosition(n.operationVector)),this.updateHeroSeparation(t),this._super(t),this.linked||(n.isTouching(this.body)?this.airTime=0:this.airTime+=t,this.body.SetAngularDamping(this.airTime>1?1:T),this.linkDelay>0&&(this.linkDelay=Math.max(0,this.linkDelay-t.delta))),this.tail.update(t),this.linked){var s=this.body.GetPosition(),a=this.world.hero.body.GetPosition();this.eye.viewAngle=n.atan2VecDiff(s,a),this.eye.setViewDistance(n.b2Vec2Distance(s,a)/B)}else this.eye.setVelocity(this.body.GetLinearVelocity());if(this.eye.update(t),this.touch&&n.b2Vec2Copy(this.getTargetPosition(),this.tail.targetPosition),!this.exploding&&this.linked){var o=p,r=o+(this.world.hero.snotJoinedCount+this.snotJoinedCount)*g,h=f,l=this.world.box2dWidth;this.body.GetPosition().x>l-y&&(h*=2);var d=this.body.GetLinearVelocity().Copy();d.y=Math.min(S,d.y),this.body.GetPosition().y<h&&(r-=(1-this.body.GetPosition().y/h)*m*2,this.body.GetLinearVelocity().y>v&&(d.y=e.util.Maths.stepTo(d.y,v,1))),this.body.SetLinearVelocity(d),this.upForce=e.util.Maths.stepTo(this.upForce,Math.max(r,m/3),2),this.body.ApplyForce(new i(0,-this.upForce*this.body.GetMass()),this.body.GetWorldCenter())}
this.exploding||this.updateGrassRadius(),this.updateFurOpacity(),30*this.body.GetPosition().y>this.world.height+50&&this.restart()},updateRotation:function(){this.transform.rotation=this.body.GetAngle()},updateGrassRadius:function(){var t=this.linked?w:M;this.grassSystem.setRadius(e.util.Maths.stepTo(this.grassSystem.radius,t,.5)),this.baloonFur.setRadius(this.grassSystem.radius),this.baloonFur.setVisible(this.baloonFur.radius>M),this.scaleCoeff=(this.baloonFur.radius-M)/(w-M);var i=C+.35*this.scaleCoeff;this.eye.setScale(i,i),this.setBaseWidth(2*this.grassSystem.radius+b)},updateFurOpacity:function(){var t=this.alpha,e=1.25*(1-t);this.baloonFur.setOpacity(this.scaleCoeff*(1-e)),this.grassSystem.setOpacity(1-e)},linkToHero:function(){e.util.soundController.playSoundEffect(e.util.GameSounds.random(e.util.GameSounds.leapOn),50),this.linked=!0,this.snotEnabled=!1,this.linkTime=this.world.totalTime,this.tail.setLinked(!0),this.eye.setEyeMoveAllowed(!1),this.eye.setViewDistance(.3);var t=this.world.hero;this.tail.end.SetPosition(t.body.GetPosition()),this.linkJoint=n.createRevoluteJoint(this.tail.end,t.body,t.body.GetPosition(),!1),this.endTouch(this.touch),this.body.SetLinearDamping(1),this.body.SetAngularDamping(1),this.upForce=0;var i=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){i.createBaloon()},.2),this.destroyEvent.sendEvent(),t.teleportEvent.addListener(this,this.onHeroTeleport),this.linkEvent.sendEvent()},onHeroTeleport:function(){this.releaseHero(),this.tail.springTail()},getTargetPosition:function(){this.tempTouchPoint.x=this.touch.x/30,this.tempTouchPoint.y=this.touch.y/30,n.limitDistance(this.tempTouchPoint,this.body.GetPosition(),r,this.tempTouchPoint);var t=this.world.hero.body.GetPosition();return n.b2Vec2Distance(this.tempTouchPoint,t)<d&&n.b2Vec2Distance(t,this.body.GetPosition())<c&&(n.b2Vec2Copy(t,this.tempTouchPoint),this.linkToHero()),this.tempTouchPoint},grassTexture:function(){return e.util.GameImages.McBaloonGrassAll},grassCount:function(){return 20},grassRadius:function(){return M},width:function(){return 2*M+b}});e.elem.BaloonBodyClip=D}(Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=e.elem.GravityParticleSystem.extend({init:function(t,s,n){this._super(t,null,n?n:e.util.GameImages.McWhiteSmoke),this.opacityStep=1.17,this.scaleStep=6,this.startOpacity=new e.elem.Range(.863,.137),this.speed=new e.elem.Range(140,20),this.particlesScale=new e.elem.Range(2,1),this.angle=new e.elem.Range(0,e.util.Maths.toRadians(3600)),this.transform.setPosition(s.x,s.y),this.angleVec=new i},initParticle:function(t){this._super(t);var i=Math.sqrt(t.speedX*t.speedX+t.speedY*t.speedY),s=Math.atan2(t.transform.position.y-this.transform.position.y,t.transform.position.x-this.transform.position.x);e.util.Box2dUtil.toVec(i,s,this.angleVec),t.speedX=this.angleVec.x,t.speedY=this.angleVec.y},updateParticleTime:function(t,e){t.visible&&(this._super(t,e),t.opacity-=this.opacityStep*e.delta,t.addToScale(this.scaleStep*e.delta,this.scaleStep*e.delta),(t.opacity<=0||t.getScaleX()<0)&&(t.visible=!1))},draw:function(t){for(var e=null,i=0;i<this.particles.length;i++)e=this.particles[i],this.particleImage.alpha=e.opacity*this.alpha,this.particleImage.frame=e.frame,this.particleImage.draw(t.foreground,e.transform)}});e.elem.Explosion=s}(Box2D,cj),function(t){function e(e){this.minAngle=t.util.Maths.randRange(-e,0),this.maxAngle=t.util.Maths.randRange(0,e),this.diff=this.maxAngle-this.minAngle,this.windOffset=t.util.Maths.randRange(-.7,.7)}
function i(t){this.step=t,this.currentWind=0,this.currentWindStep=0,this.windValue=this.getRandomValue(),this.windChange=this.getRandomValue()}
e.prototype.getAngle=function(t){return this.minAngle+this.diff*t},i.prototype.update=function(t){this.windChange+=Math.random()*i.ACC_MULTIPLIER,this.windValue=Math.cos(this.windChange),this.currentWindStep+=this.step},i.prototype.getWind=function(t){return(Math.sin(this.currentWindStep+t)+1)/2*this.windValue},i.prototype.getRandomValue=function(){return t.util.Maths.randRange(-1,1)},i.ACC_MULTIPLIER=.01,t.util.WindData=e,t.util.WindManager=i}(cj),function(t,e,i){function s(t,e){this.particle=t,this.offsetX=e}
function n(t){this.rotationChanger=new i.elem.CosChanger(-15,15,i.util.Maths.randRange(.005,.01)),this.rotationChanger.progress=i.util.Maths.randRange(0,2*Math.PI),this.initialAngle=0,this.initialDegrees=0,this.contactAngle=0,this.currentContactAngle=0,this.particle=t}
var a=t.Common.Math.b2Vec2,o=1,r=.06981317,h=2.5*.0174532925,l=.0174532925,d=-40/30,c=-2,u=5,m=2,p=5,g=.5,f=.65,y=8,v=40/30,S=e.extend({init:function(t,e){this.world=t,this.plasticine=e,this.touched=!1,this.touchDistance=0,this.touchOffset=0,this.touchStartOffset=0,this.notTouchedFrames=0,this.touchingObject=null,this.grass=null,this.windData=null,this.smallGrasses=[],this.flies=[],this.startAngle=-i.util.Maths.randRange(-Math.PI/12,Math.PI/12),this.smallGrassRotation=0,this.create()},create:function(){var t=Math.min(this.grassFrame(),this.world.grass.totalFrames()-1);this.grass=this.world.grass.addParticleWithFrame(t),this.grass.setPositionV(i.util.DrawUtil.ConvertToDrawPoint(this.plasticine.getFlowerSurfaceCenter()));var e=i.util.Maths.randRange(.7*f,f);this.grass.setScale(e,e),this.windData=new i.util.WindData(this.windAngle),this.createSmallGrass(),this.createFlies()},smallGrassScale:g,windAngle:Math.PI/6,trampleAngle:Math.PI/6,createSmallGrass:function(){for(var t=0,e=null,n=0,o=new a(0,0),r=null,h=0;m>h;h++)t=Math.min(this.smallGrassFrame(),this.world.grass.totalFrames()-1),e=this.world.grass.addParticleWithFrame(t),r=i.util.Maths.randRange(.6*this.smallGrassScale,this.smallGrassScale),e.setScale(r,r),n=this.getSmallGrassOffset(h),o.x=n,o.y=1,o.Add(this.grass.getPosition()),e.setPositionV(o),this.smallGrasses.push(new s(e,n))},createFlies:function(){for(var t=null,e=null,s=0;o>s;s++)t=new a(i.util.Maths.randRange(-this.plasticine.width,this.plasticine.width),i.util.Maths.randRange(d,c)),t.Add(this.plasticine.body.GetPosition()),t.Multiply(30),e=this.world.flies.addParticleWithPosition(t),this.flies.push(new w(this.world,this.plasticine,e,this))},update:function(t){this.touched||this.notTouchedFrames++,this.updateGrassRotation(t),this.updateGrassPosition(t);for(var e=0;e<this.flies.length;e++)this.flies[e].update(t)},updateGrassRotation:function(t){var e=this.world.windManager.getWind(this.windData.windOffset),s=this.windData.getAngle(e)+this.startAngle,n=s;if(this.notTouchedFrames>=u&&(this.touchDistance=0,this.touchingObject=null),null!=this.touchingObject){var a=this.touchOffset-this.touchStartOffset,o=2*v;if(a/this.touchStartOffset<=0&&Math.abs(a)<o){this.touchDistance=i.util.Maths.getSign(a)*Math.min(Math.abs(a/v),1);var r=-Math.min(a/(1.5*v),1)*this.trampleAngle;s-=1.5*r,n-=2*r}else this.touchingObject=null,this.touchDistance=0}
var h=s,l=30*t.delta,d=this.smallGrassStep(),c=this.grassStep();this.smallGrassRotation=i.util.Maths.stepTo(this.smallGrassRotation,n,d*l),this.grass.setRotation(i.util.Maths.stepTo(this.grass.getRotation(),h,c*l)),this.touched=!1},updateGrassPosition:function(t){this.grass.setPositionV(this.plasticine.item.getFlowerSurfaceCenter());var e,i;for(e=0,i=this.smallGrasses.length;i>e;e++)this.updateSmallGrassPosition(this.smallGrasses[e],e)},updateSmallGrassPosition:function(t,e){var i,s;i=this.plasticine.getLocalFlowerSurfaceCenter(),i.x+=t.offsetX,s=this.plasticine.body.GetWorldPointCachedVector(i),s.x*=30,s.y*=30,t.particle.setPositionV(s),t.particle.setRotation(this.smallGrassRotation)},onTouchWith:function(t,e){this.scareFlies(t),(!this.touchingObject||e!==this.touchingObject&&Math.abs(t)<Math.abs(this.touchOffset))&&(this.touchStartOffset=i.util.Maths.getSign(t)*v,this.touchingObject=e),this.touchingObject===e&&(this.touchOffset=t,this.notTouchedFrames=0),this.touched=!0},scareFlies:function(t){i.util.Maths.fuzzyEqual(t,0)&&(t=Math.random()>.5?1:-1);for(var e=0;e<this.flies.length;e++)this.flies[e].scare(-i.util.Maths.getSign(t))},grassFrame:function(){return Math.floor(Math.random()*y)},smallGrassFrame:function(){return Math.floor(Math.random()*p)+y},getSmallGrassOffset:function(t){return i.util.Maths.randRange(-this.plasticine.width,this.plasticine.width)},smallGrassStep:function(){return this.touched?r:l},grassStep:function(){return this.touched?h:l}}),w=e.extend({init:function(t,e,s,n){this.world=t,this.ground=e,this.particle=s;var o=i.util.Maths.randRange(.8,1.2);this.particle.setScale(o,o),this.initialPosition=this.particle.getPosition().Copy(),this.initialGroundY=n.grass.getPositionY(),this.scareOffsetX=i.util.Maths.randRange(-10,-30),this.scareOffsetY=i.util.Maths.randRange(-30,-50),this.scared=0,this.scareTime=0,this.alphaStep=i.util.Maths.randRange(-2*Math.PI,2*Math.PI),this.alphaStepDiff=i.util.Maths.randRange(.005,.05),this.stepX=0,this.stepY=i.util.Maths.randRange(.25,.75),this.windOffset=i.util.Maths.randRange(-.5,.5),this.horizontalOffset=i.util.Maths.randRange(10,20),this.verticalStep=i.util.Maths.randRange(-2*Math.PI,2*Math.PI),this.verticalStepDiff=i.util.Maths.randRange(.01,.02),this.verticalOffset=i.util.Maths.randRange(-5,20),this.verticalOffsetMultiplier=i.util.Maths.randRange(1,2),this.grass=n.grass,this.invertedScareOffsetY=1/this.scareOffsetY,this.targetPosition=new a,this.stepPosition=new a},update:function(t){var e=this.grass.getPositionY(),s=this.particle.getPosition();this.particle.opacity=(Math.cos(this.alphaStep)+1)/2,this.targetPosition.x=this.initialPosition.x+this.horizontalOffset*this.world.windManager.getWind(this.windOffset),this.targetPosition.y=this.initialPosition.y+this.verticalOffset*Math.sin(this.verticalStep)+(e-this.initialGroundY),0!=this.scared&&(this.targetPosition.x+=this.scared*this.scareOffsetX,this.targetPosition.y+=this.scareOffsetY,this.stepY=Math.abs(s.y-this.targetPosition.y)*this.invertedScareOffsetY,this.scareTime-=t.delta,this.scareTime<=0&&(this.scared=0)),this.stepX=Math.min(Math.abs((this.targetPosition.x-s.x)/(this.targetPosition.y-s.y)*this.stepY),1),i.util.Box2dUtil.stepToVec(s,this.targetPosition,this.stepX*this.stepX+this.stepY*this.stepY,this.stepPosition),this.particle.setPositionV(this.stepPosition),this.alphaStep+=this.alphaStepDiff,this.verticalStep+=this.verticalStepDiff},scare:function(t){0===this.scared&&(this.scared=t),this.scareTime=i.util.Maths.randRange(.5,2.5)}});n.prototype.update=function(t,e){this.rotationChanger.update(t.delta),Math.abs(this.currentContactAngle)>Math.abs(this.contactAngle)?this.currentContactAngle=i.util.Maths.stepTo(this.currentContactAngle,this.contactAngle,.05):this.currentContactAngle=this.contactAngle;var s=this.initialDegrees+e+this.rotationChanger.value+i.util.Maths.toDegrees(this.currentContactAngle),n=i.util.Maths.toRadians(s),a=Math.min(Math.abs(this.particle.transform.rotation-n)/i.util.Maths.toRadians(7),i.util.Maths.toRadians(3));this.particle.transform.rotation=i.util.Maths.stepTo(this.particle.transform.rotation,n,a)},n.prototype.setInitialAngle=function(t){this.initialAngle=t,this.initialDegrees=-i.util.Maths.toDegrees(t)+90,this.particle.transform.rotation=i.util.Maths.toRadians(this.initialDegrees)},i.elem.GrassController=S,i.elem.FlyController=w,i.elem.RotatorGrass=n}(Box2D,Class,cj),function(t,e,i){var s=(t.Common.Math.b2Vec2,4),n=4,a=3,o=i.elem.GrassController.extend({init:function(t,e){this._super(t,e)},smallGrassScale:.7,windAngle:Math.PI/8,trampleAngle:Math.PI/12,grassFrame:function(){return Math.floor(Math.random()*a)},smallGrassFrame:function(){return this.grassFrame()},getSmallGrassOffset:function(t){return 0===t?-this.plasticine.width/2:this.plasticine.width/2},smallGrassStep:function(){return this._super()/2},grassStep:function(){return this._super()/2},updateSmallGrassPosition:function(t,e){this._super(t,e);var i,a=this.plasticine.item,o=!a.previous.bodyClip.grassController&&0===e,r=!a.next.bodyClip.grassController&&1===e;(o||r)&&(i=t.particle.getPosition(),t.particle.setPosition(i.x+(s*o?1:-1),i.y+n),t.particle.setScale(.5,.5))}});i.elem.WhiteGrassController=o}(Box2D,Class,cj),function(t){function e(e,i,s){this.progress=Math.random()*Math.PI,this.value=0,s?(this.step=s,this.minValue=e,this.maxValue=i):(this.minValue=0,this.maxValue=1,this.step=t.util.Maths.randRange(e,i)),this.amplitude=1,this.update(0)}
var i=t.elem.EntityBase.extend({init:function(e,i,s,n){this._super(s,i,n,e),this.body&&this.body.SetUserData(this),this.bitmap=new t.util.Bitmap(this.getViewImage())},draw:function(t){this.world.isCulling||this.bitmap.draw(t.particle,this.transform)}}),s=i.extend({init:function(e,i,s,n){this._super(e,i,s,n),this.shadow=null;var a=this.getViewType();"McStoneView3"!==a&&"McStoneView1"!==a||(this.shadow=new t.util.Bitmap(t.util.GameImages.McStoneShadow))},update:function(t){this.shadow&&(this.shadow.alpha=1-this.world.lightPower)},draw:function(t){this.world.isCulling||(this.bitmap.draw(t.particle,this.transform),this.shadow&&this.shadow.draw(t.particle,this.transform))}}),n=i.extend({init:function(e,i,s,n){switch(this._super(e,i,s,n),this.setZOrder(t.util.EntityZOrder.BLACK_KAKTUS),this.getViewType()){case "McEggView0":this.bitmap=new t.util.Bitmap(t.util.GameImages.McEggView0);break;case "McEggView1":this.bitmap=new t.util.Bitmap(t.util.GameImages.McEggView1);break;case "McEggView2":this.bitmap=new t.util.Bitmap(t.util.GameImages.McEggView2);break;case "McEggView3":this.bitmap=new t.util.Bitmap(t.util.GameImages.McEggView3);break;case "McEggBridgeView":this.bitmap=new t.util.Bitmap(t.util.GameImages.McEggBridgeView);break;case "McKaktusView0":this.bitmap=new t.util.Bitmap(t.util.GameImages.McKaktusView0);break;case "McKaktusView1":this.bitmap=new t.util.Bitmap(t.util.GameImages.McKaktusView1);break;case "McKaktusView2":this.bitmap=new t.util.Bitmap(t.util.GameImages.McKaktusView2);break;case "McKaktusView3":this.bitmap=new t.util.Bitmap(t.util.GameImages.McKaktusView3);break;case "McKaktusView4":this.bitmap=new t.util.Bitmap(t.util.GameImages.McKaktusView4);break;default:t.PRODUCTION||"undefined"==typeof console||console.log("missing kaktus type:"+this.getViewType())}}}),a=i.extend({init:function(e,i,s,n){this._super(e,i,s,n),this.setZOrder(t.util.EntityZOrder.BLACK_KAKTUS),this.bitmap=new t.util.Bitmap(t.util.GameImages.McEggBridgeView)}}),o=i.extend({init:function(t,e,i,s){this._super(t,e,i,s)},draw:function(t){this.bitmap.draw(t.foreground,this.transform)}}),r=o.extend({init:function(t,i,s,n){this._super(t,i,s,n);var a=t.alphaStep,o=t.maximumAlpha;this.changer=new e(a,a),this.changer.maxValue=this.changer.minValue=o},update:function(t){this.changer.update(t.delta),this.bitmap.alpha=this.changer.value}});e.prototype.update=function(t){this.progress+=this.step*t*30,this.value=this.getValue(this.minValue,this.maxValue,this.progress)},e.prototype.getValue=function(e,i,s){return t.util.Maths.lerp(e,i,(1+Math.cos(s))/2*this.amplitude)},e.prototype.isMax=function(){return Math.abs(this.progress%(2*Math.PI))<this.step},t.elem.Static=i,t.elem.StoneBodyClip=s,t.elem.KaktusBodyClip=n,t.elem.KaktusForeground=a,t.elem.AlphaForeground=r,t.elem.CosChanger=e}(cj),function(t,e,i){var s=e.Common.Math.b2Vec2,n=i.elem.EntityBase.extend({init:function(t,e,s,n){this._super(s,e,n,t),this.bitmap=new i.util.Bitmap(this.getViewImage()),this.name=t.clipType,this.hasToRun=!0,this.hasToHide=!0,this.visible=!1,this.hiding=!1,this.labels=[],this.addText(t.textData);for(var a=0;t["textData"+a];)this.addText(t["textData"+a]),a++},update:function(t){if(this.world.touchEnabled&&this.hasToRun){this.hasToRun=!1;var e=this;i.util.newDelayAction(i.util.ScheduleContext.LEVEL,function(){e.fadeIn(.5)},2)}},draw:function(t){if(this.visible){var e=t.foreground;e.save(),i.util.Maths.transformContext(e,this.transform);for(var s=0;s<this.labels.length;s++)this.labels[s].draw(e);this.bitmap.drawNoTransform(e,0,0,0,1,1),e.restore()}},addText:function(t){var e=t.textSize,s=t.textPosition,n=t.fontSize,a=t.textAlign,o=n/2;i.util.localizedStringLoader.isEnglish()||(o=.76*o);var r=i.util.localizedStringLoader.getLocalizedString(t.text),h=new i.util.MultilineLabel(r,o,n/1.25);h.setAlignment(a),"right"===a?s.x+=e.x/2:"left"===a&&(s.x-=e.x/2),h.transform.setPosition(s.x,-s.y);var l=t.color;if(l){var d=new i.util.Color(0,0,0,1);d.r=l>>16&255,d.g=l>>8&255,d.b=255&l,h.color=d.toString()}
this.labels.push(h)},setAlpha:function(t){for(var e=0;e<this.labels.length;e++)this.labels[e].alpha=t;this.bitmap.alpha=t},fadeIn:function(t){if(!this.hiding){var e=this;e.visible=!0,e.setAlpha(0),i.util.newStepAction(i.util.ScheduleContext.LEVEL,function(){e.setAlpha(1),e.hasToHide&&i.util.newDelayAction(i.util.ScheduleContext.LEVEL,function(){e.fadeOut(.5)},5)},function(t,i){e.setAlpha(1-i/t)},t,this.name+" Hint Fade In")}},fadeOut:function(t){var e=this;this.hiding||(this.hiding=!0,i.util.newStepAction(i.util.ScheduleContext.LEVEL,function(){e.visible=!1,e.setAlpha(0)},function(t,i){e.setAlpha(i/t)},t,this.name+" Hint Fade Out"))}}),a=n.extend({init:function(t,e,i,s){this._super(t,e,i,s),this.snotGot=!1,this.hasToHide=!1,this.snots=[]},update:function(t){this._super(t),this.snotGot||(this.snotGot=!0,this.getSnot())},getSnot:function(){var t=this.transform.position.Copy();t.Multiply(1/30),this.snots=i.util.Box2dUtil.queryAABBFromRadiusByType(this.world.b2World,t,6.67,i.elem.SnotBodyClip);for(var e=0;e<this.snots.length;e++)this.snots[e].linkEvent.addListener(this,this.onSnotLink)},onSnotLink:function(){this.fadeOut(.5);for(var t=0;t<this.snots.length;t++)this.snots[t].linkEvent.removeListener(this,this.onSnotLink)}}),o=a.extend({init:function(t,e,i,s){this._super(t,e,i,s),this.hasToRun=!1,this.used=!1},onSnotLink:function(){if(!this.used){this.used=!0,this.fadeIn(.5);for(var t,e=0;e<this.snots.length;e++)t=this.snots[e],t.linkEvent.removeListener(this,this.onSnotLink),t.releaseEvent.addListener(this,this.onSnotRelease)}},onSnotRelease:function(){this.fadeOut(.5);for(var t=0;t<this.snots.length;t++)this.snots[t].releaseEvent.removeListener(this,this.onSnotRelease)}}),r=n.extend({init:function(t,e,i,s){this._super(t,e,i,s),this.hasToHide=!1,this.lightGot=!1,this.lights=[]},update:function(t){this._super(t),this.lightGot||(this.lightGot=!0,this.getLight())},getLight:function(){var t=this.transform.position.Copy();t.Multiply(1/30),this.lights=i.util.Box2dUtil.queryAABBFromRadiusByType(this.world.b2World,t,6.67,i.elem.EnergyBodyClip);for(var e=0;e<this.lights.length;e++)this.lights[e].collectEvent.addListener(this,this.onEnergyCollected)},onEnergyCollected:function(){this.fadeOut(.5);for(var t=0;t<this.lights.length;t++)this.lights[t].collectEvent.removeListener(this,this.onEnergyCollected)}}),h=n.extend({init:function(t,e,s,n){this._super(t,e,s,n),this.hasToHide=!1;var a=this.transform.position.Copy();a.Multiply(1/30),this.portal=i.util.Box2dUtil.queryAABBFromRadiusByType(this.world.b2World,a,6.67,i.elem.TeleportBodyClip),this.portal=this.portal[0],this.portal.useEvent.addListener(this,this.onPortalUse),this.hasToRun=!0},onPortalUse:function(){this.portal.useEvent.removeListener(this,this.onPortalUse),this.fadeOut(.5)}}),l=h.extend({init:function(t,e,i,s){this._super(t,e,i,s),this.hasToRun=!1,this.hasToHide=!0},onPortalUse:function(){this.portal.useEvent.removeListener(this,this.onPortalUse),this.fadeIn(.5)}}),d=n.extend({init:function(e,n,a,o){this._super(e,n,a,o),t.navigator.msMaxTouchPoints||Modernizr.touch||(this.bitmap=new i.util.Bitmap(i.util.GameImages.McGroundHintMouseView),this.labels[0].setText(i.util.localizedStringLoader.getLocalizedString("SLIDE_MOUSE"))),this.hasToHide=!1,this.initialPosition=new s,this.initialPositionSet=!1,this.maxDistance=60},update:function(t){this._super(t),!this.initialPositionSet&&this.world.hero?(this.initialPosition=this.world.hero.transform.position.Copy(),this.initialPositionSet=!0):!this.hiding&&Math.abs(this.world.hero.transform.position.x-this.initialPosition.x)>this.maxDistance&&this.fadeOut(.5)}}),c=n.extend({init:function(t,e,s,n){this._super(t,e,s,n),this.bitmap=new i.util.Bitmap(i.util.GameImages.McRelsHintView);var a=this.transform.position.Copy();a.Multiply(1/30),this.rels=i.util.Box2dUtil.queryAABBFromRadiusByType(this.world.b2World,a,6.67,i.elem.DragableBodyClip),this.rels=this.rels[0],this.rels.dragStartEvent.addListener(this,this.onDragStart)},onDragStart:function(){this.rels.dragStartEvent.removeListener(this,this.onDragStart),this.fadeOut(.5)}}),u=n.extend({init:function(t,e,i,s){this._super(t,e,i,s),this.hasToHide=!1,this.hasToRun=!1,this.trampoline=null,this.touched=!1},update:function(t){this._super(t),this.trampoline||this.getTrampoline()},getTrampoline:function(){var t=this.transform.position.Copy();t.Multiply(1/30),this.trampoline=i.util.Box2dUtil.queryAABBFromRadiusByType(this.world.b2World,t,6.67,i.elem.TrampolinePartBodyClip);for(var e=0;e<this.trampoline.length;e++)
if(this.trampoline[e].parent){this.trampoline=this.trampoline[e].parent,this.trampoline.dragEvent.addListener(this,this.onDragStart),this.trampoline.heroTouchEvent.addListener(this,this.onHeroTouch);break}},onDragStart:function(){this.touched&&(this.hiding||this.fadeOut(.5))},onHeroTouch:function(){this.trampoline.dragging||this.touched||(this.touched=!0,this.fadeIn(.5))}}),m=n.extend({init:function(t,e,s,n){this._super(t,e,s,n),this.hasToRun=!1,this.hasToHide=!1,this.joinCount=0;var a=this.transform.position.Copy();a.Multiply(1/30),this.snots=i.util.Box2dUtil.queryAABBFromRadiusByType(this.world.b2World,a,6.67,i.elem.SnotBodyClip);for(var o=0;o<this.snots.length;o++)this.snots[o].linkEvent.addListener(this,this.onSnotLink),this.snots[o].releaseEvent.addListener(this,this.onSnotRelease)},onSnotLink:function(){this.joinCount++,2===this.joinCount&&this.fadeIn(.5)},onSnotRelease:function(){this.joinCount--,this.visible&&!this.hiding&&(this.fadeOut(.5),this.hiding=!1)}}),p=n.extend({init:function(t,e,i,s){this._super(t,e,i,s),this.hasToHide=!1,this.amie=this.world.amie,this.amie&&this.amie.linkEvent.addListener(this,this.onLinked)},onLinked:function(){this.amie.linkEvent.removeListener(this,this.onLinked),this.fadeOut(.5)}});i.elem.FadeHint=n,i.elem.SnotLinkHint=a,i.elem.SnotReleaseHint=o,i.elem.LightsHint=r,i.elem.PortalHint=h,i.elem.Portal2Hint=l,i.elem.MoveCharHint=d,i.elem.RelsHint=c,i.elem.SlingshotHint=u,i.elem.MultitouchHint=m,i.elem.AmieHint=p}(window,Box2D,cj),function(t,e){var i=t.Common.Math.b2Vec2,s=t.Dynamics.b2Body,n=e.elem.EntityBase.extend({init:function(t,n,a,o){this._super(a,n,o,t),this.body.SetType(s.b2_kinematicBody),this.joined=!1,this.joinedBody=null,this.offset=new i,this.bitmap=new e.util.Bitmap(this.getViewImage())},update:function(t){this._super(t),this.joined||this.join(),this.joined&&this.body.SetPosition(e.util.Box2dUtil.b2Vec2Add(this.joinedBody.GetPosition(),this.offset))},draw:function(t){this.world.isCulling||this.bitmap.draw(t.particle,this.transform)},join:function(){this.body.SetType(s.b2_dynamicBody),this.joined=!0,this.joinedBody=this.world.ground;for(var i,a=this.body.GetFixtureList();a;a=a.GetNext())
if(a.GetType()===t.Collision.Shapes.b2Shape.e_circleShape){i=a.GetShape();break}for(var o,r=this.body.GetWorldPointCachedVector(i.GetLocalPosition()),h=e.util.Box2dUtil.queryAABBFromRadius(this.world.b2World,r,n.RADIUS,!0),l=0;l<h.length;l++)
if(o=h[l].GetBody(),o!==this.body){this.joinedBody=o;break}e.util.Box2dUtil.createRevoluteJoint(this.body,this.joinedBody,this.body.GetWorldCenter(),!1,!1),this.offset=t.Common.Math.b2Math.SubtractVV(this.body.GetPosition(),this.joinedBody.GetPosition()),this.body.SetSleepingAllowed(!1)}});n.RADIUS=2.5/30,e.elem.StickyBodyClip=n}(Box2D,cj),function(t,e,i,s){function n(t){this.showTime=1.5,this.fadeTime=.8,this.world=t,this.textPosition=new a(.5*t.width,.3*t.height),this.messages=[s.util.localizedStringLoader.getLocalizedString("MUSIC_BY"),s.util.localizedStringLoader.getLocalizedString("GRAPHICS_BY"),s.util.localizedStringLoader.getLocalizedString("DIRECTED_BY")],this.rightMessages=[s.util.localizedStringLoader.getLocalizedString("DAVID_LEON"),s.util.localizedStringLoader.getLocalizedString("MIHAI_MAKSYM"),s.util.localizedStringLoader.getLocalizedString("BY_MAKSYM_HRYNIV")],this.labels=[];var e=this;s.util.newDelayAction(s.util.ScheduleContext.LEVEL,function(){e.playItem()},3)}
var a=t.Common.Math.b2Vec2,o=t.Dynamics.b2Body,r=s.elem.StickyBodyClip.extend({init:function(t,e,i,n){this._super(t,e,i,n),this.roseParts=[],this.bonusHidden=!1,this.finished=!1,this.finalRose=new s.util.BitmapAnimation(s.util.GameImages.McFinalRose),this.finalRose.setPersistent(),this.finalRose.speed=0,this.world.bonusTarget=this,this.world.canShowIntro?this.playIntro():this.finished=!0},update:function(t){if(this._super(t),this.world.canShowIntro&&!this.bonusHidden&&(this.bonusHidden=!0,this.world.hideBonuses()),this.finished)this.finalRose.speed>-1&&(this.finalRose.speed-=t.delta/20*this.finalRose.currentFrame),this.finalRose.update(t);else{for(var e=0;e<this.roseParts.length;e++)this.roseParts[e].update(t);this.leafMain.update(t),this.puddle.update(t)}},draw:function(t){if(this.intro&&this.intro.draw(t),this.finished)this.world.isCulling||this.finalRose.draw(t.particle,this.transform);else{if(!this.world.isCulling){for(var e=0;e<this.roseParts.length;e++)this.roseParts[e].draw(t.particle,this.transform);this.headBack.draw(t.particle,this.transform),this.headLight.draw(t.particle,this.transform),this.headFront.draw(t.particle,this.transform)}
this.leafMain.draw(t.foreground,this.transform),this.puddle.draw(t.foreground,this.puddleTransform)}},playIntro:function(){var t=this;if(this.skipBtn=this.world.game.skipBtn,s.util.removeClass(this.skipBtn.getElement(),"noShow"),i.csstransitions)this.skipBtn.getElement().style.opacity=1;else{var e=new Tweenable;e.tween({from:{opacity:0},to:{opacity:1},duration:300,step:function(){t.skipBtn.getElement().style.opacity=this.opacity},easing:"easeOutSine"})}
this.skipBtn.addEventHandlers(),this.world.setTouchEnabled(!1),this.world.setIntroPlaying(!0),this.intro=new n(this.world),this.stalk=new s.util.BitmapAnimation(s.util.GameImages.McStebloAnimation),this.stalk.setPersistent(),this.headDown=new s.util.BitmapAnimation(s.util.GameImages.McRoseHeadDown),this.headDown.setPersistent(),this.headDown.isDrawing=!1,this.leaf1=new s.util.BitmapAnimation(s.util.GameImages.McLystok1),this.leaf1.setPersistent(),this.leaf1.speed=.5,this.leaf2=new s.util.BitmapAnimation(s.util.GameImages.McLystok2),this.leaf2.setPersistent(),this.headLight=new s.util.BitmapAnimation(s.util.GameImages.McRoseHeadLight),this.headLight.setPersistent(),this.headLight.sprite.alpha=150/255,this.headBack=new s.util.BitmapAnimation(s.util.GameImages.McRoseHeadBack),this.headBack.setPersistent(),this.headFront=new s.util.BitmapAnimation(s.util.GameImages.McRoseHeadFront),this.headFront.setPersistent(),this.leafMain=new s.util.BitmapAnimation(s.util.GameImages.McLystokMain),this.leafMain.setPersistent(),this.leafMain.maxFrame=79,this.roseParts=[this.stalk,this.headDown,this.leaf1,this.leaf2],this.puddle=new s.util.BitmapAnimation(s.util.GameImages.McPuddle),this.puddleTransform=new s.util.Transform,this.puddleTransform.setPosition(this.transform.position.x-80,this.transform.position.y+1),this.puddle.onCompletionShowNothing=!1,this.puddle.speed=.7,this.fadeLight()},fadeLight:function(){var t=this;s.util.newFadeAction(s.util.ScheduleContext.LEVEL,t.headLight.sprite,2.5,50/255,function(){s.util.newFadeAction(s.util.ScheduleContext.LEVEL,t.headLight.sprite,2.5,100/255,function(){s.util.newFadeAction(s.util.ScheduleContext.LEVEL,t.headLight.sprite,2.5,30/255,function(){s.util.newFadeAction(s.util.ScheduleContext.LEVEL,t.headLight.sprite,2.5,80/255,function(){s.util.newFadeAction(s.util.ScheduleContext.LEVEL,t.headLight.sprite,2.5,0,function(){t.goDown()})})})})})},applyBonus:function(){this.finalRose.currentFrame<1?this.finalRose.speed=.3:this.finalRose.currentFrame<30&&(this.finalRose.speed+=.3),this.finalRose.play()},bonusTargetPosition:function(){return this.getPosition()},goDown:function(){this.headFront.isDrawing=!1,this.headBack.isDrawing=!1,this.headLight.isDrawing=!1,this.headDown.isDrawing=!0;for(var t=this,e=0;e<this.roseParts.length;e++)this.roseParts[e].play(this.roseParts[e]===this.leaf1?function(){t.onLeaf1Fall()}:null);this.leafMain.play()},onLeaf1Fall:function(){this.leafMain.setMaxFrame();var t=this;this.leafMain.play(function(){t.onLeafMainEnd()})},onLeafMainEnd:function(){var t=this;s.util.newDelayAction(s.util.ScheduleContext.LEVEL,function(){t.puddle.play(function(){t.onPuddleEnd()})},.75)},onPuddleEnd:function(){var t=this,e=t.world.hero;e.body.SetType(o.b2_dynamicBody),s.util.Box2dUtil.setSensor(e.body,!0);var i=this.puddleTransform.position.Copy();i.Multiply(1/this._SCALE),e.body.SetPosition(i),e.eye.allowRandomAnimation=!1,e.setVisible(!0),e.body.ApplyImpulse(new a(0,-2),e.body.GetWorldCenter()),e.body.SetFixedRotation(!0),s.util.newDelayAction(s.util.ScheduleContext.LEVEL,function(){s.util.Box2dUtil.setSensor(e.body,!1),t.puddle.rewind=!0,t.puddle.play()},.5),s.util.newDelayAction(s.util.ScheduleContext.LEVEL,function(){t.lookAtRose()},2.5),s.util.soundController.playSoundEffect(s.util.GameSounds.effects.begin5,50)},lookAtRose:function(){var t=this;t.world.hero.eye.setEyeMoveAllowed(!1),t.world.hero.setEyeTargetAngle(s.util.Maths.toRadians(-45)),s.util.newDelayAction(s.util.ScheduleContext.LEVEL,function(){t.lookAtBonuses()},1.5),s.util.newDelayAction(s.util.ScheduleContext.LEVEL,function(){t.world.showBonuses()},1)},lookAtBonuses:function(){var t=this,e=t.world.hero;if(this.finished=!0,e.setEyeTargetAngle(s.util.Maths.toRadians(225)),s.util.newDelayAction(s.util.ScheduleContext.LEVEL,function(){e.body.SetFixedRotation(!1),e.eye.setEyeMoveAllowed(!0),e.eye.allowRandomAnimation=!0,e.eye.scheduleRandomAnimation(),t.world.setIntroPlaying(!1),t.world.setTouchEnabled(!0)},1.5),this.skipBtn.removeEventHandlers(),i.csstransitions)this.skipBtn.getElement().style.opacity=0;else{var n=new Tweenable;n.tween({from:{opacity:1},to:{opacity:0},duration:300,step:function(){t.skipBtn.getElement().style.opacity=this.opacity},easing:"easeOutSine"})}}});n.prototype.draw=function(t){t.foreground.save(),t.foreground.translate(this.textPosition.x,this.textPosition.y),s.util.localizedStringLoader.isEnglish()&&this.inspired&&this.inspired.alpha>0&&this.inspired.drawNoTransform(t.foreground,0,0,0,1,1),this.logo&&this.logo.alpha>0&&this.logo.drawNoTransform(t.foreground,0,0,0,1,1);for(var e,i=0;i<this.labels.length;i++)e=this.labels[i],e.draw(t.foreground);t.foreground.restore()},n.prototype.playItem=function(){if(this.messages.length>0){this.showMessage(this.messages.pop(),this.rightMessages.pop());var t=this;s.util.newDelayAction(s.util.ScheduleContext.LEVEL,function(){t.playItem()},4)}else this.playInspired()},n.prototype.playInspired=function(){this.inspired=new s.util.Bitmap(s.util.GameImages.McInspired);var t=new s.util.MultilineLabel(s.util.localizedStringLoader.getLocalizedString("INSPIRED_BY"),20,30);t.transform.setPosition(-40,0),t.color="rgb(0,0,0)",this.fadeInOut(t),s.util.localizedStringLoader.isEnglish()&&this.fadeInOut(this.inspired),this.labels.push(t);var e=this;s.util.newDelayAction(s.util.ScheduleContext.LEVEL,function(){e.playLogo()},7)},n.prototype.playLogo=function(){this.logo=new s.util.Bitmap(s.util.GameImages.McIntroLogo),this.fadeInOut(this.logo,6)},n.prototype.showMessage=function(t,e){var i=new s.util.MultilineLabel(t,20,30);i.transform.setPosition(-10,0),i.setAlignment("right"),i.color="rgb(150,150,150)",this.fadeInOut(i);var n=new s.util.MultilineLabel(e,20,30);n.transform.setPosition(10,0),n.setAlignment("left"),n.color="rgb(150,150,150)",this.fadeInOut(n),this.labels.push(i),this.labels.push(n)},n.prototype.fadeInOut=function(t,e){t.alpha=.01;var i=e?e:this.showTime,n=this;s.util.newStepAction(s.util.ScheduleContext.LEVEL,function(){s.util.newDelayAction(s.util.ScheduleContext.LEVEL,function(){s.util.newStepAction(s.util.ScheduleContext.LEVEL,function(){t.alpha=0},function(e,i){t.alpha=i/e},n.fadeTime)},i)},function(e,i){t.alpha=1-i/e},n.fadeTime)},s.elem.RoseBodyClip=r,s.elem.IntroPlayer=n}(Box2D,Class,Modernizr,cj),function(t,e){function i(t,i){this.world=t,this.success=i,this.textVisible=!0,this.onEndTime=0,this.minY=150,this.maxY=600,this.margins=10,this.start=!1,this.textPosition=new s(this.world.width/2,this.maxY),this.labels=[],this.textCanvas=document.createElement("canvas"),this.textCtx=this.textCanvas.getContext("2d"),this.textCanvas.id="textCanvas",this.textCanvas.width=this.world.width,this.textCanvas.height=this.world.height;var n=this.world.contexts.foreground.canvas.parentElement;n.insertBefore(this.textCanvas,this.world.contexts.foreground.canvas.nextSibling);var a=this.success?e.util.localizedStringLoader.getLocalizedString("YOU_DID_IT"):e.util.localizedStringLoader.getLocalizedString("YOU_TRIED_HARD"),o=new e.util.MultilineLabel(a,12,24);o.transform.setPosition(85,70),o.color=l,this.labels.push(o);var r=new e.util.MultilineLabel(e.util.localizedStringLoader.getLocalizedString("CREDITS"),11,16);r.transform.setPosition(85,180),r.color=l,this.labels.push(r),this.creditsPosition=new s(85,210),this.addCredits("GRAPHIC_ARTISTS","MIHAI_TYMOSHENKO"),this.addCredits(null,"ANDRIY_SHVUREV"),this.addCredits("COMPOSER","DAVID_LEON"),this.addCredits("SFX_BY","IHOR_PRYSHLIAK"),this.addCredits("PRODUCER","TOM_KINNINBUGRH"),this.addCredits("IDEA","ANTON_MYKHAYLETS"),this.addCredits("EVERYTHING_ELSE","MAKSYM_HRYNIV"),this.addCredits("HTML5_VERSION_SPONSOR","HTML5_SPONSOR"),this.addCredits("HTML5_VERSION_DEV","CLARITY"),this.addCredits(null,"CLARITY_NAMES_1"),this.addCredits(null,"CLARITY_NAMES_2"),this.addCredits(null,"CLARITY_NAMES_3");var h=new e.util.MultilineLabel(e.util.localizedStringLoader.getLocalizedString("STARS"),11,24);h.transform.position=this.creditsPosition.Copy(),h.color=l,this.labels.push(h),this.fadeAlpha=0;var d=this;e.util.newStepAction(e.util.ScheduleContext.LEVEL,null,function(t,i){d.fadeAlpha=e.util.Maths.lerp(0,.5,1-i/t),d.start=!0},u)}
var s=t.Common.Math.b2Vec2,n=t.Dynamics.b2Body,a=1.7,o=8,r=8,h=254,l="rgba(255,255,255, 1)",d=23,c=15,u=2,m=5,p=7,g=.33,f=e.elem.EndLevelBodyClip.extend({init:function(t,i,s,n){this._super(t,i,s,n),this.setZOrder(e.util.EntityZOrder.END_LEVEL_LAYER),this.scaleChanger=new e.elem.CosChanger(.2,.2),this.scaleChanger.minValue=-.2,this.scaleChanger.maxValue=.2,this.bounce=!1},update:function(t){this._super(t),this.bounce&&(this.scaleChanger.update(t.delta),this.portal.targetScale=this.scaleChanger.value+a)},completeLevel:function(t){var i=this.body.GetPosition();this.portal.targetScale=a,this.portal.scaleStep=.1,this.scaleChanger.progress=e.util.Maths.PI2(),this.scaleChanger.update(0),t.finishLevel(i,.3,!0);var s=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){s.hidePortal()},o)},hidePortal:function(){this.bounce=!1,this.portal.targetScale=0}}),y=e.elem.HeroBodyClip.extend({init:function(t,i,s,n){this._super(t,i,s,n),this.isEndHero=!0,this.eye.allowRandomAnimation=!1,this.userData=e.util.ReadUserData(),this.energies=[],this.energySpeed=200,this.shakePosition=0,this.hasToStop=!1,this.stopped=!1,this.outro=null},update:function(t){this._super(t),this.rose||(this.rose=this.world.getElement(v)),this.outro&&this.outro.update(t);for(var i=0;i<this.energies.length;i++)this.energies[i].update(t);if(this.hasToStop&&!this.stopped){var a=this.body.GetLinearVelocity();a.x=Math.min(a.x,-.05),this.body.SetLinearVelocity(a)}
if(this.hasToStop&&!this.stopped&&Math.abs(this.shakePosition-this.getPosition().x-h)<10&&Math.abs(this.body.GetLinearVelocity().x)<.1){this.body.SetType(n.b2_staticBody),this.body.SetLinearVelocity(new s),this.body.SetAngularVelocity(0),this.stopped=!0,this.sleep=!0,this.eye.setEyeMoveAllowed(!1),e.util.soundController.playSoundEffect(e.util.GameSounds.effects.petitkoIsHoping,70);var o=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){o.lookAtRose()},.2),this.userData.roseSaved()?e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){o.smileAfterLook()},2):e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){o.lookAtTear()},1.5)}},updateShadow:function(t){this.stopped?this.shadow.updateShadowOpacity(!0,t):this._super(t)},draw:function(t){this._super(t),this.outro&&this.outro.draw(t)},finishReached:function(){if(this.levelCompleted){var t=this;e.util.newShakeSequence(e.util.ScheduleContext.LEVEL,this,o,4,50,function(){t.afterShake()}),this.world.game.setCanPause(!1),this.world.setTouchEnabled(!1),this.createLights(),this.stripes=new e.ctrl.BackButtonLetterBox(this.world.game),this.stripes.show(),this.world.renewGround(),this.world.zoomTo(new s(550,480),1.4,r+2),e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){e.util.soundController.playSoundEffect(e.util.GameSounds.effects.petitkoIsTrying,70)},p)}},createLights:function(){for(var t,i,s=this,n=e.util.ReadUserData().totalStars()*g,a=1;n>a;a++)t=Math.sin(a/n*e.util.Maths.PI2()),i=t*r,e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){s.createLight()},i)},createLight:function(){var t=this.world.energy.addParticle(),i=new e.elem.EnergyPart(this.world,t,this,this.getPosition(),e.util.Maths.randRange(0,2*Math.PI));i.collect(),i.speedValue=Math.min(this.energySpeed,600),this.energySpeed+=10,this.energies.push(i)},afterShake:function(){this.body.SetType(n.b2_dynamicBody),e.util.Box2dUtil.setSensor(this.body,!1),this.shakePosition=this.getPosition().x,this.hasToStop=!0,this.eye.allowRandomAnimation=!1},lookAtRose:function(){this.setEyeTargetAngle(e.util.Maths.toRadians(-135))},smileAfterLook:function(){this.eye.setViewDistance(0),this.eye.playAnimation("smile",!0),this.showOutro()},lookAtTear:function(){this.rose.dropTear();var t=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.lookAfterTear()},1)},lookAfterTear:function(){var t=this;this.setEyeTargetAngle(e.util.Maths.toRadians(135)),e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.lookAtRose2()},1.5)},lookAtRose2:function(){var t=this;this.lookAtRose(),e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.becomeSad()},2)},becomeSad:function(){this.setEyeTargetAngle(e.util.Maths.toRadians(90)),e.util.soundController.playSoundEffect(e.util.GameSounds.effects.saddness,70);var t=this.eye.eyeAnimations.animations.closeSlow;t.setMaxFrame(18),t.onCompletionShowNothing=!1,t.loop=!1,t.lockY=!1,this.eye.playAnimation("closeSlow",!0,function(){t.isAnimating=!0});var i=this;e.util.newStepAction(e.util.ScheduleContext.LEVEL,null,function(t,s){var n=e.util.Maths.lerp(0,e.util.Maths.toRadians(70),1-s/t);i.tails[0].transform.rotation=n},1.7),this.showOutro()},showOutro:function(){var t=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.outro=new i(t.world,t.userData.roseSaved())},1)}}),v=e.elem.StickyBodyClip.extend({init:function(t,i,n,a){this._super(t,i,n,a),this.world.bonusTarget=this,this.bonusBasePosition=this.transform.position.Copy(),this.bonusBasePosition.x+=28,this.bonusBasePosition.y-=78,this.bonusOffset=new s,this.tear=new e.util.BitmapAnimation(e.util.GameImages.McTear),this.roseClip=new e.util.BitmapAnimation(e.util.GameImages.McEndRose),this.roseClip.setPersistent(),this.blackRoseOverlay=new e.util.BitmapAnimation(e.util.GameImages.McEndRoseBlack),this.blackRoseOverlay.setPersistent(),this.started=!1,this.goingDown=!1,this.rised=!1,this.startTime=0,this.userData=e.util.ReadUserData(),this.saved=this.userData.roseSaved(),this.roseSaved||(this.roseClip.setMaxFrame(.55*this.roseClip.maxFrame),this.blackRoseOverlay.setMaxFrame(.55*this.blackRoseOverlay.maxFrame)),this.maxTime=this.saved?o/2:o/2.7,this.colorStep=0,this.colorProgress=0,this.colorChanger=new e.elem.CosChanger(.05,.05),this.colorChanger.minValue=-.1,this.colorChanger.maxValue=0},update:function(t){if(this._super(t),this.startTime>0){var i=e.util.Maths.clamp((this.world.totalTime-this.startTime)/this.maxTime,0,1),s=e.util.Maths.easeInOutSine(i,this.roseClip.maxFrame);s=this.goingDown?this.roseClip.maxFrame-s:s,this.roseClip.setCurrentFrame(s),this.blackRoseOverlay.setCurrentFrame(s),this.roseClip.currentFrame===this.roseClip.maxFrame&&(this.saved||this.goingDown?this.saved&&!this.rised&&(this.rised=!0):(this.goingDown=!0,this.startTime=this.world.totalTime))}
this.goingDown?this.colorProgress-=.002:(this.rised?this.colorStep=.05:(Math.abs(this.roseClip.currentFrame-this.roseClip.maxFrame)>8&&(this.colorStep-=5e-4),this.colorStep=e.util.Maths.clamp(this.colorStep,-.05,.035)),this.colorProgress=e.util.Maths.clamp(this.colorProgress+this.colorStep,0,1)),this.colorChanger.update(t.delta),this.roseClip.update(t),this.blackRoseOverlay.update(t),this.blackRoseOverlay.sprite.alpha=e.util.Maths.clamp(1-this.colorProgress-this.colorChanger.value,0,.98),this.tear.update(t)},draw:function(t){this.world.isCulling||(this.roseClip.draw(t.particle,this.transform),this.blackRoseOverlay.draw(t.particle,this.transform)),this.tear.draw(t.foreground,this.transform)},applyBonus:function(){if(!this.started){this.started=!0;var t=this;e.util.newDelayAction(e.util.ScheduleContext.LEVEL,function(){t.startTime=t.world.totalTime},this.saved?5:6)}
var i=Math.abs(this.roseClip.currentFrame-this.roseClip.maxFrame)<8?.03:.01;this.colorStep=Math.max(i,this.colorStep+.003)},bonusTargetPosition:function(){var t=-20*this.roseClip.currentFrame/this.roseClip.maxFrame;return this.bonusOffset.x=this.bonusOffset.y=t,this.bonusOffset.Add(this.bonusBasePosition),this.bonusOffset},dropTear:function(){this.tear.speed=.7,this.tear.play()}});i.prototype.update=function(t){this.start&&this.textPosition.y>this.minY&&(this.textPosition.y-=t.delta*c),this.textPosition.y<=this.minY&&(this.onEndTime+=t.delta),this.onEndTime>m&&this.setTextVisibility(!1)},i.prototype.draw=function(t){var i=t.foreground;if(i.save(),i.fillStyle="rgba(0, 0, 0,"+this.fadeAlpha+")",i.fillRect(0,25,this.world.width,this.world.height),i.restore(),this.textCtx){this.textCtx.save(),this.textCtx.clearRect(0,0,this.world.width,this.world.height),e.util.Maths.transformContext(this.textCtx,this.world.transform),this.textCtx.translate(this.textPosition.x,this.textPosition.y);for(var s,n=0;n<this.labels.length;n++)s=this.labels[n],s.draw(this.textCtx);this.textCtx.restore()}},i.prototype.addCredits=function(t,i){if(t){var s=new e.util.MultilineLabel(e.util.localizedStringLoader.getLocalizedString(t),11,16);s.transform.setPosition(this.creditsPosition.x-this.margins,this.creditsPosition.y),s.color=l,s.setAlignment("right"),this.labels.push(s)}
if(i){var n=new e.util.MultilineLabel(e.util.localizedStringLoader.getLocalizedString(i),11,16);n.transform.setPosition(this.creditsPosition.x+this.margins,this.creditsPosition.y),n.color=l,n.setAlignment("left"),this.labels.push(n)}
this.nextLine()},i.prototype.nextLine=function(){this.creditsPosition.y+=d},i.prototype.setTextVisibility=function(t){if(t!=this.textVisible){this.textVisible=t;for(var i=this.textVisible?1:0,s=this,n=0;n<this.labels.length;n++)e.util.newFadeAction(e.util.ScheduleContext.LEVEL,this.labels[n],u,i,0!==n?void 0:function(){for(var t=0;t<s.labels.length;t++)s.labels[t].visible=!1})}},e.elem.EndLastLevelBodyClip=f,e.elem.EndHeroBodyClip=y,e.elem.EndRoseBodyClip=v}(Box2D,cj),function(t,e){function i(t){s=t}
var s,n=!1,a=void 0,o=1,r=0,h=.08,l=function(){s.save(),s.clearRect(0,0,s.canvas.width,s.canvas.height),s.fillStyle="rgba(0, 0, 0,"+o+")",s.fillRect(0,0,s.canvas.width,s.canvas.height),s.restore()};i.prototype.update=function(i){if(o=e.util.Maths.stepTo(o,r,h),o=o>1?1:0>o?0:o,l(),o===r&&(0===o&&(s.canvas.style.visibility="hidden"),this.register(!1),a))try{a()}catch(n){t.console&&t.console.log("Failed Action Post Transition. "+n)}},i.prototype.register=function(t){t&&!n?(e.util.dispatcher.register(this),n=!0):!t&&n&&(e.util.dispatcher.deregister(this),n=!1)},i.prototype.setToBlack=function(){s.canvas.style.visibility="visible",o=1,l()},i.prototype.setToTransparent=function(){s.canvas.style.visibility="hidden",o=0,l()},i.prototype.fadeIn=function(t){s.canvas.style.visibility="visible",o=1,a=t,r=0,this.register(!0)},i.prototype.fadeOut=function(t){s.canvas.style.visibility="visible",o=0,a=t,r=1,this.register(!0)},e.util.LevelTransitionManager=i}(window,cj),function(t,e,i,s){function n(t,i,n){this.game=n,this.completed=!1,this.totalTime=0,this.cullCount=11,this.cullFactor=1,this.isCulling=!0,this.indicator=e.getElementById("loading"),this.plasticines=[],this.entities=new s.util.Collection,this.entities.addCount=0,this.entities.add=function(t){t.addIndex=this.addCount,this.addCount++,t.zOrder||(t.zOrder=0),t.zIndex||(t.zIndex=0),this.addedElements.push(t)},this.entities.disposeMethod(function(t){t instanceof s.elem.EntityBase&&t.dispose()}),this.entities.sortMethod(function(t,e){var i=t.zOrder-e.zOrder;return 0===i&&(i=t.zIndex-e.zIndex,0===i&&(i=t.addIndex-e.addIndex)),i}),this.contexts=t,this.b2World=s.util.Box2dUtil.createWorld(i.debug,t.transition.canvas),this.ground=this.b2World.GetBodyList(),this.width=0,this.height=0,this.initContactListener(),this.backgroundParticles=null,this.groundFall=null,this.dust=null,this.grass=null,this.flies=null,this.windManager=null,this.hero=null,this.endLevelPortal=null,this.useParticles=!0,this.usePlasticines=!0,this.useSnots=!0,this.positionDependents=[],this.positionProviders=[],this.providersValue=0,this.teleports=[],this.loading=!1,this.canShowIntro=!0,this.bonusTarget=null,this.touchEnabled=!0,this.introPlaying=!1,this.forcePlasticineDraw=!1,this.lightPower=1,this.processors=[new s.elem.ForegroundProcessor(this),new s.elem.PlasticineProcessor(this),new s.elem.SnotProcessor(this),new s.elem.StrongSnotProcessor(this),new s.elem.TrampolineProcessor(this),new s.elem.CircleProcessor(this),new s.elem.PolygonProcessor(this),new s.elem.BodyProcessor(this),new s.elem.FakeProcessor(this,"hint"),new s.elem.BackSnotProcessor(this)],this.transform=new s.util.Transform,this.isZooming=!1}
var a=i.Common.Math.b2Vec2;n.prototype.getElement=function(t){for(var e=0;e<this.entities.elements.length;e++)
if(this.entities.elements[e]instanceof t)return this.entities.elements[e];return null},n.prototype.clearLevel=function(){this.entities.clear(),this.hero=null,this.endLevelPortal=null,this.positionDependents=[],this.positionProviders=[],this.providersValue=0;var t=this.contexts.foreground;t.clearRect(0,0,t.canvas.width,t.canvas.height),t=this.contexts.particle,t.clearRect(0,0,t.canvas.width,t.canvas.height),t=this.contexts.background,t.clearRect(0,0,t.canvas.width,t.canvas.height)},n.prototype.loadLevelXml=function(t,e){if(this.loadLevelBegin()){var i=s.util.levelXmlToJSON(t);this.loadLevelJSON(i,e)}},n.prototype.loadLevel=function(t,e){if(this.loadLevelBegin()){var i=this;s.util.levelXmlLoader.load(t,function(t){i.loadLevelJSON(t,e)})}},n.prototype.loadLevelBegin=function(){if(this.loading)return!1;this.loading=!0,this.loadingIndicator(!0);var t=this;return t.width=this.game.canvas.width,t.box2dWidth=t.width/30,t.height=this.game.canvas.height,t.box2dHeight=t.height/30,!0},n.prototype.loadLevelJSON=function(t,e){for(var i,n,o=t,r=[],h=this,l=!1,d=new PxLoader({appVersion:s.version}),c=o.items.length-1;c>=0;c--)n=o.items[c].children[0].config,i=h.isBlackSide()&&n.blackViewType?n.blackViewType:n.viewType,"McHeroView"===i?(s.util.assets.images.McHeroView=s.util.assets.images[s.util.GameImages.McHeroBackView],s.util.assets.expendableImages.push("McHeroView")):void 0!==i&&(l|=s.util.assets.queueLevelImage(d,i,"img/"+i+"-hd.png"),r.push(i+"-hd"));for(var u,m=o.levelProperties.backgrounds,c=0;c<m.length;c++){u=m[c];var p=u.type;l|=s.util.assets.queueLevelImage(d,p,"img/"+p+"-hd"+(u.config.jpg?".jpg":".png")),r.push(p+"-hd")}
var g=function(){var t=h.contexts.background;t.clearRect(0,0,h.game.bgCanvas.width,h.game.bgCanvas.height),h.processBackgrounds(m),h.createParticles();for(var i,n=0;n<o.items.length;n++){i=o.items[n].children;for(var r=0;r<i.length;r++)h.processItem(i[r])}
s.util.Box2dUtil.createLevelBorders(h.ground,new a(h.box2dWidth,h.box2dHeight)),s.util.PlasticineConstants.applyStaticBodiesFilter(h.ground),s.util.newDelayAction(s.util.ScheduleContext.ALL,function(){h.loading=!1,h.loadingIndicator(!1),e&&e()},.3)};s.util.elementXmlLoader.load(r,function(t){l?(d.addCompletionListener(g),d.start()):g()})},n.prototype.processBackgrounds=function(e){for(var i,n=this.contexts.background,a=[],o=!1,r=0;r<e.length;r++){i=e[r];var h=new s.util.Transform;h.setPosition(i.position.x,this.height-i.position.y),h.setRotation(s.util.Maths.toRadians(i.rotation||0));var l=i.initialScale,d=i.scale.x/l,c=i.scale.y/l;h.setScale(d,c);var u,m=i.config.type;if(m)try{m in s.elem?(u=new s.elem[m](i,this,h),a.push(u),o=!0):t.console&&t.console.log(m+" not in cj.elem namespace")}catch(p){t.console&&t.console.log(m+" "+p)}else u=new s.elem.BackgroundBase(i,this,h),a.push(u)}
if(o){a[0].img.draw(n,a[0].transform);for(var r=1;r<a.length;r++)this.entities.add(a[r])}else for(var r=0;r<a.length;r++)a[r].img.draw(n,a[r].transform)},n.prototype.processItem=function(t){for(var e,i,s=0;s<this.processors.length;s++)
if(e=this.processors[s],e.match(t)){i=e.processItem(t),null!=i&&this.processCreatedPhysicsItem(i,t);break}},n.prototype.processCreatedPhysicsItem=function(e,i){var n=i.config,a=(n.iPhoneViewType||n.viewType,n.iPhoneClipType||n.clipType),o=new s.util.Transform,r=n.scale.x,h=n.scale.y;n.flipX!==!0&&"true"!==n.flipX||(r*=-1),n.flipY!==!0&&"true"!==n.flipY||(h*=-1);var l=n.z;o.setScale(r,h),o.setPosition(30*i.position.x,this.height-30*i.position.y),o.setRotation(s.util.Maths.toRadians(n.rotation||0));var d=void 0;a?a in s.elem?d=new s.elem[a](n,e,this,o):t.console&&t.console.log(a+" not in cj.elem namespace"):d=new s.elem.Static(n,e,this,o),void 0!==d&&null!==d&&("plasticine"===n.type&&this.plasticines.push(d),l&&0!==l&&d.setZOrder(l),d.zIndex=n.zIndex,this.entities.add(d))},n.prototype.loadingIndicator=function(t){t?s.util.removeClass(this.indicator,"hide"):s.util.addClass(this.indicator,"hide")},n.prototype.completeLevel=function(){this.completed=!0,this.game.completeLevel()},n.prototype.isNormalSide=function(){return this.game.theme===s.util.Theme.NORMAL},n.prototype.isBlackSide=function(){return this.game.theme===s.util.Theme.BLACKSIDE},n.prototype.isMachineSide=function(){return this.game.theme===s.util.Theme.MACHINE},n.prototype.isWhiteSide=function(){return this.game.theme===s.util.Theme.WHITESIDE},n.prototype.isValentine=function(){return this.game.theme===s.util.Theme.VALENTINE},n.prototype.update=function(t){this.totalTime+=t.delta,this.windManager&&this.windManager.update(t),s.util.Box2dUtil.updateWorld(this.b2World,t.delta);for(var e=0;e<this.entities.elements.length;e++)this.entities.elements[e].update(t);this.entities.update()},n.prototype.draw=function(){var t=this.contexts.foreground;if(t.clearRect(0,0,t.canvas.width,t.canvas.height),this.cullCount+=1,this.cullCount>this.cullFactor&&(this.contexts.particle.clearRect(0,0,this.game.particleCanvas.width,this.game.particleCanvas.height),this.isCulling=!1),this.isZooming){var e,i=null;for(e in this.contexts)this.contexts.hasOwnProperty(e)&&(i=this.contexts[e],i.save(),s.util.Maths.transformContext(i,this.transform));for(var n=0;n<this.plasticines.length;n++)this.plasticines[n].ctx.save(),s.util.Maths.transformContext(this.plasticines[n].ctx,this.transform)}
for(var a,o=0;o<this.entities.elements.length;o++)a=this.entities.elements[o],a.visible&&a.draw(this.contexts);if(this.isCulling||(this.isCulling=!0,this.cullCount=0),this.isZooming){var e,i=null;for(e in this.contexts)this.contexts.hasOwnProperty(e)&&(i=this.contexts[e],i.restore());for(var n=0;n<this.plasticines.length;n++)this.plasticines[n].ctx.restore()}},n.prototype.renewGround=function(){for(var t=0;t<this.plasticines.length;t++)this.plasticines[t].restart()},n.prototype.addPositionDependent=function(t){this.positionDependents.push(t)},n.prototype.addPositionProvider=function(t){this.providersValue+=t.value,this.positionProviders.push(t);for(var e=0;e<this.positionDependents.length;e++)this.positionDependents[e].providerAdded(t.provider)},n.prototype.removePositionProvider=function(t){var e=this.positionProviders.indexOf(t);if(!(0>e)){this.providersValue-=t.value,this.positionProviders.splice(e,1);for(var i=0;i<this.positionDependents.length;i++)this.positionDependents[i].providerRemoved(t.provider)}},n.prototype.getRandomPositionProvider=function(){if(this.positionProviders.length<=0)return null;for(var t=s.util.Maths.randRange(0,this.providersValue),e=0,i=0,n=null;t>e;)n=this.positionProviders[i],e+=n.value,i++;return this.positionProviders[i-1].provider},n.prototype.getTouchProvider=function(t){for(var e,i=0;i<this.positionProviders.length;i++)
if(e=this.positionProviders[i].provider,e.isTouch()&&e.touch.id===t.id)return e},n.prototype.registerTeleportColor=function(t,e){this.teleports[e]=t},n.prototype.getTeleport=function(t){return this.teleports[t]},n.prototype.getBonusTarget=function(){return this.bonusTarget?this.bonusTarget:this.hero},n.prototype.createParticles=function(){this.isBlackSide()?this.backgroundParticles=new s.elem.BlueLights(this):this.isMachineSide()?this.backgroundParticles=new s.elem.SnowFall(this):this.isWhiteSide()?this.backgroundParticles=new s.elem.WhiteSnow(this):this.isValentine()?this.backgroundParticles=new s.elem.ValentineFall(this):this.backgroundParticles=new s.elem.BlackFall(this),this.backgroundParticles.createBetweenBounds(25),this.entities.add(this.backgroundParticles),this.groundFall=new s.elem.GroundFall(this),this.entities.add(this.groundFall),this.dust=new s.elem.Dust(this),this.entities.add(this.dust),this.grass=new s.elem.GrassParticleSystem(this,null,s.util.GameImages.McTotalGrass),this.grass.setZOrder(s.util.EntityZOrder.GRASS),this.entities.add(this.grass),this.flies=new s.elem.ParticleSystem(this,null,s.util.GameImages.McFly),this.flies.setZOrder(s.util.EntityZOrder.FLIES),this.entities.add(this.flies),this.energy=new s.elem.ForegroundParticleSystem(this,null,s.util.GameImages.McEnergyBall),this.energy.setZOrder(s.util.EntityZOrder.ENERGY),this.entities.add(this.energy);var t=this.isWhiteSide()?.02:.03;this.windManager=new s.util.WindManager(t)},n.prototype.hideBonuses=function(){this.endLevelPortal.setVisible(!1),this.energy.setVisible(!1),this.energy.alpha=0},n.prototype.showBonuses=function(){this.endLevelPortal.setVisible(!0),this.endLevelPortal.showPortal(),this.energy.setVisible(!0),s.util.newFadeAction(s.util.ScheduleContext.LEVEL,this.energy,2,1)},n.prototype.setScale=function(t){this.transform.setScale(t,t)},n.prototype.setPosition=function(t,e){this.transform.setPosition(t,e)},n.prototype.zoomTo=function(t,e,i){this.isZooming=!0;var n=new a;n.x=this.width/2-t.x*e,n.y=this.height/2-t.y*e,n.x=s.util.Maths.clamp(0,this.width,n.x),n.y=s.util.Maths.clamp(0,this.height,n.y),s.util.newScaleMoveAction(s.util.ScheduleContext.LEVEL,this,i,n,e)},n.prototype.setTouchEnabled=function(t){this.introPlaying||this.touchEnabled!=t&&(this.touchEnabled=t,t||this.game.touchModule.clearTouches())},n.prototype.setIntroPlaying=function(t){this.introPlaying!=t&&(this.introPlaying=t)},n.prototype.freeTouch=function(t){this.game.touchModule.freeTouch(t)},n.prototype.startTouch=function(t){if(this.touchEnabled){this.addPositionProvider(new s.elem.PositionProviderValue(new s.elem.TouchPositionProvider(t),5));for(var e=this.getEntitiesAtTouch(t),i=null,n=0;n<e.length;n++)
if(i=e[n],i.startTouch(t)){t.addListener(i);break}}},n.prototype.moveTouch=function(t){if(this.touchEnabled){for(var e=this.getEntitiesAtTouch(t),i=t.listener?t.listener.touchPriority():-(1/0),s=null,n=0;n<e.length;n++)
if(s=e[n],!t.listener&&s.startTouch(t))t.addListener(s);else if(s.isTouchSwipable()&&s.touchPriority()>i&&s.startTouch(t)){t.endTouch(),t.addListener(s);break}
t.moveTouch()}},n.prototype.endTouch=function(t){if(this.touchEnabled){for(var e=null,i=0;i<this.positionProviders.length;i++)e=this.positionProviders[i],e.provider.isTouch()&&e.provider.touch===t&&this.removePositionProvider(e);t.endTouch()}},n.prototype.getEntitiesAtTouch=function(t){var e,i=new a(t.x/30,t.y/30);e=s.util.Box2dUtil.queryAABBFromRadius(this.b2World,i,t.radius),e.length>0&&e.sort(function(t,e){var n=e.GetBody().GetUserData().touchPriority()-t.GetBody().GetUserData().touchPriority();if(0===n){var a=s.util.Box2dUtil.b2Vec2Subtract(i,t.GetBody().GetPosition()).LengthSquared(),o=s.util.Box2dUtil.b2Vec2Subtract(i,e.GetBody().GetPosition()).LengthSquared();n=a-o}
return n});var n,o,r,h,l=[],d=[],c=!1;for(h=0,r=e.length;r>h;h++)n=e[h].GetBody().GetUserData(),n&&(l.push(n),"PlasticinePartBodyClip"===n.name&&(c=!0));for(h=0,r=l.length;r>h;h++)o=l[h],o.isClickable(d.length,c)&&d.push(o);return d},n.prototype.initContactListener=function(){var t=new i.Dynamics.b2ContactListener;t.BeginContact=function(t){var e=t.GetFixtureA().GetBody().GetUserData(),i=t.GetFixtureB().GetBody().GetUserData();e&&e.onCollisionStart(t.GetFixtureB().GetBody(),t),i&&i.onCollisionStart(t.GetFixtureA().GetBody(),t)},t.EndContact=function(t){var e=t.GetFixtureA().GetBody().GetUserData(),i=t.GetFixtureB().GetBody().GetUserData();e&&e.onCollisionEnd(t.GetFixtureB().GetBody(),t),i&&i.onCollisionEnd(t.GetFixtureA().GetBody(),t)},t.PreSolve=function(t,e){if(t.IsTouching()){var i=t.GetFixtureA().GetBody().GetUserData(),s=t.GetFixtureB().GetBody().GetUserData();i&&i.onCollision(t.GetFixtureB().GetBody(),t),s&&s.onCollision(t.GetFixtureA().GetBody(),t)}},t.PostSolve=function(t,e){if(t.IsTouching()){var i=t.GetFixtureA().GetBody().GetUserData(),s=t.GetFixtureB().GetBody().GetUserData();i&&i.postSolve(t.GetFixtureB().GetBody(),t,e),s&&s.postSolve(t.GetFixtureA().GetBody(),t,e)}},this.b2World.SetContactListener(t)},s.elem.World=n}(window,document,Box2D,cj),function(t,e,i){function s(t){this.game=t,this.ctx=t.contexts.foreground,this.transform=new i.util.Transform,this.transform.setPosition(this.ctx.canvas.width/2,this.ctx.canvas.height/2),this.minSpeed=0,this.speedMult=0,this.depthChanged=!0,this.inChapter=!1,this.planetsVisible=!1,this.hasToExplode=!1,this.touchEnabled=!0,this.clickListeners=[],this.currentChapter=t.currentWorld,this.setTargetIndex(t.currentWorld),this.touching=!1,this.lastDragChange=0,this.previousTouchPosition=new n,this.fadeColor=new i.util.Color(0,0,0,0),this.names=new Q,this.names.transform.setPosition(140,160),this.userData=i.util.ReadUserData(),this.createScore(),this.chapters=[],this.explodingChapters=[],this.createPlanet(0),this.createPlanet(1),this.createPlanet(2),this.createPlanet(3),this.createPlanet(4),this.createPlanet(5),this.createBackgrounds(),this.fixCurrentPosition(),this.refreshDepth(),this.localTouch=new i.util.TouchPoint,this.currentTouch=null}
var n=t.Common.Math.b2Vec2,a=6,o=2*Math.PI/a,r=.09,h=1.8,l=340,d=150,c=.02,u=.7,m=1.3,p=.196,g=.608,f=20,y=new i.util.Color(0,0,0,0),v=new i.util.Color(0,0,0,1),S=new n,w=.3,M=4,b=5;s.prototype.update=function(t){for(var e=0;e<this.chapters.length;e++)this.chapters[e].update(t);if(!this.touching&&this.currentPosition!=this.targetPosition){var s=Math.max(Math.abs(this.currentPosition-this.targetPosition)*this.speedMult,this.minSpeed);this.currentPosition=i.util.Maths.stepTo(this.currentPosition,this.targetPosition,s),this.depthChanged=!0}
this.refreshDepth(),this.refreshPosition()},s.prototype.draw=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.scoreCtx.clearRect(0,0,this.scoreCtx.canvas.width,this.scoreCtx.canvas.height);for(var t,e=0;e<this.backgrounds.length;e++)t=this.backgrounds[e],t.alpha>0&&t.drawToFit(this.ctx,0,0,this.ctx.canvas.width,this.ctx.canvas.height);if(this.planetsVisible){this.ctx.save(),i.util.Maths.transformContext(this.ctx,this.transform);for(var e=0;e<this.chapters.length;e++)this.chapters[e].draw(this.ctx);this.ctx.restore(),this.names.draw(this.ctx)}
this.ctx.fillStyle=this.fadeColor.toAlphaString(),this.ctx.fillRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.energyIcon.draw(this.scoreCtx),this.starsField.draw(this.scoreCtx)},s.prototype.addListener=function(t){this.clickListeners.push(t)},s.prototype.removeListener=function(t){var e=this.clickListeners.indexOf(t);e>=0&&this.clickListeners.splice(e,1)},s.prototype.createPlanet=function(t){var e,i=this.userData.totalStars(),s=i>=this.userData.starsToUnlock(t);if(s)switch(t){case 0:e=new E(this,t);break;case 1:e=new B(this,t);break;case 2:e=new I(this,t);break;case 3:e=new k(this,t);break;case 4:e=new x(this,t);break;case 5:e=new A(this,t);break;default:return}else e=t===M?new T(this,null,t,!1):new C(this,null,t);this.chapters.push(e),s&&t>this.userData.unlockedChapters&&b>t&&(t===M?this.createMultiTouchUnlockChapter(e):this.createExplodingChapter(e))},s.prototype.createExplodingChapter=function(t){this.hasToExplode=!0,this.setTouchEnabled(!1),this.setTargetIndex(t.index-1),this.fixCurrentPosition();var e=this;i.util.newDelayAction(i.util.ScheduleContext.ALL,function(){e.selectNextChapter(t.index)},.7),this.addExplodingChapter(t,new C(this,t,t.index))},s.prototype.addExplodingChapter=function(t,e){e.targetChapter=t,e.explodeEvent.addListener(this,this.onLockExplode),this.explodingChapters[t.index]=e,t.alpha=0,t.updatables.push(e),t.explodingChapter=e},s.prototype.createMultiTouchUnlockChapter=function(t){var e=i.util.ReadUserData();if(!e.openedMultiTouch){this.hasToExplode=!0,this.setTargetIndex(t.index-1),this.fixCurrentPosition();var s=this;i.util.newDelayAction(i.util.ScheduleContext.ALL,function(){s.selectNextChapter(t.index)},.7),e.openedMultiTouch=!0,i.util.WriteUserData(e)}
this.addExplodingChapter(t,new T(this,t,t.index,!0))},s.prototype.onLockExplode=function(t){this.explodingChapters[t].explodeEvent.removeListener(this,this.onLockExplode),this.setTouchEnabled(!0),this.userData.unlockedChapters=Math.max(this.userData.unlockedChapters,t),i.util.WriteUserData(this.userData)},s.prototype.createScore=function(){this.scoreCtx=document.getElementById("scoreCanvas").getContext("2d"),this.energyIcon=new L(i.util.GameImages.McEnergyIcon),this.energyIcon.transform.setPosition(30,this.scoreCtx.canvas.height-24),this.starsField=new i.util.MultilineLabel("",12,12),this.starsField.transform.setPosition(52,this.scoreCtx.canvas.height-16),this.starsField.setAlignment("left"),this.starsField.color="rgb(150,150,150)",this.refreshScore()},s.prototype.refreshScore=function(){var t=this.inChapter?this.userData.getChapterStars(this.currentChapter):this.userData.totalStars(),e=this.inChapter?this.userData.getChapterScore(this.currentChapter):this.userData.totalScore(),s=this.inChapter?30:150,n=i.util.localizedStringLoader.getFormatedLocalizedString("STARS_AND_SCORE",[t.toString(),s,e]);this.starsField.setText(n)},s.prototype.showScore=function(){this.refreshScore(),i.util.newFadeAction(i.util.ScheduleContext.ALL,this.starsField,w,1,null),i.util.newFadeAction(i.util.ScheduleContext.ALL,this.energyIcon,w,1,null)},s.prototype.hideScore=function(){i.util.newFadeAction(i.util.ScheduleContext.ALL,this.starsField,w,0,null),i.util.newFadeAction(i.util.ScheduleContext.ALL,this.energyIcon,w,0,null)},s.prototype.showPlanets=function(){var t=this;t.inChapter=!1,this.showScore(),t.planetsVisible=!0,t.names.visible=!0;var e=t.transform.scale.x;t.names.alpha,i.util.newStepAction(i.util.ScheduleContext.ALL,null,function(s,n){var a=1-n/s,o=i.util.Maths.stepTo(e,1,a);i.util.DrawUtil.colorLerp(v,y,a,t.fadeColor),t.transform.setScale(o,o)},w),i.util.newFadeAction(i.util.ScheduleContext.ALL,this.names,w,1,null),i.util.soundController.playSoundTrack(i.util.GameSounds.tracks.menu,1)},s.prototype.hidePlanets=function(){this.inChapter=!0,this.hideScore();var t=this,e=t.transform.scale.x;t.names.alpha,i.util.newStepAction(i.util.ScheduleContext.ALL,function(){t.game.modifyTheme(t.currentChapter),t.game.changeWorld(t.currentChapter),t.showLevels()},function(s,n){var a=1-n/s,o=i.util.Maths.stepTo(e,5,a);i.util.DrawUtil.colorLerp(y,v,a,t.fadeColor),t.transform.setScale(o,o)},w),i.util.newFadeAction(i.util.ScheduleContext.ALL,this.names,w,0,function(){t.names.visible=!0})},s.prototype.showLevels=function(t){this.inChapter=!0,this.showScore(),this.planetsVisible=!1,this.game.lvlPicker.show(t);var e=this;i.util.newStepAction(i.util.ScheduleContext.ALL,null,function(t,s){var n=1-s/t;i.util.DrawUtil.colorLerp(v,y,n,e.fadeColor)},w)},s.prototype.hideLevels=function(){this.hideScore();var t=this;i.util.newStepAction(i.util.ScheduleContext.ALL,function(){t.showPlanets()},function(e,s){var n=1-s/e;i.util.DrawUtil.colorLerp(y,v,n,t.fadeColor)},w)},s.prototype.setTouchEnabled=function(t){this.touchEnabled!=t&&(this.touchEnabled=t)},s.prototype.startTouch=function(t){if(this.touchEnabled){this.localTouch.x=t.x-this.transform.position.x,this.localTouch.y=t.y-this.transform.position.y;for(var e=0;e<this.clickListeners.length;e++)this.clickListeners[e].startTouch(this.localTouch);this.inChapter||this.currentTouch||!this.touchEnabled||(this.currentTouch=t,this.previousTouchPosition.x=t.x,this.previousTouchPosition.y=t.y,this.touching=!0)}},s.prototype.moveTouch=function(t){if(this.touchEnabled){this.localTouch.x=t.x-this.transform.position.x,this.localTouch.y=t.y-this.transform.position.y;for(var e=0;e<this.clickListeners.length;e++)this.clickListeners[e].moveTouch(this.localTouch);if(!this.inChapter&&this.currentTouch===t&&this.touchEnabled){var s=new n(t.x,t.y),a=s.x-this.previousTouchPosition.x;if(Math.abs(a)>0){this.lastDragChange=a;var o=this.lastDragChange/this.ctx.canvas.width*h;this.currentPosition+=o,this.depthChanged=!0,this.speedMult=o,i.util.Box2dUtil.b2Vec2Copy(s,this.previousTouchPosition)}}}},s.prototype.endTouch=function(t){if(this.touchEnabled){this.localTouch.x=t.x-this.transform.position.x,this.localTouch.y=t.y-this.transform.position.y;for(var e=0;e<this.clickListeners.length;e++)this.clickListeners[e].endTouch(this.localTouch);t===this.currentTouch&&(this.currentTouch=null,this.inChapter||(this.lastDragChange>0&&this.currentPosition>this.targetIndex*o?this.targetIndex++:this.lastDragChange<0&&this.currentPosition<this.targetIndex*o&&this.targetIndex--,this.refreshTargetPosition(),this.minSpeed=Math.max(Math.abs(this.targetPosition-this.currentPosition)/20,c),this.depthChanged=!0,this.touching=!1))}},s.prototype.refreshPosition=function(){if(!this.inChapter)
for(var t,e,i=0;i<this.chapters.length;i++)t=this.chapters[i],e=this.currentPosition+t.offset,t.transform.setPosition(l*Math.sin(e),0)},s.prototype.setTargetIndex=function(t){this.targetIndex=-t,this.refreshTargetPosition(),this.minSpeed=r},s.prototype.refreshDepth=function(){if(this.depthChanged){var t=-this.currentPosition/o,e=Math.floor(t),i=e%a,s=t-e;0>i&&(i+=a);var n=(i+1)%a;this.setBackgroundAlphaOffset(i,n,s),this.names.setIndex(t),this.fadeBetweenWorlds(t);for(var r,h,l,d,c=0;c<this.chapters.length;c++)r=this.chapters[c],h=this.currentPosition+r.offset,l=(Math.cos(h)+1)/2,d=u+(m-u)*l*l,r.transform.scale.x=d,r.transform.scale.y=d,r.setDepth(l);this.chapters.sort(function(t,e){return t.depth-e.depth}),this.depthChanged=!1}},s.prototype.refreshTargetPosition=function(){this.targetPosition=this.targetIndex*o},s.prototype.fixCurrentPosition=function(){this.currentPosition=this.targetPosition},s.prototype.rotateToChapter=function(t){var e=this.chapters[this.chapters.length-1].index,i=t.index,s=e-i;0===e&&i===this.chapters.length-1?s=1:e===this.chapters.length-1&&0===i&&(s=-1),1>=s&&s>=-1&&(this.targetIndex+=s,this.refreshTargetPosition(),this.minSpeed=r,this.currentTouch=null,this.touching=!1)},s.prototype.createBackgrounds=function(){this.worldColorResources={black:{colorName:"black",backgroundImage:new i.util.Bitmap(i.util.GameImages.McChapter1Background),pageColor:new i.util.Color(50,50,50,.25),textColor:new i.util.Color(225,225,225,1),disabledIconColor:new i.util.Color(75,75,75,1),$border:$("#gameBorderBlack"),$header:$("#menuHeaderBlack"),$footer:$("#menuFooterBlack")},blue:{colorName:"blue",backgroundImage:new i.util.Bitmap(i.util.GameImages.McChapter2Background),pageColor:new i.util.Color(0,37,63,.5),textColor:new i.util.Color(66,97,123,1),disabledIconColor:new i.util.Color(22,45,63,1),$border:$("#gameBorderBlue"),$header:$("#menuHeaderBlue"),$footer:$("#menuFooterBlue")},white:{colorName:"white",backgroundImage:new i.util.Bitmap(i.util.GameImages.McChapter4Background),pageColor:new i.util.Color(0,0,0,.5),textColor:new i.util.Color(196,196,196,1),disabledIconColor:new i.util.Color(75,75,75,1),$border:$("#gameBorderWhite"),$header:$("#menuHeaderWhite"),$footer:$("#menuFooterWhite")},purple:{colorName:"purple",backgroundImage:new i.util.Bitmap(i.util.GameImages.McChapter5Background),pageColor:new i.util.Color(63,39,63,.5),textColor:new i.util.Color(35,20,31,1),disabledIconColor:new i.util.Color(50,40,50,1),$border:$("#gameBorderPurple"),$header:$("#menuHeaderPurple"),$footer:$("#menuFooterPurple")}},this.worldColors=[this.worldColorResources.black,this.worldColorResources.blue,this.worldColorResources.white,this.worldColorResources.purple,this.worldColorResources.black,this.worldColorResources.blue],this.backgrounds=[new i.util.Bitmap(i.util.GameImages.McChapter1Background),new i.util.Bitmap(i.util.GameImages.McChapter2Background),new i.util.Bitmap(i.util.GameImages.McChapter4Background),new i.util.Bitmap(i.util.GameImages.McChapter5Background),new i.util.Bitmap(i.util.GameImages.McChapter3Background),new i.util.Bitmap(i.util.GameImages.McChapter2Background)],this.fontColors=[new i.util.Color(150,150,150,1),new i.util.Color(66,97,123,1),new i.util.Color(150,150,150,1),new i.util.Color(110,90,110,1),new i.util.Color(150,150,150,1),new i.util.Color(66,97,123,1)],this.lastWorldOffset=0,this.pageColor=new i.util.Color(0,0,0,.25),this.fontColor=new i.util.Color(150,150,150,1),this.disabledIconColor=new i.util.Color(85,85,85,1),this.evenOdd=!1;for(var t=0;t<this.backgrounds.length;t++)this.backgrounds[t].alpha=0},s.prototype.fadeBetweenWorlds=function(t){var e=0>t?a+t%a:t%a,s=e<this.lastWorldOffset,n=s?Math.ceil(e)%a:Math.floor(e),o=s?Math.floor(e):Math.ceil(e)%a;if(!(0>n||0>o||n>this.worldColors.length-1||o>this.worldColors.length-1)){if(n!=o){var r=s?1-(e-o):e-n,h=s?e-o:1-(e-n);r>.9&&(r=1,h=0,$("#shareLinks").removeClass(this.worldColors[n].colorName),$("#shareLinks").addClass(this.worldColors[o].colorName),$("#container").removeClass(this.worldColors[n].colorName),$("#container").addClass(this.worldColors[o].colorName));var l=this.worldColors[n],d=this.worldColors[o];l.$border.css({opacity:h}),d.$border.css({opacity:r}),l.$header.css({opacity:h}),d.$header.css({opacity:r}),l.$footer.css({opacity:h}),d.$footer.css({opacity:r}),this.evenOdd&&(i.util.DrawUtil.colorLerp(l.pageColor,d.pageColor,r,this.pageColor),document.getElementById("backgroundOverlay").style.background=this.pageColor.toAlphaString()),i.util.DrawUtil.colorLerp(l.disabledIconColor,d.disabledIconColor,r,this.disabledIconColor),$(".disabledIcon").css({"background-color":this.disabledIconColor}),$("#sharePanelHitArea span").css({color:this.fontColor})}
this.lastWorldOffset=e,this.evenOdd=!this.evenOdd}},s.prototype.setBackgroundAlphaOffset=function(t,e,s){var n=1-s,a=this.backgrounds[t];a.alpha=n,a=this.backgrounds[e],a.alpha=s,this.game.menuSoundBtn.setAlphaOffset(t,e,s),this.game.menuSoundEffectBtn.setAlphaOffset(t,e,s),this.game.menuPetitBtn.setAlphaOffset(t,e,s),i.util.DrawUtil.colorLerp(this.fontColors[t],this.fontColors[e],s,this.fontColor),this.starsField.color=this.fontColor.toString()},s.prototype.selectNextChapter=function(t){t-1===-this.targetIndex&&this.setTargetIndex(t)},s.prototype.clearLevel=function(){this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height)};var P=e.extend({init:function(t,e){this.worldPicker=t,this.transform=new i.util.Transform,this.alpha=1,this.index=e,this.depth=-1,this.offset=e*Math.PI*2/a,this.visible=!0,this.alphaItems=[],this.depthDependents=[],this.updatables=[],this.explodingChapter=null,this.drawables=[],this.createSprites(),this.createClickListener()},update:function(t){if(this.depth>.5)
for(var e=0;e<this.updatables.length;e++)this.updatables[e].update(t)},draw:function(t){t.save(),i.util.Maths.transformContext(t,this.transform),t.globalAlpha=this.alpha;for(var e,s=0;s<this.drawables.length;s++)e=this.drawables[s],(this.visible||e.ignoreParentVisibility)&&e.draw(t);this.explodingChapter&&this.explodingChapter.draw(t),this.blurBackground.draw(t),t.restore()},createClickListener:function(){this.clickListener=new et(this,180),this.clickListener.radius=40,this.clickListener.disableDrag=!0,this.clickListener.clickEvent.addListener(this,this.touchRaised),this.worldPicker.addListener(this.clickListener)},createSprites:function(){this.background=new L(i.util.GameImages.McPlanetLockedBackground),this.blurBackground=new L(i.util.GameImages.McChapterLockedBlur),this.drawables.push(this.background)},setDepth:function(t){this.depth!=t&&(this.depth=t,this.refreshDepth())},refreshDepth:function(){this.blurBackground.alpha=i.util.Maths.clamp((1-this.depth)/ .2, 0, 1);
                    var t = i.util.Maths.clamp((this.depth - .7) /.3,0,1);this.background.alpha=i.util.Maths.clamp(3*t,0,1);for(var e=0;e<this.alphaItems.length;e++)this.alphaItems[e].setOpacity(t);for(var e=0;e<this.depthDependents.length;e++)this.depthDependents[e].depth=this.depth;this.visible=t>0},touchRaised:function(){this.worldPicker.inChapter||!(this.depth>.1)||this.explodingChapter&&this.explodingChapter.visible||(this.depth>.99?this.onTouch():this.worldPicker.rotateToChapter(this))},onTouch:function(){this.worldPicker.currentChapter=this.index,i.util.soundController.playSoundEffect(i.util.GameSounds.effects.click,80),this.worldPicker.hidePlanets()},getPosition:function(){return this.transform.position},setPosition:function(t,e){this.transform.setPosition(t,e)},setScale:function(t,e){this.transform.setScale(t,e)}}),C=P.extend({init:function(t,e,s){this.parent=e,this.isBlue=1===s,this._super(t,s),this.targetChapter=null,this.exploding=!1,this.explodeEvent=new i.util.EventSender},update:function(t){this._super(t),this.targetChapter&&this.setDepth(this.targetChapter.depth)},draw:function(t){this._super(t),this.explosion&&(t.save(),i.util.Maths.transformContext(t,this.transform),this.explosion.draw(t),t.restore())},createSprites:function(){this.background=null,this.blurBackground=null,1==this.index?(this.background=new L(i.util.GameImages.McPlanetLockedBackgroundBlue),this.blurBackground=new L(i.util.GameImages.McChapterLockedBlur)):2==this.index?(this.background=new L(i.util.GameImages.McPlanet4Locked),this.blurBackground=new L(i.util.GameImages.McChapter4Blur)):3==this.index?(this.background=new L(i.util.GameImages.McPlanetVLocked),this.blurBackground=new L(i.util.GameImages.McChapterVBlur)):(this.background=new L(i.util.GameImages.McPlanetLockedBackground),this.blurBackground=new L(i.util.GameImages.McChapterLockedBlur)),this.tablo=new O(this.index,this.isBlue),this.tablo.transform.setPosition(-74,-28),this.drawables.push(this.background),this.drawables.push(this.tablo)},setDepth:function(t){this._super(t),this.tablo&&this.tablo.setOpen(t>.9),!this.exploding&&this.targetChapter&&1===t&&this.onReadyToUnlock()},onReadyToUnlock:function(){this.startExplosion()},startExplosion:function(){var t=this;t.exploding=!0,i.util.newShakeSequence(i.util.ScheduleContext.ALL,this,.7,5,20,function(){t.doExplode()})},doExplode:function(){this.worldPicker.hasToExplode=!1;var t=this;i.util.newFadeAction(i.util.ScheduleContext.ALL,this,.35,0),i.util.newFadeAction(i.util.ScheduleContext.ALL,t.targetChapter,.3,1,null),i.util.newDelayAction(i.util.ScheduleContext.ALL,function(){t.explodeEvent.sendEvent(t.index),t.parent.updatables.pop(),t.parent.explodingChapter=null},1),this.explosion=new W(new n,i.util.GameImages.McBlackSmoke),this.explosion.transform.rotation=i.util.Maths.toRadians(-90),this.explosion.scaleStep=-.5,this.explosion.horizontalPosition=new i.elem.Range(0,20),this.explosion.verticalPosition=new i.elem.Range(0,20),this.explosion.speed=new i.elem.Range(220,60),this.explosion.particlesScale=new i.elem.Range(1,.5),this.explosion.createOnStartPosition(75),this.updatables.push(this.explosion)},onTouch:function(){}}),T=C.extend({init:function(t,e,i,s){this.unlocked=s,this._super(t,e,i)},createClickListener:function(){this.unlocked?(this.clickListener=new it([this.touchPoint1,this.touchPoint2,this.touchPoint3],50),this.clickListener.clickEvent.addListener(this,this.fadeLights),this.worldPicker.addListener(this.clickListener)):this._super()},createSprites:function(){this.background=new L(i.util.GameImages.McPlanetIELocked),this.drawables.push(this.background),this.blurBackground=new L(i.util.GameImages.McChapterIELockedBlur),this.unlocked?this.createUnLockedSprites():this.createLockedSprites()},onReadyToUnlock:function(){},fadeLights:function(){var t=this;this.exploding=!0,this.worldPicker.setTouchEnabled(!1),this.worldPicker.currentTouch=null,this.worldPicker.removeListener(this.clickListener),this.lockedSign.setOpen(!1),i.util.newFadeAction(i.util.ScheduleContext.ALL,t.touchPoint1,.5,0,function(){i.util.newFadeAction(i.util.ScheduleContext.ALL,t.touchPoint2,.5,0,function(){i.util.newFadeAction(i.util.ScheduleContext.ALL,t.touchPoint3,.5,0,function(){t.startExplosion()})})})},createLockedSprites:function(){this.tablo=new O(this.index,this.isBlue),this.tablo.transform.setPosition(-74,-28),this.drawables.push(this.tablo)},createUnLockedSprites:function(){this.lockedSign=new F,this.lockedSign.transform.setPosition(70,15),this.drawables.push(this.lockedSign),this.touchPoint1=new j(new n(-75,-90),i.util.GameImages.McEnergyBall,.15,.24),this.touchPoint1.setOpacity(0),this.alphaItems.push(this.touchPoint1),this.updatables.push(this.touchPoint1),this.drawables.push(this.touchPoint1),this.touchPoint2=new j(new n(-5,-115),i.util.GameImages.McEnergyBall,.15,.24),this.touchPoint2.setOpacity(0),this.alphaItems.push(this.touchPoint2),this.updatables.push(this.touchPoint2),this.drawables.push(this.touchPoint2),this.touchPoint3=new j(new n(65,-90),i.util.GameImages.McEnergyBall,.15,.24),this.touchPoint3.setOpacity(0),this.alphaItems.push(this.touchPoint3),this.updatables.push(this.touchPoint3),this.drawables.push(this.touchPoint3)},setDepth:function(t){this._super(t),this.lockedSign&&!this.exploding&&this.lockedSign.setOpen(t>.9)}}),E=P.extend({createSprites:function(){this.createSnot(new n(70,-60),30,.8/1.5),this.createSnot(new n(83,-44),80,.6/1.5),this.createSnot(new n(74,59),130,.4/1.5),this.createSnot(new n(54,72),180,.5/1.5),this.createSnot(new n(-83,35),-90,.5/1.5),this.addSpikes(new n(-92,-8),1,2,4,0),this.addSpikes(new n(-90,-23),.85,3,3,Math.PI/3),this.addSpikes(new n(-88,-37),.65,4,2,Math.PI/3*2),this.background=new L(i.util.GameImages.McPlanet1Background),this.foreground=new L(i.util.GameImages.McPlanet1Foreground),this.roseLight=new D(i.util.GameImages.McPlanetRoseLight,p,g,3),this.roseForeground=new L(i.util.GameImages.McRoseForeground),this.eye=new Y,this.blurBackground=new L(i.util.GameImages.McChapter1Blur),this.blurBackground.transform.setScale(1.1,1.1),this.drawables.push(this.background),this.updatables.push(this.roseLight),this.drawables.push(this.roseLight),this.drawables.push(this.roseForeground),this.updatables.push(this.eye),this.drawables.push(this.eye),this.drawables.push(this.foreground)},addSpikes:function(t,e,s,n,a){var o=new i.util.Transform;o.setPosition(t.x,t.y),o.setScale(e,e);var r=new V(i.util.GameImages.McMenuCircleSpikes,o,s,n,a);this.updatables.push(r),this.drawables.push(r)},createSnot:function(t,e,s){var n=new q(26);n.transform.setPosition(t.x,t.y),n.transform.rotation=i.util.Maths.toRadians(e),n.transform.setScale(s,s),this.depthDependents.push(n),this.updatables.push(n),this.drawables.push(n)}}),B=P.extend({createSprites:function(){this.background=new L(i.util.GameImages.McPlanet2Background),this.blurBackground=new L(i.util.GameImages.McChapter2Blur),this.createBouncingSprite(i.util.GameImages.McPlanetSpringBack,i.util.Maths.toRadians(-45),new n(-69,-26),.8),this.createBouncingSprite(i.util.GameImages.McPlanetSpringBack,i.util.Maths.toRadians(150),new n(26,73),.7),this.drawables.push(this.background),this.energy=new j(new n(-67,53),i.util.GameImages.McEnergyBall,.15,.24),this.alphaItems.push(this.energy),this.updatables.push(this.energy),this.drawables.push(this.energy),this.createSmoke(),this.createBouncingSprite(i.util.GameImages.McPlanetSpringView,i.util.Maths.toRadians(50),new n(70,-35),.9),this.createBouncingSprite(i.util.GameImages.McPlanetSpringView,i.util.Maths.toRadians(190),new n(-14,74),.9),this.createBouncingSprite(i.util.GameImages.McPlanetSpringView,i.util.Maths.toRadians(-90),new n(-78,3),.8),this.satellite=new X,this.alphaItems.push(this.satellite),this.updatables.push(this.satellite),this.drawables.push(this.satellite)},update:function(t){this._super(t);var e=this.satellite.satellite.transform.scale.x>.75,i=this.drawables.indexOf(this.satellite);e&&i!==this.drawables.length-1?(this.drawables.splice(i,1),this.drawables.push(this.satellite)):e||0===i||(this.drawables.splice(i,1),this.drawables.unshift(this.satellite))},createBouncingSprite:function(t,e,s,n){var a=new i.util.Transform;a.setPosition(s.x,s.y),a.setRotation(e),a.setScale(n,n);var o=new _(t,a);o.maxBounceEvent.addListener(this,this.onSpringSpit),this.updatables.push(o),this.drawables.push(o)},createSmoke:function(){this.springSmoke=new z,this.springSmoke.particleImage=new i.util.Bitmap(i.util.GameImages.McWhiteSmoke,i.util.Theme.BLACKSIDE),this.springSmoke.createOnStartPosition(20),this.springSmoke.hideAllParticles(),this.springSmoke.opacityStep=70/255,this.springSmoke.scaleStep=1,this.springSmoke.maxOpacity=180/255,this.springSmoke.particleScale=new i.elem.Range(1.2,.3),this.alphaItems.push(this.springSmoke),this.updatables.push(this.springSmoke),this.drawables.push(this.springSmoke)},onSpringSpit:function(t){if(i.util.Maths.fuzzyEqual(this.depth,1)){var e=this.springSmoke.addOrGetInvisible(),s=new n(0,-43);s.Multiply(t.transform.scale.x),i.util.Box2dUtil.rotate(s,t.transform.rotation,s),s.x+=t.transform.position.x,s.y+=t.transform.position.y,e.setPositionV(s),i.util.Box2dUtil.toVec(-15,t.transform.rotation+Math.PI/2,s),e.speedX=s.x,e.speedY=s.y}}}),x=P.extend({createSprites:function(){this.blurBackground=new L(i.util.GameImages.McChapter3Blur),this.background=new L(i.util.GameImages.McPlanet3Background),this.drawables.push(this.background),this.createGear(i.util.GameImages.McPlanet3Gear3,new n(-11,41),0,1,-.35),this.createGear(i.util.GameImages.McPlanet3Gear2,new n(-15,-6),0,1,.25),this.createGear(i.util.GameImages.McPlanet3Gear1,new n(30,-18),0,1,-.4),this.createGear(i.util.GameImages.McPlanet3Gear4,new n(53,40),0,1,.7),this.energy=new j(new n(4,4),i.util.GameImages.McPlanet3ForegroundParticle,.04,.13),this.alphaItems.push(this.energy),this.updatables.push(this.energy),this.drawables.push(this.energy),this.backLight=new D(i.util.GameImages.McPlanet3BackgroundLight,.4,1,3),this.updatables.push(this.backLight),this.drawables.push(this.backLight),this.foreground=new L(i.util.GameImages.McPlanet3Foreground),this.drawables.push(this.foreground),this.sparkles=new H(i.util.GameImages.McPlanet3Particle,new n(-105,20),new n(60,-105),20),this.sparkles.addParticles(30),this.alphaItems.push(this.sparkles),this.updatables.push(this.sparkles),this.drawables.push(this.sparkles)},createGear:function(t,e,s,n,a){var o=new i.util.Transform;o.setPosition(e.x,e.y),o.setRotation(s),o.setScale(n,n);var r=new G(t,o,a);this.updatables.push(r),this.drawables.push(r)}}),I=P.extend({createSprites:function(){this.blurBackground=new L(i.util.GameImages.McChapter4Blur),this.background=new L(i.util.GameImages.McPlanet4Background),this.drawables.push(this.background)},update:function(t){this._super(t)}}),k=P.extend({createSprites:function(){var t=new i.util.Transform;t.setRotation(60);var e=new i.util.Transform;e.setRotation(30),this.blurBackground=new L(i.util.GameImages.McChapterVBlur),this.background=new L(i.util.GameImages.McPlanetVBackground),this.background1=new G(i.util.GameImages.McPlanetVBackground1,t,1),this.background2=new G(i.util.GameImages.McPlanetVBackground2,e,-.75),this.drawables.push(this.background1),this.drawables.push(this.background2),this.drawables.push(this.background),this.updatables.push(this.background1),this.updatables.push(this.background2)},update:function(t){this._super(t)}}),A=P.extend({createSprites:function(){this.blurBackground=new L(i.util.GameImages.McChapterDevBlur),this.rays1=new D(i.util.GameImages.McPlanetDevBackRays,.2,1,3.5),this.rays1.transform.setPosition(22,-52),this.alphaItems.push(this.rays1),this.updatables.push(this.rays1),this.drawables.push(this.rays1),this.sign=new R(i.util.GameImages.McPlanetDevSign,0,Math.PI),this.sign.transform.setPosition(5,-85),this.drawables.push(this.sign),this.createSnot(new n(-63,-63),-55,1),this.backLight=new D(i.util.GameImages.McPlanetDevBackLight,.5,.9,4),this.updatables.push(this.backLight),this.drawables.push(this.backLight),this.codeEmitter=new N,this.codeEmitter.addParticles(8),this.alphaItems.push(this.codeEmitter),this.updatables.push(this.codeEmitter),this.drawables.push(this.codeEmitter),this.background=new L(i.util.GameImages.McPlanetDevBackground),this.drawables.push(this.background),this.rays2=new D(i.util.GameImages.McPlanetDevUpperRightRays,.7,1,.5),this.rays2.transform.setPosition(45,-47),this.alphaItems.push(this.rays2),this.updatables.push(this.rays2),this.drawables.push(this.rays2),this.rays3=new D(i.util.GameImages.McPlanetDevLowerRightRays,0,1,2.5),this.rays3.transform.setPosition(10,-25),this.alphaItems.push(this.rays3),this.updatables.push(this.rays3),this.drawables.push(this.rays3),this.rays4=new D(i.util.GameImages.McPlanetDevUpperLeftRays,.5,1,1),this.rays4.transform.setPosition(-56,-32),this.alphaItems.push(this.rays4),this.updatables.push(this.rays4),this.drawables.push(this.rays4),this.foreground=new L(i.util.GameImages.McPlanetDevForeground),this.foreground.transform.setPosition(33,60),this.drawables.push(this.foreground)},setDepth:function(t){this._super(t),this.sign.setOpen(t>.9)},createSnot:function(t,e,s){var n=new Z(36);n.transform.setPosition(t.x,t.y),n.transform.rotation=i.util.Maths.toRadians(e),n.transform.setScale(s,s),this.depthDependents.push(n),this.updatables.push(n),this.drawables.push(n)},onTouch:function(){i.util.logEvent("http://view.atdmt.com/action/SMG_MRTINX_SITE_CJ_BHS"),i.util.logEvent("http://ace.adoftheyear.com/p13100/tagger_v02.php?project=p13100&tag=1a&channel=[sid=US_ContreJour_Tag_2_1b|cid=1002|]"),i.util.logMeteorEvent("hp_5_behindscenes"),i.util.soundController.playSoundEffect(i.util.GameSounds.effects.click,80),window.open(i.util.localizedStringLoader.getLocalizedString("BEHIND_THE_SCENES_LINK")),window.focus()}}),L=e.extend({init:function(t){this.image=new i.util.Bitmap(t),this.transform=new i.util.Transform,this.alpha=1,this.fadeAlpha=1,this.visible=!0},update:function(t){},draw:function(t){this.visible&&(this.image.alpha=this.alpha*this.fadeAlpha,this.image.draw(t,this.transform))},setOpacity:function(t){this.alpha=t},setPosition:function(t,e){this.transform.setPosition(t,e)},setScale:function(t,e){this.transform.setScale(t,e)},setRotation:function(t){this.transform.rotation=t},setVisible:function(t){this.visible=t}}),D=L.extend({init:function(t,e,i,s){this._super(t),this.fadeAlpha=e,this.fadeTime=0,this.fadeFrom=e,this.fadeTo=i,this.maxTime=s},update:function(t){if(this.fadeTime+=t.delta,this.fadeTime>=this.maxTime){this.fadeTime=0;var e=this.fadeTo;this.fadeTo=this.fadeFrom,this.fadeFrom=e}
this.fadeAlpha=i.util.Maths.lerp(this.fadeFrom,this.fadeTo,this.fadeTime/this.maxTime)}}),G=L.extend({init:function(t,e,i){this._super(t),this.transform=e,this.speed=i},update:function(t){this.transform.rotation+=this.speed*t.delta}}),V=G.extend({init:function(t,e,s,n,a){this._super(t,e,s),this.changer=new i.elem.CosChanger(0,0),this.changer.minValue=-n,this.changer.maxvalue=n,this.changer.step=.2,this.changer.progress=a,this.initialX=this.transform.position.x,this.scale=1},update:function(t){this._super(t),this.changer.update(t.delta),this.transform.position.x=this.initialX+this.changer.value}}),_=L.extend({init:function(t,e){this._super(t),this.changer=new i.elem.CosChanger(.06,.1),this.changer.minValue=.95,this.changer.maxValue=1.04,this.initialScale=e.scale.x,this.transform=e,this.maxBounceEvent=new i.util.EventSender},update:function(t){this.changer.update(t.delta),this.transform.scale.x=this.changer.value*this.initialScale,this.transform.scale.y=(2-this.changer.value)*this.initialScale,this.changer.isMax()&&this.maxBounceEvent.sendEvent(this)}}),R=L.extend({init:function(t,e,i){this._super(t),this.ignoreParentVisibility=!0,this.open=!1,this.transform.rotation=i,this.transform.setScale(0,0),this.rotateFrom=e,this.rotateTo=i},setOpen:function(t){if(this.open!==t){var e=this;this.onOpen(t),this.open=t;var s=this.open?1:0,n=this.open?this.rotateFrom:this.rotateTo,a=this.transform.scale.x,o=this.transform.rotation;i.util.newStepAction(i.util.ScheduleContext.ALL,null,function(t,r){var h=1-r/t,l=i.util.Maths.lerp(a,s,h),d=i.util.Maths.lerp(o,n,h);e.transform.setScale(l,l),e.transform.rotation=d},w)}},onOpen:function(t){},draw:function(t){this.visible&&(t.save(),this.image.alpha=this.alpha,i.util.Maths.transformContext(t,this.transform),this.image.drawNoTransform(t,0,0,0,1,1),t.restore())}}),O=R.extend({init:function(t,e){this._super(e?i.util.GameImages.McPlanetTabloBlue:i.util.GameImages.McPlanetTablo,0,-i.util.Maths.PI2()),this.energyIcon=new L(i.util.GameImages.McEnergyIcon),this.energyIcon.transform.setPosition(100,-46),this.starsLabel=new i.util.MultilineLabel(i.util.ReadUserData().starsToUnlock(t).toString(),16,16),this.starsLabel.transform.setPosition(60,-38),this.starsLabel.color=e?"rgb(66, 97, 123)":"rgb(150,150,150)",this.lockIcon=new L(e?i.util.GameImages.McLockIconBlue:i.util.GameImages.McLockIcon),this.lockIcon.transform.setPosition(24,-46)},draw:function(t){this.visible&&(t.save(),this.image.alpha=this.alpha,i.util.Maths.transformContext(t,this.transform),this.image.drawNoTransform(t,0,0,0,1,1),this.energyIcon.draw(t),this.starsLabel.draw(t),this.lockIcon.draw(t),t.restore())}}),F=R.extend({init:function(){this._super(i.util.GameImages.McIeLockedSign,0,-Math.PI),this.text=new i.util.MultilineLabel(i.util.localizedStringLoader.getLocalizedString("WORLD_PICKER_MULTI_TOUCH"),i.util.localizedStringLoader.getFontSize(11),22),this.text.color="rgb(150,150,150)",this.text.transform.setPosition(-70,80)},draw:function(t){this.visible&&(t.save(),this.image.alpha=this.alpha,i.util.Maths.transformContext(t,this.transform),this.image.drawNoTransform(t,0,0,0,1,1),this.text.draw(t),t.restore())},onOpen:function(t){var e=0;t&&(e=1),i.util.newFadeAction(i.util.ScheduleContext.ALL,this.text,.2,e)}}),U=i.elem.ParticleSystem.extend({init:function(t,e,i,s){this._super(t,e,i,s)},draw:function(t){for(var e=null,i=0;i<this.particles.length;i++)e=this.particles[i],this.particleImage.alpha=e.opacity*this.alpha,this.particleImage.frame=e.frame,this.particleImage.draw(t,e.transform)}}),N=i.elem.GravityParticleSystem.extend({init:function(){this._super(null,null,i.util.GameImages.McPlanetDevParticles,null),this.speed=new i.elem.Range(30,5),this.angle=new i.elem.Range(i.util.Maths.toRadians(125),i.util.Maths.toRadians(15)),this.particleScale=new i.elem.Range(.6,.2),this.startOpacity=new i.elem.Range(.8,.2),this.alphaDiff=14e-5},updateParticleTime:function(t,e){this._super(t,e),t.opacity-=this.alphaDiff*t.speedX,t.opacity<=0&&this.initParticle(t)},draw:function(t){for(var e=null,i=0;i<this.particles.length;i++)e=this.particles[i],this.particleImage.alpha=e.opacity*this.alpha,this.particleImage.frame=e.frame,this.particleImage.draw(t,e.transform)},initParticle:function(t){this._super(t),t.setPosition(10,-25),t.setRotation(Math.atan2(t.speedY,t.speedX))}}),H=i.elem.GravityParticleSystem.extend({init:function(t,e,s,a){this._super(null,null,t,null),this.speed=new i.elem.Range(25,8),this.angle=new i.elem.Range(-Math.PI/2,0),this.particleScale=new i.elem.Range(.6,.3),this.startOpacity=new i.elem.Range(0,0),this.amplitude=a,this.alphaDiffIn=.04,this.alphaDiffOut=.02,this.minPoint=e.Copy(),this.maxPoint=s.Copy(),this.directionVec=i.util.Box2dUtil.rotate90(i.util.Box2dUtil.b2Vec2Subtract(this.maxPoint,this.minPoint)).Copy(),this.directionVec.Normalize(),this.lerpVec=new n,this.offsetVec=new n},updateParticleTime:function(t,e){this._super(t,e),t.isFadingIn?t.opacity+=this.alphaDiffIn*t.getScaleX():t.opacity-=this.alphaDiffOut*t.getScaleX(),t.opacity>.784&&(t.isFadingIn=!1),t.opacity<=0&&this.initParticle(t)},initParticle:function(t){this._super(t);var e=Math.random();i.util.Box2dUtil.b2Vec2Lerp(this.minPoint,this.maxPoint,e,this.lerpVec);var s=Math.cos(Math.PI*(e-.5))*this.amplitude;i.util.Box2dUtil.b2Vec2Copy(this.directionVec,this.offsetVec),this.offsetVec.Multiply(s),t.setPosition(this.lerpVec.x+this.offsetVec.x,this.lerpVec.y+this.offsetVec.y),t.isFadingIn=!0},draw:function(t){for(var e=null,i=0;i<this.particles.length;i++)e=this.particles[i],this.particleImage.alpha=e.opacity*this.alpha,this.particleImage.frame=e.frame,this.particleImage.draw(t,e.transform)}}),z=i.elem.WhiteSmoke.extend({init:function(){this._super(null,null)},draw:function(t){for(var e=null,i=0;i<this.particles.length;i++)e=this.particles[i],this.particleImage.alpha=e.opacity*this.alpha,this.particleImage.frame=e.frame,this.particleImage.draw(t,e.transform)}}),W=i.elem.Explosion.extend({init:function(t,e){this._super(null,t,e)},draw:function(t){for(var e=null,i=0;i<this.particles.length;i++)e=this.particles[i],this.particleImage.alpha=e.opacity*this.alpha,this.particleImage.frame=e.frame,this.particleImage.draw(t,e.transform)}}),j=e.extend({init:function(t,e,s,n){this.transform=new i.util.Transform,this.transform.setPosition(t.x,t.y),this.system=new U(null,null,e,null),this.parts=[],this.alpha=1;for(var a,o=0;5>o;o++)a=this.system.addParticle(t),this.parts.push(new i.elem.EnergyPart(this,a,null,t,2*Math.PI/5*o)),this.parts[o].angleStep=i.util.Maths.randRange(s,n);this.system.setParticleScale(.55,.55)},update:function(t){for(var e=0;e<this.parts.length;e++)this.parts[e].update(t)},draw:function(t){this.system.setOpacity(this.alpha),this.system.draw(t)},setOpacity:function(t){this.alpha=t}}),X=e.extend({init:function(t){this.transform=new i.util.Transform,this.satellite=new L(i.util.GameImages.McSatellite),this.changer=new i.elem.CosChanger(.06,.065),this.changer.minValue=-d,this.changer.maxValue=d,this.parentOpacity=0},update:function(t){this.changer.update(t.delta),this.satellite.transform.setPosition(this.changer.value,0);var e=this.changer.getValue(.5,1,this.changer.progress-Math.PI/2);this.satellite.transform.setScale(e,e),this.satellite.alpha=this.parentOpacity*e,this.transform.rotation+=i.util.Maths.toRadians(t.delta*f)},draw:function(t){t.save(),i.util.Maths.transformContext(t,this.transform),this.satellite.draw(t),t.restore()},setOpacity:function(t){this.parentOpacity=t}}),Y=i.elem.MonsterEye.extend({init:function(t,e){this._super(null,null,t?t:i.util.GameImages.McPlanet1EyeBall,e?e:i.util.GameImages.McPlanet1Eye),this.transform.setPosition(10,10),this.transform.setScale(.9,.9),this.visible=!0,this.maxAngle=Math.PI/12,this.speed=new n,this.currentStep=new n,this.RADIUS=25,this.eyeOffset=.4,this.STEP=.5,this.MIN_TIMEOUT=3,this.MAX_TIMEOUT=10,this.providerMinTime=3,this.providerMaxTime=8,this.scheduleRandomAnimation()},update:function(t){this._super(t),i.util.Box2dUtil.b2Vec2Copy(this.speed,this.currentStep),this.currentStep.Multiply(t.delta),this.targetOffset.Add(this.currentStep)},draw:function(t){this.visible&&(this.shiftedEyeTransform.setPosition(this.transform.position.x+this.oldTargetOffset.x*this.eyeOffset,this.transform.position.y+this.oldTargetOffset.y*this.eyeOffset),this.shiftedEyeTransform.setScale(this.transform.scale.x,this.transform.scale.y),this.eyeAnimations.animationPlaying()?this.eyeAnimations.draw(t,this.shiftedEyeTransform):this.backEye.draw(t,this.shiftedEyeTransform),this.shiftedEyeTransform.setPosition(this.transform.position.x+this.oldTargetOffset.x,this.transform.position.y+this.oldTargetOffset.y),this.shiftedEyeTransform.setScale(this.transform.scale.x,this.transform.scale.y),this.eyeBallAnimations.animationPlaying()?this.eyeBallAnimations.draw(t,this.shiftedEyeTransform):this.eyeBall.draw(t,this.shiftedEyeTransform))},setAnimations:function(){this.addEyeAnimation(i.util.GameImages.McPlanet1EyeBlink,"blink",!0,!1,!1),this.addEyeAnimation(i.util.GameImages.McPlanet1EyeBlinkOneTime,"blinkonce",!0,!1,!1)},changePositionProvider:function(){this._super();var t=i.util.Maths.randRange(-10,10),e=i.util.Maths.randRange(-this.maxAngle,this.maxAngle)-Math.PI/4;i.util.Box2dUtil.toVec(t,e,this.targetOffset);var t=2*Math.random(),e=e;i.util.Box2dUtil.toVec(t,e,this.speed),this.positionProvider=this},providePosition:function(){return i.util.Box2dUtil.b2Vec2Add(this.transform.position,this.targetOffset)}}),J=Y.extend({init:function(){this._super(i.util.GameImages.McMenuMonsterEyeBall,i.util.GameImages.McMenuMonsterEye),this.transform.setPosition(0,0),this.transform.setScale(1,1),this.providerMinTime=2,this.providerMaxTime=4,this.maxAngle=Math.PI,this.RADIUS=7},setAnimations:function(){this.addEyeAnimation(i.util.GameImages.McEyeBlinkMonster,"blink",!0,!1,!1),this.addEyeAnimation(i.util.GameImages.McEyeBlinkOneTimeMonster,"blinkonce",!0,!1,!1)}}),K=Y.extend({init:function(){this._super(i.util.GameImages.McDevSnotEyeBall,i.util.GameImages.McDevSnotEye),this.transform.setPosition(0,0),this.transform.setScale(1,1),this.providerMinTime=2,this.providerMaxTime=4,this.maxAngle=Math.PI,this.RADIUS=7},setAnimations:function(){this.addEyeAnimation(i.util.GameImages.McDevSnotEyeBlink,"blink",!0,!1,!1),this.addEyeAnimation(i.util.GameImages.McDevSnotEyeBlinkOneTime,"blinkonce",!0,!1,!1)},changePositionProvider:function(){this._super();var t=i.util.Maths.randRange(-10,10),e=i.util.Maths.randRange(-this.maxAngle,this.maxAngle)-Math.PI/4;i.util.Box2dUtil.toVec(t,e,this.targetOffset);var t=2*Math.random(),e=e;i.util.Box2dUtil.toVec(t,e,this.speed),this.positionProvider=this}}),q=e.extend({init:function(){this.distanceMult=40,this.endInit=new n(0,-80),this.middleInit=new n(0,-30),this.middle=this.middleInit.Copy(),this.end=this.endInit.Copy(),this.drawPoints=[];for(var t=0;3>t;t++)this.drawPoints.push(new i.util.DrawUtil.PointsPair);this.transform=new i.util.Transform,this.depth=0,this.head=new L(i.util.GameImages.McPlanetSnotStart),this.eye=new J,this.endOffset=new n,this.targetEnd=new n,this.setDepthPoints()},update:function(t){this.setDepthPoints(),this.head.transform.setPosition(this.end.x,this.end.y),this.eye.transform.setPosition(this.end.x,this.end.y),this.eye.update(t),this.calculateDrawPoints()},draw:function(t){t.save(),i.util.Maths.transformContext(t,this.transform),i.util.DrawUtil.drawBezier(t,this.drawPoints,"black"),this.head.draw(t),this.eye.draw(t),t.restore()},setDepthPoints:function(){if(i.util.Maths.fuzzyEqual(1,this.depth)){i.util.Box2dUtil.toVec(this.eye.viewDistance*this.distanceMult,this.eye.viewAngle,this.endOffset),i.util.Box2dUtil.b2Vec2AddRef(this.endInit,this.endOffset,this.targetEnd);var t=i.util.Box2dUtil.b2Vec2Distance(this.targetEnd,this.end);i.util.Box2dUtil.stepToVec(this.middle,this.middleInit,1,this.middle),i.util.Box2dUtil.stepToVec(this.end,this.targetEnd,Math.min(1,t/5),this.end)}else this.depth>.6?(i.util.Box2dUtil.b2Vec2Copy(q.lowDepthEndPoint,this.targetEnd),i.util.Box2dUtil.stepToVec(this.middle,q.lowDepthMiddlePoint,10,this.middle),i.util.Box2dUtil.stepToVec(this.end,this.targetEnd,10,this.end)):(i.util.Box2dUtil.b2Vec2Copy(q.lowDepthMiddlePoint,this.middle),i.util.Box2dUtil.b2Vec2Copy(q.lowDepthEndPoint,this.targetEnd),i.util.Box2dUtil.b2Vec2Copy(this.targetEnd,this.end))},calculateDrawPoints:function(){i.util.DrawUtil.getPointsPair(this.drawPoints[0],S,S,this.middle,13),i.util.DrawUtil.getPointsPair(this.drawPoints[1],this.middle,S,this.middle,6.5),i.util.DrawUtil.getPointsPair(this.drawPoints[2],this.end,this.middle,this.end,26)}});q.lowDepthMiddlePoint=new n(-5,5),q.lowDepthEndPoint=new n(-10,10);var Z=q.extend({init:function(t){this._super(t),this.distanceMult=20,this.endInit=new n(0,-55),this.middleInit=new n(0,-25),this.middle=this.middleInit.Copy(),this.end=this.endInit.Copy(),this.targetEnd=this.end.Copy(),this.head=new L(i.util.GameImages.McPlanetDevSnotStart),this.eye=new K,this.eye.transform.setScale(1.2,1.2),this.head.transform.setScale(.6,.6),this.setDepthPoints(),this.calculateDrawPoints(),this.color=new i.util.Color(0,102,131,1),this.color=this.color.toString()},calculateDrawPoints:function(){i.util.DrawUtil.getPointsPair(this.drawPoints[0],S,S,this.middle,24),i.util.DrawUtil.getPointsPair(this.drawPoints[1],this.middle,S,this.middle,12),i.util.DrawUtil.getPointsPair(this.drawPoints[2],this.end,this.middle,this.end,36)},draw:function(t){t.save(),i.util.Maths.transformContext(t,this.transform),i.util.DrawUtil.drawBezier(t,this.drawPoints,this.color),this.head.draw(t),this.eye.draw(t),t.restore()}}),Q=e.extend({init:function(){this.width=1300,this.visible=!0,this.alpha=1,this.transform=new i.util.Transform,this.currentIndex=0,this.names=[],this.names.push(this.createChapterTitle("CHAPTER1","rgba(228,228,228,1)")),this.names.push(this.createChapterTitle("CHAPTER2","rgba(132,215,255,1)")),this.names.push(this.createChapterTitle("CHAPTER4","rgba(216,216,216,1)")),this.names.push(this.createChapterTitle("CHAPTER5","rgba(135,216,253,1)")),this.names.push(this.createChapterTitle("CHAPTER3","rgba(135,216,253,1)")),this.names.push(this.createChapterTitle("BEHIND_SCENES","rgb(132, 215, 255)"))},createChapterTitle:function(t,e){var s=i.util.localizedStringLoader.getLocalizedString("FONT_CHAPTER")||"handofsean",n=new i.util.MultilineLabel(i.util.localizedStringLoader.getLocalizedString(t),30,45,s);return n.color=e,n.shadowColor="rgba(0, 0, 0, .75)",n.shadow=!0,n.bold=!1,n.firstLineScale=.7,n},setIndex:function(t){for(var e=this.names.length,s=0;e>s;s++)this.names[s].visible=!1;this.currentIndex=t;var n=this.currentIndex%e;0>n&&(n+=e);var a=Math.floor(n),o=(a+1)%e,r=this.currentIndex%1;0>r&&(r+=1);var h=this.names[(o+1)%e];h.visible=!1;var l=this.names[a],d=this.names[o];l&&(l.transform.setPosition(-r*this.width,0),l.visible=!0),d&&(d.transform.setPosition((1-r)*this.width,0),d.visible=!i.util.Maths.fuzzyEqual(r,0))},draw:function(t){if(this.visible){t.save(),i.util.Maths.transformContext(t,this.transform);for(var e=0;e<this.names.length;e++)this.names[e].alpha=this.alpha,this.names[e].draw(t);t.restore()}}}),tt=e.extend({init:function(){this.radius=20,this.enabled=!0,this.clickEvent=new i.util.EventSender,this.startPositions=[],this.touchCount=0,this.touchPosition=new n},startTouch:function(t){this.startPositions[t.id]=new n(t.x,t.y),this.touchCount++},moveTouch:function(t){this.startPositions[t.id]&&this.isOutStartPosition(t)&&this.removeTouch(t)},endTouch:function(t){this.startPositions[t.id]&&(this.isEnabled()&&this.clickEvent.sendEvent(),this.removeTouch(t))},removeTouch:function(t){delete this.startPositions[t.id],this.touchCount--},isOutStartPosition:function(t){return this.touchPosition.x=t.x,this.touchPosition.y=t.y,i.util.Box2dUtil.b2Vec2Distance(this.touchPosition,this.startPositions[t.id])>this.radius},isEnabled:function(){return this.enabled}}),et=tt.extend({init:function(t,e){this._super(),this.target=t,this.clickRadius=e},startTouch:function(t){this.spriteContainsPoint(t)&&this._super(t)},spriteContainsPoint:function(t){this.touchPosition.x=t.x,this.touchPosition.y=t.y;var e=i.util.Box2dUtil.b2Vec2Distance(this.touchPosition,this.target.transform.position);return e<this.clickRadius},isOutStartPosition:function(t){var e=!this.spriteContainsPoint(t);return this.disableDrag&&(e|=this._super(t)),e}}),it=e.extend({init:function(t,e){this.clickEvent=new i.util.EventSender,this.listeners=[];for(var s,n=0;n<t.length;n++)s=new et(t[n],e),s.radius=30,s.disableDrag=!0,s.enabled=!1,this.listeners.push(s)},startTouch:function(t){for(var e,i=0,s=0;s<this.listeners.length;s++)e=this.listeners[s],e.startTouch(t),e.touchCount>0&&i++;i>=this.listeners.length&&this.clickEvent.sendEvent()},moveTouch:function(t){for(var e=0;e<this.listeners.length;e++)this.listeners[e].moveTouch(t)},endTouch:function(t){for(var e=0;e<this.listeners.length;e++)this.listeners[e].endTouch(t)}});i.ctrl.WorldPicker=s,i.elem.Sprite=L,i.constants.IE_WORLD_INDEX=M}(Box2D,Class,cj),function(t,e,i,s,n){function a(t){this.myTweenable=void 0,this.game=t,this.ctx={foreground:this.game.fakeHeroCtx},this.fadeOut=e.getElementById("levelCompleteFade"),this.container=e.getElementById("levelCompleteContainer"),this.back=e.getElementById("levelComplete"),this.levelTitle=e.getElementById("levelTitle"),this.lightsBonus=e.getElementById("lightsBonus"),this.timeBonus=e.getElementById("timeBonus"),this.lineBreak=e.getElementById("lineBreak"),this.levelTotal=e.getElementById("levelTotal"),this.energyContainer=e.getElementById("energiesContainer"),this.energies=this.energyContainer.children,this.fakeHero=void 0,this.hasTransitions=!0,this.isVisible=!1,this.letterBox=new n.ctrl.LetterBox(t),i.csstransitions||(this.hasTransitions=!1,this.myTweenable=new s),this.init()}
a.prototype.init=function(){this.completeMessage=e.getElementById("levelCompleteMessage"),this.restartBtnDOM=e.getElementById("completeRestartButton"),this.menuBtnDOM=e.getElementById("completeMenuButton"),this.skipBtnDOM=e.getElementById("completeSkipButton"),this.levelRestartBtn=new n.ctrl.GameButton(this.restartBtnDOM,!0,!1,!0),this.levelMenuBtn=new n.ctrl.GameButton(this.menuBtnDOM,!0,!1,!0),this.levelSkipBtn=new n.ctrl.GameButton(this.skipBtnDOM,!0,!1,!0),this.levelSkipBtn.fadeInTargetScale=1.2,n.util.set2dScale(this.restartBtnDOM,.5,.5),n.util.set2dScale(this.menuBtnDOM,.5,.5),n.util.set2dScale(this.skipBtnDOM,.5,.5),n.util.localizedStringLoader.isEnglish()||(this.lightsBonus.className=this.lightsBonus.className.replace("mediumText","smallText"),this.timeBonus.className=this.timeBonus.className.replace("mediumText","smallText")),this.resetScores(),this.levelRestartBtn.setVisible(!1),this.levelMenuBtn.setVisible(!1),this.levelSkipBtn.setVisible(!1),n.util.addClass(this.timeBonus,"hidden");for(var t=0;t<this.energies.length;t++){var i=this.energies[t];n.util.set2dScale(i,.5,.5),i.style.opacity=0}},a.prototype.resetFakeHero=function(){this.fakeHero=null,this.fakeHero=new n.elem.FakeHero(this.game.world)},a.prototype.startPortalEntrance=function(t,e){var i=this,s=n.util.ReadUserData(),a=s.worlds[this.game.currentWorld].levels[this.game.currentLevel-1],o=a.score>0&&(a.score<e||a.stars<t);n.util.newDelayAction(n.util.ScheduleContext.LEVEL,function(){i.fakeHero.showPortal(t,o)},.5)},a.prototype.setCompleteMessage=function(t){this.completeMessage.innerHTML=n.util.localizedStringLoader.getLocalizedString("COMPLETE_TEXT_"+t)},a.prototype.show=function(t,e,i,a,o){var r=this;if(n.util.dispatcher.register(this),this.isVisible=!0,this.levelRestartBtn.addEventHandlers(),this.levelMenuBtn.addEventHandlers(),this.levelSkipBtn.addEventHandlers(),this.startPortalEntrance(o,i+a),this.setCompleteMessage(o),this.letterBox.show(),this.hasTransitions)
if(this.container.style.visibility="visible",n.util.setTransitionDuration(this.container,500),n.util.setTransitionDelay(this.container,50),this.container.style.backgroundColor="rgba(255,255,255,0.3)",this.showBack(this.back),this.levelRestartBtn.fadeIn(600),this.levelMenuBtn.fadeIn(700),this.levelSkipBtn.fadeIn(800),this.levelTitle.innerHTML=n.util.localizedStringLoader.getFormatedLocalizedString("LEVEL",[t,e]),this.fadeInEnergy(this.energies[0],600),this.fadeInEnergy(this.energies[1],700),this.fadeInEnergy(this.energies[2],800),0==o)this.showScores(e,i,a,500);else{for(var h=0;o>h;h++){var l=this.energies[h];n.util.removeClass(l,"energyInactive"),n.util.addClass(l,"pulse"),l.style.animationDelay=500*h+1e3+"ms",l.style.WebkitAnimationDelay=500*h+1e3+"ms",l.style.msAnimationDelay=500*h+1e3+"ms",l.style.MozAnimationDelay=500*h+1e3+"ms"}
this.showScores(e,i,a,500)}
else this.container.style.opacity=0,this.container.style.backgroundColor="rgba(255,255,255,0.3)",this.container.style.visibility="visible",this.levelTitle.innerHTML=n.util.localizedStringLoader.getFormatedLocalizedString("LEVEL",[t,e]),this.myTweenable.tween({from:{opacity:0},to:{opacity:1},duration:550,step:function(){r.container.style.opacity=this.opacity},easing:"easeOutSine",callback:function(){r.container.style.opacity=1,r.levelRestartBtn.fadeIn(600),r.levelMenuBtn.fadeIn(700),r.levelSkipBtn.fadeIn(800);for(var t=0;o>t;t++){var h=r.energies[t];n.util.removeClass(h,"energyInactive"),r.pulseEnergy(h,500*t+1e3)}
r.fadeInEnergy(r.energies[0],600),r.fadeInEnergy(r.energies[1],700),r.fadeInEnergy(r.energies[2],800),r.showScores(e,i,a,500);var l=new s;l.tween({from:{opacity:0,scale:.8},to:{opacity:1,scale:1},duration:250,step:function(){r.back.style.opacity=this.opacity,n.util.set2dScale(r.back,this.scale,this.scale)},easing:"easeOutSine"})}})},a.prototype.showScores=function(t,e,i,a){var o=this;if(this.hasTransitions)this.fadeInElement(this.levelTitle,300,0+a),this.fadeInElement(this.lightsBonus,300,300+a),this.fadeInElement(this.timeBonus,300,1e3+a),this.fadeInElement(this.levelTotal,300,1500+a),n.util.setTransitionDelay(this.lineBreak,a+1200),n.util.setTransitionDuration(this.lineBreak,300),this.lineBreak.style.width="157px",this.animateLabel(this.lightsBonus,"ENERGY_BONUS",e,300+a),this.animateLabel(this.timeBonus,"TIME_BONUS",i,1e3+a),this.animateLabel(this.levelTotal,"TOTAL",e+i,1500+a);else{this.fadeInText(this.levelTitle,a),this.fadeInText(this.lightsBonus,300+a),this.fadeInText(this.timeBonus,1e3+a),this.fadeInText(this.levelTotal,1500+a),this.animateLabel(this.lightsBonus,"ENERGY_BONUS",e,300+a),this.animateLabel(this.timeBonus,"TIME_BONUS",i,1e3+a),this.animateLabel(this.levelTotal,"TOTAL",e+i,1500+a);var r=setTimeout(function(){clearTimeout(r);var t=new s;t.tween({from:{width:0},to:{width:157},duration:300,step:function(){o.lineBreak.style.width=this.width+"px"},easing:"easeOutSine"})},a+1200)}},a.prototype.hide=function(){var t=this;if(this.fadeOut.style.visibility="visible",n.util.dispatcher.deregister(this),this.isVisible=!1,this.levelRestartBtn.removeEventHandlers(),this.levelMenuBtn.removeEventHandlers(),this.levelSkipBtn.removeEventHandlers(),this.hasTransitions)this.fadeOut.style.opacity=1;else{var e=new s;e.tween({from:{opacity:0},to:{opacity:1},duration:500,step:function(){t.fadeOut.style.opacity=this.opacity},easing:"easeOutSine"})}
var i=setTimeout(function(){clearTimeout(i),t.reset()},500)},a.prototype.update=function(t){var e=this.ctx.foreground;e.clearRect(0,0,e.canvas.width,e.canvas.height),this.fakeHero&&(this.fakeHero.update(t),this.fakeHero.draw(this.ctx))},a.prototype.reset=function(){this.fadeOut.style.visibility="hidden",this.fadeOut.style.opacity=0,this.resetBack(this.back),this.resetContainer(),this.letterBox.reset(),this.levelRestartBtn.fadeOut(0),this.levelMenuBtn.fadeOut(0),this.levelSkipBtn.fadeOut(0),n.util.setTransitionDuration(this.lineBreak,0),n.util.setTransitionDelay(this.lineBreak,0),this.lineBreak.style.width="0px";for(var t=0;t<this.energies.length;t++)this.resetEnergy(this.energies[t]);n.util.set2dScale(this.restartBtnDOM,.5,.5),n.util.set2dScale(this.menuBtnDOM,.5,.5),n.util.set2dScale(this.skipBtnDOM,.5,.5),this.resetScores(),this.fadeOutElement(this.levelTitle),this.fadeOutElement(this.lightsBonus),this.fadeOutElement(this.timeBonus),this.fadeOutElement(this.levelTotal)},a.prototype.resetScores=function(){this.levelTitle.innerHTML=n.util.localizedStringLoader.getFormatedLocalizedString("LEVEL",[0,0]),this.lightsBonus.innerHTML=n.util.localizedStringLoader.getFormatedLocalizedString("ENERGY_BONUS",[0]),this.timeBonus.innerHTML=n.util.localizedStringLoader.getFormatedLocalizedString("TIME_BONUS",[0]),this.levelTotal.innerHTML=n.util.localizedStringLoader.getFormatedLocalizedString("TOTAL",[0])},a.prototype.fadeInEnergy=function(t,e){if(this.hasTransitions)t.style.transitionProperty="transform, opacity",t.style.transitionTimingFunction="cubic-bezier(0.175, 0.885, 0.320, 1), ease-out",t.style.transitionDuration="300ms, 300ms",t.style.transitionDelay=e+"ms,"+e+"ms",t.style.msTransitionProperty="-ms-transform, opacity",t.style.msTransitionTimingFunction="cubic-bezier(0.175, 0.885, 0.320, 1), ease-out",t.style.msTransitionDuration="300ms, 300ms",t.style.msTransitionDelay=e+"ms,"+e+"ms",t.style.MozTransitionProperty="-moz-transform, opacity",t.style.MozTransitionTimingFunction="cubic-bezier(0.175, 0.885, 0.320, 1), ease-out",t.style.MozTransitionDuration="300ms, 300ms",t.style.MozTransitionDelay=e+"ms,"+e+"ms",t.style.WebkitTransitionProperty="-webkit-transform, opacity",t.style.WebkitTransitionTimingFunction="cubic-bezier(0.175, 0.885, 0.320, 1), ease-out",t.style.WebkitTransitionDuration="300ms, 300ms",t.style.WebkitTransitionDelay=e+"ms,"+e+"ms",t.style.oTransitionProperty="-o-transform, opacity",t.style.oTransitionTimingFunction="cubic-bezier(0.175, 0.885, 0.320, 1), ease-out",t.style.oTransitionDuration="300ms, 300ms",t.style.oTransitionDelay=e+"ms,"+e+"ms",n.util.set2dScale(t,1,1),t.style.opacity=1;else{t.style.opacity=0,n.util.set2dScale(t,.5,.5);var i=setTimeout(function(){clearTimeout(i);var e=new s;e.tween({from:{opacity:0,scale:.5},to:{opacity:1,scale:1},duration:300,step:function(){t.style.opacity=this.opacity,n.util.set2dScale(t,this.scale,this.scale)},easing:"easeOutSine"})},e)}},a.prototype.pulseEnergy=function(t,e){var i=setTimeout(function(){clearTimeout(i);var e=new s;e.tween({from:{scale:1},to:{scale:1.2},duration:250,step:function(){n.util.set2dScale(t,this.scale,this.scale)},easing:"easeInSine",callback:function(){var e=new s;e.tween({from:{scale:1.2},to:{scale:1},duration:250,step:function(){n.util.set2dScale(t,this.scale,this.scale)},easing:"easeOutSine"})}})},e)},a.prototype.fadeInText=function(t,e){var i=setTimeout(function(){clearTimeout(i),t.style.opacity=0;var e=new s;e.tween({from:{opacity:0},to:{opacity:1},duration:250,step:function(){t.style.opacity=this.opacity},easing:"easeInSine"})},e)},a.prototype.resetEnergy=function(t){var e=0,i="0ms, 0ms";t.style.transitionDuration=i,t.style.transitionDelay=e+"ms,"+e+"ms",t.style.msTransitionDuration=i,t.style.msTransitionDelay=e+"ms,"+e+"ms",t.style.MozTransitionDuration=i,t.style.MozTransitionDelay=e+"ms,"+e+"ms",t.style.WebkitTransitionDuration=i,t.style.WebkitTransitionDelay=e+"ms,"+e+"ms",t.style.oTransitionDuration=i,t.style.oTransitionDelay=e+"ms,"+e+"ms",n.util.set2dScale(t,.5,.5),t.style.opacity=0,n.util.removeClass(t,"pulse"),n.util.addClass(t,"energyInactive")},a.prototype.fadeInElement=function(t,e,i){t.style.opacity=0,n.util.setTransitionProperty(t,"opacity"),n.util.setTransitionEasingFunction(t,"ease-out"),n.util.setTransitionDuration(t,e),n.util.setTransitionDelay(t,i),t.style.opacity=1},a.prototype.fadeOutElement=function(t){n.util.setTransitionProperty(t,"opacity"),n.util.setTransitionDuration(t,0),n.util.setTransitionDelay(t,0),t.style.opacity=0},a.prototype.showBack=function(t){var e=350;t.style.transitionDuration="300ms, 300ms",t.style.transitionDelay=e+"ms,"+e+"ms",t.style.msTransitionDuration="300ms, 300ms",t.style.msTransitionDelay=e+"ms,"+e+"ms",t.style.MozTransitionDuration="300ms, 300ms",t.style.MozTransitionDelay=e+"ms,"+e+"ms",t.style.WebkitTransitionDuration="300ms, 300ms",t.style.WebkitTransitionDelay=e+"ms,"+e+"ms",t.style.oTransitionDuration="300ms, 300ms",t.style.oTransitionDelay=e+"ms,"+e+"ms",n.util.set2dScale(t,1,1),t.style.opacity=1},a.prototype.resetContainer=function(){n.util.setTransitionDuration(this.container,0),n.util.setTransitionDelay(this.container,0),this.container.style.backgroundColor="rgba(255,255,255,0.0)",this.container.style.visibility="hidden"},a.prototype.resetBack=function(t){var e="0ms, 0ms",i=0;t.style.transitionDuration=e,t.style.transitionDelay=i+"ms,"+i+"ms",t.style.msTransitionDuration=e,t.style.msTransitionDelay=i+"ms,"+i+"ms",t.style.MozTransitionDuration=e,t.style.MozTransitionDelay=i+"ms,"+i+"ms",t.style.WebkitTransitionDuration=e,t.style.WebkitTransitionDelay=i+"ms,"+i+"ms",t.style.oTransitionDuration=e,t.style.oTransitionDelay=i+"ms,"+i+"ms",n.util.set2dScale(t,.8,.8),t.style.opacity=0},a.prototype.animateLabel=function(e,i,s,a){var o=.75*s,r=0,h=t.setInterval(function(){return r++,Math.round(o)==s?void t.clearInterval(h):void(r>=a/30&&(o+=.45*(s-o),e.innerHTML=n.util.localizedStringLoader.getFormatedLocalizedString(i,[Math.round(o)])))},30)},n.ctrl.LevelComplete=a}(window,document,Modernizr,Tweenable,cj),function(t,e,i,s,n){function a(){function i(){e[h]&&r.autoPause()}
function a(){r.autoPause()}
var r=this;this.canvas=e.getElementById("surface"),this.bgCanvas=e.getElementById("bgSurface"),this.transitionCanvas=e.getElementById("transitionCanvas"),this.fakeHeroCanvas=e.getElementById("fakeHeroCanvas"),this.particleCanvas=e.getElementById("particleCanvas"),this.ctx=this.canvas.getContext("2d"),this.bgCtx=this.bgCanvas.getContext("2d"),this.transitionCtx=this.transitionCanvas.getContext("2d"),this.fakeHeroCtx=this.fakeHeroCanvas.getContext("2d"),this.particleCtx=this.particleCanvas.getContext("2d"),this.uiUpdateTime=e.getElementById("updateTime"),this.uiDrawTime=e.getElementById("drawTime"),this.uiFreezeGraphsButton=e.getElementById("freezeGraphsButton"),this.statsLastDrawn=Date.now(),this.drawStatTotal=0,this.drawStatCounter=0,this.updateStatTotal=0,this.updateStatCounter=0,this.spritesStatTotal=0,this.spritesStatCounter=0,this.fpsStatTotal=0,this.fpsStatCounter=0,this.areGraphsFrozen=!1,this.graphsFps=20,this.graphsLineColor="rgb(7, 76, 77)",this.graphsLineFillColor="rgb(17, 17, 17)",this.currentWorld=0,this.maxLevel=10,this.theme=n.util.Theme.NORMAL,this.soundtrack=void 0,this.canPause=!1,this.setCanPause(!0),this.isPaused=!1,this.canShowIntro=!0,this.windowHasFocus=!0,$("#menuPanelBG").hide(),$("#menuPanelBGBlue").show(),$("#menuPanelBG").show(),$("#menuPanelBGBlue").hide(),this.meetPetit=$("#meetPetitDiv"),this.gameWarning=$("#gameWarning"),this.ipadAppStore=$("#gameWarningAppStore"),this.ipadAppStore.click(function(){t.open("http://itunes.apple.com/us/app/contre-jour-hd/id444085845?mt=8")}),this.minimumFPSStillTesting=!0,this.minimumFPS=n.util.getQueryString("minfps",30),"string"==typeof this.minimumFPS&&(this.minimumFPS=parseInt(this.minimumFPS)),this.minimumFPSTimeLimit=1e4,this.minimumFPSTriggeredAt=0,this.showFPS=n.util.getQueryString("fps",void 0),this.fpsDiv=$("#fpsDiv"),this.fpsCounter=0,this.showFPS&&$("#vote-sxsw").hide(),t.setInterval(function(){if(0!==r.fpsCounter){if(r.showFPS&&(r.fpsDiv[0].innerHTML=r.fpsCounter+" FPS"),!r.windowHasFocus)return r.minimumFPSTriggeredAt=0,void(r.fpsCounter=0);if(r.minimumFPSStillTesting)
if(r.fpsCounter<r.minimumFPS){if(0===r.minimumFPSTriggeredAt)r.minimumFPSTriggeredAt=Date.now();else if(Date.now()-r.minimumFPSTriggeredAt>r.minimumFPSTimeLimit){if(r.minimumFPSStillTesting=!1,"Explorer"===BrowserDetect.browser&&10===BrowserDetect.version)return;"iPad"===BrowserDetect.OS?(r.meetPetit.hide(),r.gameWarning[0].innerHTML=n.util.localizedStringLoader.getLocalizedString("PERFORMANCE_WARNING_IPAD"),r.ipadAppStore.fadeIn("slow"),$("#gameFooter").addClass("app-store-warning")):(r.gameWarning[0].innerHTML=n.util.localizedStringLoader.getLocalizedString("PERFORMANCE_WARNING"),r.meetPetit.hide(),r.gameWarning.click(function(){r.gameWarning.fadeOut("slow")})),r.gameWarning.fadeIn("slow")}}else r.minimumFPSTriggeredAt=0;r.fpsCounter=0}},1e3),this.uiFreezeGraphsButton.onclick=function(){r.areGraphsFrozen=!r.areGraphsFrozen,r.areGraphsFrozen===!0?(r.uiFreezeGraphsButton.innerHTML="Start",r.drawChart.stop(),r.touchChart.stop(),r.updateChart.stop(),r.spritesChart.stop(),r.fpsChart.stop()):(r.uiFreezeGraphsButton.innerHTML="Freeze",r.drawChart.start(),r.touchChart.start(),r.updateChart.start(),r.spritesChart.start(),r.fpsChart.start())};var h,l;if("undefined"!=typeof e.hidden?(h="hidden",l="visibilitychange"):"undefined"!=typeof e.mozHidden?(h="mozHidden",l="mozvisibilitychange"):"undefined"!=typeof e.msHidden?(h="msHidden",l="msvisibilitychange"):"undefined"!=typeof e.webkitHidden&&(h="webkitHidden",l="webkitvisibilitychange"),this.autoPauseInfo=l?{element:e,event:l,listener:i}:{element:t,event:"blur",listener:a},this.areGraphsFrozen=!1,this.drawCount=0,this.lastFPS=0,this.lastUpdateTime=0,this.lastDrawTime=0,this.lastTouchCount=0,this.isStatsEnabled=n.util.getQueryString("stats","false"),"false"===this.isStatsEnabled?this.isStatsEnabled=!1:this.isStatsEnabled=!0,this.isStatsEnabled===!0){var d=e.getElementById("devStats");d.style.visibility="visible";var c={};c.fps=this.graphsFps,c.interpolation="line",c.maxValue=60,c.minValue=0,c.grid={},c.grid.strokeStyle="rgb(0, 0, 0)",c.grid.lineWidth=0,c.grid.millisPerLine=1e3,c.grid.verticalSections=0,c.labels={},c.labels.fillStyle="rgb(153, 153, 153)";var u={};u.strokeStyle=this.graphsLineColor,u.lineWidth=2,u.fillStyle=this.graphsLineFillColor,this.fpsChart=new s(c),this.fpsChart.streamTo(e.getElementById("fpsStatsCanvas")),this.fpsLine=new TimeSeries,this.fpsChart.addTimeSeries(this.fpsLine,u),this.fpsStatsValue=e.getElementById("fpsStatsValue");var m={};m.fps=this.graphsFps,m.interpolation="line",m.maxValue=7,m.minValue=0,m.grid={},m.grid.strokeStyle="rgb(0, 0, 0)",m.grid.lineWidth=0,m.grid.millisPerLine=1e3,m.grid.verticalSections=0,m.labels={},m.labels.fillStyle="rgb(153, 153, 153)";var p={};p.strokeStyle=this.graphsLineColor,p.lineWidth=2,p.fillStyle=this.graphsLineFillColor,this.touchChart=new s(m),this.touchChart.streamTo(e.getElementById("touchStatsCanvas")),this.touchLine=new TimeSeries,this.touchChart.addTimeSeries(this.touchLine,p),this.touchStatsValue=e.getElementById("touchStatsValue");var g={};g.fps=this.graphsFps,g.interpolation="line",g.maxValue=50,g.minValue=0,g.grid={},g.grid.strokeStyle="rgb(0, 0, 0)",g.grid.lineWidth=0,g.grid.millisPerLine=1e3,g.grid.verticalSections=0,g.labels={},g.labels.fillStyle="rgb(153, 153, 153)";var f={};f.strokeStyle=this.graphsLineColor,f.lineWidth=2,f.fillStyle=this.graphsLineFillColor,this.updateChart=new s(g),this.updateChart.streamTo(e.getElementById("updateStatsCanvas")),this.updateLine=new TimeSeries,this.updateChart.addTimeSeries(this.updateLine,f),this.updateStatsValue=e.getElementById("updateStatsValue");var y={};y.fps=this.graphsFps,y.interpolation="line",y.maxValue=50,y.minValue=0,y.grid={},y.grid.strokeStyle="rgb(0, 0, 0)",y.grid.lineWidth=0,y.grid.millisPerLine=1e3,y.grid.verticalSections=0,y.labels={},y.labels.fillStyle="rgb(153, 153, 153)";var v={};v.strokeStyle=this.graphsLineColor,v.lineWidth=2,v.fillStyle=this.graphsLineFillColor,this.drawChart=new s(y),this.drawChart.streamTo(e.getElementById("drawStatsCanvas")),this.drawLine=new TimeSeries,this.drawChart.addTimeSeries(this.drawLine,v),this.drawStatsValue=e.getElementById("drawStatsValue");var S={};S.fps=this.graphsFps,S.interpolation="line",S.maxValue=50,S.minValue=0,S.grid={},S.grid.strokeStyle="rgb(0, 0, 0)",S.grid.lineWidth=0,S.grid.millisPerLine=1e3,S.grid.verticalSections=0,S.labels={},S.labels.fillStyle="rgb(153, 153, 153)";var w={};w.strokeStyle=this.graphsLineColor,w.lineWidth=2,w.fillStyle=this.graphsLineFillColor,this.spritesChart=new s(S),this.spritesChart.streamTo(e.getElementById("spriteStatsCanvas")),this.spritesLine=new TimeSeries,this.spritesChart.addTimeSeries(this.spritesLine,w),this.spritesStatsValue=e.getElementById("spritesStatsValue")}
this.contexts={background:this.bgCtx,transition:this.transitionCtx,foreground:this.ctx,particle:this.particleCtx},this.touchModule=void 0,this.options={debug:!0},this.world=void 0,this.levelTransitionMgr=new n.util.LevelTransitionManager(this.transitionCtx),this.score=new n.util.Score,this.lightPoint=new o(this.ctx.canvas.width/30,0);var r;n.util.getQueryString("editor",!1)}
var o=i.Common.Math.b2Vec2;a.prototype.Start=function(){var t=this;n.util.dispatcher.start(),this.touchModule=new n.util.TouchModule(this.canvas,this),this.levelComplete=new n.ctrl.LevelComplete(this),this.lvlPicker=new n.ctrl.LevelPicker(this,e.getElementById("levelPicker")),this.menu=new n.ctrl.MenuPanel(this,e.getElementById("menu")),this.pauseBtn=new n.ctrl.GameButton(e.getElementById("gamePauseBtn"),!0,!1,!1),this.pauseBtn.setPressEvent(function(e){t.world.completed||(t.pause(),t.menu.show())}),this.skipBtn=new n.ctrl.GameButton(e.getElementById("gameSkipBtn"),!0,!1,!1,"introSkipBtn","introSkipIcon"),this.skipBtn.setPressEvent(function(e){t.restartLevel()}),n.util.addClass(this.skipBtn.getElement(),"noShow"),this.levelComplete.levelRestartBtn.setPressEvent(function(e){t.levelComplete.hide(),t.restartLevel()}),this.levelComplete.levelMenuBtn.setPressEvent(function(e){t.levelComplete.hide(),t.levelTransitionMgr.fadeOut(function(){t.loadMainMenu(!1),t.levelTransitionMgr.fadeIn()})}),this.levelComplete.levelSkipBtn.setPressEvent(function(e){t.levelComplete.hide(),t.nextLevel()});var i=e.getElementById("soundButtonDiv");this.menuSoundBtn=new n.ctrl.MainMenuSoundButton(i,"gameSoundIconNonThemed","gameSoundIconBlueNonThemed","gameSoundIconPurpleNonThemed"),this.menuSoundBtn.addEventHandlers();var s=n.util.soundController.isMutedTracks();s&&this.menuSoundBtn.forceToggle(!s);var a=function(){var e=!n.util.soundController.isMutedTracks();n.util.soundController.muteTracks(e),t.menu.btnSound.forceToggle(!e)};this.menuSoundBtn.setPressEvent(a);var o=e.getElementById("soundEffectButtonDiv");this.menuSoundEffectBtn=new n.ctrl.MainMenuSoundButton(o,"gameSoundEffectIconNonThemed","gameSoundEffectIconBlueNonThemed","gameSoundEffectIconPurpleNonThemed"),this.menuSoundEffectBtn.addEventHandlers();var r=n.util.soundController.isMutedEffects();r&&this.menuSoundEffectBtn.forceToggle(!r);var h=function(){var e=!n.util.soundController.isMutedEffects();n.util.soundController.muteEffects(e),t.menu.btnSoundEffect.forceToggle(!e)};this.menuSoundEffectBtn.setPressEvent(h);var l=e.getElementById("meetPetitDiv");this.menuPetitBtn=new n.ctrl.MeetPetitButton(l),n.util.soundController.isIPAD===!0&&(this.menuSoundBtn.element.style.display="none",this.menuSoundEffectBtn.element.style.display="none"),this.tempSoundStatus=n.util.soundController.isMutedTracks(),this.tempSoundEffectStatus=n.util.soundController.isMutedEffects(),n.util.bindVisibilityChange(function(e){n.util.isBrowserHidden()?(t.windowHasFocus=!1,t.tempSoundStatus=n.util.soundController.isMutedTracks(),t.tempSoundEffectStatus=n.util.soundController.isMutedEffects(),n.util.soundController.muteTracks(!0),n.util.soundController.muteEffects(!0)):(t.windowHasFocus=!0,n.util.soundController.muteTracks(t.tempSoundStatus),n.util.soundController.muteEffects(t.tempSoundEffectStatus))}),n.util.getQueryString("world",0),n.util.getQueryString("level",0),this.levelXml?t.loadLevelFromXml():t.loadMainMenu(!0)},a.prototype.loadMainMenu=function(t){this.setCanPause(!1),n.util.addClass(this.pauseBtn.getElement(),"noShow"),n.util.addClass(this.skipBtn.getElement(),"noShow"),this.skipBtn.removeEventHandlers(),this.pauseBtn.removeEventHandlers(),n.util.scheduler.clear(n.util.ScheduleContext.LEVEL),n.util.dispatcher.deregister(this),this.isPaused=!1,this.canShowIntro=!0,this.world?this.world.clearLevel():(this.levelTransitionMgr.setToBlack(),this.levelTransitionMgr.fadeIn()),this.world=new n.ctrl.WorldPicker(this),this.lvlPicker.toggleGround(!0),t||this.world.hasToExplode?this.world.showPlanets():this.world.showLevels(!0),n.util.dispatcher.register(this)},a.prototype.loadLevelFromXml=function(){var t=this;this.levelTransitionMgr.setToBlack(),this.levelXml&&(this.canShowIntro=!1,n.util.dispatcher.deregister(this),this.isPaused=!1,n.util.scheduler.clear(n.util.ScheduleContext.LEVEL),this.world&&this.world.clearLevel(),t.world=new n.elem.World(t.contexts,t.options,t),t.world.loadLevelXml(t.levelXml,function(){t.loadLevelComplete()}),n.util.dispatcher.register(t))},a.prototype.changeWorld=function(t){this.currentWorld=t,this.soundtrack=n.util.GameSounds.allTracks[this.currentWorld]},a.prototype.loadLevel=function(t){var e=this;if(this.isPaused=!1,this.levelTransitionMgr.setToBlack(),e.lvlPicker.toggleGround(!1),void 0!==t&&t>=0&&10>=t){n.util.scheduler.clear(n.util.ScheduleContext.LEVEL),n.util.dispatcher.deregister(this),this.world&&this.world.clearLevel(),this.isPaused=!1;var i=n.util.ReadUserData(),s=0==t?i.endLevel():i.worlds[this.currentWorld].levels[t-1];this.currentLevel=s.levelDisplayNumber,this.theme=0===t?n.util.Theme.NORMAL:i.worlds[this.currentWorld].theme,e.loadWorld(s)}},a.prototype.loadOutroScene=function(){this.loadLevel(0);var t=n.util.ReadUserData();t.lastLevelOpen||(t.lastLevelOpen=!0,n.util.WriteUserData(t))},a.prototype.loadWorld=function(t){var e=this;n.util.addClass(this.skipBtn.getElement(),"noShow"),this.skipBtn.removeEventHandlers(),n.util.soundController.playSoundTrack(169===t.levelNumber?n.util.GameSounds.allTracks[0]:e.soundtrack,1),this.world=new n.elem.World(this.contexts,this.options,this),this.world.canShowIntro=this.canShowIntro,this.world.loadLevel(t.levelNumber,function(){e.levelComplete.resetFakeHero(),e.loadLevelComplete()}),n.util.dispatcher.register(this)},a.prototype.loadLevelComplete=function(){var t=this;this.score.time=0,this.score.stars=0;var e=n.util.ReadUserData(),i=e.worlds[this.currentWorld].levels[this.currentLevel-1];i&&i.state!=n.util.LevelState.UNLOCKED&&(i.state=n.util.LevelState.UNLOCKED,n.util.WriteUserData(e)),n.util.removeClass(t.pauseBtn.getElement(),"noShow"),t.pauseBtn.addEventHandlers(),this.menu.hideImmediate(),this.levelTransitionMgr.fadeIn(function(){t.world.hero&&(t.currentWorld>0||!t.canShowIntro?t.world.hero.respawn():1!=t.currentLevel&&t.world.hero.respawn())}),this.setCanPause(!0)},a.prototype.modifyTheme=function(t){0===t||2===t||3===t||4===t?($("#menuPanelBG").show(),$("#menuPanelBGBlue").hide(),n.util.ModifyClass(".level0","background","url(../img/McLevels0-hd.png?v="+n.version+")"),n.util.ModifyClass(".level1","background","url(../img/McLevels1-hd.png?v="+n.version+")"),n.util.ModifyClass(".level2","background","url(../img/McLevels2-hd.png?v="+n.version+")"),n.util.ModifyClass(".level3","background","url(../img/McLevels3-hd.png?v="+n.version+")"),n.util.ModifyClass(".level4","background","url(../img/McLevels4-hd.png?v="+n.version+")"),n.util.ModifyClass(".level5","background","url(../img/McLevels5-hd.png?v="+n.version+")"),n.util.ModifyClass(".level6","background","url(../img/McLevels6-hd.png?v="+n.version+")"),n.util.ModifyClass(".level7","background","url(../img/McLevels7-hd.png?v="+n.version+")"),n.util.ModifyClass(".level8","background","url(../img/McLevels8-hd.png?v="+n.version+")"),n.util.ModifyClass(".level9","background","url(../img/McLevels9-hd.png?v="+n.version+")"),n.util.ModifyClass(".levelItemInactive","background","url(../img/McLevelItemInactive-hd.png?v="+n.version+")"),n.util.ModifyClass(".levelItem","background-image","url(../img/McLevelItemBackground-hd.png?v="+n.version+")")):1===t&&($("#menuPanelBG").hide(),$("#menuPanelBGBlue").show(),n.util.ModifyClass(".level0","background","url(../img/McLevels0-hd_blue.png?v="+n.version+")"),n.util.ModifyClass(".level1","background","url(../img/McLevels1-hd_blue.png?v="+n.version+")"),n.util.ModifyClass(".level2","background","url(../img/McLevels2-hd_blue.png?v="+n.version+")"),n.util.ModifyClass(".level3","background","url(../img/McLevels3-hd_blue.png?v="+n.version+")"),n.util.ModifyClass(".level4","background","url(../img/McLevels4-hd_blue.png?v="+n.version+")"),n.util.ModifyClass(".level5","background","url(../img/McLevels5-hd_blue.png?v="+n.version+")"),n.util.ModifyClass(".level6","background","url(../img/McLevels6-hd_blue.png?v="+n.version+")"),n.util.ModifyClass(".level7","background","url(../img/McLevels7-hd_blue.png?v="+n.version+")"),n.util.ModifyClass(".level8","background","url(../img/McLevels8-hd_blue.png?v="+n.version+")"),n.util.ModifyClass(".level9","background","url(../img/McLevels9-hd_blue.png?v="+n.version+")"),n.util.ModifyClass(".levelItemInactive","background","url(../img/McLevelItemInactive-hd_blue.png?v="+n.version+")"),n.util.ModifyClass(".levelItem","background-image","url(../img/McLevelItemBackground-hd_blue.png?v="+n.version+")"))},a.prototype.storeScore=function(){var t=n.util.ReadUserData(),e=t.worlds[this.currentWorld].levels[this.currentLevel-1],i=t.worlds[this.currentWorld].levels[this.currentLevel];i&&(i.state=n.util.LevelState.UNLOCKED),e.time>this.score.time&&(e.time=this.score.time),e.stars<this.score.stars&&(e.stars=this.score.stars);var s=this.score.getStarBonus()+this.score.getTimeBonus();e.score<s&&(e.score=s),e.state=n.util.LevelState.UNLOCKED,n.util.WriteUserData(t)},a.prototype.isLastLevel=function(){return 4===this.currentWorld&&10===this.currentLevel},a.prototype.isOutroScene=function(){return 0===this.currentLevel},a.prototype.completeLevel=function(){this.levelComplete.show(this.currentWorld+1,this.currentLevel,this.score.getStarBonus(),this.score.getTimeBonus(),this.score.stars),this.storeScore(),this.setCanPause(!1)},a.prototype.restartLevel=function(){var t=this;this.canShowIntro=!1,this.levelTransitionMgr.fadeOut(function(){t.levelXml?t.loadLevelFromXml():t.loadLevel(t.currentLevel)})},a.prototype.nextLevel=function(){var t=this;this.canShowIntro=!0,this.levelTransitionMgr.fadeOut(function(){t.levelXml?t.loadLevelFromXml():t.isLastLevel()?t.loadOutroScene():t.currentLevel<t.maxLevel?t.loadLevel(t.currentLevel+=1):(t.loadMainMenu(!0),t.levelTransitionMgr.fadeIn(),n.util.newDelayAction(n.util.ScheduleContext.ALL,function(){t.world.selectNextChapter(t.currentWorld+1)},.5))})},a.prototype.pause=function(){this.isPaused=!0,this.world.setTouchEnabled(!1)},a.prototype.setCanPause=function(t){this.canPause!=t&&(t?this.enableAutoPause():this.disableAutoPause()),this.canPause=t},a.prototype.enableAutoPause=function(){this.autoPauseInfo&&this.autoPauseInfo.element.addEventListener(this.autoPauseInfo.event,this.autoPauseInfo.listener)},a.prototype.disableAutoPause=function(){this.autoPauseInfo&&this.autoPauseInfo.element.removeEventListener(this.autoPauseInfo.event,this.autoPauseInfo.listener)},a.prototype.autoPause=function(){this.isPaused||!this.levelComplete||this.levelComplete.isVisible||(this.pause(),this.menu.show())},a.prototype.resume=function(){this.isPaused=!1,this.world.setTouchEnabled(!0)},a.prototype.update=function(t){var e=this.touchModule.getPoints(),i=Date.now(),s=this.isPaused?n.util.ScheduleContext.ALL&~n.util.ScheduleContext.LEVEL:n.util.ScheduleContext.ALL;n.util.scheduler.update(t,s),this.isStatsEnabled!==!0||this.areGraphsFrozen||(this.drawStatTotal=this.drawStatTotal+this.lastDrawTime,this.drawStatCounter++,this.updateStatTotal=this.updateStatTotal+this.lastUpdateTime,this.updateStatCounter++,this.spritesStatTotal=this.spritesStatTotal+this.drawCount,this.spritesStatCounter++,this.fpsStatCounter++,this.drawLine.append(Date.now(),this.lastDrawTime),this.updateLine.append(Date.now(),this.lastUpdateTime),this.touchLine.append(Date.now(),e.length),this.spritesLine.append(Date.now(),this.drawCount),Date.now()-this.statsLastDrawn>1e3&&(this.fpsLine.append(Date.now(),this.fpsStatCounter),this.statsLastDrawn=Date.now(),this.drawStatsValue.innerHTML=Math.floor(this.drawStatTotal/this.drawStatCounter),this.updateStatsValue.innerHTML=Math.floor(this.updateStatTotal/this.updateStatCounter),this.touchStatsValue.innerHTML=e.length,this.spritesStatsValue.innerHTML=Math.floor(this.spritesStatTotal/this.spritesStatCounter),this.fpsStatsValue.innerHTML=this.fpsStatCounter,this.drawStatTotal=0,this.drawStatCounter=0,this.updateStatTotal=0,this.updateStatCounter=0,this.spritesStatTotal=0,this.spritesStatCounter=0,this.fpsStatCounter=0)),this.fpsCounter++,this.drawCount=0,this.touchModule.update(),this.isPaused||(this.world.update(t),this.score.time+=t.delta),this.draw(t);var a=Date.now();this.lastUpdateTime=a-i},a.prototype.draw=function(t,e){var i=Date.now();this.isPaused||this.world.draw(t);var s=Date.now();this.lastDrawTime=s-i},a.prototype.startTouch=function(t){this.world&&this.world.startTouch(t)},a.prototype.moveTouch=function(t){this.world&&this.world.moveTouch(t)},a.prototype.endTouch=function(t){this.world&&this.world.endTouch(t)},n.elem.Game=a}(window,document,Box2D,SmoothieChart,cj),function(t){function e(t,e){var e=e||1.05;this.velX=(.5-Math.random())/1e3,this.velY=Math.random()/1e3,this.velO=0,this.posY=e,this.opacity=.5+.5*Math.random(),this.posX=Math.random(),this.scale=.7+1*Math.random(),this.img=t,this.isActive=!0,this.update=function(){this.posX-=this.velX,this.posY-=this.velY,this.opacity-=this.velO,this.isActive=this.scale>.025&&this.opacity>.025&&this.posY>-.05&&this.posX>-.05&&this.posX<1.025},this.draw=function(e){if(this.isActive){var i=e.canvas.width*this.posX,s=e.canvas.height*this.posY;e.save(),e.globalAlpha=this.opacity,e.translate(i,s),e.scale(this.scale,this.scale),e.drawImage(t,0,0),e.restore()}}}
function i(e){var i=this;this.$card=$("#card"),this.$cardcontent=$("#card-content"),this.$editor=$("#card-editor"),this.$dismiss=$("#card-editor-dismiss"),this.$ieMessage=$("#card-message-ie"),this.$customMessage=$("#card-message"),this.$toDiv=$("#card-to-text"),this.$fromDiv=$("#card-from-text"),this.$messageDiv=$("#card-message-text"),this.$toInput=$("#card-to-input"),this.$fromInput=$("#card-from-input"),this.$messageInput=$("#card-message-input"),this.localize(),this.particles=[],this.particleCount=200,this.$canvas=$("#card-canvas"),this.canvas=document.getElementById("card-canvas"),this.ctx=this.canvas.getContext("2d"),this.particleImg=new Image,this.particleImageLoaded=!1,this.evenodd=!0,this.isEditorMinimized=!1,$("#card-close").click(function(){i.hide()}),$("#card-play").click(function(){i.hide()}),$("#card-share").click(function(){i.updateEditorView(h.SOCIAL)}),$("#card-write").click(function(){i.updateEditorView(h.CUSTOMIZE)}),$("#card-customize-cancel").click(function(){i.updateEditorView(h.SOCIAL)}),$("#card-clipboard").click(function(){i.copyCardUrlToClipboard()}),$("#card-done-change").click(function(){i.updateEditorView(h.CUSTOMIZE)}),$("#card-customize-preview").click(function(){i.minimizeEditor()}),$("#card-editor-minimized").click(function(){i.restoreEditor()}),$("#card-customize-done").click(function(){t.util.logEvent("ValentineCard","Customize"),i.updateEditorView(h.SEND)}),$("#card-share-stumbleupon").bind("click",function(){i.share("Stumbleupon")}),$("#card-share-facebook").bind("click",function(){i.share("Facebook","Celebrate friendship with exclusive brand new levels in Contre Jour!")}),$("#card-share-twitter").bind("click",function(){i.share("Twitter","Celebrate Friendship with Contre Jour and @IE10! #html5 #valentine")}),this.$dismiss.click(function(){i.showMessageFromUrlData(),i.updateEditorView(h.HIDDEN)}),this.updateContentSize(),$(window).resize(function(){i.updateContentSize()}),this.$toInput.bind("propertychange keyup input paste",function(t){i.updateMessageTextFromInput(t)}),this.$fromInput.bind("propertychange keyup input paste",function(t){i.updateMessageTextFromInput(t)}),this.$messageInput.bind("propertychange keyup input paste",function(t){i.updateMessageTextFromInput(t)}),this.urlData=e}
function s(){var t=this;this.$panel=$("#shareCardPanel"),this.$content=$("#shareCardPanel-content"),this.$panel.click(function(){m||(m=new i("")),m.show(h.CUSTOMIZE,!1)});var e=setInterval(function(){t.$panel.hasClass("show")&&(clearInterval(e),t.showPanel())},1e3)}
t.USE_VALENTINE_SHARING=!1;var n=location.protocol+"//"+location.host+location.pathname,a="card",o="valentine",r="valentine",h={HIDDEN:"hidden",SOCIAL:"social",CUSTOMIZE:"customize",SEND:"send",getViewDivId:function(t){return"card-editor-"+t}};i.prototype.share=function(e,i){t.util.logShareEvent(e),"undfined"!=typeof meteor&&(i?window.open(meteor.sharing.href(e,{title:i}),"_blank","width=580,height=400,menubar=0"):window.open(meteor.sharing.href(e),"_blank","width=580,height=400,menubar=0"))},i.prototype.show=function(e,i){var s=this,e=e||h.HIDDEN;i?$("#card-close").addClass("play"):$("#card-close").removeClass("play"),t.ctrl.loader.startHibernation(),this.particleImageLoaded?(t.util.dispatcher.start(),t.util.dispatcher.register(s)):(this.particleImg.onload=function(){t.util.dispatcher.start(),t.util.dispatcher.register(s),s.particleImageLoaded=!0},this.particleImg.src="img/card-particle.png"),this.$cardcontent.fadeOut(0),this.$card.fadeIn(500),this.$cardcontent.delay(500).fadeIn(500),s.updateEditorView(e)},i.prototype.hide=function(){""!==location.hash&&(location.hash="");var e=this;t.ctrl.loader.stopHibernation(),setTimeout(function(){e.$card.fadeOut(),t.util.dispatcher.deregister(e)},500)},i.prototype.minimizeEditor=function(){this.isEditorMinimized=!0,$("#card-editor").removeClass("restored"),$("#card-editor").addClass("minimized")},i.prototype.restoreEditor=function(){this.isEditorMinimized=!1,$("#card-editor").removeClass("minimized"),$("#card-editor").addClass("restored"),setTimeout(function(){$("#card-editor").removeClass("restored")},400)},i.prototype.updateContentSize=function(){var t=this.$card.width()/this.$card.height();this.$card.removeClass("portrait"),this.$card.removeClass("landscape"),this.$card.removeClass("square");var e=1366,i=1366;.8>t?(this.$card.addClass("portrait"),e=768):t>1.2?(this.$card.addClass("landscape"),i=768):this.$card.addClass("square");var s=Math.min(this.$card.width()/e,this.$card.height()/i),n=(this.$card.width()-e)/2,a=(this.$card.height()-i)/2,o="translate("+n+"px, "+a+"px) scale("+s+","+s+")";this.$cardcontent.css({transform:o})},i.prototype.update=function(){if(this.evenodd=!this.evenodd,!this.evenodd){if(0==this.particles.length)
for(;this.particles.length<this.particleCount;)this.particles.push(new e(this.particleImg,.9*Math.random()));else if(this.particles.length>2*this.particleCount)
for(var t=this.particles.length-1;t>=0;t--)this.particles[t].isActive||this.particles.remove(t);this.ctx.canvas.width=this.$canvas.width(),this.ctx.canvas.height=this.$canvas.height(),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height);for(var i=0,t=0;t<this.particles.length;t++)this.particles[t].update(),this.particles[t].draw(this.ctx),this.particles[t].isActive&&i++;for(var t=i;t<this.particleCount;t++)this.particles.push(new e(this.particleImg,1))}},i.prototype.updateEditorView=function(t){var e=this;if(!this.isEditorMinimized){var i=this.currentEditorView;if(i!==t)
if(this.currentEditorView=t,t==h.HIDDEN)this.$ieMessage.fadeOut(0),this.$customMessage.fadeOut(0),this.showMessageFromUrlData(500),this.$editor.animate({left:-1*this.$editor.width()},500,"easeInOutQuart",function(){e.$editor.hide(),e.$dismiss.hide()});else{var s=400;void 0!==i&&i!=h.HIDDEN||($(".card-editor-view").fadeOut(0),this.$dismiss.show(),this.$editor.show(),this.$editor.animate({left:40},500,"easeInOutQuart"),s=0);var n=$("#"+h.getViewDivId(i));n.fadeOut(s);var a=$("#"+h.getViewDivId(t));if(a.fadeIn(s),t==h.SOCIAL)this.$ieMessage.fadeIn(500),this.$customMessage.fadeOut(500);else if(t==h.CUSTOMIZE)i!=h.SEND&&(this.$toInput.val(""),this.$fromInput.val(""),this.$messageInput.val(""),this.updateMessageTextFromInput()),this.$ieMessage.fadeOut(500),this.$customMessage.fadeIn(500);else if(t==h.SEND){var o=this.createCardUrl();$("#card-url").val(o),$("#card-url").select(),-1!==BrowserDetect.OS.indexOf("Mac")&&$("#card-editor-send").addClass("mac"),-1!==BrowserDetect.browser.indexOf("Explorer")&&$("#card-editor-send").addClass("ie"),this.$ieMessage.fadeOut(500),this.$customMessage.fadeIn(500)}}}},i.prototype.updateMessageTextFromInput=function(){var t=this.$toInput.val()||this.$messageInput.val()||this.$fromInput.val();this.updateMessageText(this.$toInput.val()?this.$toInput.val():this.$toInput.attr("placeholder"),this.$messageInput.val()?this.$messageInput.val():this.$messageInput.attr("placeholder"),this.$fromInput.val()?this.$fromInput.val():this.$fromInput.attr("placeholder"),t),this.$toInput.val()&&this.$messageInput.val()&&this.$fromInput.val()?$("#card-customize-done").removeClass("disabled"):$("#card-customize-done").addClass("disabled")},i.prototype.updateMessageText=function(t,e,i,s){s&&(location.hash=this.createCardHash(t,e,i)),this.$toDiv.text(t+","),this.$messageDiv.text(e),this.$fromDiv.text(i);var n=1.25,a=180-e.length*n;$("#card-message").css({"font-size":a})},i.prototype.copyCardUrlToClipboard=function(){window.clipboardData&&window.clipboardData.setData("Text",$("#card-url").val())},i.prototype.createCardUrl=function(){var t=this.createCardHash(this.$toInput.val(),this.$messageInput.val(),this.$fromInput.val());return n+"#"+t},i.prototype.createCardHash=function(t,e,i){var s={};s.t=t,s.m=e,s.f=i;var n=JSON.stringify(s),a=Base64.encode(n),o=encodeURIComponent(a);return o},i.prototype.showMessageFromUrlData=function(t){var e=null,t=t||0,i=null;if(this.urlData)try{i=Base64.decode(decodeURIComponent(this.urlData)),i&&(e=JSON.parse(i))}catch(s){e=null}
e?(this.hasCustomMessage=!0,this.updateMessageText(e.t,e.m,e.f),this.$ieMessage.fadeOut(t),this.$customMessage.fadeIn(t)):(this.$ieMessage.fadeIn(t),this.$customMessage.fadeOut(t))},i.prototype.localize=function(){t.util.localizedStringLoader.isEnglish()||t.util.localizedStringLoader.load(function(){var e=t.util.localizedStringLoader.getLanguagePrefix();e=null!=e?e.toUpperCase():"EN",$(".card-sprite").css("background-image","url(img/card-sprite-"+e+".png)"),$("#card-message-ie").css("background-image","url(img/card-msg-"+e+".svg)"),$("#card-editor-social h4").html(t.util.localizedStringLoader.getLocalizedString("CARD_CELEBRATE_FRIENDSHIP")),$("#card-editor-social p").html(t.util.localizedStringLoader.getLocalizedString("CARD_SEND_MESSAGE")),$("#card-write").html(t.util.localizedStringLoader.getLocalizedString("CARD_WRITE_A_NOTE")),$("#card-editor-social h5").html(t.util.localizedStringLoader.getLocalizedString("CARD_OR_SHARE_THIS")),$("#card-to-label").text(t.util.localizedStringLoader.getLocalizedString("CARD_TO")),$("#card-to-input").attr({placeholder:t.util.localizedStringLoader.getLocalizedString("CARD_TO_PROMPT")}),$("#card-message-label").text(t.util.localizedStringLoader.getLocalizedString("CARD_MESSAGE")),$("#card-message-input").attr({placeholder:t.util.localizedStringLoader.getLocalizedString("CARD_MESSAGE_PROMPT")}),$("#card-from-label").text(t.util.localizedStringLoader.getLocalizedString("CARD_SIGNED")),$("#card-from-input").attr({placeholder:t.util.localizedStringLoader.getLocalizedString("CARD_LOVE_ME")}),$("#card-editor-send h4").html(t.util.localizedStringLoader.getLocalizedString("CARD_WAY_TO_GO")),$("#card-copy-prompt").html(t.util.localizedStringLoader.getLocalizedString("CARD_COPY_LINK")),$("#card-clipboard-alt").html(t.util.localizedStringLoader.getLocalizedString("CARD_USE_CTRL")),$("#card-not-right").html(t.util.localizedStringLoader.getLocalizedString("CARD_NOT_QUITE_RIGHT")),$("#card-done-change").html(t.util.localizedStringLoader.getLocalizedString("CARD_CHANGE_SOMETHING"))},!1)},s.prototype.showPanel=function(){var t=parseInt(this.$content.css("right"),10);this.$content.css({right:t-this.$panel.width()+"px",display:"block",opacity:0}),this.$panel.show(),this.$content.delay(1e3).animate({right:t+"px",opacity:1},600,"easeOutExpo")};var l="NOTFOUND",d=t.util.getQueryString(a,l),c=t.util.getQueryString(o,l),u=location.hash,m=null,p=null,g=!1;if(u&&u.indexOf("#")>=0&&(u=u.split("#")[1]),u&&(g=!0,u==r?p=null:"fbid="==u.substr(0,5)?(g=!1,p=null):p=u),!g&&(d!=l||c!=l)){g=!0;var p=d!=l?d:c}
g&&(t.util.logEvent("ValentineCard","View"),m=new i(p),m.show(h.HIDDEN,!0)),t.USE_VALENTINE_SHARING&&new s}(cj),function(t,e,i){function s(){this.expanded=!1,i.USE_VALENTINE_SHARING&&$("#sharePanel").hide()}
s.prototype.init=function(){if(!i.offline&&!i.USE_VALENTINE_SHARING){var e=this;this.canHover=!0,this.hover=!1,this.lastClick=Date.now(),this.shareDiv=$("#sharePanel"),this.shareDivHit=$("#sharePanelHitArea"),this.shareText=$("#shareContentText"),this.shareLinks=$("#shareLinks"),this.shareRight=$("#shareRight"),this.shareLeft=$("#shareLeft"),this.shareMiddle=$("#shareMiddle"),this.touch=!1,this.isAnimating=!1;var s=!1;t.navigator.msMaxTouchPoints&&t.navigator.msMaxTouchPoints>0&&(s=!0),(Modernizr.touch||s)&&(this.touch=!0,this.shareDivHit=this.shareDiv),$("#sharePanelOverlay").bind("click",function(){e.toggleExpanded()}),$("#sharePanel").bind("click",function(){e.toggleExpanded()}),this.shareDivHit.bind("click",function(){e.lastClick=Date.now(),e.expanded||e.toggleExpanded()}),this.shareStumbleupon=$("#shareStumbleupon"),this.shareFacebook=$("#shareFacebook"),this.shareTwitter=$("#shareTwitter"),this.shareStumbleupon.bind("click",function(){e.share("Stumbleupon"),e.handleTouch()}),this.shareFacebook.bind("click",function(){e.share("Facebook"),e.handleTouch()}),this.shareTwitter.bind("click",function(){e.share("Twitter","TWITTER_SHARE_MESSAGE"),e.handleTouch()})}},s.prototype.share=function(e,s){i.util.logShareEvent(e),"undefined"!=typeof meteor&&(s?t.open(meteor.sharing.href(e,{title:i.util.localizedStringLoader.getLocalizedString(s)}),"_blank","width=580,height=400,menubar=0"):t.open(meteor.sharing.href(e),"_blank","width=580,height=400,menubar=0"))},s.prototype.handleTouch=function(){this.expanded&&Date.now()-this.lastClick>500&&this.toggleExpanded()},s.prototype.toggleExpanded=function(){var t=this;this.isAnimating||(t.lastClick=Date.now(),this.isAnimating=!0,t.expanded?(t.expanded=!1,$("#sharePanel").removeClass("expanded"),$("#sharePanelOverlay").removeClass("expanded"),$("#shareLinks").animate({right:"-115px"},{duration:500,easing:"easeInOutExpo",complete:function(){t.isAnimating=!1}})):(t.expanded=!0,$("#sharePanel").addClass("expanded"),$("#sharePanelOverlay").addClass("expanded"),$("#shareLinks").animate({right:"-30px"},{duration:500,easing:"easeInOutExpo",complete:function(){t.isAnimating=!1}})))},i.ctrl.sharePanel=new s}(window,document,cj),function(t,e,i,s){function n(){var t={tracks:i.audio.mp3?"mp3":i.audio.ogg?"ogg":"",effects:i.audio.mp3?"mp3":i.audio.wav?"wav":""};s.util.localizedStringLoader.load(null,!1),s.util.assets.initializeGameImages(),s.util.elementXmlLoader.makeConfigFileRequests(),t.tracks&&s.util.assets.initializeGameSounds(!0,t.tracks),t.effects&&s.util.assets.initializeGameSounds(!1,t.effects),s.util.assets.addGameImageAssetProgressListener(a),s.util.assets.addGameImageAssetCompletionListener(o),s.util.assets.loadGameAssets()}
function a(t){s.ctrl.loader&&(s.ctrl.loader.loaderPercentTarget=Math.round(t.completedCount/t.totalCount*100))}
function o(){if(s.ctrl.game=new s.elem.Game,s.ctrl.loader){$("#ieLogo").on("click",function(){s.util.logEvent("http://view.atdmt.com/action/SMG_MRTINX_SITE_CJ_GamingReimagined"),s.util.logMeteorEvent("hp_6_gamingie")});var e=$("#cjLogo").on("click",function(){t.open("http://mokusgames.com/","_blank")}),i="cjLogoText";switch(s.util.localizedStringLoader.currentLanguage){case "russian":i="cjLogoTextSmall";break;case "portuguese":i="cjLogoTextMedium"}
$("<div/>").addClass(i).html(s.util.localizedStringLoader.getLocalizedString("GET_MORE")).appendTo(e),s.ctrl.sharePanel.init(),s.ctrl.loader.onLoadComplete()}}
function r(){var t=s.util.ReadUserData(),e=t.settings,i=e?e.debug:!1;(i&&s.PRODUCTION||!i&&!s.PRODUCTION)&&(s.util.ClearUserData(),t=s.util.ReadUserData()),"Explorer"===BrowserDetect.browser&&(s.util.ModifyClass(".letterBox","width","961px"),s.util.ModifyClass(".letterBox","height","76px"),s.util.ModifyClass(".gameContainer","width","961px"),s.util.ModifyClass(".gameContainer","height","641px")),s.util.WriteUserData(t),s.ctrl.loader.ready?n():s.ctrl.loader.preloader.addCompletionListener(n),s.util.updateTiles()}
var h=s.util.getQueryString("debug","false");("true"===h||t.location.href.indexOf("msstore.contrejour.ie")>-1)&&(s.PRODUCTION=!1),e.getElementById("gameContainer"),r()}(window,document,Modernizr,cj)